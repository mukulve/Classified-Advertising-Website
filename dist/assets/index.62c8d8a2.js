(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))r(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const y of f.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&r(y)}).observe(document,{childList:!0,subtree:!0});function t(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerpolicy&&(f.referrerPolicy=u.referrerpolicy),u.crossorigin==="use-credentials"?f.credentials="include":u.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(u){if(u.ep)return;u.ep=!0;const f=t(u);fetch(u.href,f)}})();const gP="modulepreload",_P=function(i){return"/"+i},BT={},Yo=function(e,t,r){if(!t||t.length===0)return e();const u=document.getElementsByTagName("link");return Promise.all(t.map(f=>{if(f=_P(f),f in BT)return;BT[f]=!0;const y=f.endsWith(".css"),l=y?'[rel="stylesheet"]':"";if(!!r)for(let R=u.length-1;R>=0;R--){const z=u[R];if(z.href===f&&(!y||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${l}`))return;const A=document.createElement("link");if(A.rel=y?"stylesheet":gP,y||(A.as="script",A.crossOrigin=""),A.href=f,document.head.appendChild(A),y)return new Promise((R,z)=>{A.addEventListener("load",R),A.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${f}`)))})})).then(()=>e())};function pn(){}function Yr(i,e){for(const t in e)i[t]=e[t];return i}function QI(i){return i()}function FT(){return Object.create(null)}function Pr(i){i.forEach(QI)}function mx(i){return typeof i=="function"}function ia(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}let Fg;function mh(i,e){return Fg||(Fg=document.createElement("a")),Fg.href=e,i===Fg.href}function yP(i){return Object.keys(i).length===0}function gx(i,...e){if(i==null)return pn;const t=i.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function gh(i){let e;return gx(i,t=>e=t)(),e}function Hr(i,e,t){i.$$.on_destroy.push(gx(e,t))}function dl(i,e,t,r){if(i){const u=JI(i,e,t,r);return i[0](u)}}function JI(i,e,t,r){return i[1]&&r?Yr(t.ctx.slice(),i[1](r(e))):t.ctx}function fl(i,e,t,r){if(i[2]&&r){const u=i[2](r(t));if(e.dirty===void 0)return u;if(typeof u=="object"){const f=[],y=Math.max(e.dirty.length,u.length);for(let l=0;l<y;l+=1)f[l]=e.dirty[l]|u[l];return f}return e.dirty|u}return e.dirty}function pl(i,e,t,r,u,f){if(u){const y=JI(e,t,r,f);i.p(y,u)}}function ml(i){if(i.ctx.length>32){const e=[],t=i.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function _h(i){const e={};for(const t in i)t[0]!=="$"&&(e[t]=i[t]);return e}function h_(i,e){const t={};e=new Set(e);for(const r in i)!e.has(r)&&r[0]!=="$"&&(t[r]=i[r]);return t}function Pe(i,e){i.appendChild(e)}function yt(i,e,t){i.insertBefore(e,t||null)}function mt(i){i.parentNode&&i.parentNode.removeChild(i)}function e2(i,e){for(let t=0;t<i.length;t+=1)i[t]&&i[t].d(e)}function tt(i){return document.createElement(i)}function sl(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function un(i){return document.createTextNode(i)}function Dt(){return un(" ")}function gl(){return un("")}function Gn(i,e,t,r){return i.addEventListener(e,t,r),()=>i.removeEventListener(e,t,r)}function t2(i){return function(e){return e.preventDefault(),i.call(this,e)}}function st(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}function yo(i,e){const t=Object.getOwnPropertyDescriptors(i.__proto__);for(const r in e)e[r]==null?i.removeAttribute(r):r==="style"?i.style.cssText=e[r]:r==="__value"?i.value=i[r]=e[r]:t[r]&&t[r].set?i[r]=e[r]:st(i,r,e[r])}function vP(i){return Array.from(i.childNodes)}function Fi(i,e){e=""+e,i.wholeText!==e&&(i.data=e)}function d_(i,e){i.value=e==null?"":e}function f_(i,e,t,r){t===null?i.style.removeProperty(e):i.style.setProperty(e,t,r?"important":"")}function xP(i,e,{bubbles:t=!1,cancelable:r=!1}={}){const u=document.createEvent("CustomEvent");return u.initCustomEvent(i,t,r,e),u}function p_(i,e){return new i(e)}let Qf;function Gf(i){Qf=i}function bp(){if(!Qf)throw new Error("Function called outside component initialization");return Qf}function wp(i){bp().$$.on_mount.push(i)}function bP(i){bp().$$.on_destroy.push(i)}function n2(){const i=bp();return(e,t,{cancelable:r=!1}={})=>{const u=i.$$.callbacks[e];if(u){const f=xP(e,t,{cancelable:r});return u.slice().forEach(y=>{y.call(i,f)}),!f.defaultPrevented}return!0}}function $f(i,e){return bp().$$.context.set(i,e),e}function Qo(i){return bp().$$.context.get(i)}function m_(i,e){const t=i.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const Lf=[],NT=[],Kg=[],UT=[],i2=Promise.resolve();let S0=!1;function r2(){S0||(S0=!0,i2.then(s2))}function wP(){return r2(),i2}function yh(i){Kg.push(i)}const Jv=new Set;let Ng=0;function s2(){const i=Qf;do{for(;Ng<Lf.length;){const e=Lf[Ng];Ng++,Gf(e),TP(e.$$)}for(Gf(null),Lf.length=0,Ng=0;NT.length;)NT.pop()();for(let e=0;e<Kg.length;e+=1){const t=Kg[e];Jv.has(t)||(Jv.add(t),t())}Kg.length=0}while(Lf.length);for(;UT.length;)UT.pop()();S0=!1,Jv.clear(),Gf(i)}function TP(i){if(i.fragment!==null){i.update(),Pr(i.before_update);const e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(yh)}}const Yg=new Set;let gc;function gr(){gc={r:0,c:[],p:gc}}function _r(){gc.r||Pr(gc.c),gc=gc.p}function _t(i,e){i&&i.i&&(Yg.delete(i),i.i(e))}function wt(i,e,t,r){if(i&&i.o){if(Yg.has(i))return;Yg.add(i),gc.c.push(()=>{Yg.delete(i),r&&(t&&i.d(1),r())}),i.o(e)}else r&&r()}function Ic(i,e){const t={},r={},u={$$scope:1};let f=i.length;for(;f--;){const y=i[f],l=e[f];if(l){for(const T in y)T in l||(r[T]=1);for(const T in l)u[T]||(t[T]=l[T],u[T]=1);i[f]=l}else for(const T in y)u[T]=1}for(const y in r)y in t||(t[y]=void 0);return t}function A0(i){return typeof i=="object"&&i!==null?i:{}}function bn(i){i&&i.c()}function gn(i,e,t,r){const{fragment:u,after_update:f}=i.$$;u&&u.m(e,t),r||yh(()=>{const y=i.$$.on_mount.map(QI).filter(mx);i.$$.on_destroy?i.$$.on_destroy.push(...y):Pr(y),i.$$.on_mount=[]}),f.forEach(yh)}function _n(i,e){const t=i.$$;t.fragment!==null&&(Pr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function EP(i,e){i.$$.dirty[0]===-1&&(Lf.push(i),r2(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function _l(i,e,t,r,u,f,y,l=[-1]){const T=Qf;Gf(i);const A=i.$$={fragment:null,ctx:[],props:f,update:pn,not_equal:u,bound:FT(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(T?T.$$.context:[])),callbacks:FT(),dirty:l,skip_bound:!1,root:e.target||T.$$.root};y&&y(A.root);let R=!1;if(A.ctx=t?t(i,e.props||{},(z,j,...ee)=>{const se=ee.length?ee[0]:j;return A.ctx&&u(A.ctx[z],A.ctx[z]=se)&&(!A.skip_bound&&A.bound[z]&&A.bound[z](se),R&&EP(i,z)),j}):[],A.update(),R=!0,Pr(A.before_update),A.fragment=r?r(A.ctx):!1,e.target){if(e.hydrate){const z=vP(e.target);A.fragment&&A.fragment.l(z),z.forEach(mt)}else A.fragment&&A.fragment.c();e.intro&&_t(i.$$.fragment),gn(i,e.target,e.anchor,e.customElement),s2()}Gf(T)}class yl{$destroy(){_n(this,1),this.$destroy=pn}$on(e,t){if(!mx(t))return pn;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const u=r.indexOf(t);u!==-1&&r.splice(u,1)}}$set(e){this.$$set&&!yP(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const VT=i=>typeof i>"u",o2=i=>typeof i=="function",a2=i=>typeof i=="number";function IP(i){return!i.defaultPrevented&&i.button===0&&!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function l2(){let i=0;return()=>i++}function SP(){return Math.random().toString(36).substring(2)}const ol=typeof window>"u";function c2(i,e,t){return i.addEventListener(e,t),()=>i.removeEventListener(e,t)}const C0=(i,e)=>i?{}:{style:e},lh=i=>({"aria-hidden":"true",...C0(i,"display:none;")}),nh=[];function AP(i,e){return{subscribe:js(i,e).subscribe}}function js(i,e=pn){let t;const r=new Set;function u(l){if(ia(i,l)&&(i=l,t)){const T=!nh.length;for(const A of r)A[1](),nh.push(A,i);if(T){for(let A=0;A<nh.length;A+=2)nh[A][0](nh[A+1]);nh.length=0}}}function f(l){u(l(i))}function y(l,T=pn){const A=[l,T];return r.add(A),r.size===1&&(t=e(u)||pn),l(i),()=>{r.delete(A),r.size===0&&(t(),t=null)}}return{set:u,update:f,subscribe:y}}function CP(i,e,t){const r=!Array.isArray(i),u=r?[i]:i,f=e.length<2;return AP(t,y=>{let l=!1;const T=[];let A=0,R=pn;const z=()=>{if(A)return;R();const ee=e(r?T[0]:T,y);f?y(ee):R=mx(ee)?ee:pn},j=u.map((ee,se)=>gx(ee,be=>{T[se]=be,A&=~(1<<se),l&&z()},()=>{A|=1<<se}));return l=!0,z(),function(){Pr(j),R()}})}const Tp=i=>`@@svnav-ctx__${i}`,k0=Tp("LOCATION"),vh=Tp("ROUTER"),u2=Tp("ROUTE"),kP=Tp("ROUTE_PARAMS"),MP=Tp("FOCUS_ELEM"),h2=/^:(.+)/,zf=(i,e,t)=>i.substr(e,t),M0=(i,e)=>zf(i,0,e.length)===e,DP=i=>i==="",PP=i=>h2.test(i),d2=i=>i[0]==="*",RP=i=>i.replace(/\*.*$/,""),f2=i=>i.replace(/(^\/+|\/+$)/g,"");function Eo(i,e=!1){const t=f2(i).split("/");return e?t.filter(Boolean):t}const e0=(i,e)=>i+(e?`?${e}`:""),_x=i=>`/${f2(i)}`;function Ep(...i){const e=r=>Eo(r,!0).join("/"),t=i.map(e).join("/");return _x(t)}const yx=1,G_=2,Sc=3,LP=4,p2=5,zP=6,m2=7,OP=8,BP=9,g2=10,_2=11,FP={[yx]:"Link",[G_]:"Route",[Sc]:"Router",[LP]:"useFocus",[p2]:"useLocation",[zP]:"useMatch",[m2]:"useNavigate",[OP]:"useParams",[BP]:"useResolvable",[g2]:"useResolve",[_2]:"navigate"},vx=i=>FP[i];function NP(i,e){let t;return i===G_?t=e.path?`path="${e.path}"`:"default":i===yx?t=`to="${e.to}"`:i===Sc&&(t=`basepath="${e.basepath||""}"`),`<${vx(i)} ${t||""} />`}function UP(i,e,t,r){const u=t&&NP(r||i,t),f=u?`

Occurred in: ${u}`:"",y=vx(i),l=o2(e)?e(y):e;return`<${y}> ${l}${f}`}const y2=i=>(...e)=>i(UP(...e)),v2=y2(i=>{throw new Error(i)}),g_=y2(console.warn),jT=4,VP=3,jP=2,GP=1,$P=1;function qP(i,e){const t=i.default?0:Eo(i.fullPath).reduce((r,u)=>{let f=r;return f+=jT,DP(u)?f+=$P:PP(u)?f+=jP:d2(u)?f-=jT+GP:f+=VP,f},0);return{route:i,score:t,index:e}}function WP(i){return i.map(qP).sort((e,t)=>e.score<t.score?1:e.score>t.score?-1:e.index-t.index)}function x2(i,e){let t,r;const[u]=e.split("?"),f=Eo(u),y=f[0]==="",l=WP(i);for(let T=0,A=l.length;T<A;T++){const{route:R}=l[T];let z=!1;const j={},ee=Ge=>({...R,params:j,uri:Ge});if(R.default){r=ee(e);continue}const se=Eo(R.fullPath),be=Math.max(f.length,se.length);let Re=0;for(;Re<be;Re++){const Ge=se[Re],it=f[Re];if(!VT(Ge)&&d2(Ge)){const Ue=Ge==="*"?"*":Ge.slice(1);j[Ue]=f.slice(Re).map(decodeURIComponent).join("/");break}if(VT(it)){z=!0;break}const dt=h2.exec(Ge);if(dt&&!y){const Ue=decodeURIComponent(it);j[dt[1]]=Ue}else if(Ge!==it){z=!0;break}}if(!z){t=ee(Ep(...f.slice(0,Re)));break}}return t||r||null}function b2(i,e){return x2([i],e)}function ZP(i,e){if(M0(i,"/"))return i;const[t,r]=i.split("?"),[u]=e.split("?"),f=Eo(t),y=Eo(u);if(f[0]==="")return e0(u,r);if(!M0(f[0],".")){const A=y.concat(f).join("/");return e0((u==="/"?"":"/")+A,r)}const l=y.concat(f),T=[];return l.forEach(A=>{A===".."?T.pop():A!=="."&&T.push(A)}),e0(`/${T.join("/")}`,r)}function GT(i,e){const{pathname:t,hash:r="",search:u="",state:f}=i,y=Eo(e,!0),l=Eo(t,!0);for(;y.length;)y[0]!==l[0]&&v2(Sc,`Invalid state: All locations must begin with the basepath "${e}", found "${t}"`),y.shift(),l.shift();return{pathname:Ep(...l),hash:r,search:u,state:f}}const $T=i=>i.length===1?"":i,xx=i=>{const e=i.indexOf("?"),t=i.indexOf("#"),r=e!==-1,u=t!==-1,f=u?$T(zf(i,t)):"",y=u?zf(i,0,t):i,l=r?$T(zf(y,e)):"";return{pathname:(r?zf(y,0,e):y)||"/",search:l,hash:f}},HP=i=>{const{pathname:e,search:t,hash:r}=i;return e+t+r};function XP(i,e,t){return Ep(t,ZP(i,e))}function KP(i,e){const t=_x(RP(i)),r=Eo(t,!0),u=Eo(e,!0).slice(0,r.length),f=b2({fullPath:t},Ep(...u));return f&&f.uri}const t0="POP",YP="PUSH",QP="REPLACE";function n0(i){return{...i.location,pathname:encodeURI(decodeURI(i.location.pathname)),state:i.history.state,_key:i.history.state&&i.history.state._key||"initial"}}function JP(i){let e=[],t=n0(i),r=t0;const u=(f=e)=>f.forEach(y=>y({location:t,action:r}));return{get location(){return t},listen(f){e.push(f);const y=()=>{t=n0(i),r=t0,u([f])};u([f]);const l=c2(i,"popstate",y);return()=>{l(),e=e.filter(T=>T!==f)}},navigate(f,y){const{state:l={},replace:T=!1}=y||{};if(r=T?QP:YP,a2(f))y&&g_(_2,"Navigation options (state or replace) are not supported, when passing a number as the first argument to navigate. They are ignored."),r=t0,i.history.go(f);else{const A={...l,_key:SP()};try{i.history[T?"replaceState":"pushState"](A,"",f)}catch{i.location[T?"replace":"assign"](f)}}t=n0(i),u()}}}function i0(i,e){return{...xx(e),state:i}}function eR(i="/"){let e=0,t=[i0(null,i)];return{get entries(){return t},get location(){return t[e]},addEventListener(){},removeEventListener(){},history:{get state(){return t[e].state},pushState(r,u,f){e++,t=t.slice(0,e),t.push(i0(r,f))},replaceState(r,u,f){t[e]=i0(r,f)},go(r){const u=e+r;u<0||u>t.length-1||(e=u)}}}}const tR=!!(!ol&&window.document&&window.document.createElement),nR=!ol&&window.location.origin==="null",w2=JP(tR&&!nR?window:eR()),{navigate:iR}=w2;let Wo=null,T2=!0;function rR(i,e){const t=document.querySelectorAll("[data-svnav-router]");for(let r=0;r<t.length;r++){const u=t[r],f=Number(u.dataset.svnavRouter);if(f===i)return!0;if(f===e)return!1}return!1}function sR(i){(!Wo||i.level>Wo.level||i.level===Wo.level&&rR(i.routerId,Wo.routerId))&&(Wo=i)}function oR(){Wo=null}function aR(){T2=!1}function qT(i){if(!i)return!1;const e="tabindex";try{if(!i.hasAttribute(e)){i.setAttribute(e,"-1");let t;t=c2(i,"blur",()=>{i.removeAttribute(e),t()})}return i.focus(),document.activeElement===i}catch{return!1}}function lR(i,e){return Number(i.dataset.svnavRouteEnd)===e}function cR(i){return/^H[1-6]$/i.test(i.tagName)}function WT(i,e=document){return e.querySelector(i)}function uR(i){let t=WT(`[data-svnav-route-start="${i}"]`).nextElementSibling;for(;!lR(t,i);){if(cR(t))return t;const r=WT("h1,h2,h3,h4,h5,h6",t);if(r)return r;t=t.nextElementSibling}return null}function hR(i){Promise.resolve(gh(i.focusElement)).then(e=>{const t=e||uR(i.id);t||g_(Sc,`Could not find an element to focus. You should always render a header for accessibility reasons, or set a custom focus element via the "useFocus" hook. If you don't want this Route or Router to manage focus, pass "primary={false}" to it.`,i,G_),!qT(t)&&qT(document.documentElement)})}const dR=(i,e,t)=>(r,u)=>wP().then(()=>{if(!Wo||T2){aR();return}if(r&&hR(Wo.route),i.announcements&&u){const{path:f,fullPath:y,meta:l,params:T,uri:A}=Wo.route,R=i.createAnnouncement({path:f,fullPath:y,meta:l,params:T,uri:A},gh(t));Promise.resolve(R).then(z=>{e.set(z)})}oR()}),ZT="position:fixed;top:-1px;left:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;";function fR(i){let e,t,r=[{role:"status"},{"aria-atomic":"true"},{"aria-live":"polite"},{"data-svnav-announcer":""},C0(i[6],ZT)],u={};for(let f=0;f<r.length;f+=1)u=Yr(u,r[f]);return{c(){e=tt("div"),t=un(i[0]),yo(e,u)},m(f,y){yt(f,e,y),Pe(e,t)},p(f,y){y[0]&1&&Fi(t,f[0]),yo(e,u=Ic(r,[{role:"status"},{"aria-atomic":"true"},{"aria-live":"polite"},{"data-svnav-announcer":""},C0(f[6],ZT)]))},d(f){f&&mt(e)}}}function pR(i){let e,t,r,u,f,y=[lh(i[6]),{"data-svnav-router":i[3]}],l={};for(let z=0;z<y.length;z+=1)l=Yr(l,y[z]);const T=i[22].default,A=dl(T,i,i[21],null);let R=i[2]&&i[4]&&i[1].announcements&&fR(i);return{c(){e=tt("div"),t=Dt(),A&&A.c(),r=Dt(),R&&R.c(),u=gl(),yo(e,l)},m(z,j){yt(z,e,j),yt(z,t,j),A&&A.m(z,j),yt(z,r,j),R&&R.m(z,j),yt(z,u,j),f=!0},p(z,j){yo(e,l=Ic(y,[lh(z[6]),{"data-svnav-router":z[3]}])),A&&A.p&&(!f||j[0]&2097152)&&pl(A,T,z,z[21],f?fl(T,z[21],j,null):ml(z[21]),null),z[2]&&z[4]&&z[1].announcements&&R.p(z,j)},i(z){f||(_t(A,z),f=!0)},o(z){wt(A,z),f=!1},d(z){z&&mt(e),z&&mt(t),A&&A.d(z),z&&mt(r),R&&R.d(z),z&&mt(u)}}}const mR=l2(),HT="/";function gR(i,e,t){let r,u,f,y,l,{$$slots:T={},$$scope:A}=e,{basepath:R=HT}=e,{url:z=null}=e,{history:j=w2}=e,{primary:ee=!0}=e,{a11y:se={}}=e,{disableInlineStyles:be=!1}=e;const Re={createAnnouncement:It=>`Navigated to ${It.uri}`,announcements:!0,...se},Ge=R,it=_x(R),dt=Qo(k0),Ue=Qo(vh),ge=!dt,Ke=mR(),He=ee&&!(Ue&&!Ue.manageFocus),en=js("");Hr(i,en,It=>t(0,l=It));const vt=Ue?Ue.disableInlineStyles:be,Ft=js([]);Hr(i,Ft,It=>t(20,y=It));const Lt=js(null);Hr(i,Lt,It=>t(18,u=It));let kt=!1;const Qt=ge?0:Ue.level+1,Xe=ge?js((()=>GT(ol?xx(z):j.location,it))()):dt;Hr(i,Xe,It=>t(17,r=It));const an=js(r);Hr(i,an,It=>t(19,f=It));const li=dR(Re,en,Xe),ni=It=>ri=>ri.filter(Tn=>Tn.id!==It);function ii(It){if(ol){if(kt)return;const ri=b2(It,r.pathname);if(ri)return kt=!0,ri}else Ft.update(ri=>{const Tn=ni(It.id)(ri);return Tn.push(It),Tn})}function rn(It){Ft.update(ni(It))}return!ge&&R!==HT&&g_(Sc,'Only top-level Routers can have a "basepath" prop. It is ignored.',{basepath:R}),ge&&(wp(()=>j.listen(ri=>{const Tn=GT(ri.location,it);an.set(r),Xe.set(Tn)})),$f(k0,Xe)),$f(vh,{activeRoute:Lt,registerRoute:ii,unregisterRoute:rn,manageFocus:He,level:Qt,id:Ke,history:ge?j:Ue.history,basepath:ge?it:Ue.basepath,disableInlineStyles:vt}),i.$$set=It=>{"basepath"in It&&t(11,R=It.basepath),"url"in It&&t(12,z=It.url),"history"in It&&t(13,j=It.history),"primary"in It&&t(14,ee=It.primary),"a11y"in It&&t(15,se=It.a11y),"disableInlineStyles"in It&&t(16,be=It.disableInlineStyles),"$$scope"in It&&t(21,A=It.$$scope)},i.$$.update=()=>{if(i.$$.dirty[0]&2048&&R!==Ge&&g_(Sc,'You cannot change the "basepath" prop. It is ignored.'),i.$$.dirty[0]&1179648){const It=x2(y,r.pathname);Lt.set(It)}if(i.$$.dirty[0]&655360&&ge){const It=!!r.hash,ri=!It&&He,Tn=!It||r.pathname!==f.pathname;li(ri,Tn)}i.$$.dirty[0]&262144&&He&&u&&u.primary&&sR({level:Qt,routerId:Ke,route:u})},[l,Re,ge,Ke,He,en,vt,Ft,Lt,Xe,an,R,z,j,ee,se,be,r,u,f,y,A,T]}class _R extends yl{constructor(e){super(),_l(this,e,gR,pR,ia,{basepath:11,url:12,history:13,primary:14,a11y:15,disableInlineStyles:16},null,[-1,-1])}}const E2=_R;function Ip(i,e,t=vh,r=Sc){Qo(t)||v2(i,f=>`You cannot use ${f} outside of a ${vx(r)}.`,e)}const yR=i=>{const{subscribe:e}=Qo(i);return{subscribe:e}};function Sp(){return Ip(p2),yR(k0)}function I2(){const{history:i}=Qo(vh);return i}function S2(){const i=Qo(u2);return i?CP(i,e=>e.base):js("/")}function A2(){Ip(g2);const i=S2(),{basepath:e}=Qo(vh);return r=>XP(r,gh(i),e)}function vR(){Ip(m2);const i=A2(),{navigate:e}=I2();return(r,u)=>{const f=a2(r)?r:i(r);return e(f,u)}}const xR=i=>({params:i&16,location:i&8}),XT=i=>({params:ol?gh(i[10]):i[4],location:i[3],navigate:i[11]});function KT(i){let e,t;return e=new E2({props:{primary:i[1],$$slots:{default:[TR]},$$scope:{ctx:i}}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p(r,u){const f={};u&2&&(f.primary=r[1]),u&528409&&(f.$$scope={dirty:u,ctx:r}),e.$set(f)},i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function bR(i){let e;const t=i[18].default,r=dl(t,i,i[19],XT);return{c(){r&&r.c()},m(u,f){r&&r.m(u,f),e=!0},p(u,f){r&&r.p&&(!e||f&524312)&&pl(r,t,u,u[19],e?fl(t,u[19],f,xR):ml(u[19]),XT)},i(u){e||(_t(r,u),e=!0)},o(u){wt(r,u),e=!1},d(u){r&&r.d(u)}}}function wR(i){let e,t,r;const u=[{location:i[3]},{navigate:i[11]},ol?gh(i[10]):i[4],i[12]];var f=i[0];function y(l){let T={};for(let A=0;A<u.length;A+=1)T=Yr(T,u[A]);return{props:T}}return f&&(e=p_(f,y())),{c(){e&&bn(e.$$.fragment),t=gl()},m(l,T){e&&gn(e,l,T),yt(l,t,T),r=!0},p(l,T){const A=T&7192?Ic(u,[T&8&&{location:l[3]},T&2048&&{navigate:l[11]},T&1040&&A0(ol?gh(l[10]):l[4]),T&4096&&A0(l[12])]):{};if(f!==(f=l[0])){if(e){gr();const R=e;wt(R.$$.fragment,1,0,()=>{_n(R,1)}),_r()}f?(e=p_(f,y()),bn(e.$$.fragment),_t(e.$$.fragment,1),gn(e,t.parentNode,t)):e=null}else f&&e.$set(A)},i(l){r||(e&&_t(e.$$.fragment,l),r=!0)},o(l){e&&wt(e.$$.fragment,l),r=!1},d(l){l&&mt(t),e&&_n(e,l)}}}function TR(i){let e,t,r,u;const f=[wR,bR],y=[];function l(T,A){return T[0]!==null?0:1}return e=l(i),t=y[e]=f[e](i),{c(){t.c(),r=gl()},m(T,A){y[e].m(T,A),yt(T,r,A),u=!0},p(T,A){let R=e;e=l(T),e===R?y[e].p(T,A):(gr(),wt(y[R],1,1,()=>{y[R]=null}),_r(),t=y[e],t?t.p(T,A):(t=y[e]=f[e](T),t.c()),_t(t,1),t.m(r.parentNode,r))},i(T){u||(_t(t),u=!0)},o(T){wt(t),u=!1},d(T){y[e].d(T),T&&mt(r)}}}function ER(i){let e,t,r,u,f,y=[lh(i[7]),{"data-svnav-route-start":i[5]}],l={};for(let z=0;z<y.length;z+=1)l=Yr(l,y[z]);let T=i[2]&&KT(i),A=[lh(i[7]),{"data-svnav-route-end":i[5]}],R={};for(let z=0;z<A.length;z+=1)R=Yr(R,A[z]);return{c(){e=tt("div"),t=Dt(),T&&T.c(),r=Dt(),u=tt("div"),yo(e,l),yo(u,R)},m(z,j){yt(z,e,j),yt(z,t,j),T&&T.m(z,j),yt(z,r,j),yt(z,u,j),f=!0},p(z,[j]){yo(e,l=Ic(y,[lh(z[7]),{"data-svnav-route-start":z[5]}])),z[2]?T?(T.p(z,j),j&4&&_t(T,1)):(T=KT(z),T.c(),_t(T,1),T.m(r.parentNode,r)):T&&(gr(),wt(T,1,1,()=>{T=null}),_r()),yo(u,R=Ic(A,[lh(z[7]),{"data-svnav-route-end":z[5]}]))},i(z){f||(_t(T),f=!0)},o(z){wt(T),f=!1},d(z){z&&mt(e),z&&mt(t),T&&T.d(z),z&&mt(r),z&&mt(u)}}}const IR=l2();function SR(i,e,t){let r;const u=["path","component","meta","primary"];let f=h_(e,u),y,l,T,A,{$$slots:R={},$$scope:z}=e,{path:j=""}=e,{component:ee=null}=e,{meta:se={}}=e,{primary:be=!0}=e;Ip(G_,e);const Re=IR(),{registerRoute:Ge,unregisterRoute:it,activeRoute:dt,disableInlineStyles:Ue}=Qo(vh);Hr(i,dt,kt=>t(16,y=kt));const ge=S2();Hr(i,ge,kt=>t(17,T=kt));const Ke=Sp();Hr(i,Ke,kt=>t(3,l=kt));const He=js(null);let en;const vt=js(),Ft=js({});Hr(i,Ft,kt=>t(4,A=kt)),$f(u2,vt),$f(kP,Ft),$f(MP,He);const Lt=vR();return ol||bP(()=>it(Re)),i.$$set=kt=>{t(24,e=Yr(Yr({},e),_h(kt))),t(12,f=h_(e,u)),"path"in kt&&t(13,j=kt.path),"component"in kt&&t(0,ee=kt.component),"meta"in kt&&t(14,se=kt.meta),"primary"in kt&&t(1,be=kt.primary),"$$scope"in kt&&t(19,z=kt.$$scope)},i.$$.update=()=>{if(i.$$.dirty&155658){const kt=j==="",Qt=Ep(T,j),lt={id:Re,path:j,meta:se,default:kt,fullPath:kt?"":Qt,base:kt?T:KP(Qt,l.pathname),primary:be,focusElement:He};vt.set(lt),t(15,en=Ge(lt))}if(i.$$.dirty&98304&&t(2,r=!!(en||y&&y.id===Re)),i.$$.dirty&98308&&r){const{params:kt}=en||y;Ft.set(kt)}},e=_h(e),[ee,be,r,l,A,Re,dt,Ue,ge,Ke,Ft,Lt,f,j,se,en,y,T,R,z]}class AR extends yl{constructor(e){super(),_l(this,e,SR,ER,ia,{path:13,component:0,meta:14,primary:1})}}const go=AR;function CR(i){let e,t,r,u;const f=i[13].default,y=dl(f,i,i[12],null);let l=[{href:i[0]},i[2],i[1]],T={};for(let A=0;A<l.length;A+=1)T=Yr(T,l[A]);return{c(){e=tt("a"),y&&y.c(),yo(e,T)},m(A,R){yt(A,e,R),y&&y.m(e,null),t=!0,r||(u=Gn(e,"click",i[4]),r=!0)},p(A,[R]){y&&y.p&&(!t||R&4096)&&pl(y,f,A,A[12],t?fl(f,A[12],R,null):ml(A[12]),null),yo(e,T=Ic(l,[(!t||R&1)&&{href:A[0]},R&4&&A[2],R&2&&A[1]]))},i(A){t||(_t(y,A),t=!0)},o(A){wt(y,A),t=!1},d(A){A&&mt(e),y&&y.d(A),r=!1,u()}}}function kR(i,e,t){let r,u,f,y,l,T;const A=["to","replace","state","getProps"];let R=h_(e,A),z,{$$slots:j={},$$scope:ee}=e,{to:se}=e,{replace:be=!1}=e,{state:Re={}}=e,{getProps:Ge=null}=e;Ip(yx,e);const it=Sp();Hr(i,it,He=>t(11,z=He));const dt=n2(),Ue=A2(),{navigate:ge}=I2();function Ke(He){dt("click",He),IP(He)&&(He.preventDefault(),ge(r,{state:Re,replace:y||be}))}return i.$$set=He=>{t(19,e=Yr(Yr({},e),_h(He))),t(18,R=h_(e,A)),"to"in He&&t(5,se=He.to),"replace"in He&&t(6,be=He.replace),"state"in He&&t(7,Re=He.state),"getProps"in He&&t(8,Ge=He.getProps),"$$scope"in He&&t(12,ee=He.$$scope)},i.$$.update=()=>{i.$$.dirty&2080&&t(0,r=Ue(se,z)),i.$$.dirty&2049&&t(10,u=M0(z.pathname,r)),i.$$.dirty&2049&&t(9,f=r===z.pathname),i.$$.dirty&2049&&(y=xx(r)===HP(z)),i.$$.dirty&512&&t(2,l=f?{"aria-current":"page"}:{}),t(1,T=(()=>{if(o2(Ge)){const He=Ge({location:z,href:r,isPartiallyCurrent:u,isCurrent:f});return{...R,...He}}return R})())},e=_h(e),[r,T,l,it,Ke,se,be,Re,Ge,f,u,z,ee,j]}class MR extends yl{constructor(e){super(),_l(this,e,kR,CR,ia,{to:5,replace:6,state:7,getProps:8})}}const Pi=MR;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C2=function(i){const e=[];let t=0;for(let r=0;r<i.length;r++){let u=i.charCodeAt(r);u<128?e[t++]=u:u<2048?(e[t++]=u>>6|192,e[t++]=u&63|128):(u&64512)===55296&&r+1<i.length&&(i.charCodeAt(r+1)&64512)===56320?(u=65536+((u&1023)<<10)+(i.charCodeAt(++r)&1023),e[t++]=u>>18|240,e[t++]=u>>12&63|128,e[t++]=u>>6&63|128,e[t++]=u&63|128):(e[t++]=u>>12|224,e[t++]=u>>6&63|128,e[t++]=u&63|128)}return e},DR=function(i){const e=[];let t=0,r=0;for(;t<i.length;){const u=i[t++];if(u<128)e[r++]=String.fromCharCode(u);else if(u>191&&u<224){const f=i[t++];e[r++]=String.fromCharCode((u&31)<<6|f&63)}else if(u>239&&u<365){const f=i[t++],y=i[t++],l=i[t++],T=((u&7)<<18|(f&63)<<12|(y&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(T>>10)),e[r++]=String.fromCharCode(56320+(T&1023))}else{const f=i[t++],y=i[t++];e[r++]=String.fromCharCode((u&15)<<12|(f&63)<<6|y&63)}}return e.join("")},k2={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let u=0;u<i.length;u+=3){const f=i[u],y=u+1<i.length,l=y?i[u+1]:0,T=u+2<i.length,A=T?i[u+2]:0,R=f>>2,z=(f&3)<<4|l>>4;let j=(l&15)<<2|A>>6,ee=A&63;T||(ee=64,y||(j=64)),r.push(t[R],t[z],t[j],t[ee])}return r.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(C2(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):DR(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let u=0;u<i.length;){const f=t[i.charAt(u++)],l=u<i.length?t[i.charAt(u)]:0;++u;const A=u<i.length?t[i.charAt(u)]:64;++u;const z=u<i.length?t[i.charAt(u)]:64;if(++u,f==null||l==null||A==null||z==null)throw Error();const j=f<<2|l>>4;if(r.push(j),A!==64){const ee=l<<4&240|A>>2;if(r.push(ee),z!==64){const se=A<<6&192|z;r.push(se)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}},PR=function(i){const e=C2(i);return k2.encodeByteArray(e,!0)},__=function(i){return PR(i).replace(/\./g,"")},M2=function(i){try{return k2.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hi(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function RR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Hi())}function LR(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function zR(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function OR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function BR(){const i=Hi();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function FR(){return!LR()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function D2(){try{return typeof indexedDB=="object"}catch{return!1}}function NR(){return new Promise((i,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",u=self.indexedDB.open(r);u.onsuccess=()=>{u.result.close(),t||self.indexedDB.deleteDatabase(r),i(!0)},u.onupgradeneeded=()=>{t=!1},u.onerror=()=>{var f;e(((f=u.error)===null||f===void 0?void 0:f.message)||"")}}catch(t){e(t)}})}function UR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VR=()=>UR().__FIREBASE_DEFAULTS__,jR=()=>{if(typeof process>"u"||typeof process.env>"u")return;const i={}.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},GR=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&M2(i[1]);return e&&JSON.parse(e)},bx=()=>{try{return VR()||jR()||GR()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},P2=i=>{var e,t;return(t=(e=bx())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[i]},$R=i=>{const e=P2(i);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},qR=()=>{var i;return(i=bx())===null||i===void 0?void 0:i.config},R2=i=>{var e;return(e=bx())===null||e===void 0?void 0:e[`_${i}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZR(i,e){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",u=i.iat||0,f=i.sub||i.user_id;if(!f)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const y=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:u,exp:u+3600,auth_time:u,sub:f,user_id:f,firebase:{sign_in_provider:"custom",identities:{}}},i),l="";return[__(JSON.stringify(t)),__(JSON.stringify(y)),l].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HR="FirebaseError";class ra extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=HR,Object.setPrototypeOf(this,ra.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ap.prototype.create)}}class Ap{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},u=`${this.service}/${e}`,f=this.errors[e],y=f?XR(f,r):"Error",l=`${this.serviceName}: ${y} (${u}).`;return new ra(u,l,r)}}function XR(i,e){return i.replace(KR,(t,r)=>{const u=e[r];return u!=null?String(u):`<${r}?>`})}const KR=/\{\$([^}]+)}/g;function YR(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}function xh(i,e){if(i===e)return!0;const t=Object.keys(i),r=Object.keys(e);for(const u of t){if(!r.includes(u))return!1;const f=i[u],y=e[u];if(YT(f)&&YT(y)){if(!xh(f,y))return!1}else if(f!==y)return!1}for(const u of r)if(!t.includes(u))return!1;return!0}function YT(i){return i!==null&&typeof i=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bh(i){const e=[];for(const[t,r]of Object.entries(i))Array.isArray(r)?r.forEach(u=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(u))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Of(i){const e={};return i.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[u,f]=r.split("=");e[decodeURIComponent(u)]=decodeURIComponent(f)}}),e}function Bf(i){const e=i.indexOf("?");if(!e)return"";const t=i.indexOf("#",e);return i.substring(e,t>0?t:void 0)}function QR(i,e){const t=new JR(i,e);return t.subscribe.bind(t)}class JR{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let u;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");eL(e,["next","error","complete"])?u=e:u={next:e,error:t,complete:r},u.next===void 0&&(u.next=r0),u.error===void 0&&(u.error=r0),u.complete===void 0&&(u.complete=r0);const f=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?u.error(this.finalError):u.complete()}catch{}}),this.observers.push(u),f}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eL(i,e){if(typeof i!="object"||i===null)return!1;for(const t of e)if(t in i&&typeof i[t]=="function")return!0;return!1}function r0(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gt(i){return i&&i._delegate?i._delegate:i}class Ac{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tL{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new WR;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const u=this.getOrInitializeService({instanceIdentifier:t});u&&r.resolve(u)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),u=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(f){if(u)return null;throw f}else{if(u)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(iL(e))try{this.getOrInitializeService({instanceIdentifier:uc})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(t);try{const f=this.getOrInitializeService({instanceIdentifier:u});r.resolve(f)}catch{}}}}clearInstance(e=uc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=uc){return this.instances.has(e)}getOptions(e=uc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const u=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[f,y]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(f);r===l&&y.resolve(u)}return u}onInit(e,t){var r;const u=this.normalizeInstanceIdentifier(t),f=(r=this.onInitCallbacks.get(u))!==null&&r!==void 0?r:new Set;f.add(e),this.onInitCallbacks.set(u,f);const y=this.instances.get(u);return y&&e(y,u),()=>{f.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(!!r)for(const u of r)try{u(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:nL(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=uc){return this.component?this.component.multipleInstances?e:uc:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function nL(i){return i===uc?void 0:i}function iL(i){return i.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rL{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new tL(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $n;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})($n||($n={}));const sL={debug:$n.DEBUG,verbose:$n.VERBOSE,info:$n.INFO,warn:$n.WARN,error:$n.ERROR,silent:$n.SILENT},oL=$n.INFO,aL={[$n.DEBUG]:"log",[$n.VERBOSE]:"log",[$n.INFO]:"info",[$n.WARN]:"warn",[$n.ERROR]:"error"},lL=(i,e,...t)=>{if(e<i.logLevel)return;const r=new Date().toISOString(),u=aL[e];if(u)console[u](`[${r}]  ${i.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class wx{constructor(e){this.name=e,this._logLevel=oL,this._logHandler=lL,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $n))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?sL[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$n.DEBUG,...e),this._logHandler(this,$n.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$n.VERBOSE,...e),this._logHandler(this,$n.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$n.INFO,...e),this._logHandler(this,$n.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$n.WARN,...e),this._logHandler(this,$n.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$n.ERROR,...e),this._logHandler(this,$n.ERROR,...e)}}const cL=(i,e)=>e.some(t=>i instanceof t);let QT,JT;function uL(){return QT||(QT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hL(){return JT||(JT=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const L2=new WeakMap,D0=new WeakMap,z2=new WeakMap,s0=new WeakMap,Tx=new WeakMap;function dL(i){const e=new Promise((t,r)=>{const u=()=>{i.removeEventListener("success",f),i.removeEventListener("error",y)},f=()=>{t(tl(i.result)),u()},y=()=>{r(i.error),u()};i.addEventListener("success",f),i.addEventListener("error",y)});return e.then(t=>{t instanceof IDBCursor&&L2.set(t,i)}).catch(()=>{}),Tx.set(e,i),e}function fL(i){if(D0.has(i))return;const e=new Promise((t,r)=>{const u=()=>{i.removeEventListener("complete",f),i.removeEventListener("error",y),i.removeEventListener("abort",y)},f=()=>{t(),u()},y=()=>{r(i.error||new DOMException("AbortError","AbortError")),u()};i.addEventListener("complete",f),i.addEventListener("error",y),i.addEventListener("abort",y)});D0.set(i,e)}let P0={get(i,e,t){if(i instanceof IDBTransaction){if(e==="done")return D0.get(i);if(e==="objectStoreNames")return i.objectStoreNames||z2.get(i);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return tl(i[e])},set(i,e,t){return i[e]=t,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function pL(i){P0=i(P0)}function mL(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=i.call(o0(this),e,...t);return z2.set(r,e.sort?e.sort():[e]),tl(r)}:hL().includes(i)?function(...e){return i.apply(o0(this),e),tl(L2.get(this))}:function(...e){return tl(i.apply(o0(this),e))}}function gL(i){return typeof i=="function"?mL(i):(i instanceof IDBTransaction&&fL(i),cL(i,uL())?new Proxy(i,P0):i)}function tl(i){if(i instanceof IDBRequest)return dL(i);if(s0.has(i))return s0.get(i);const e=gL(i);return e!==i&&(s0.set(i,e),Tx.set(e,i)),e}const o0=i=>Tx.get(i);function _L(i,e,{blocked:t,upgrade:r,blocking:u,terminated:f}={}){const y=indexedDB.open(i,e),l=tl(y);return r&&y.addEventListener("upgradeneeded",T=>{r(tl(y.result),T.oldVersion,T.newVersion,tl(y.transaction))}),t&&y.addEventListener("blocked",()=>t()),l.then(T=>{f&&T.addEventListener("close",()=>f()),u&&T.addEventListener("versionchange",()=>u())}).catch(()=>{}),l}const yL=["get","getKey","getAll","getAllKeys","count"],vL=["put","add","delete","clear"],a0=new Map;function eE(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(a0.get(e))return a0.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,u=vL.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(u||yL.includes(t)))return;const f=async function(y,...l){const T=this.transaction(y,u?"readwrite":"readonly");let A=T.store;return r&&(A=A.index(l.shift())),(await Promise.all([A[t](...l),u&&T.done]))[0]};return a0.set(e,f),f}pL(i=>({...i,get:(e,t,r)=>eE(e,t)||i.get(e,t,r),has:(e,t)=>!!eE(e,t)||i.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xL{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(bL(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function bL(i){const e=i.getComponent();return(e==null?void 0:e.type)==="VERSION"}const R0="@firebase/app",tE="0.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cc=new wx("@firebase/app"),wL="@firebase/app-compat",TL="@firebase/analytics-compat",EL="@firebase/analytics",IL="@firebase/app-check-compat",SL="@firebase/app-check",AL="@firebase/auth",CL="@firebase/auth-compat",kL="@firebase/database",ML="@firebase/database-compat",DL="@firebase/functions",PL="@firebase/functions-compat",RL="@firebase/installations",LL="@firebase/installations-compat",zL="@firebase/messaging",OL="@firebase/messaging-compat",BL="@firebase/performance",FL="@firebase/performance-compat",NL="@firebase/remote-config",UL="@firebase/remote-config-compat",VL="@firebase/storage",jL="@firebase/storage-compat",GL="@firebase/firestore",$L="@firebase/firestore-compat",qL="firebase",WL="9.15.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y_="[DEFAULT]",ZL={[R0]:"fire-core",[wL]:"fire-core-compat",[EL]:"fire-analytics",[TL]:"fire-analytics-compat",[SL]:"fire-app-check",[IL]:"fire-app-check-compat",[AL]:"fire-auth",[CL]:"fire-auth-compat",[kL]:"fire-rtdb",[ML]:"fire-rtdb-compat",[DL]:"fire-fn",[PL]:"fire-fn-compat",[RL]:"fire-iid",[LL]:"fire-iid-compat",[zL]:"fire-fcm",[OL]:"fire-fcm-compat",[BL]:"fire-perf",[FL]:"fire-perf-compat",[NL]:"fire-rc",[UL]:"fire-rc-compat",[VL]:"fire-gcs",[jL]:"fire-gcs-compat",[GL]:"fire-fst",[$L]:"fire-fst-compat","fire-js":"fire-js",[qL]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v_=new Map,L0=new Map;function HL(i,e){try{i.container.addComponent(e)}catch(t){Cc.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,t)}}function bh(i){const e=i.name;if(L0.has(e))return Cc.debug(`There were multiple attempts to register component ${e}.`),!1;L0.set(e,i);for(const t of v_.values())HL(t,i);return!0}function Cp(i,e){const t=i.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),i.container.getProvider(e)}function XL(i,e,t=y_){Cp(i,e).clearInstance(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KL={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},nl=new Ap("app","Firebase",KL);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YL{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ac("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw nl.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kp=WL;function O2(i,e={}){let t=i;typeof e!="object"&&(e={name:e});const r=Object.assign({name:y_,automaticDataCollectionEnabled:!1},e),u=r.name;if(typeof u!="string"||!u)throw nl.create("bad-app-name",{appName:String(u)});if(t||(t=qR()),!t)throw nl.create("no-options");const f=v_.get(u);if(f){if(xh(t,f.options)&&xh(r,f.config))return f;throw nl.create("duplicate-app",{appName:u})}const y=new rL(u);for(const T of L0.values())y.addComponent(T);const l=new YL(t,r,y);return v_.set(u,l),l}function B2(i=y_){const e=v_.get(i);if(!e&&i===y_)return O2();if(!e)throw nl.create("no-app",{appName:i});return e}function il(i,e,t){var r;let u=(r=ZL[i])!==null&&r!==void 0?r:i;t&&(u+=`-${t}`);const f=u.match(/\s|\//),y=e.match(/\s|\//);if(f||y){const l=[`Unable to register library "${u}" with version "${e}":`];f&&l.push(`library name "${u}" contains illegal characters (whitespace or "/")`),f&&y&&l.push("and"),y&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Cc.warn(l.join(" "));return}bh(new Ac(`${u}-version`,()=>({library:u,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QL="firebase-heartbeat-database",JL=1,Jf="firebase-heartbeat-store";let l0=null;function F2(){return l0||(l0=_L(QL,JL,{upgrade:(i,e)=>{switch(e){case 0:i.createObjectStore(Jf)}}}).catch(i=>{throw nl.create("idb-open",{originalErrorMessage:i.message})})),l0}async function ez(i){try{return(await F2()).transaction(Jf).objectStore(Jf).get(N2(i))}catch(e){if(e instanceof ra)Cc.warn(e.message);else{const t=nl.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Cc.warn(t.message)}}}async function nE(i,e){try{const r=(await F2()).transaction(Jf,"readwrite");return await r.objectStore(Jf).put(e,N2(i)),r.done}catch(t){if(t instanceof ra)Cc.warn(t.message);else{const r=nl.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Cc.warn(r.message)}}}function N2(i){return`${i.name}!${i.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tz=1024,nz=30*24*60*60*1e3;class iz{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new sz(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=iE();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(u=>u.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(u=>{const f=new Date(u.date).valueOf();return Date.now()-f<=nz}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=iE(),{heartbeatsToSend:t,unsentEntries:r}=rz(this._heartbeatsCache.heartbeats),u=__(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}}function iE(){return new Date().toISOString().substring(0,10)}function rz(i,e=tz){const t=[];let r=i.slice();for(const u of i){const f=t.find(y=>y.agent===u.agent);if(f){if(f.dates.push(u.date),rE(t)>e){f.dates.pop();break}}else if(t.push({agent:u.agent,dates:[u.date]}),rE(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class sz{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return D2()?NR().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await ez(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const u=await this.read();return nE(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:u.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const u=await this.read();return nE(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:u.lastSentHeartbeatDate,heartbeats:[...u.heartbeats,...e.heartbeats]})}else return}}function rE(i){return __(JSON.stringify({version:2,heartbeats:i})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oz(i){bh(new Ac("platform-logger",e=>new xL(e),"PRIVATE")),bh(new Ac("heartbeat",e=>new iz(e),"PRIVATE")),il(R0,tE,i),il(R0,tE,"esm2017"),il("fire-js","")}oz("");var az="firebase",lz="9.15.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */il(az,lz,"app");var cz=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qt,Ex=Ex||{},dn=cz||self;function x_(){}function $_(i){var e=typeof i;return e=e!="object"?e:i?Array.isArray(i)?"array":e:"null",e=="array"||e=="object"&&typeof i.length=="number"}function Mp(i){var e=typeof i;return e=="object"&&i!=null||e=="function"}function uz(i){return Object.prototype.hasOwnProperty.call(i,c0)&&i[c0]||(i[c0]=++hz)}var c0="closure_uid_"+(1e9*Math.random()>>>0),hz=0;function dz(i,e,t){return i.call.apply(i.bind,arguments)}function fz(i,e,t){if(!i)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var u=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(u,r),i.apply(e,u)}}return function(){return i.apply(e,arguments)}}function Mr(i,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Mr=dz:Mr=fz,Mr.apply(null,arguments)}function Ug(i,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),i.apply(this,r)}}function vr(i,e){function t(){}t.prototype=e.prototype,i.X=e.prototype,i.prototype=new t,i.prototype.constructor=i,i.Wb=function(r,u,f){for(var y=Array(arguments.length-2),l=2;l<arguments.length;l++)y[l-2]=arguments[l];return e.prototype[u].apply(r,y)}}function vl(){this.s=this.s,this.o=this.o}var pz=0;vl.prototype.s=!1;vl.prototype.na=function(){!this.s&&(this.s=!0,this.M(),pz!=0)&&uz(this)};vl.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const U2=Array.prototype.indexOf?function(i,e){return Array.prototype.indexOf.call(i,e,void 0)}:function(i,e){if(typeof i=="string")return typeof e!="string"||e.length!=1?-1:i.indexOf(e,0);for(let t=0;t<i.length;t++)if(t in i&&i[t]===e)return t;return-1};function Ix(i){const e=i.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=i[r];return t}return[]}function sE(i,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if($_(r)){const u=i.length||0,f=r.length||0;i.length=u+f;for(let y=0;y<f;y++)i[u+y]=r[y]}else i.push(r)}}function Dr(i,e){this.type=i,this.g=this.target=e,this.defaultPrevented=!1}Dr.prototype.h=function(){this.defaultPrevented=!0};var mz=function(){if(!dn.addEventListener||!Object.defineProperty)return!1;var i=!1,e=Object.defineProperty({},"passive",{get:function(){i=!0}});try{dn.addEventListener("test",x_,e),dn.removeEventListener("test",x_,e)}catch{}return i}();function b_(i){return/^[\s\xa0]*$/.test(i)}var oE=String.prototype.trim?function(i){return i.trim()}:function(i){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(i)[1]};function u0(i,e){return i<e?-1:i>e?1:0}function q_(){var i=dn.navigator;return i&&(i=i.userAgent)?i:""}function _o(i){return q_().indexOf(i)!=-1}function Sx(i){return Sx[" "](i),i}Sx[" "]=x_;function gz(i){var e=vz;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=i(9)}var _z=_o("Opera"),wh=_o("Trident")||_o("MSIE"),V2=_o("Edge"),z0=V2||wh,j2=_o("Gecko")&&!(q_().toLowerCase().indexOf("webkit")!=-1&&!_o("Edge"))&&!(_o("Trident")||_o("MSIE"))&&!_o("Edge"),yz=q_().toLowerCase().indexOf("webkit")!=-1&&!_o("Edge");function G2(){var i=dn.document;return i?i.documentMode:void 0}var w_;e:{var h0="",d0=function(){var i=q_();if(j2)return/rv:([^\);]+)(\)|;)/.exec(i);if(V2)return/Edge\/([\d\.]+)/.exec(i);if(wh)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(i);if(yz)return/WebKit\/(\S+)/.exec(i);if(_z)return/(?:Version)[ \/]?(\S+)/.exec(i)}();if(d0&&(h0=d0?d0[1]:""),wh){var f0=G2();if(f0!=null&&f0>parseFloat(h0)){w_=String(f0);break e}}w_=h0}var vz={};function xz(){return gz(function(){let i=0;const e=oE(String(w_)).split("."),t=oE("9").split("."),r=Math.max(e.length,t.length);for(let y=0;i==0&&y<r;y++){var u=e[y]||"",f=t[y]||"";do{if(u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],f=/(\d*)(\D*)(.*)/.exec(f)||["","","",""],u[0].length==0&&f[0].length==0)break;i=u0(u[1].length==0?0:parseInt(u[1],10),f[1].length==0?0:parseInt(f[1],10))||u0(u[2].length==0,f[2].length==0)||u0(u[2],f[2]),u=u[3],f=f[3]}while(i==0)}return 0<=i})}var O0;if(dn.document&&wh){var aE=G2();O0=aE||parseInt(w_,10)||void 0}else O0=void 0;var bz=O0;function ep(i,e){if(Dr.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var t=this.type=i.type,r=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=e,e=i.relatedTarget){if(j2){e:{try{Sx(e.nodeName);var u=!0;break e}catch{}u=!1}u||(e=null)}}else t=="mouseover"?e=i.fromElement:t=="mouseout"&&(e=i.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:wz[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&ep.X.h.call(this)}}vr(ep,Dr);var wz={2:"touch",3:"pen",4:"mouse"};ep.prototype.h=function(){ep.X.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var Dp="closure_listenable_"+(1e6*Math.random()|0),Tz=0;function Ez(i,e,t,r,u){this.listener=i,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ha=u,this.key=++Tz,this.ba=this.ea=!1}function W_(i){i.ba=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function Ax(i,e,t){for(const r in i)e.call(t,i[r],r,i)}function $2(i){const e={};for(const t in i)e[t]=i[t];return e}const lE="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q2(i,e){let t,r;for(let u=1;u<arguments.length;u++){r=arguments[u];for(t in r)i[t]=r[t];for(let f=0;f<lE.length;f++)t=lE[f],Object.prototype.hasOwnProperty.call(r,t)&&(i[t]=r[t])}}function Z_(i){this.src=i,this.g={},this.h=0}Z_.prototype.add=function(i,e,t,r,u){var f=i.toString();i=this.g[f],i||(i=this.g[f]=[],this.h++);var y=F0(i,e,r,u);return-1<y?(e=i[y],t||(e.ea=!1)):(e=new Ez(e,this.src,f,!!r,u),e.ea=t,i.push(e)),e};function B0(i,e){var t=e.type;if(t in i.g){var r=i.g[t],u=U2(r,e),f;(f=0<=u)&&Array.prototype.splice.call(r,u,1),f&&(W_(e),i.g[t].length==0&&(delete i.g[t],i.h--))}}function F0(i,e,t,r){for(var u=0;u<i.length;++u){var f=i[u];if(!f.ba&&f.listener==e&&f.capture==!!t&&f.ha==r)return u}return-1}var Cx="closure_lm_"+(1e6*Math.random()|0),p0={};function W2(i,e,t,r,u){if(r&&r.once)return H2(i,e,t,r,u);if(Array.isArray(e)){for(var f=0;f<e.length;f++)W2(i,e[f],t,r,u);return null}return t=Dx(t),i&&i[Dp]?i.N(e,t,Mp(r)?!!r.capture:!!r,u):Z2(i,e,t,!1,r,u)}function Z2(i,e,t,r,u,f){if(!e)throw Error("Invalid event type");var y=Mp(u)?!!u.capture:!!u,l=Mx(i);if(l||(i[Cx]=l=new Z_(i)),t=l.add(e,t,r,y,f),t.proxy)return t;if(r=Iz(),t.proxy=r,r.src=i,r.listener=t,i.addEventListener)mz||(u=y),u===void 0&&(u=!1),i.addEventListener(e.toString(),r,u);else if(i.attachEvent)i.attachEvent(K2(e.toString()),r);else if(i.addListener&&i.removeListener)i.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function Iz(){function i(t){return e.call(i.src,i.listener,t)}const e=Sz;return i}function H2(i,e,t,r,u){if(Array.isArray(e)){for(var f=0;f<e.length;f++)H2(i,e[f],t,r,u);return null}return t=Dx(t),i&&i[Dp]?i.O(e,t,Mp(r)?!!r.capture:!!r,u):Z2(i,e,t,!0,r,u)}function X2(i,e,t,r,u){if(Array.isArray(e))for(var f=0;f<e.length;f++)X2(i,e[f],t,r,u);else r=Mp(r)?!!r.capture:!!r,t=Dx(t),i&&i[Dp]?(i=i.i,e=String(e).toString(),e in i.g&&(f=i.g[e],t=F0(f,t,r,u),-1<t&&(W_(f[t]),Array.prototype.splice.call(f,t,1),f.length==0&&(delete i.g[e],i.h--)))):i&&(i=Mx(i))&&(e=i.g[e.toString()],i=-1,e&&(i=F0(e,t,r,u)),(t=-1<i?e[i]:null)&&kx(t))}function kx(i){if(typeof i!="number"&&i&&!i.ba){var e=i.src;if(e&&e[Dp])B0(e.i,i);else{var t=i.type,r=i.proxy;e.removeEventListener?e.removeEventListener(t,r,i.capture):e.detachEvent?e.detachEvent(K2(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Mx(e))?(B0(t,i),t.h==0&&(t.src=null,e[Cx]=null)):W_(i)}}}function K2(i){return i in p0?p0[i]:p0[i]="on"+i}function Sz(i,e){if(i.ba)i=!0;else{e=new ep(e,this);var t=i.listener,r=i.ha||i.src;i.ea&&kx(i),i=t.call(r,e)}return i}function Mx(i){return i=i[Cx],i instanceof Z_?i:null}var m0="__closure_events_fn_"+(1e9*Math.random()>>>0);function Dx(i){return typeof i=="function"?i:(i[m0]||(i[m0]=function(e){return i.handleEvent(e)}),i[m0])}function rr(){vl.call(this),this.i=new Z_(this),this.P=this,this.I=null}vr(rr,vl);rr.prototype[Dp]=!0;rr.prototype.removeEventListener=function(i,e,t,r){X2(this,i,e,t,r)};function mr(i,e){var t,r=i.I;if(r)for(t=[];r;r=r.I)t.push(r);if(i=i.P,r=e.type||e,typeof e=="string")e=new Dr(e,i);else if(e instanceof Dr)e.target=e.target||i;else{var u=e;e=new Dr(r,i),q2(e,u)}if(u=!0,t)for(var f=t.length-1;0<=f;f--){var y=e.g=t[f];u=Vg(y,r,!0,e)&&u}if(y=e.g=i,u=Vg(y,r,!0,e)&&u,u=Vg(y,r,!1,e)&&u,t)for(f=0;f<t.length;f++)y=e.g=t[f],u=Vg(y,r,!1,e)&&u}rr.prototype.M=function(){if(rr.X.M.call(this),this.i){var i=this.i,e;for(e in i.g){for(var t=i.g[e],r=0;r<t.length;r++)W_(t[r]);delete i.g[e],i.h--}}this.I=null};rr.prototype.N=function(i,e,t,r){return this.i.add(String(i),e,!1,t,r)};rr.prototype.O=function(i,e,t,r){return this.i.add(String(i),e,!0,t,r)};function Vg(i,e,t,r){if(e=i.i.g[String(e)],!e)return!0;e=e.concat();for(var u=!0,f=0;f<e.length;++f){var y=e[f];if(y&&!y.ba&&y.capture==t){var l=y.listener,T=y.ha||y.src;y.ea&&B0(i.i,y),u=l.call(T,r)!==!1&&u}}return u&&!r.defaultPrevented}var Px=dn.JSON.stringify;function Az(){var i=J2;let e=null;return i.g&&(e=i.g,i.g=i.g.next,i.g||(i.h=null),e.next=null),e}class Cz{constructor(){this.h=this.g=null}add(e,t){const r=Y2.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}}var Y2=new class{constructor(i,e){this.i=i,this.j=e,this.h=0,this.g=null}get(){let i;return 0<this.h?(this.h--,i=this.g,this.g=i.next,i.next=null):i=this.i(),i}}(()=>new kz,i=>i.reset());class kz{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Mz(i){dn.setTimeout(()=>{throw i},0)}function Q2(i,e){N0||Dz(),U0||(N0(),U0=!0),J2.add(i,e)}var N0;function Dz(){var i=dn.Promise.resolve(void 0);N0=function(){i.then(Pz)}}var U0=!1,J2=new Cz;function Pz(){for(var i;i=Az();){try{i.h.call(i.g)}catch(t){Mz(t)}var e=Y2;e.j(i),100>e.h&&(e.h++,i.next=e.g,e.g=i)}U0=!1}function H_(i,e){rr.call(this),this.h=i||1,this.g=e||dn,this.j=Mr(this.lb,this),this.l=Date.now()}vr(H_,rr);qt=H_.prototype;qt.ca=!1;qt.R=null;qt.lb=function(){if(this.ca){var i=Date.now()-this.l;0<i&&i<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-i):(this.R&&(this.g.clearTimeout(this.R),this.R=null),mr(this,"tick"),this.ca&&(Rx(this),this.start()))}};qt.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Rx(i){i.ca=!1,i.R&&(i.g.clearTimeout(i.R),i.R=null)}qt.M=function(){H_.X.M.call(this),Rx(this),delete this.g};function Lx(i,e,t){if(typeof i=="function")t&&(i=Mr(i,t));else if(i&&typeof i.handleEvent=="function")i=Mr(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:dn.setTimeout(i,e||0)}function eS(i){i.g=Lx(()=>{i.g=null,i.i&&(i.i=!1,eS(i))},i.j);const e=i.h;i.h=null,i.m.apply(null,e)}class Rz extends vl{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:eS(this)}M(){super.M(),this.g&&(dn.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function tp(i){vl.call(this),this.h=i,this.g={}}vr(tp,vl);var cE=[];function tS(i,e,t,r){Array.isArray(t)||(t&&(cE[0]=t.toString()),t=cE);for(var u=0;u<t.length;u++){var f=W2(e,t[u],r||i.handleEvent,!1,i.h||i);if(!f)break;i.g[f.key]=f}}function nS(i){Ax(i.g,function(e,t){this.g.hasOwnProperty(t)&&kx(e)},i),i.g={}}tp.prototype.M=function(){tp.X.M.call(this),nS(this)};tp.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function X_(){this.g=!0}X_.prototype.Aa=function(){this.g=!1};function Lz(i,e,t,r,u,f){i.info(function(){if(i.g)if(f)for(var y="",l=f.split("&"),T=0;T<l.length;T++){var A=l[T].split("=");if(1<A.length){var R=A[0];A=A[1];var z=R.split("_");y=2<=z.length&&z[1]=="type"?y+(R+"="+A+"&"):y+(R+"=redacted&")}}else y=null;else y=f;return"XMLHTTP REQ ("+r+") [attempt "+u+"]: "+e+`
`+t+`
`+y})}function zz(i,e,t,r,u,f,y){i.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+u+"]: "+e+`
`+t+`
`+f+" "+y})}function ch(i,e,t,r){i.info(function(){return"XMLHTTP TEXT ("+e+"): "+Bz(i,t)+(r?" "+r:"")})}function Oz(i,e){i.info(function(){return"TIMEOUT: "+e})}X_.prototype.info=function(){};function Bz(i,e){if(!i.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(i=0;i<t.length;i++)if(Array.isArray(t[i])){var r=t[i];if(!(2>r.length)){var u=r[1];if(Array.isArray(u)&&!(1>u.length)){var f=u[0];if(f!="noop"&&f!="stop"&&f!="close")for(var y=1;y<u.length;y++)u[y]=""}}}}return Px(t)}catch{return e}}var Uc={},uE=null;function K_(){return uE=uE||new rr}Uc.Pa="serverreachability";function iS(i){Dr.call(this,Uc.Pa,i)}vr(iS,Dr);function np(i){const e=K_();mr(e,new iS(e))}Uc.STAT_EVENT="statevent";function rS(i,e){Dr.call(this,Uc.STAT_EVENT,i),this.stat=e}vr(rS,Dr);function Br(i){const e=K_();mr(e,new rS(e,i))}Uc.Qa="timingevent";function sS(i,e){Dr.call(this,Uc.Qa,i),this.size=e}vr(sS,Dr);function Pp(i,e){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return dn.setTimeout(function(){i()},e)}var Y_={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},oS={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function zx(){}zx.prototype.h=null;function hE(i){return i.h||(i.h=i.i())}function aS(){}var Rp={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Ox(){Dr.call(this,"d")}vr(Ox,Dr);function Bx(){Dr.call(this,"c")}vr(Bx,Dr);var V0;function Q_(){}vr(Q_,zx);Q_.prototype.g=function(){return new XMLHttpRequest};Q_.prototype.i=function(){return{}};V0=new Q_;function Lp(i,e,t,r){this.l=i,this.j=e,this.m=t,this.U=r||1,this.S=new tp(this),this.O=Fz,i=z0?125:void 0,this.T=new H_(i),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new lS}function lS(){this.i=null,this.g="",this.h=!1}var Fz=45e3,j0={},T_={};qt=Lp.prototype;qt.setTimeout=function(i){this.O=i};function G0(i,e,t){i.K=1,i.v=ey(Jo(e)),i.s=t,i.P=!0,cS(i,null)}function cS(i,e){i.F=Date.now(),zp(i),i.A=Jo(i.v);var t=i.A,r=i.U;Array.isArray(r)||(r=[String(r)]),_S(t.i,"t",r),i.C=0,t=i.l.H,i.h=new lS,i.g=FS(i.l,t?e:null,!i.s),0<i.N&&(i.L=new Rz(Mr(i.La,i,i.g),i.N)),tS(i.S,i.g,"readystatechange",i.ib),e=i.H?$2(i.H):{},i.s?(i.u||(i.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",i.g.da(i.A,i.u,i.s,e)):(i.u="GET",i.g.da(i.A,i.u,null,e)),np(),Lz(i.j,i.u,i.A,i.m,i.U,i.s)}qt.ib=function(i){i=i.target;const e=this.L;e&&Zo(i)==3?e.l():this.La(i)};qt.La=function(i){try{if(i==this.g)e:{const R=Zo(this.g);var e=this.g.Ea();const z=this.g.aa();if(!(3>R)&&(R!=3||z0||this.g&&(this.h.h||this.g.fa()||mE(this.g)))){this.I||R!=4||e==7||(e==8||0>=z?np(3):np(2)),J_(this);var t=this.g.aa();this.Y=t;t:if(uS(this)){var r=mE(this.g);i="";var u=r.length,f=Zo(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){_c(this),qf(this);var y="";break t}this.h.i=new dn.TextDecoder}for(e=0;e<u;e++)this.h.h=!0,i+=this.h.i.decode(r[e],{stream:f&&e==u-1});r.splice(0,u),this.h.g+=i,this.C=0,y=this.h.g}else y=this.g.fa();if(this.i=t==200,zz(this.j,this.u,this.A,this.m,this.U,R,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var l,T=this.g;if((l=T.g?T.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!b_(l)){var A=l;break t}}A=null}if(t=A)ch(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,$0(this,t);else{this.i=!1,this.o=3,Br(12),_c(this),qf(this);break e}}this.P?(hS(this,R,y),z0&&this.i&&R==3&&(tS(this.S,this.T,"tick",this.hb),this.T.start())):(ch(this.j,this.m,y,null),$0(this,y)),R==4&&_c(this),this.i&&!this.I&&(R==4?LS(this.l,this):(this.i=!1,zp(this)))}else t==400&&0<y.indexOf("Unknown SID")?(this.o=3,Br(12)):(this.o=0,Br(13)),_c(this),qf(this)}}}catch{}finally{}};function uS(i){return i.g?i.u=="GET"&&i.K!=2&&i.l.Da:!1}function hS(i,e,t){let r=!0,u;for(;!i.I&&i.C<t.length;)if(u=Nz(i,t),u==T_){e==4&&(i.o=4,Br(14),r=!1),ch(i.j,i.m,null,"[Incomplete Response]");break}else if(u==j0){i.o=4,Br(15),ch(i.j,i.m,t,"[Invalid Chunk]"),r=!1;break}else ch(i.j,i.m,u,null),$0(i,u);uS(i)&&u!=T_&&u!=j0&&(i.h.g="",i.C=0),e!=4||t.length!=0||i.h.h||(i.o=1,Br(16),r=!1),i.i=i.i&&r,r?0<t.length&&!i.$&&(i.$=!0,e=i.l,e.g==i&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),$x(e),e.K=!0,Br(11))):(ch(i.j,i.m,t,"[Invalid Chunked Response]"),_c(i),qf(i))}qt.hb=function(){if(this.g){var i=Zo(this.g),e=this.g.fa();this.C<e.length&&(J_(this),hS(this,i,e),this.i&&i!=4&&zp(this))}};function Nz(i,e){var t=i.C,r=e.indexOf(`
`,t);return r==-1?T_:(t=Number(e.substring(t,r)),isNaN(t)?j0:(r+=1,r+t>e.length?T_:(e=e.substr(r,t),i.C=r+t,e)))}qt.cancel=function(){this.I=!0,_c(this)};function zp(i){i.V=Date.now()+i.O,dS(i,i.O)}function dS(i,e){if(i.B!=null)throw Error("WatchDog timer not null");i.B=Pp(Mr(i.gb,i),e)}function J_(i){i.B&&(dn.clearTimeout(i.B),i.B=null)}qt.gb=function(){this.B=null;const i=Date.now();0<=i-this.V?(Oz(this.j,this.A),this.K!=2&&(np(),Br(17)),_c(this),this.o=2,qf(this)):dS(this,this.V-i)};function qf(i){i.l.G==0||i.I||LS(i.l,i)}function _c(i){J_(i);var e=i.L;e&&typeof e.na=="function"&&e.na(),i.L=null,Rx(i.T),nS(i.S),i.g&&(e=i.g,i.g=null,e.abort(),e.na())}function $0(i,e){try{var t=i.l;if(t.G!=0&&(t.g==i||q0(t.h,i))){if(!i.J&&q0(t.h,i)&&t.G==3){try{var r=t.Fa.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var u=r;if(u[0]==0){e:if(!t.u){if(t.g)if(t.g.F+3e3<i.F)S_(t),iy(t);else break e;Gx(t),Br(18)}}else t.Ba=u[1],0<t.Ba-t.T&&37500>u[2]&&t.L&&t.A==0&&!t.v&&(t.v=Pp(Mr(t.cb,t),6e3));if(1>=xS(t.h)&&t.ja){try{t.ja()}catch{}t.ja=void 0}}else yc(t,11)}else if((i.J||t.g==i)&&S_(t),!b_(e))for(u=t.Fa.g.parse(e),e=0;e<u.length;e++){let A=u[e];if(t.T=A[0],A=A[1],t.G==2)if(A[0]=="c"){t.I=A[1],t.ka=A[2];const R=A[3];R!=null&&(t.ma=R,t.j.info("VER="+t.ma));const z=A[4];z!=null&&(t.Ca=z,t.j.info("SVER="+t.Ca));const j=A[5];j!=null&&typeof j=="number"&&0<j&&(r=1.5*j,t.J=r,t.j.info("backChannelRequestTimeoutMs_="+r)),r=t;const ee=i.g;if(ee){const se=ee.g?ee.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(se){var f=r.h;f.g||se.indexOf("spdy")==-1&&se.indexOf("quic")==-1&&se.indexOf("h2")==-1||(f.j=f.l,f.g=new Set,f.h&&(Fx(f,f.h),f.h=null))}if(r.D){const be=ee.g?ee.g.getResponseHeader("X-HTTP-Session-Id"):null;be&&(r.za=be,pi(r.F,r.D,be))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-i.F,t.j.info("Handshake RTT: "+t.P+"ms")),r=t;var y=i;if(r.sa=BS(r,r.H?r.ka:null,r.V),y.J){bS(r.h,y);var l=y,T=r.J;T&&l.setTimeout(T),l.B&&(J_(l),zp(l)),r.g=y}else PS(r);0<t.i.length&&ry(t)}else A[0]!="stop"&&A[0]!="close"||yc(t,7);else t.G==3&&(A[0]=="stop"||A[0]=="close"?A[0]=="stop"?yc(t,7):jx(t):A[0]!="noop"&&t.l&&t.l.wa(A),t.A=0)}}np(4)}catch{}}function Uz(i){if(i.W&&typeof i.W=="function")return i.W();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if($_(i)){for(var e=[],t=i.length,r=0;r<t;r++)e.push(i[r]);return e}e=[],t=0;for(r in i)e[t++]=i[r];return e}function Vz(i){if(i.oa&&typeof i.oa=="function")return i.oa();if(!i.W||typeof i.W!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if($_(i)||typeof i=="string"){var e=[];i=i.length;for(var t=0;t<i;t++)e.push(t);return e}e=[],t=0;for(const r in i)e[t++]=r;return e}}}function fS(i,e){if(i.forEach&&typeof i.forEach=="function")i.forEach(e,void 0);else if($_(i)||typeof i=="string")Array.prototype.forEach.call(i,e,void 0);else for(var t=Vz(i),r=Uz(i),u=r.length,f=0;f<u;f++)e.call(void 0,r[f],t&&t[f],i)}var pS=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function jz(i,e){if(i){i=i.split("&");for(var t=0;t<i.length;t++){var r=i[t].indexOf("="),u=null;if(0<=r){var f=i[t].substring(0,r);u=i[t].substring(r+1)}else f=i[t];e(f,u?decodeURIComponent(u.replace(/\+/g," ")):"")}}}function bc(i,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,i instanceof bc){this.h=e!==void 0?e:i.h,E_(this,i.j),this.s=i.s,this.g=i.g,I_(this,i.m),this.l=i.l,e=i.i;var t=new ip;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),dE(this,t),this.o=i.o}else i&&(t=String(i).match(pS))?(this.h=!!e,E_(this,t[1]||"",!0),this.s=Ff(t[2]||""),this.g=Ff(t[3]||"",!0),I_(this,t[4]),this.l=Ff(t[5]||"",!0),dE(this,t[6]||"",!0),this.o=Ff(t[7]||"")):(this.h=!!e,this.i=new ip(null,this.h))}bc.prototype.toString=function(){var i=[],e=this.j;e&&i.push(Nf(e,fE,!0),":");var t=this.g;return(t||e=="file")&&(i.push("//"),(e=this.s)&&i.push(Nf(e,fE,!0),"@"),i.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&i.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&i.push("/"),i.push(Nf(t,t.charAt(0)=="/"?qz:$z,!0))),(t=this.i.toString())&&i.push("?",t),(t=this.o)&&i.push("#",Nf(t,Zz)),i.join("")};function Jo(i){return new bc(i)}function E_(i,e,t){i.j=t?Ff(e,!0):e,i.j&&(i.j=i.j.replace(/:$/,""))}function I_(i,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);i.m=e}else i.m=null}function dE(i,e,t){e instanceof ip?(i.i=e,Hz(i.i,i.h)):(t||(e=Nf(e,Wz)),i.i=new ip(e,i.h))}function pi(i,e,t){i.i.set(e,t)}function ey(i){return pi(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function Ff(i,e){return i?e?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Nf(i,e,t){return typeof i=="string"?(i=encodeURI(i).replace(e,Gz),t&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Gz(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var fE=/[#\/\?@]/g,$z=/[#\?:]/g,qz=/[#\?]/g,Wz=/[#\?@]/g,Zz=/#/g;function ip(i,e){this.h=this.g=null,this.i=i||null,this.j=!!e}function xl(i){i.g||(i.g=new Map,i.h=0,i.i&&jz(i.i,function(e,t){i.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}qt=ip.prototype;qt.add=function(i,e){xl(this),this.i=null,i=Fh(this,i);var t=this.g.get(i);return t||this.g.set(i,t=[]),t.push(e),this.h+=1,this};function mS(i,e){xl(i),e=Fh(i,e),i.g.has(e)&&(i.i=null,i.h-=i.g.get(e).length,i.g.delete(e))}function gS(i,e){return xl(i),e=Fh(i,e),i.g.has(e)}qt.forEach=function(i,e){xl(this),this.g.forEach(function(t,r){t.forEach(function(u){i.call(e,u,r,this)},this)},this)};qt.oa=function(){xl(this);const i=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const u=i[r];for(let f=0;f<u.length;f++)t.push(e[r])}return t};qt.W=function(i){xl(this);let e=[];if(typeof i=="string")gS(this,i)&&(e=e.concat(this.g.get(Fh(this,i))));else{i=Array.from(this.g.values());for(let t=0;t<i.length;t++)e=e.concat(i[t])}return e};qt.set=function(i,e){return xl(this),this.i=null,i=Fh(this,i),gS(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[e]),this.h+=1,this};qt.get=function(i,e){return i?(i=this.W(i),0<i.length?String(i[0]):e):e};function _S(i,e,t){mS(i,e),0<t.length&&(i.i=null,i.g.set(Fh(i,e),Ix(t)),i.h+=t.length)}qt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const f=encodeURIComponent(String(r)),y=this.W(r);for(r=0;r<y.length;r++){var u=f;y[r]!==""&&(u+="="+encodeURIComponent(String(y[r]))),i.push(u)}}return this.i=i.join("&")};function Fh(i,e){return e=String(e),i.j&&(e=e.toLowerCase()),e}function Hz(i,e){e&&!i.j&&(xl(i),i.i=null,i.g.forEach(function(t,r){var u=r.toLowerCase();r!=u&&(mS(this,r),_S(this,u,t))},i)),i.j=e}var Xz=class{constructor(i,e){this.h=i,this.g=e}};function yS(i){this.l=i||Kz,dn.PerformanceNavigationTiming?(i=dn.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(dn.g&&dn.g.Ga&&dn.g.Ga()&&dn.g.Ga().$b),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Kz=10;function vS(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function xS(i){return i.h?1:i.g?i.g.size:0}function q0(i,e){return i.h?i.h==e:i.g?i.g.has(e):!1}function Fx(i,e){i.g?i.g.add(e):i.h=e}function bS(i,e){i.h&&i.h==e?i.h=null:i.g&&i.g.has(e)&&i.g.delete(e)}yS.prototype.cancel=function(){if(this.i=wS(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function wS(i){if(i.h!=null)return i.i.concat(i.h.D);if(i.g!=null&&i.g.size!==0){let e=i.i;for(const t of i.g.values())e=e.concat(t.D);return e}return Ix(i.i)}function Nx(){}Nx.prototype.stringify=function(i){return dn.JSON.stringify(i,void 0)};Nx.prototype.parse=function(i){return dn.JSON.parse(i,void 0)};function Yz(){this.g=new Nx}function Qz(i,e,t){const r=t||"";try{fS(i,function(u,f){let y=u;Mp(u)&&(y=Px(u)),e.push(r+f+"="+encodeURIComponent(y))})}catch(u){throw e.push(r+"type="+encodeURIComponent("_badmap")),u}}function Jz(i,e){const t=new X_;if(dn.Image){const r=new Image;r.onload=Ug(jg,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ug(jg,t,r,"TestLoadImage: error",!1,e),r.onabort=Ug(jg,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ug(jg,t,r,"TestLoadImage: timeout",!1,e),dn.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=i}else e(!1)}function jg(i,e,t,r,u){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,u(r)}catch{}}function Op(i){this.l=i.ac||null,this.j=i.jb||!1}vr(Op,zx);Op.prototype.g=function(){return new ty(this.l,this.j)};Op.prototype.i=function(i){return function(){return i}}({});function ty(i,e){rr.call(this),this.D=i,this.u=e,this.m=void 0,this.readyState=Ux,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}vr(ty,rr);var Ux=0;qt=ty.prototype;qt.open=function(i,e){if(this.readyState!=Ux)throw this.abort(),Error("Error reopening a connection");this.C=i,this.B=e,this.readyState=1,rp(this)};qt.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};i&&(e.body=i),(this.D||dn).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))};qt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Bp(this)),this.readyState=Ux};qt.Wa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,rp(this)),this.g&&(this.readyState=3,rp(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof dn.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;TS(this)}else i.text().then(this.Va.bind(this),this.ga.bind(this))};function TS(i){i.j.read().then(i.Ta.bind(i)).catch(i.ga.bind(i))}qt.Ta=function(i){if(this.g){if(this.u&&i.value)this.response.push(i.value);else if(!this.u){var e=i.value?i.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!i.done}))&&(this.response=this.responseText+=e)}i.done?Bp(this):rp(this),this.readyState==3&&TS(this)}};qt.Va=function(i){this.g&&(this.response=this.responseText=i,Bp(this))};qt.Ua=function(i){this.g&&(this.response=i,Bp(this))};qt.ga=function(){this.g&&Bp(this)};function Bp(i){i.readyState=4,i.l=null,i.j=null,i.A=null,rp(i)}qt.setRequestHeader=function(i,e){this.v.append(i,e)};qt.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""};qt.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,i.push(t[0]+": "+t[1]),t=e.next();return i.join(`\r
`)};function rp(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});var eO=dn.JSON.parse;function Ci(i){rr.call(this),this.headers=new Map,this.u=i||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=ES,this.K=this.L=!1}vr(Ci,rr);var ES="",tO=/^https?$/i,nO=["POST","PUT"];qt=Ci.prototype;qt.Ka=function(i){this.L=i};qt.da=function(i,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+i);e=e?e.toUpperCase():"GET",this.H=i,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():V0.g(),this.C=this.u?hE(this.u):hE(V0),this.g.onreadystatechange=Mr(this.Ha,this);try{this.F=!0,this.g.open(e,String(i),!0),this.F=!1}catch(f){pE(this,f);return}if(i=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var u in r)t.set(u,r[u]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(const f of r.keys())t.set(f,r.get(f));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(f=>f.toLowerCase()=="content-type"),u=dn.FormData&&i instanceof dn.FormData,!(0<=U2(nO,e))||r||u||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[f,y]of t)this.g.setRequestHeader(f,y);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{AS(this),0<this.B&&((this.K=iO(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Mr(this.qa,this)):this.A=Lx(this.qa,this.B,this)),this.v=!0,this.g.send(i),this.v=!1}catch(f){pE(this,f)}};function iO(i){return wh&&xz()&&typeof i.timeout=="number"&&i.ontimeout!==void 0}qt.qa=function(){typeof Ex<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,mr(this,"timeout"),this.abort(8))};function pE(i,e){i.h=!1,i.g&&(i.l=!0,i.g.abort(),i.l=!1),i.j=e,i.m=5,IS(i),ny(i)}function IS(i){i.D||(i.D=!0,mr(i,"complete"),mr(i,"error"))}qt.abort=function(i){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=i||7,mr(this,"complete"),mr(this,"abort"),ny(this))};qt.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ny(this,!0)),Ci.X.M.call(this)};qt.Ha=function(){this.s||(this.F||this.v||this.l?SS(this):this.fb())};qt.fb=function(){SS(this)};function SS(i){if(i.h&&typeof Ex<"u"&&(!i.C[1]||Zo(i)!=4||i.aa()!=2)){if(i.v&&Zo(i)==4)Lx(i.Ha,0,i);else if(mr(i,"readystatechange"),Zo(i)==4){i.h=!1;try{const l=i.aa();e:switch(l){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=l===0){var u=String(i.H).match(pS)[1]||null;if(!u&&dn.self&&dn.self.location){var f=dn.self.location.protocol;u=f.substr(0,f.length-1)}r=!tO.test(u?u.toLowerCase():"")}t=r}if(t)mr(i,"complete"),mr(i,"success");else{i.m=6;try{var y=2<Zo(i)?i.g.statusText:""}catch{y=""}i.j=y+" ["+i.aa()+"]",IS(i)}}finally{ny(i)}}}}function ny(i,e){if(i.g){AS(i);const t=i.g,r=i.C[0]?x_:null;i.g=null,i.C=null,e||mr(i,"ready");try{t.onreadystatechange=r}catch{}}}function AS(i){i.g&&i.K&&(i.g.ontimeout=null),i.A&&(dn.clearTimeout(i.A),i.A=null)}function Zo(i){return i.g?i.g.readyState:0}qt.aa=function(){try{return 2<Zo(this)?this.g.status:-1}catch{return-1}};qt.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}};qt.Sa=function(i){if(this.g){var e=this.g.responseText;return i&&e.indexOf(i)==0&&(e=e.substring(i.length)),eO(e)}};function mE(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.J){case ES:case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}qt.Ea=function(){return this.m};qt.Oa=function(){return typeof this.j=="string"?this.j:String(this.j)};function CS(i){let e="";return Ax(i,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function Vx(i,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=CS(t),typeof i=="string"?t!=null&&encodeURIComponent(String(t)):pi(i,e,t))}function Af(i,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[i]||e}function kS(i){this.Ca=0,this.i=[],this.j=new X_,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Af("failFast",!1,i),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Af("baseRetryDelayMs",5e3,i),this.bb=Af("retryDelaySeedMs",1e4,i),this.$a=Af("forwardChannelMaxRetries",2,i),this.ta=Af("forwardChannelRequestTimeoutMs",2e4,i),this.ra=i&&i.xmlHttpFactory||void 0,this.Da=i&&i.Zb||!1,this.J=void 0,this.H=i&&i.supportsCrossDomainXhr||!1,this.I="",this.h=new yS(i&&i.concurrentRequestLimit),this.Fa=new Yz,this.O=i&&i.fastHandshake||!1,this.N=i&&i.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=i&&i.Xb||!1,i&&i.Aa&&this.j.Aa(),i&&i.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&i&&i.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}qt=kS.prototype;qt.ma=8;qt.G=1;function jx(i){if(MS(i),i.G==3){var e=i.U++,t=Jo(i.F);pi(t,"SID",i.I),pi(t,"RID",e),pi(t,"TYPE","terminate"),Fp(i,t),e=new Lp(i,i.j,e,void 0),e.K=2,e.v=ey(Jo(t)),t=!1,dn.navigator&&dn.navigator.sendBeacon&&(t=dn.navigator.sendBeacon(e.v.toString(),"")),!t&&dn.Image&&(new Image().src=e.v,t=!0),t||(e.g=FS(e.l,null),e.g.da(e.v)),e.F=Date.now(),zp(e)}OS(i)}function iy(i){i.g&&($x(i),i.g.cancel(),i.g=null)}function MS(i){iy(i),i.u&&(dn.clearTimeout(i.u),i.u=null),S_(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&dn.clearTimeout(i.m),i.m=null)}function ry(i){vS(i.h)||i.m||(i.m=!0,Q2(i.Ja,i),i.C=0)}function rO(i,e){return xS(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=e.D.concat(i.i),!0):i.G==1||i.G==2||i.C>=(i.Za?0:i.$a)?!1:(i.m=Pp(Mr(i.Ja,i,e),zS(i,i.C)),i.C++,!0)}qt.Ja=function(i){if(this.m)if(this.m=null,this.G==1){if(!i){this.U=Math.floor(1e5*Math.random()),i=this.U++;const u=new Lp(this,this.j,i,void 0);let f=this.s;if(this.S&&(f?(f=$2(f),q2(f,this.S)):f=this.S),this.o!==null||this.N||(u.H=f,f=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){t:{var r=this.i[t];if("__data__"in r.g&&(r=r.g.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=DS(this,u,e),t=Jo(this.F),pi(t,"RID",i),pi(t,"CVER",22),this.D&&pi(t,"X-HTTP-Session-Id",this.D),Fp(this,t),f&&(this.N?e="headers="+encodeURIComponent(String(CS(f)))+"&"+e:this.o&&Vx(t,this.o,f)),Fx(this.h,u),this.Ya&&pi(t,"TYPE","init"),this.O?(pi(t,"$req",e),pi(t,"SID","null"),u.Z=!0,G0(u,t,null)):G0(u,t,e),this.G=2}}else this.G==3&&(i?gE(this,i):this.i.length==0||vS(this.h)||gE(this))};function gE(i,e){var t;e?t=e.m:t=i.U++;const r=Jo(i.F);pi(r,"SID",i.I),pi(r,"RID",t),pi(r,"AID",i.T),Fp(i,r),i.o&&i.s&&Vx(r,i.o,i.s),t=new Lp(i,i.j,t,i.C+1),i.o===null&&(t.H=i.s),e&&(i.i=e.D.concat(i.i)),e=DS(i,t,1e3),t.setTimeout(Math.round(.5*i.ta)+Math.round(.5*i.ta*Math.random())),Fx(i.h,t),G0(t,r,e)}function Fp(i,e){i.ia&&Ax(i.ia,function(t,r){pi(e,r,t)}),i.l&&fS({},function(t,r){pi(e,r,t)})}function DS(i,e,t){t=Math.min(i.i.length,t);var r=i.l?Mr(i.l.Ra,i.l,i):null;e:{var u=i.i;let f=-1;for(;;){const y=["count="+t];f==-1?0<t?(f=u[0].h,y.push("ofs="+f)):f=0:y.push("ofs="+f);let l=!0;for(let T=0;T<t;T++){let A=u[T].h;const R=u[T].g;if(A-=f,0>A)f=Math.max(0,u[T].h-100),l=!1;else try{Qz(R,y,"req"+A+"_")}catch{r&&r(R)}}if(l){r=y.join("&");break e}}}return i=i.i.splice(0,t),e.D=i,r}function PS(i){i.g||i.u||(i.Z=1,Q2(i.Ia,i),i.A=0)}function Gx(i){return i.g||i.u||3<=i.A?!1:(i.Z++,i.u=Pp(Mr(i.Ia,i),zS(i,i.A)),i.A++,!0)}qt.Ia=function(){if(this.u=null,RS(this),this.$&&!(this.K||this.g==null||0>=this.P)){var i=2*this.P;this.j.info("BP detection timer enabled: "+i),this.B=Pp(Mr(this.eb,this),i)}};qt.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Br(10),iy(this),RS(this))};function $x(i){i.B!=null&&(dn.clearTimeout(i.B),i.B=null)}function RS(i){i.g=new Lp(i,i.j,"rpc",i.Z),i.o===null&&(i.g.H=i.s),i.g.N=0;var e=Jo(i.sa);pi(e,"RID","rpc"),pi(e,"SID",i.I),pi(e,"CI",i.L?"0":"1"),pi(e,"AID",i.T),pi(e,"TYPE","xmlhttp"),Fp(i,e),i.o&&i.s&&Vx(e,i.o,i.s),i.J&&i.g.setTimeout(i.J);var t=i.g;i=i.ka,t.K=1,t.v=ey(Jo(e)),t.s=null,t.P=!0,cS(t,i)}qt.cb=function(){this.v!=null&&(this.v=null,iy(this),Gx(this),Br(19))};function S_(i){i.v!=null&&(dn.clearTimeout(i.v),i.v=null)}function LS(i,e){var t=null;if(i.g==e){S_(i),$x(i),i.g=null;var r=2}else if(q0(i.h,e))t=e.D,bS(i.h,e),r=1;else return;if(i.G!=0){if(i.pa=e.Y,e.i)if(r==1){t=e.s?e.s.length:0,e=Date.now()-e.F;var u=i.C;r=K_(),mr(r,new sS(r,t)),ry(i)}else PS(i);else if(u=e.o,u==3||u==0&&0<i.pa||!(r==1&&rO(i,e)||r==2&&Gx(i)))switch(t&&0<t.length&&(e=i.h,e.i=e.i.concat(t)),u){case 1:yc(i,5);break;case 4:yc(i,10);break;case 3:yc(i,6);break;default:yc(i,2)}}}function zS(i,e){let t=i.Xa+Math.floor(Math.random()*i.bb);return i.l||(t*=2),t*e}function yc(i,e){if(i.j.info("Error code "+e),e==2){var t=null;i.l&&(t=null);var r=Mr(i.kb,i);t||(t=new bc("//www.google.com/images/cleardot.gif"),dn.location&&dn.location.protocol=="http"||E_(t,"https"),ey(t)),Jz(t.toString(),r)}else Br(2);i.G=0,i.l&&i.l.va(e),OS(i),MS(i)}qt.kb=function(i){i?(this.j.info("Successfully pinged google.com"),Br(2)):(this.j.info("Failed to ping google.com"),Br(1))};function OS(i){if(i.G=0,i.la=[],i.l){const e=wS(i.h);(e.length!=0||i.i.length!=0)&&(sE(i.la,e),sE(i.la,i.i),i.h.i.length=0,Ix(i.i),i.i.length=0),i.l.ua()}}function BS(i,e,t){var r=t instanceof bc?Jo(t):new bc(t,void 0);if(r.g!="")e&&(r.g=e+"."+r.g),I_(r,r.m);else{var u=dn.location;r=u.protocol,e=e?e+"."+u.hostname:u.hostname,u=+u.port;var f=new bc(null,void 0);r&&E_(f,r),e&&(f.g=e),u&&I_(f,u),t&&(f.l=t),r=f}return t=i.D,e=i.za,t&&e&&pi(r,t,e),pi(r,"VER",i.ma),Fp(i,r),r}function FS(i,e,t){if(e&&!i.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=t&&i.Da&&!i.ra?new Ci(new Op({jb:!0})):new Ci(i.ra),e.Ka(i.H),e}function NS(){}qt=NS.prototype;qt.xa=function(){};qt.wa=function(){};qt.va=function(){};qt.ua=function(){};qt.Ra=function(){};function A_(){if(wh&&!(10<=Number(bz)))throw Error("Environmental error: no available transport.")}A_.prototype.g=function(i,e){return new us(i,e)};function us(i,e){rr.call(this),this.g=new kS(e),this.l=i,this.h=e&&e.messageUrlParams||null,i=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.s=i,i=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(i?i["X-WebChannel-Content-Type"]=e.messageContentType:i={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(i?i["X-WebChannel-Client-Profile"]=e.ya:i={"X-WebChannel-Client-Profile":e.ya}),this.g.S=i,(i=e&&e.Yb)&&!b_(i)&&(this.g.o=i),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!b_(e)&&(this.g.D=e,i=this.h,i!==null&&e in i&&(i=this.h,e in i&&delete i[e])),this.j=new Nh(this)}vr(us,rr);us.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var i=this.g,e=this.l,t=this.h||void 0;Br(0),i.V=e,i.ia=t||{},i.L=i.Y,i.F=BS(i,null,i.V),ry(i)};us.prototype.close=function(){jx(this.g)};us.prototype.u=function(i){var e=this.g;if(typeof i=="string"){var t={};t.__data__=i,i=t}else this.v&&(t={},t.__data__=Px(i),i=t);e.i.push(new Xz(e.ab++,i)),e.G==3&&ry(e)};us.prototype.M=function(){this.g.l=null,delete this.j,jx(this.g),delete this.g,us.X.M.call(this)};function US(i){Ox.call(this);var e=i.__sm__;if(e){e:{for(const t in e){i=t;break e}i=void 0}(this.i=i)&&(i=this.i,e=e!==null&&i in e?e[i]:void 0),this.data=e}else this.data=i}vr(US,Ox);function VS(){Bx.call(this),this.status=1}vr(VS,Bx);function Nh(i){this.g=i}vr(Nh,NS);Nh.prototype.xa=function(){mr(this.g,"a")};Nh.prototype.wa=function(i){mr(this.g,new US(i))};Nh.prototype.va=function(i){mr(this.g,new VS)};Nh.prototype.ua=function(){mr(this.g,"b")};A_.prototype.createWebChannel=A_.prototype.g;us.prototype.send=us.prototype.u;us.prototype.open=us.prototype.m;us.prototype.close=us.prototype.close;Y_.NO_ERROR=0;Y_.TIMEOUT=8;Y_.HTTP_ERROR=6;oS.COMPLETE="complete";aS.EventType=Rp;Rp.OPEN="a";Rp.CLOSE="b";Rp.ERROR="c";Rp.MESSAGE="d";rr.prototype.listen=rr.prototype.N;Ci.prototype.listenOnce=Ci.prototype.O;Ci.prototype.getLastError=Ci.prototype.Oa;Ci.prototype.getLastErrorCode=Ci.prototype.Ea;Ci.prototype.getStatus=Ci.prototype.aa;Ci.prototype.getResponseJson=Ci.prototype.Sa;Ci.prototype.getResponseText=Ci.prototype.fa;Ci.prototype.send=Ci.prototype.da;Ci.prototype.setWithCredentials=Ci.prototype.Ka;var sO=function(){return new A_},oO=function(){return K_()},g0=Y_,aO=oS,lO=Uc,_E={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},cO=Op,Gg=aS,uO=Ci;const yE="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ir.UNAUTHENTICATED=new ir(null),ir.GOOGLE_CREDENTIALS=new ir("google-credentials-uid"),ir.FIRST_PARTY=new ir("first-party-uid"),ir.MOCK_USER=new ir("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uh="9.15.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const al=new wx("@firebase/firestore");function W0(){return al.logLevel}function HU(i){al.setLogLevel(i)}function ot(i,...e){if(al.logLevel<=$n.DEBUG){const t=e.map(qx);al.debug(`Firestore (${Uh}): ${i}`,...t)}}function Ri(i,...e){if(al.logLevel<=$n.ERROR){const t=e.map(qx);al.error(`Firestore (${Uh}): ${i}`,...t)}}function Th(i,...e){if(al.logLevel<=$n.WARN){const t=e.map(qx);al.warn(`Firestore (${Uh}): ${i}`,...t)}}function qx(i){if(typeof i=="string")return i;try{return e=i,JSON.stringify(e)}catch{return i}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pt(i="Unexpected state"){const e=`FIRESTORE (${Uh}) INTERNAL ASSERTION FAILED: `+i;throw Ri(e),new Error(e)}function jt(i,e){i||Pt()}function XU(i,e){i||Pt()}function Et(i,e){return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ze={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class nt extends ra{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class hO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ir.UNAUTHENTICATED))}shutdown(){}}class dO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class fO{constructor(e){this.t=e,this.currentUser=ir.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i;const u=T=>this.i!==r?(r=this.i,t(T)):Promise.resolve();let f=new Zi;this.o=()=>{this.i++,this.currentUser=this.u(),f.resolve(),f=new Zi,e.enqueueRetryable(()=>u(this.currentUser))};const y=()=>{const T=f;e.enqueueRetryable(async()=>{await T.promise,await u(this.currentUser)})},l=T=>{ot("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=T,this.auth.addAuthTokenListener(this.o),y()};this.t.onInit(T=>l(T)),setTimeout(()=>{if(!this.auth){const T=this.t.getImmediate({optional:!0});T?l(T):(ot("FirebaseAuthCredentialsProvider","Auth not yet detected"),f.resolve(),f=new Zi)}},0),y()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(ot("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(jt(typeof r.accessToken=="string"),new jS(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return jt(e===null||typeof e=="string"),new ir(e)}}class pO{constructor(e,t,r,u){this.h=e,this.l=t,this.m=r,this.g=u,this.type="FirstParty",this.user=ir.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(jt(!(typeof this.h!="object"||this.h===null||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class mO{constructor(e,t,r,u){this.h=e,this.l=t,this.m=r,this.g=u}getToken(){return Promise.resolve(new pO(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(ir.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class GS{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class gO{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const r=f=>{f.error!=null&&ot("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${f.error.message}`);const y=f.token!==this.A;return this.A=f.token,ot("FirebaseAppCheckTokenProvider",`Received ${y?"new":"existing"} token.`),y?t(f.token):Promise.resolve()};this.o=f=>{e.enqueueRetryable(()=>r(f))};const u=f=>{ot("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=f,this.appCheck.addTokenListener(this.o)};this.T.onInit(f=>u(f)),setTimeout(()=>{if(!this.appCheck){const f=this.T.getImmediate({optional:!0});f?u(f):ot("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(jt(typeof t.token=="string"),this.A=t.token,new GS(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class KU{getToken(){return Promise.resolve(new GS(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _O(i){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<i;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $S{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const u=_O(40);for(let f=0;f<u.length;++f)r.length<20&&u[f]<t&&(r+=e.charAt(u[f]%e.length))}return r}}function hn(i,e){return i<e?-1:i>e?1:0}function Eh(i,e,t){return i.length===e.length&&i.every((r,u)=>t(r,e[u]))}function qS(i){return i+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new nt(ze.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new nt(ze.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new nt(ze.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new nt(ze.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return xi.fromMillis(Date.now())}static fromDate(e){return xi.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new xi(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?hn(this.nanoseconds,e.nanoseconds):hn(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ht(e)}static min(){return new Ht(new xi(0,0))}static max(){return new Ht(new xi(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sp{constructor(e,t,r){t===void 0?t=0:t>e.length&&Pt(),r===void 0?r=e.length-t:r>e.length-t&&Pt(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return sp.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof sp?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let u=0;u<r;u++){const f=e.get(u),y=t.get(u);if(f<y)return-1;if(f>y)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class On extends sp{construct(e,t,r){return new On(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new nt(ze.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(u=>u.length>0))}return new On(t)}static emptyPath(){return new On([])}}const yO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Li extends sp{construct(e,t,r){return new Li(e,t,r)}static isValidIdentifier(e){return yO.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Li.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Li(["__name__"])}static fromServerFormat(e){const t=[];let r="",u=0;const f=()=>{if(r.length===0)throw new nt(ze.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let y=!1;for(;u<e.length;){const l=e[u];if(l==="\\"){if(u+1===e.length)throw new nt(ze.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const T=e[u+1];if(T!=="\\"&&T!=="."&&T!=="`")throw new nt(ze.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=T,u+=2}else l==="`"?(y=!y,u++):l!=="."||y?(r+=l,u++):(f(),u++)}if(f(),y)throw new nt(ze.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Li(t)}static emptyPath(){return new Li([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e){this.path=e}static fromPath(e){return new Tt(On.fromString(e))}static fromName(e){return new Tt(On.fromString(e).popFirst(5))}static empty(){return new Tt(On.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&On.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return On.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Tt(new On(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{constructor(e,t,r,u){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=u}}function Z0(i){return i.fields.find(e=>e.kind===2)}function hc(i){return i.fields.filter(e=>e.kind!==2)}function vO(i,e){let t=hn(i.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(i.fields.length,e.fields.length);++r)if(t=xO(i.fields[r],e.fields[r]),t!==0)return t;return hn(i.fields.length,e.fields.length)}C_.UNKNOWN_ID=-1;class Qg{constructor(e,t){this.fieldPath=e,this.kind=t}}function xO(i,e){const t=Li.comparator(i.fieldPath,e.fieldPath);return t!==0?t:hn(i.kind,e.kind)}class op{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new op(0,hs.min())}}function WS(i,e){const t=i.toTimestamp().seconds,r=i.toTimestamp().nanoseconds+1,u=Ht.fromTimestamp(r===1e9?new xi(t+1,0):new xi(t,r));return new hs(u,Tt.empty(),e)}function ZS(i){return new hs(i.readTime,i.key,-1)}class hs{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new hs(Ht.min(),Tt.empty(),-1)}static max(){return new hs(Ht.max(),Tt.empty(),-1)}}function Wx(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=Tt.comparator(i.documentKey,e.documentKey),t!==0?t:hn(i.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HS="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class XS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bl(i){if(i.code!==ze.FAILED_PRECONDITION||i.message!==HS)throw i;ot("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Pt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Me((r,u)=>{this.nextCallback=f=>{this.wrapSuccess(e,f).next(r,u)},this.catchCallback=f=>{this.wrapFailure(t,f).next(r,u)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Me?t:Me.resolve(t)}catch(t){return Me.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Me.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Me.reject(t)}static resolve(e){return new Me((t,r)=>{t(e)})}static reject(e){return new Me((t,r)=>{r(e)})}static waitFor(e){return new Me((t,r)=>{let u=0,f=0,y=!1;e.forEach(l=>{++u,l.next(()=>{++f,y&&f===u&&t()},T=>r(T))}),y=!0,f===u&&t()})}static or(e){let t=Me.resolve(!1);for(const r of e)t=t.next(u=>u?Me.resolve(u):r());return t}static forEach(e,t){const r=[];return e.forEach((u,f)=>{r.push(t.call(this,u,f))}),this.waitFor(r)}static mapArray(e,t){return new Me((r,u)=>{const f=e.length,y=new Array(f);let l=0;for(let T=0;T<f;T++){const A=T;t(e[A]).next(R=>{y[A]=R,++l,l===f&&r(y)},R=>u(R))}})}static doWhile(e,t){return new Me((r,u)=>{const f=()=>{e()===!0?t().next(()=>{f()},u):r()};f()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new Zi,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new Wf(e,t.error)):this.P.resolve()},this.transaction.onerror=r=>{const u=Zx(r.target.error);this.P.reject(new Wf(e,u))}}static open(e,t,r,u){try{return new sy(t,e.transaction(u,r))}catch(f){throw new Wf(t,f)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(ot("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new wO(t)}}class Gs{constructor(e,t,r){this.name=e,this.version=t,this.S=r,Gs.D(Hi())===12.2&&Ri("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ot("SimpleDb","Removing database:",e),dc(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!D2())return!1;if(Gs.N())return!0;const e=Hi(),t=Gs.D(e),r=0<t&&t<10,u=Gs.k(e),f=0<u&&u<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||f)}static N(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.O)==="YES"}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static k(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}async F(e){return this.db||(ot("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const u=indexedDB.open(this.name,this.version);u.onsuccess=f=>{const y=f.target.result;t(y)},u.onblocked=()=>{r(new Wf(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},u.onerror=f=>{const y=f.target.error;y.name==="VersionError"?r(new nt(ze.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):y.name==="InvalidStateError"?r(new nt(ze.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+y)):r(new Wf(e,y))},u.onupgradeneeded=f=>{ot("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',f.oldVersion);const y=f.target.result;this.S.$(y,u.transaction,f.oldVersion,this.version).next(()=>{ot("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,u){const f=t==="readonly";let y=0;for(;;){++y;try{this.db=await this.F(e);const l=sy.open(this.db,e,f?"readonly":"readwrite",r),T=u(l).next(A=>(l.V(),A)).catch(A=>(l.abort(A),Me.reject(A))).toPromise();return T.catch(()=>{}),await l.v,T}catch(l){const T=l,A=T.name!=="FirebaseError"&&y<3;if(ot("SimpleDb","Transaction failed with error:",T.message,"Retrying:",A),this.close(),!A)return Promise.reject(T)}}}close(){this.db&&this.db.close(),this.db=void 0}}class bO{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return dc(this.q.delete())}}class Wf extends nt{constructor(e,t){super(ze.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function wl(i){return i.name==="IndexedDbTransactionError"}class wO{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(ot("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(ot("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),dc(r)}add(e){return ot("SimpleDb","ADD",this.store.name,e,e),dc(this.store.add(e))}get(e){return dc(this.store.get(e)).next(t=>(t===void 0&&(t=null),ot("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return ot("SimpleDb","DELETE",this.store.name,e),dc(this.store.delete(e))}count(){return ot("SimpleDb","COUNT",this.store.name),dc(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||typeof this.store.getAll!="function"){const u=this.cursor(r),f=[];return this.H(u,(y,l)=>{f.push(l)}).next(()=>f)}{const u=this.store.getAll(r.range);return new Me((f,y)=>{u.onerror=l=>{y(l.target.error)},u.onsuccess=l=>{f(l.target.result)}})}}J(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new Me((u,f)=>{r.onerror=y=>{f(y.target.error)},r.onsuccess=y=>{u(y.target.result)}})}Y(e,t){ot("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const u=this.cursor(r);return this.H(u,(f,y,l)=>l.delete())}Z(e,t){let r;t?r=e:(r={},t=e);const u=this.cursor(r);return this.H(u,t)}tt(e){const t=this.cursor({});return new Me((r,u)=>{t.onerror=f=>{const y=Zx(f.target.error);u(y)},t.onsuccess=f=>{const y=f.target.result;y?e(y.primaryKey,y.value).next(l=>{l?y.continue():r()}):r()}})}H(e,t){const r=[];return new Me((u,f)=>{e.onerror=y=>{f(y.target.error)},e.onsuccess=y=>{const l=y.target.result;if(!l)return void u();const T=new bO(l),A=t(l.primaryKey,l.value,T);if(A instanceof Me){const R=A.catch(z=>(T.done(),Me.reject(z)));r.push(R)}T.isDone?u():T.G===null?l.continue():l.continue(T.G)}}).next(()=>Me.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function dc(i){return new Me((e,t)=>{i.onsuccess=r=>{const u=r.target.result;e(u)},i.onerror=r=>{const u=Zx(r.target.error);t(u)}})}let vE=!1;function Zx(i){const e=Gs.D(Hi());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(i.message.indexOf(t)>=0){const r=new nt("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return vE||(vE=!0,setTimeout(()=>{throw r},0)),r}}return i}class TO{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}nt(e){ot("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{ot("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(t){wl(t)?ot("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await bl(t)}await this.nt(6e4)})}}class EO{constructor(e,t){this.localStore=e,this.persistence=t}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.it(t,e))}it(e,t){const r=new Set;let u=t,f=!0;return Me.doWhile(()=>f===!0&&u>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(y=>{if(y!==null&&!r.has(y))return ot("IndexBackiller",`Processing collection: ${y}`),this.rt(e,y,u).next(l=>{u-=l,r.add(y)});f=!1})).next(()=>t-u)}rt(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(u=>this.localStore.localDocuments.getNextDocuments(e,t,u,r).next(f=>{const y=f.changes;return this.localStore.indexManager.updateIndexEntries(e,y).next(()=>this.ot(u,f)).next(l=>(ot("IndexBackiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>y.size)}))}ot(e,t){let r=e;return t.changes.forEach((u,f)=>{const y=ZS(f);Wx(y,r)>0&&(r=y)}),new hs(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ut(r),this.ct=r=>t.writeSequenceNumber(r))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}Xr.at=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{constructor(e,t,r,u,f,y,l,T){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=u,this.ssl=f,this.forceLongPolling=y,this.autoDetectLongPolling=l,this.useFetchStreams=T}}class kc{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new kc("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof kc&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xE(i){let e=0;for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function Vc(i,e){for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function KS(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Np(i){return i==null}function ap(i){return i===0&&1/i==-1/0}function YS(i){return typeof i=="number"&&Number.isInteger(i)&&!ap(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YU(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Xi(t)}static fromUint8Array(e){const t=function(r){let u="";for(let f=0;f<r.length;++f)u+=String.fromCharCode(r[f]);return u}(e);return new Xi(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return hn(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xi.EMPTY_BYTE_STRING=new Xi("");const SO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ll(i){if(jt(!!i),typeof i=="string"){let e=0;const t=SO.exec(i);if(jt(!!t),t[1]){let u=t[1];u=(u+"000000000").substr(0,9),e=Number(u)}const r=new Date(i);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ai(i.seconds),nanos:Ai(i.nanos)}}function Ai(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function Mc(i){return typeof i=="string"?Xi.fromBase64String(i):Xi.fromUint8Array(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hx(i){var e,t;return((t=(((e=i==null?void 0:i.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function QS(i){const e=i.mapValue.fields.__previous_value__;return Hx(e)?QS(e):e}function lp(i){const e=ll(i.mapValue.fields.__local_write_time__.timestampValue);return new xi(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const el={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Jg={nullValue:"NULL_VALUE"};function Dc(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?Hx(i)?4:JS(i)?9007199254740991:10:Pt()}function Io(i,e){if(i===e)return!0;const t=Dc(i);if(t!==Dc(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return lp(i).isEqual(lp(e));case 3:return function(r,u){if(typeof r.timestampValue=="string"&&typeof u.timestampValue=="string"&&r.timestampValue.length===u.timestampValue.length)return r.timestampValue===u.timestampValue;const f=ll(r.timestampValue),y=ll(u.timestampValue);return f.seconds===y.seconds&&f.nanos===y.nanos}(i,e);case 5:return i.stringValue===e.stringValue;case 6:return function(r,u){return Mc(r.bytesValue).isEqual(Mc(u.bytesValue))}(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return function(r,u){return Ai(r.geoPointValue.latitude)===Ai(u.geoPointValue.latitude)&&Ai(r.geoPointValue.longitude)===Ai(u.geoPointValue.longitude)}(i,e);case 2:return function(r,u){if("integerValue"in r&&"integerValue"in u)return Ai(r.integerValue)===Ai(u.integerValue);if("doubleValue"in r&&"doubleValue"in u){const f=Ai(r.doubleValue),y=Ai(u.doubleValue);return f===y?ap(f)===ap(y):isNaN(f)&&isNaN(y)}return!1}(i,e);case 9:return Eh(i.arrayValue.values||[],e.arrayValue.values||[],Io);case 10:return function(r,u){const f=r.mapValue.fields||{},y=u.mapValue.fields||{};if(xE(f)!==xE(y))return!1;for(const l in f)if(f.hasOwnProperty(l)&&(y[l]===void 0||!Io(f[l],y[l])))return!1;return!0}(i,e);default:return Pt()}}function cp(i,e){return(i.values||[]).find(t=>Io(t,e))!==void 0}function cl(i,e){if(i===e)return 0;const t=Dc(i),r=Dc(e);if(t!==r)return hn(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return hn(i.booleanValue,e.booleanValue);case 2:return function(u,f){const y=Ai(u.integerValue||u.doubleValue),l=Ai(f.integerValue||f.doubleValue);return y<l?-1:y>l?1:y===l?0:isNaN(y)?isNaN(l)?0:-1:1}(i,e);case 3:return bE(i.timestampValue,e.timestampValue);case 4:return bE(lp(i),lp(e));case 5:return hn(i.stringValue,e.stringValue);case 6:return function(u,f){const y=Mc(u),l=Mc(f);return y.compareTo(l)}(i.bytesValue,e.bytesValue);case 7:return function(u,f){const y=u.split("/"),l=f.split("/");for(let T=0;T<y.length&&T<l.length;T++){const A=hn(y[T],l[T]);if(A!==0)return A}return hn(y.length,l.length)}(i.referenceValue,e.referenceValue);case 8:return function(u,f){const y=hn(Ai(u.latitude),Ai(f.latitude));return y!==0?y:hn(Ai(u.longitude),Ai(f.longitude))}(i.geoPointValue,e.geoPointValue);case 9:return function(u,f){const y=u.values||[],l=f.values||[];for(let T=0;T<y.length&&T<l.length;++T){const A=cl(y[T],l[T]);if(A)return A}return hn(y.length,l.length)}(i.arrayValue,e.arrayValue);case 10:return function(u,f){if(u===el.mapValue&&f===el.mapValue)return 0;if(u===el.mapValue)return 1;if(f===el.mapValue)return-1;const y=u.fields||{},l=Object.keys(y),T=f.fields||{},A=Object.keys(T);l.sort(),A.sort();for(let R=0;R<l.length&&R<A.length;++R){const z=hn(l[R],A[R]);if(z!==0)return z;const j=cl(y[l[R]],T[A[R]]);if(j!==0)return j}return hn(l.length,A.length)}(i.mapValue,e.mapValue);default:throw Pt()}}function bE(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return hn(i,e);const t=ll(i),r=ll(e),u=hn(t.seconds,r.seconds);return u!==0?u:hn(t.nanos,r.nanos)}function Ih(i){return H0(i)}function H0(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?function(r){const u=ll(r);return`time(${u.seconds},${u.nanos})`}(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?Mc(i.bytesValue).toBase64():"referenceValue"in i?(t=i.referenceValue,Tt.fromName(t).toString()):"geoPointValue"in i?`geo(${(e=i.geoPointValue).latitude},${e.longitude})`:"arrayValue"in i?function(r){let u="[",f=!0;for(const y of r.values||[])f?f=!1:u+=",",u+=H0(y);return u+"]"}(i.arrayValue):"mapValue"in i?function(r){const u=Object.keys(r.fields||{}).sort();let f="{",y=!0;for(const l of u)y?y=!1:f+=",",f+=`${l}:${H0(r.fields[l])}`;return f+"}"}(i.mapValue):Pt();var e,t}function Pc(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function X0(i){return!!i&&"integerValue"in i}function up(i){return!!i&&"arrayValue"in i}function wE(i){return!!i&&"nullValue"in i}function TE(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function e_(i){return!!i&&"mapValue"in i}function Zf(i){if(i.geoPointValue)return{geoPointValue:Object.assign({},i.geoPointValue)};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:Object.assign({},i.timestampValue)};if(i.mapValue){const e={mapValue:{fields:{}}};return Vc(i.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Zf(r)),e}if(i.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Zf(i.arrayValue.values[t]);return e}return Object.assign({},i)}function JS(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function AO(i){return"nullValue"in i?Jg:"booleanValue"in i?{booleanValue:!1}:"integerValue"in i||"doubleValue"in i?{doubleValue:NaN}:"timestampValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in i?{stringValue:""}:"bytesValue"in i?{bytesValue:""}:"referenceValue"in i?Pc(kc.empty(),Tt.empty()):"geoPointValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in i?{arrayValue:{}}:"mapValue"in i?{mapValue:{}}:Pt()}function CO(i){return"nullValue"in i?{booleanValue:!1}:"booleanValue"in i?{doubleValue:NaN}:"integerValue"in i||"doubleValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in i?{stringValue:""}:"stringValue"in i?{bytesValue:""}:"bytesValue"in i?Pc(kc.empty(),Tt.empty()):"referenceValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in i?{arrayValue:{}}:"arrayValue"in i?{mapValue:{}}:"mapValue"in i?el:Pt()}function EE(i,e){const t=cl(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?-1:!i.inclusive&&e.inclusive?1:0}function IE(i,e){const t=cl(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?1:!i.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(e,t){this.position=e,this.inclusive=t}}function SE(i,e,t){let r=0;for(let u=0;u<i.position.length;u++){const f=e[u],y=i.position[u];if(f.field.isKeyField()?r=Tt.comparator(Tt.fromName(y.referenceValue),t.key):r=cl(y,t.data.field(f.field)),f.dir==="desc"&&(r*=-1),r!==0)break}return r}function AE(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!Io(i.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eA{}class Dn extends eA{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new kO(e,t,r):t==="array-contains"?new PO(e,r):t==="in"?new lA(e,r):t==="not-in"?new RO(e,r):t==="array-contains-any"?new LO(e,r):new Dn(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new MO(e,r):new DO(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(cl(t,this.value)):t!==null&&Dc(this.value)===Dc(t)&&this.matchesComparison(cl(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Pt()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ti extends eA{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new ti(e,t)}matches(e){return Sh(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ht!==null||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return e!==null?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Sh(i){return i.op==="and"}function K0(i){return i.op==="or"}function tA(i){return nA(i)&&Sh(i)}function nA(i){for(const e of i.filters)if(e instanceof ti)return!1;return!0}function iA(i){if(i instanceof Dn)return i.field.canonicalString()+i.op.toString()+Ih(i.value);{const e=i.filters.map(t=>iA(t)).join(",");return`${i.op}(${e})`}}function rA(i,e){return i instanceof Dn?function(t,r){return r instanceof Dn&&t.op===r.op&&t.field.isEqual(r.field)&&Io(t.value,r.value)}(i,e):i instanceof ti?function(t,r){return r instanceof ti&&t.op===r.op&&t.filters.length===r.filters.length?t.filters.reduce((u,f,y)=>u&&rA(f,r.filters[y]),!0):!1}(i,e):void Pt()}function sA(i,e){const t=i.filters.concat(e);return ti.create(t,i.op)}function oA(i){return i instanceof Dn?function(e){return`${e.field.canonicalString()} ${e.op} ${Ih(e.value)}`}(i):i instanceof ti?function(e){return e.op.toString()+" {"+e.getFilters().map(oA).join(" ,")+"}"}(i):"Filter"}class kO extends Dn{constructor(e,t,r){super(e,t,r),this.key=Tt.fromName(r.referenceValue)}matches(e){const t=Tt.comparator(e.key,this.key);return this.matchesComparison(t)}}class MO extends Dn{constructor(e,t){super(e,"in",t),this.keys=aA("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class DO extends Dn{constructor(e,t){super(e,"not-in",t),this.keys=aA("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function aA(i,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Tt.fromName(r.referenceValue))}class PO extends Dn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return up(t)&&cp(t.arrayValue,this.value)}}class lA extends Dn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&cp(this.value.arrayValue,t)}}class RO extends Dn{constructor(e,t){super(e,"not-in",t)}matches(e){if(cp(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!cp(this.value.arrayValue,t)}}class LO extends Dn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!up(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>cp(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uh{constructor(e,t="asc"){this.field=e,this.dir=t}}function zO(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(e,t){this.comparator=e,this.root=t||fr.EMPTY}insert(e,t){return new ki(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,fr.BLACK,null,null))}remove(e){return new ki(this.comparator,this.root.remove(e,this.comparator).copy(null,null,fr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const u=this.comparator(e,r.key);if(u===0)return t+r.left.size;u<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new $g(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new $g(this.root,e,this.comparator,!1)}getReverseIterator(){return new $g(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new $g(this.root,e,this.comparator,!0)}}class $g{constructor(e,t,r,u){this.isReverse=u,this.nodeStack=[];let f=1;for(;!e.isEmpty();)if(f=t?r(e.key,t):1,t&&u&&(f*=-1),f<0)e=this.isReverse?e.left:e.right;else{if(f===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class fr{constructor(e,t,r,u,f){this.key=e,this.value=t,this.color=r!=null?r:fr.RED,this.left=u!=null?u:fr.EMPTY,this.right=f!=null?f:fr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,u,f){return new fr(e!=null?e:this.key,t!=null?t:this.value,r!=null?r:this.color,u!=null?u:this.left,f!=null?f:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let u=this;const f=r(e,u.key);return u=f<0?u.copy(null,null,null,u.left.insert(e,t,r),null):f===0?u.copy(null,t,null,null,null):u.copy(null,null,null,null,u.right.insert(e,t,r)),u.fixUp()}removeMin(){if(this.left.isEmpty())return fr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,u=this;if(t(e,u.key)<0)u.left.isEmpty()||u.left.isRed()||u.left.left.isRed()||(u=u.moveRedLeft()),u=u.copy(null,null,null,u.left.remove(e,t),null);else{if(u.left.isRed()&&(u=u.rotateRight()),u.right.isEmpty()||u.right.isRed()||u.right.left.isRed()||(u=u.moveRedRight()),t(e,u.key)===0){if(u.right.isEmpty())return fr.EMPTY;r=u.right.min(),u=u.copy(r.key,r.value,null,null,u.right.removeMin())}u=u.copy(null,null,null,null,u.right.remove(e,t))}return u.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,fr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,fr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Pt();const e=this.left.check();if(e!==this.right.check())throw Pt();return e+(this.isRed()?0:1)}}fr.EMPTY=null,fr.RED=!0,fr.BLACK=!1;fr.EMPTY=new class{constructor(){this.size=0}get key(){throw Pt()}get value(){throw Pt()}get color(){throw Pt()}get left(){throw Pt()}get right(){throw Pt()}copy(i,e,t,r,u){return this}insert(i,e,t){return new fr(i,e)}remove(i,e){return this}isEmpty(){return!0}inorderTraversal(i){return!1}reverseTraversal(i){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e){this.comparator=e,this.data=new ki(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const u=r.getNext();if(this.comparator(u.key,e[1])>=0)return;t(u.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new CE(this.data.getIterator())}getIteratorFrom(e){return new CE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof si)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const u=t.getNext().key,f=r.getNext().key;if(this.comparator(u,f)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new si(this.comparator);return t.data=e,t}}class CE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ih(i){return i.hasNext()?i.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e){this.fields=e,e.sort(Li.comparator)}static empty(){return new ls([])}unionWith(e){let t=new si(Li.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ls(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Eh(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pr{constructor(e){this.value=e}static empty(){return new pr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!e_(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Zf(t)}setAll(e){let t=Li.emptyPath(),r={},u=[];e.forEach((y,l)=>{if(!t.isImmediateParentOf(l)){const T=this.getFieldsMap(t);this.applyChanges(T,r,u),r={},u=[],t=l.popLast()}y?r[l.lastSegment()]=Zf(y):u.push(l.lastSegment())});const f=this.getFieldsMap(t);this.applyChanges(f,r,u)}delete(e){const t=this.field(e.popLast());e_(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Io(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let u=t.mapValue.fields[e.get(r)];e_(u)&&u.mapValue.fields||(u={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=u),t=u}return t.mapValue.fields}applyChanges(e,t,r){Vc(t,(u,f)=>e[u]=f);for(const u of r)delete e[u]}clone(){return new pr(Zf(this.value))}}function cA(i){const e=[];return Vc(i.fields,(t,r)=>{const u=new Li([t]);if(e_(r)){const f=cA(r.mapValue).fields;if(f.length===0)e.push(u);else for(const y of f)e.push(u.child(y))}else e.push(u)}),new ls(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e,t,r,u,f,y,l){this.key=e,this.documentType=t,this.version=r,this.readTime=u,this.createTime=f,this.data=y,this.documentState=l}static newInvalidDocument(e){return new ui(e,0,Ht.min(),Ht.min(),Ht.min(),pr.empty(),0)}static newFoundDocument(e,t,r,u){return new ui(e,1,t,Ht.min(),r,u,0)}static newNoDocument(e,t){return new ui(e,2,t,Ht.min(),Ht.min(),pr.empty(),0)}static newUnknownDocument(e,t){return new ui(e,3,t,Ht.min(),Ht.min(),pr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ht.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=pr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=pr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ht.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ui&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ui(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OO{constructor(e,t=null,r=[],u=[],f=null,y=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=u,this.limit=f,this.startAt=y,this.endAt=l,this.ft=null}}function Y0(i,e=null,t=[],r=[],u=null,f=null,y=null){return new OO(i,e,t,r,u,f,y)}function Rc(i){const e=Et(i);if(e.ft===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>iA(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(u){return u.field.canonicalString()+u.dir}(r)).join(","),Np(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ih(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ih(r)).join(",")),e.ft=t}return e.ft}function Up(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!zO(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!rA(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!AE(i.startAt,e.startAt)&&AE(i.endAt,e.endAt)}function k_(i){return Tt.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}function M_(i,e){return i.filters.filter(t=>t instanceof Dn&&t.field.isEqual(e))}function kE(i,e,t){let r=Jg,u=!0;for(const f of M_(i,e)){let y=Jg,l=!0;switch(f.op){case"<":case"<=":y=AO(f.value);break;case"==":case"in":case">=":y=f.value;break;case">":y=f.value,l=!1;break;case"!=":case"not-in":y=Jg}EE({value:r,inclusive:u},{value:y,inclusive:l})<0&&(r=y,u=l)}if(t!==null){for(let f=0;f<i.orderBy.length;++f)if(i.orderBy[f].field.isEqual(e)){const y=t.position[f];EE({value:r,inclusive:u},{value:y,inclusive:t.inclusive})<0&&(r=y,u=t.inclusive);break}}return{value:r,inclusive:u}}function ME(i,e,t){let r=el,u=!0;for(const f of M_(i,e)){let y=el,l=!0;switch(f.op){case">=":case">":y=CO(f.value),l=!1;break;case"==":case"in":case"<=":y=f.value;break;case"<":y=f.value,l=!1;break;case"!=":case"not-in":y=el}IE({value:r,inclusive:u},{value:y,inclusive:l})>0&&(r=y,u=l)}if(t!==null){for(let f=0;f<i.orderBy.length;++f)if(i.orderBy[f].field.isEqual(e)){const y=t.position[f];IE({value:r,inclusive:u},{value:y,inclusive:t.inclusive})>0&&(r=y,u=t.inclusive);break}}return{value:r,inclusive:u}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e,t=null,r=[],u=[],f=null,y="F",l=null,T=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=u,this.limit=f,this.limitType=y,this.startAt=l,this.endAt=T,this.dt=null,this._t=null,this.startAt,this.endAt}}function uA(i,e,t,r,u,f,y,l){return new sa(i,e,t,r,u,f,y,l)}function Vh(i){return new sa(i)}function DE(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function Xx(i){return i.explicitOrderBy.length>0?i.explicitOrderBy[0].field:null}function oy(i){for(const e of i.filters){const t=e.getFirstInequalityField();if(t!==null)return t}return null}function Kx(i){return i.collectionGroup!==null}function wc(i){const e=Et(i);if(e.dt===null){e.dt=[];const t=oy(e),r=Xx(e);if(t!==null&&r===null)t.isKeyField()||e.dt.push(new uh(t)),e.dt.push(new uh(Li.keyField(),"asc"));else{let u=!1;for(const f of e.explicitOrderBy)e.dt.push(f),f.field.isKeyField()&&(u=!0);if(!u){const f=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new uh(Li.keyField(),f))}}}return e.dt}function Nr(i){const e=Et(i);if(!e._t)if(e.limitType==="F")e._t=Y0(e.path,e.collectionGroup,wc(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const f of wc(e)){const y=f.dir==="desc"?"asc":"desc";t.push(new uh(f.field,y))}const r=e.endAt?new ul(e.endAt.position,e.endAt.inclusive):null,u=e.startAt?new ul(e.startAt.position,e.startAt.inclusive):null;e._t=Y0(e.path,e.collectionGroup,t,e.filters,e.limit,r,u)}return e._t}function Q0(i,e){e.getFirstInequalityField(),oy(i);const t=i.filters.concat([e]);return new sa(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function D_(i,e,t){return new sa(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function Vp(i,e){return Up(Nr(i),Nr(e))&&i.limitType===e.limitType}function hA(i){return`${Rc(Nr(i))}|lt:${i.limitType}`}function J0(i){return`Query(target=${function(e){let t=e.path.canonicalString();return e.collectionGroup!==null&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(r=>oA(r)).join(", ")}]`),Np(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(r=>function(u){return`${u.field.canonicalString()} (${u.dir})`}(r)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ih(r)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ih(r)).join(",")),`Target(${t})`}(Nr(i))}; limitType=${i.limitType})`}function Yx(i,e){return e.isFoundDocument()&&function(t,r){const u=r.key.path;return t.collectionGroup!==null?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(u):Tt.isDocumentKey(t.path)?t.path.isEqual(u):t.path.isImmediateParentOf(u)}(i,e)&&function(t,r){for(const u of wc(t))if(!u.field.isKeyField()&&r.data.field(u.field)===null)return!1;return!0}(i,e)&&function(t,r){for(const u of t.filters)if(!u.matches(r))return!1;return!0}(i,e)&&function(t,r){return!(t.startAt&&!function(u,f,y){const l=SE(u,f,y);return u.inclusive?l<=0:l<0}(t.startAt,wc(t),r)||t.endAt&&!function(u,f,y){const l=SE(u,f,y);return u.inclusive?l>=0:l>0}(t.endAt,wc(t),r))}(i,e)}function dA(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function fA(i){return(e,t)=>{let r=!1;for(const u of wc(i)){const f=BO(u,e,t);if(f!==0)return f;r=r||u.field.isKeyField()}return 0}}function BO(i,e,t){const r=i.field.isKeyField()?Tt.comparator(e.key,t.key):function(u,f,y){const l=f.data.field(u),T=y.data.field(u);return l!==null&&T!==null?cl(l,T):Pt()}(i.field,e,t);switch(i.dir){case"asc":return r;case"desc":return-1*r;default:return Pt()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pA(i,e){if(i.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ap(e)?"-0":e}}function mA(i){return{integerValue:""+i}}function gA(i,e){return YS(e)?mA(e):pA(i,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(){this._=void 0}}function FO(i,e,t){return i instanceof Ah?function(r,u){const f={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return u&&(f.fields.__previous_value__=u),{mapValue:f}}(t,e):i instanceof Lc?yA(i,e):i instanceof zc?vA(i,e):function(r,u){const f=_A(r,u),y=PE(f)+PE(r.gt);return X0(f)&&X0(r.gt)?mA(y):pA(r.yt,y)}(i,e)}function NO(i,e,t){return i instanceof Lc?yA(i,e):i instanceof zc?vA(i,e):t}function _A(i,e){return i instanceof Ch?X0(t=e)||function(r){return!!r&&"doubleValue"in r}(t)?e:{integerValue:0}:null;var t}class Ah extends ay{}class Lc extends ay{constructor(e){super(),this.elements=e}}function yA(i,e){const t=xA(e);for(const r of i.elements)t.some(u=>Io(u,r))||t.push(r);return{arrayValue:{values:t}}}class zc extends ay{constructor(e){super(),this.elements=e}}function vA(i,e){let t=xA(e);for(const r of i.elements)t=t.filter(u=>!Io(u,r));return{arrayValue:{values:t}}}class Ch extends ay{constructor(e,t){super(),this.yt=e,this.gt=t}}function PE(i){return Ai(i.integerValue||i.doubleValue)}function xA(i){return up(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp{constructor(e,t){this.field=e,this.transform=t}}function UO(i,e){return i.field.isEqual(e.field)&&function(t,r){return t instanceof Lc&&r instanceof Lc||t instanceof zc&&r instanceof zc?Eh(t.elements,r.elements,Io):t instanceof Ch&&r instanceof Ch?Io(t.gt,r.gt):t instanceof Ah&&r instanceof Ah}(i.transform,e.transform)}class VO{constructor(e,t){this.version=e,this.transformResults=t}}class mi{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new mi}static exists(e){return new mi(void 0,e)}static updateTime(e){return new mi(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function t_(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}class ly{}function bA(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new Gh(i.key,mi.none()):new jh(i.key,i.data,mi.none());{const t=i.data,r=pr.empty();let u=new si(Li.comparator);for(let f of e.fields)if(!u.has(f)){let y=t.field(f);y===null&&f.length>1&&(f=f.popLast(),y=t.field(f)),y===null?r.delete(f):r.set(f,y),u=u.add(f)}return new oa(i.key,r,new ls(u.toArray()),mi.none())}}function jO(i,e,t){i instanceof jh?function(r,u,f){const y=r.value.clone(),l=LE(r.fieldTransforms,u,f.transformResults);y.setAll(l),u.convertToFoundDocument(f.version,y).setHasCommittedMutations()}(i,e,t):i instanceof oa?function(r,u,f){if(!t_(r.precondition,u))return void u.convertToUnknownDocument(f.version);const y=LE(r.fieldTransforms,u,f.transformResults),l=u.data;l.setAll(wA(r)),l.setAll(y),u.convertToFoundDocument(f.version,l).setHasCommittedMutations()}(i,e,t):function(r,u,f){u.convertToNoDocument(f.version).setHasCommittedMutations()}(0,e,t)}function Hf(i,e,t,r){return i instanceof jh?function(u,f,y,l){if(!t_(u.precondition,f))return y;const T=u.value.clone(),A=zE(u.fieldTransforms,l,f);return T.setAll(A),f.convertToFoundDocument(f.version,T).setHasLocalMutations(),null}(i,e,t,r):i instanceof oa?function(u,f,y,l){if(!t_(u.precondition,f))return y;const T=zE(u.fieldTransforms,l,f),A=f.data;return A.setAll(wA(u)),A.setAll(T),f.convertToFoundDocument(f.version,A).setHasLocalMutations(),y===null?null:y.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map(R=>R.field))}(i,e,t,r):function(u,f,y){return t_(u.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):y}(i,e,t)}function GO(i,e){let t=null;for(const r of i.fieldTransforms){const u=e.data.field(r.field),f=_A(r.transform,u||null);f!=null&&(t===null&&(t=pr.empty()),t.set(r.field,f))}return t||null}function RE(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!function(t,r){return t===void 0&&r===void 0||!(!t||!r)&&Eh(t,r,(u,f)=>UO(u,f))}(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}class jh extends ly{constructor(e,t,r,u=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=u,this.type=0}getFieldMask(){return null}}class oa extends ly{constructor(e,t,r,u,f=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=u,this.fieldTransforms=f,this.type=1}getFieldMask(){return this.fieldMask}}function wA(i){const e=new Map;return i.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=i.data.field(t);e.set(t,r)}}),e}function LE(i,e,t){const r=new Map;jt(i.length===t.length);for(let u=0;u<t.length;u++){const f=i[u],y=f.transform,l=e.data.field(f.field);r.set(f.field,NO(y,l,t[u]))}return r}function zE(i,e,t){const r=new Map;for(const u of i){const f=u.transform,y=t.data.field(u.field);r.set(u.field,FO(f,y,e))}return r}class Gh extends ly{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Qx extends ly{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $O{constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bi,zn;function TA(i){switch(i){default:return Pt();case ze.CANCELLED:case ze.UNKNOWN:case ze.DEADLINE_EXCEEDED:case ze.RESOURCE_EXHAUSTED:case ze.INTERNAL:case ze.UNAVAILABLE:case ze.UNAUTHENTICATED:return!1;case ze.INVALID_ARGUMENT:case ze.NOT_FOUND:case ze.ALREADY_EXISTS:case ze.PERMISSION_DENIED:case ze.FAILED_PRECONDITION:case ze.ABORTED:case ze.OUT_OF_RANGE:case ze.UNIMPLEMENTED:case ze.DATA_LOSS:return!0}}function EA(i){if(i===void 0)return Ri("GRPC error has no .code"),ze.UNKNOWN;switch(i){case Bi.OK:return ze.OK;case Bi.CANCELLED:return ze.CANCELLED;case Bi.UNKNOWN:return ze.UNKNOWN;case Bi.DEADLINE_EXCEEDED:return ze.DEADLINE_EXCEEDED;case Bi.RESOURCE_EXHAUSTED:return ze.RESOURCE_EXHAUSTED;case Bi.INTERNAL:return ze.INTERNAL;case Bi.UNAVAILABLE:return ze.UNAVAILABLE;case Bi.UNAUTHENTICATED:return ze.UNAUTHENTICATED;case Bi.INVALID_ARGUMENT:return ze.INVALID_ARGUMENT;case Bi.NOT_FOUND:return ze.NOT_FOUND;case Bi.ALREADY_EXISTS:return ze.ALREADY_EXISTS;case Bi.PERMISSION_DENIED:return ze.PERMISSION_DENIED;case Bi.FAILED_PRECONDITION:return ze.FAILED_PRECONDITION;case Bi.ABORTED:return ze.ABORTED;case Bi.OUT_OF_RANGE:return ze.OUT_OF_RANGE;case Bi.UNIMPLEMENTED:return ze.UNIMPLEMENTED;case Bi.DATA_LOSS:return ze.DATA_LOSS;default:return Pt()}}(zn=Bi||(Bi={}))[zn.OK=0]="OK",zn[zn.CANCELLED=1]="CANCELLED",zn[zn.UNKNOWN=2]="UNKNOWN",zn[zn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",zn[zn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",zn[zn.NOT_FOUND=5]="NOT_FOUND",zn[zn.ALREADY_EXISTS=6]="ALREADY_EXISTS",zn[zn.PERMISSION_DENIED=7]="PERMISSION_DENIED",zn[zn.UNAUTHENTICATED=16]="UNAUTHENTICATED",zn[zn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",zn[zn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",zn[zn.ABORTED=10]="ABORTED",zn[zn.OUT_OF_RANGE=11]="OUT_OF_RANGE",zn[zn.UNIMPLEMENTED=12]="UNIMPLEMENTED",zn[zn.INTERNAL=13]="INTERNAL",zn[zn.UNAVAILABLE=14]="UNAVAILABLE",zn[zn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[u,f]of r)if(this.equalsFn(u,e))return f}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),u=this.inner[r];if(u===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let f=0;f<u.length;f++)if(this.equalsFn(u[f][0],e))return void(u[f]=[e,t]);u.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let u=0;u<r.length;u++)if(this.equalsFn(r[u][0],e))return r.length===1?delete this.inner[t]:r.splice(u,1),this.innerSize--,!0;return!1}forEach(e){Vc(this.inner,(t,r)=>{for(const[u,f]of r)e(u,f)})}isEmpty(){return KS(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qO=new ki(Tt.comparator);function Kr(){return qO}const IA=new ki(Tt.comparator);function Uf(...i){let e=IA;for(const t of i)e=e.insert(t.key,t);return e}function SA(i){let e=IA;return i.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function vo(){return Xf()}function AA(){return Xf()}function Xf(){return new Tl(i=>i.toString(),(i,e)=>i.isEqual(e))}const WO=new ki(Tt.comparator),ZO=new si(Tt.comparator);function yn(...i){let e=ZO;for(const t of i)e=e.add(t);return e}const HO=new si(hn);function cy(){return HO}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(e,t,r,u,f){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=u,this.resolvedLimboDocuments=f}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const u=new Map;return u.set(e,$p.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Gp(Ht.min(),u,cy(),Kr(),yn())}}class $p{constructor(e,t,r,u,f){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=u,this.removedDocuments=f}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new $p(r,t,yn(),yn(),yn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n_{constructor(e,t,r,u){this.It=e,this.removedTargetIds=t,this.key=r,this.Tt=u}}class CA{constructor(e,t){this.targetId=e,this.Et=t}}class kA{constructor(e,t,r=Xi.EMPTY_BYTE_STRING,u=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=u}}class OE{constructor(){this.At=0,this.Rt=FE(),this.bt=Xi.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return this.At!==0}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=yn(),t=yn(),r=yn();return this.Rt.forEach((u,f)=>{switch(f){case 0:e=e.add(u);break;case 2:t=t.add(u);break;case 1:r=r.add(u);break;default:Pt()}}),new $p(this.bt,this.Pt,e,t,r)}xt(){this.vt=!1,this.Rt=FE()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class XO{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=Kr(),this.qt=BE(),this.Ut=new si(hn)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const r=this.Wt(t);switch(e.state){case 0:this.zt(t)&&r.Dt(e.resumeToken);break;case 1:r.Mt(),r.Vt||r.xt(),r.Dt(e.resumeToken);break;case 2:r.Mt(),r.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(r.Ft(),r.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),r.Dt(e.resumeToken));break;default:Pt()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((r,u)=>{this.zt(u)&&t(u)})}Jt(e){const t=e.targetId,r=e.Et.count,u=this.Yt(t);if(u){const f=u.target;if(k_(f))if(r===0){const y=new Tt(f.path);this.Qt(t,y,ui.newNoDocument(y,Ht.min()))}else jt(r===1);else this.Xt(t)!==r&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((f,y)=>{const l=this.Yt(y);if(l){if(f.current&&k_(l.target)){const T=new Tt(l.target.path);this.Lt.get(T)!==null||this.te(y,T)||this.Qt(y,T,ui.newNoDocument(T,e))}f.St&&(t.set(y,f.Ct()),f.xt())}});let r=yn();this.qt.forEach((f,y)=>{let l=!0;y.forEachWhile(T=>{const A=this.Yt(T);return!A||A.purpose===2||(l=!1,!1)}),l&&(r=r.add(f))}),this.Lt.forEach((f,y)=>y.setReadTime(e));const u=new Gp(e,t,this.Ut,this.Lt,r);return this.Lt=Kr(),this.qt=BE(),this.Ut=new si(hn),u}Gt(e,t){if(!this.zt(e))return;const r=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,r),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,r){if(!this.zt(e))return;const u=this.Wt(e);this.te(e,t)?u.Nt(t,1):u.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),r&&(this.Lt=this.Lt.insert(t,r))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new OE,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new si(hn),this.qt=this.qt.insert(e,t)),t}zt(e){const t=this.Yt(e)!==null;return t||ot("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new OE),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function BE(){return new ki(Tt.comparator)}function FE(){return new ki(Tt.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KO=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),YO=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),QO=(()=>({and:"AND",or:"OR"}))();class JO{constructor(e,t){this.databaseId=e,this.wt=t}}function kh(i,e){return i.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function MA(i,e){return i.wt?e.toBase64():e.toUint8Array()}function e3(i,e){return kh(i,e.toTimestamp())}function zi(i){return jt(!!i),Ht.fromTimestamp(function(e){const t=ll(e);return new xi(t.seconds,t.nanos)}(i))}function Jx(i,e){return function(t){return new On(["projects",t.projectId,"databases",t.database])}(i).child("documents").child(e).canonicalString()}function DA(i){const e=On.fromString(i);return jt(NA(e)),e}function hp(i,e){return Jx(i.databaseId,e.path)}function wo(i,e){const t=DA(e);if(t.get(1)!==i.databaseId.projectId)throw new nt(ze.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new nt(ze.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new Tt(RA(t))}function ex(i,e){return Jx(i.databaseId,e)}function PA(i){const e=DA(i);return e.length===4?On.emptyPath():RA(e)}function dp(i){return new On(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function RA(i){return jt(i.length>4&&i.get(4)==="documents"),i.popFirst(5)}function NE(i,e,t){return{name:hp(i,e),fields:t.value.mapValue.fields}}function LA(i,e,t){const r=wo(i,e.name),u=zi(e.updateTime),f=e.createTime?zi(e.createTime):Ht.min(),y=new pr({mapValue:{fields:e.fields}}),l=ui.newFoundDocument(r,u,f,y);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function t3(i,e){return"found"in e?function(t,r){jt(!!r.found),r.found.name,r.found.updateTime;const u=wo(t,r.found.name),f=zi(r.found.updateTime),y=r.found.createTime?zi(r.found.createTime):Ht.min(),l=new pr({mapValue:{fields:r.found.fields}});return ui.newFoundDocument(u,f,y,l)}(i,e):"missing"in e?function(t,r){jt(!!r.missing),jt(!!r.readTime);const u=wo(t,r.missing),f=zi(r.readTime);return ui.newNoDocument(u,f)}(i,e):Pt()}function n3(i,e){let t;if("targetChange"in e){e.targetChange;const r=function(T){return T==="NO_CHANGE"?0:T==="ADD"?1:T==="REMOVE"?2:T==="CURRENT"?3:T==="RESET"?4:Pt()}(e.targetChange.targetChangeType||"NO_CHANGE"),u=e.targetChange.targetIds||[],f=function(T,A){return T.wt?(jt(A===void 0||typeof A=="string"),Xi.fromBase64String(A||"")):(jt(A===void 0||A instanceof Uint8Array),Xi.fromUint8Array(A||new Uint8Array))}(i,e.targetChange.resumeToken),y=e.targetChange.cause,l=y&&function(T){const A=T.code===void 0?ze.UNKNOWN:EA(T.code);return new nt(A,T.message||"")}(y);t=new kA(r,u,f,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const u=wo(i,r.document.name),f=zi(r.document.updateTime),y=r.document.createTime?zi(r.document.createTime):Ht.min(),l=new pr({mapValue:{fields:r.document.fields}}),T=ui.newFoundDocument(u,f,y,l),A=r.targetIds||[],R=r.removedTargetIds||[];t=new n_(A,R,T.key,T)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const u=wo(i,r.document),f=r.readTime?zi(r.readTime):Ht.min(),y=ui.newNoDocument(u,f),l=r.removedTargetIds||[];t=new n_([],l,y.key,y)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const u=wo(i,r.document),f=r.removedTargetIds||[];t=new n_([],f,u,null)}else{if(!("filter"in e))return Pt();{e.filter;const r=e.filter;r.targetId;const u=r.count||0,f=new $O(u),y=r.targetId;t=new CA(y,f)}}return t}function fp(i,e){let t;if(e instanceof jh)t={update:NE(i,e.key,e.value)};else if(e instanceof Gh)t={delete:hp(i,e.key)};else if(e instanceof oa)t={update:NE(i,e.key,e.data),updateMask:l3(e.fieldMask)};else{if(!(e instanceof Qx))return Pt();t={verify:hp(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(u,f){const y=f.transform;if(y instanceof Ah)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof Lc)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof zc)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof Ch)return{fieldPath:f.field.canonicalString(),increment:y.gt};throw Pt()}(0,r))),e.precondition.isNone||(t.currentDocument=function(r,u){return u.updateTime!==void 0?{updateTime:e3(r,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:Pt()}(i,e.precondition)),t}function tx(i,e){const t=e.currentDocument?function(u){return u.updateTime!==void 0?mi.updateTime(zi(u.updateTime)):u.exists!==void 0?mi.exists(u.exists):mi.none()}(e.currentDocument):mi.none(),r=e.updateTransforms?e.updateTransforms.map(u=>function(f,y){let l=null;if("setToServerValue"in y)jt(y.setToServerValue==="REQUEST_TIME"),l=new Ah;else if("appendMissingElements"in y){const A=y.appendMissingElements.values||[];l=new Lc(A)}else if("removeAllFromArray"in y){const A=y.removeAllFromArray.values||[];l=new zc(A)}else"increment"in y?l=new Ch(f,y.increment):Pt();const T=Li.fromServerFormat(y.fieldPath);return new jp(T,l)}(i,u)):[];if(e.update){e.update.name;const u=wo(i,e.update.name),f=new pr({mapValue:{fields:e.update.fields}});if(e.updateMask){const y=function(l){const T=l.fieldPaths||[];return new ls(T.map(A=>Li.fromServerFormat(A)))}(e.updateMask);return new oa(u,f,y,t,r)}return new jh(u,f,t,r)}if(e.delete){const u=wo(i,e.delete);return new Gh(u,t)}if(e.verify){const u=wo(i,e.verify);return new Qx(u,t)}return Pt()}function i3(i,e){return i&&i.length>0?(jt(e!==void 0),i.map(t=>function(r,u){let f=r.updateTime?zi(r.updateTime):zi(u);return f.isEqual(Ht.min())&&(f=zi(u)),new VO(f,r.transformResults||[])}(t,e))):[]}function zA(i,e){return{documents:[ex(i,e.path)]}}function e1(i,e){const t={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(t.parent=ex(i,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=ex(i,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const u=function(T){if(T.length!==0)return FA(ti.create(T,"and"))}(e.filters);u&&(t.structuredQuery.where=u);const f=function(T){if(T.length!==0)return T.map(A=>function(R){return{field:sh(R.field),direction:s3(R.dir)}}(A))}(e.orderBy);f&&(t.structuredQuery.orderBy=f);const y=function(T,A){return T.wt||Np(A)?A:{value:A}}(i,e.limit);var l;return y!==null&&(t.structuredQuery.limit=y),e.startAt&&(t.structuredQuery.startAt={before:(l=e.startAt).inclusive,values:l.position}),e.endAt&&(t.structuredQuery.endAt=function(T){return{before:!T.inclusive,values:T.position}}(e.endAt)),t}function OA(i){let e=PA(i.parent);const t=i.structuredQuery,r=t.from?t.from.length:0;let u=null;if(r>0){jt(r===1);const R=t.from[0];R.allDescendants?u=R.collectionId:e=e.child(R.collectionId)}let f=[];t.where&&(f=function(R){const z=BA(R);return z instanceof ti&&tA(z)?z.getFilters():[z]}(t.where));let y=[];t.orderBy&&(y=t.orderBy.map(R=>function(z){return new uh(oh(z.field),function(j){switch(j){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(z.direction))}(R)));let l=null;t.limit&&(l=function(R){let z;return z=typeof R=="object"?R.value:R,Np(z)?null:z}(t.limit));let T=null;t.startAt&&(T=function(R){const z=!!R.before,j=R.values||[];return new ul(j,z)}(t.startAt));let A=null;return t.endAt&&(A=function(R){const z=!R.before,j=R.values||[];return new ul(j,z)}(t.endAt)),uA(e,u,y,f,l,"F",T,A)}function r3(i,e){const t=function(r,u){switch(u){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Pt()}}(0,e.purpose);return t==null?null:{"goog-listen-tags":t}}function BA(i){return i.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=oh(e.unaryFilter.field);return Dn.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=oh(e.unaryFilter.field);return Dn.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=oh(e.unaryFilter.field);return Dn.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=oh(e.unaryFilter.field);return Dn.create(f,"!=",{nullValue:"NULL_VALUE"});default:return Pt()}}(i):i.fieldFilter!==void 0?function(e){return Dn.create(oh(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Pt()}}(e.fieldFilter.op),e.fieldFilter.value)}(i):i.compositeFilter!==void 0?function(e){return ti.create(e.compositeFilter.filters.map(t=>BA(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Pt()}}(e.compositeFilter.op))}(i):Pt()}function s3(i){return KO[i]}function o3(i){return YO[i]}function a3(i){return QO[i]}function sh(i){return{fieldPath:i.canonicalString()}}function oh(i){return Li.fromServerFormat(i.fieldPath)}function FA(i){return i instanceof Dn?function(e){if(e.op==="=="){if(TE(e.value))return{unaryFilter:{field:sh(e.field),op:"IS_NAN"}};if(wE(e.value))return{unaryFilter:{field:sh(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(TE(e.value))return{unaryFilter:{field:sh(e.field),op:"IS_NOT_NAN"}};if(wE(e.value))return{unaryFilter:{field:sh(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:sh(e.field),op:o3(e.op),value:e.value}}}(i):i instanceof ti?function(e){const t=e.getFilters().map(r=>FA(r));return t.length===1?t[0]:{compositeFilter:{op:a3(e.op),filters:t}}}(i):Pt()}function l3(i){const e=[];return i.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function NA(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fr(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=UE(e)),e=c3(i.get(t),e);return UE(e)}function c3(i,e){let t=e;const r=i.length;for(let u=0;u<r;u++){const f=i.charAt(u);switch(f){case"\0":t+="";break;case"":t+="";break;default:t+=f}}return t}function UE(i){return i+""}function xo(i){const e=i.length;if(jt(e>=2),e===2)return jt(i.charAt(0)===""&&i.charAt(1)===""),On.emptyPath();const t=e-2,r=[];let u="";for(let f=0;f<e;){const y=i.indexOf("",f);switch((y<0||y>t)&&Pt(),i.charAt(y+1)){case"":const l=i.substring(f,y);let T;u.length===0?T=l:(u+=l,T=u,u=""),r.push(T);break;case"":u+=i.substring(f,y),u+="\0";break;case"":u+=i.substring(f,y+1);break;default:Pt()}f=y+2}return new On(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VE=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i_(i,e){return[i,Fr(e)]}function UA(i,e,t){return[i,Fr(e),t]}const u3={},h3=["prefixPath","collectionGroup","readTime","documentId"],d3=["prefixPath","collectionGroup","documentId"],f3=["collectionGroup","readTime","prefixPath","documentId"],p3=["canonicalId","targetId"],m3=["targetId","path"],g3=["path","targetId"],_3=["collectionId","parent"],y3=["indexId","uid"],v3=["uid","sequenceNumber"],x3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],b3=["indexId","uid","orderedDocumentKey"],w3=["userId","collectionPath","documentId"],T3=["userId","collectionPath","largestBatchId"],E3=["userId","collectionGroup","largestBatchId"],VA=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],I3=[...VA,"documentOverlays"],jA=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],GA=jA,S3=[...GA,"indexConfiguration","indexState","indexEntries"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nx extends XS{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function sr(i,e){const t=Et(i);return Gs.M(t.se,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1{constructor(e,t,r,u){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=u}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let u=0;u<this.mutations.length;u++){const f=this.mutations[u];f.key.isEqual(e.key)&&jO(f,e,r[u])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Hf(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Hf(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=AA();return this.mutations.forEach(u=>{const f=e.get(u.key),y=f.overlayedDocument;let l=this.applyToLocalView(y,f.mutatedFields);l=t.has(u.key)?null:l;const T=bA(y,l);T!==null&&r.set(u.key,T),y.isValidDocument()||y.convertToNoDocument(Ht.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),yn())}isEqual(e){return this.batchId===e.batchId&&Eh(this.mutations,e.mutations,(t,r)=>RE(t,r))&&Eh(this.baseMutations,e.baseMutations,(t,r)=>RE(t,r))}}class n1{constructor(e,t,r,u){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=u}static from(e,t,r){jt(e.mutations.length===r.length);let u=WO;const f=e.mutations;for(let y=0;y<f.length;y++)u=u.insert(f[y].key,r[y].version);return new n1(e,t,r,u)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i1{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl{constructor(e,t,r,u,f=Ht.min(),y=Ht.min(),l=Xi.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=u,this.snapshotVersion=f,this.lastLimboFreeSnapshotVersion=y,this.resumeToken=l}withSequenceNumber(e){return new rl(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new rl(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new rl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $A{constructor(e){this.ie=e}}function A3(i,e){let t;if(e.document)t=LA(i.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Tt.fromSegments(e.noDocument.path),u=Bc(e.noDocument.readTime);t=ui.newNoDocument(r,u),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Pt();{const r=Tt.fromSegments(e.unknownDocument.path),u=Bc(e.unknownDocument.version);t=ui.newUnknownDocument(r,u)}}return e.readTime&&t.setReadTime(function(r){const u=new xi(r[0],r[1]);return Ht.fromTimestamp(u)}(e.readTime)),t}function jE(i,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:P_(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(u,f){return{name:hp(u,f.key),fields:f.data.value.mapValue.fields,updateTime:kh(u,f.version.toTimestamp()),createTime:kh(u,f.createTime.toTimestamp())}}(i.ie,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Oc(e.version)};else{if(!e.isUnknownDocument())return Pt();r.unknownDocument={path:t.path.toArray(),version:Oc(e.version)}}return r}function P_(i){const e=i.toTimestamp();return[e.seconds,e.nanoseconds]}function Oc(i){const e=i.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Bc(i){const e=new xi(i.seconds,i.nanoseconds);return Ht.fromTimestamp(e)}function fc(i,e){const t=(e.baseMutations||[]).map(f=>tx(i.ie,f));for(let f=0;f<e.mutations.length-1;++f){const y=e.mutations[f];if(f+1<e.mutations.length&&e.mutations[f+1].transform!==void 0){const l=e.mutations[f+1];y.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(f+1,1),++f}}const r=e.mutations.map(f=>tx(i.ie,f)),u=xi.fromMillis(e.localWriteTimeMs);return new t1(e.batchId,u,t,r)}function Vf(i){const e=Bc(i.readTime),t=i.lastLimboFreeSnapshotVersion!==void 0?Bc(i.lastLimboFreeSnapshotVersion):Ht.min();let r;var u;return i.query.documents!==void 0?(jt((u=i.query).documents.length===1),r=Nr(Vh(PA(u.documents[0])))):r=function(f){return Nr(OA(f))}(i.query),new rl(r,i.targetId,0,i.lastListenSequenceNumber,e,t,Xi.fromBase64String(i.resumeToken))}function qA(i,e){const t=Oc(e.snapshotVersion),r=Oc(e.lastLimboFreeSnapshotVersion);let u;u=k_(e.target)?zA(i.ie,e.target):e1(i.ie,e.target);const f=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Rc(e.target),readTime:t,resumeToken:f,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:u}}function r1(i){const e=OA({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?D_(e,e.limit,"L"):e}function _0(i,e){return new i1(e.largestBatchId,tx(i.ie,e.overlayMutation))}function GE(i,e){const t=e.path.lastSegment();return[i,Fr(e.path.popLast()),t]}function $E(i,e,t,r){return{indexId:i,uid:e.uid||"",sequenceNumber:t,readTime:Oc(r.readTime),documentKey:Fr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C3{getBundleMetadata(e,t){return qE(e).get(t).next(r=>{if(r)return{id:(u=r).bundleId,createTime:Bc(u.createTime),version:u.version};var u})}saveBundleMetadata(e,t){return qE(e).put({bundleId:(r=t).id,createTime:Oc(zi(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return WE(e).get(t).next(r=>{if(r)return{name:(u=r).name,query:r1(u.bundledQuery),readTime:Bc(u.readTime)};var u})}saveNamedQuery(e,t){return WE(e).put(function(r){return{name:r.name,readTime:Oc(zi(r.readTime)),bundledQuery:r.bundledQuery}}(t))}}function qE(i){return sr(i,"bundles")}function WE(i){return sr(i,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){const r=t.uid||"";return new uy(e,r)}getOverlay(e,t){return Cf(e).get(GE(this.userId,t)).next(r=>r?_0(this.yt,r):null)}getOverlays(e,t){const r=vo();return Me.forEach(t,u=>this.getOverlay(e,u).next(f=>{f!==null&&r.set(u,f)})).next(()=>r)}saveOverlays(e,t,r){const u=[];return r.forEach((f,y)=>{const l=new i1(t,y);u.push(this.oe(e,l))}),Me.waitFor(u)}removeOverlaysForBatchId(e,t,r){const u=new Set;t.forEach(y=>u.add(Fr(y.getCollectionPath())));const f=[];return u.forEach(y=>{const l=IDBKeyRange.bound([this.userId,y,r],[this.userId,y,r+1],!1,!0);f.push(Cf(e).Y("collectionPathOverlayIndex",l))}),Me.waitFor(f)}getOverlaysForCollection(e,t,r){const u=vo(),f=Fr(t),y=IDBKeyRange.bound([this.userId,f,r],[this.userId,f,Number.POSITIVE_INFINITY],!0);return Cf(e).W("collectionPathOverlayIndex",y).next(l=>{for(const T of l){const A=_0(this.yt,T);u.set(A.getKey(),A)}return u})}getOverlaysForCollectionGroup(e,t,r,u){const f=vo();let y;const l=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Cf(e).Z({index:"collectionGroupOverlayIndex",range:l},(T,A,R)=>{const z=_0(this.yt,A);f.size()<u||z.largestBatchId===y?(f.set(z.getKey(),z),y=z.largestBatchId):R.done()}).next(()=>f)}oe(e,t){return Cf(e).put(function(r,u,f){const[y,l,T]=GE(u,f.mutation.key);return{userId:u,collectionPath:l,documentId:T,collectionGroup:f.mutation.key.getCollectionGroup(),largestBatchId:f.largestBatchId,overlayMutation:fp(r.ie,f.mutation)}}(this.yt,this.userId,t))}}function Cf(i){return sr(i,"documentOverlays")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(Ai(e.integerValue));else if("doubleValue"in e){const r=Ai(e.doubleValue);isNaN(r)?this.he(t,13):(this.he(t,15),ap(r)?t.le(0):t.le(r))}else if("timestampValue"in e){const r=e.timestampValue;this.he(t,20),typeof r=="string"?t.fe(r):(t.fe(`${r.seconds||""}`),t.le(r.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(Mc(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.he(t,45),t.le(r.latitude||0),t.le(r.longitude||0)}else"mapValue"in e?JS(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):Pt()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const r=e.fields||{};this.he(t,55);for(const u of Object.keys(r))this.de(u,t),this.ce(r[u],t)}ye(e,t){const r=e.values||[];this.he(t,50);for(const u of r)this.ce(u,t)}me(e,t){this.he(t,37),Tt.fromName(e).path.forEach(r=>{this.he(t,60),this.pe(r,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}pc.Ie=new pc;function k3(i){if(i===0)return 8;let e=0;return i>>4==0&&(e+=4,i<<=4),i>>6==0&&(e+=2,i<<=2),i>>7==0&&(e+=1),e}function ZE(i){const e=64-function(t){let r=0;for(let u=0;u<8;++u){const f=k3(255&t[u]);if(r+=f,f!==8)break}return r}(i);return Math.ceil(e/8)}class M3{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ee(r.value),r=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.be(r.value),r=t.next();this.Pe()}ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ee(r);else if(r<2048)this.Ee(960|r>>>6),this.Ee(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ee(480|r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r);else{const u=t.codePointAt(0);this.Ee(240|u>>>18),this.Ee(128|63&u>>>12),this.Ee(128|63&u>>>6),this.Ee(128|63&u)}}this.Ae()}Ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.be(r);else if(r<2048)this.be(960|r>>>6),this.be(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.be(480|r>>>12),this.be(128|63&r>>>6),this.be(128|63&r);else{const u=t.codePointAt(0);this.be(240|u>>>18),this.be(128|63&u>>>12),this.be(128|63&u>>>6),this.be(128|63&u)}}this.Pe()}Se(e){const t=this.De(e),r=ZE(t);this.Ce(1+r),this.buffer[this.position++]=255&r;for(let u=t.length-r;u<t.length;++u)this.buffer[this.position++]=255&t[u]}xe(e){const t=this.De(e),r=ZE(t);this.Ce(1+r),this.buffer[this.position++]=~(255&r);for(let u=t.length-r;u<t.length;++u)this.buffer[this.position++]=~(255&t[u])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(u){const f=new DataView(new ArrayBuffer(8));return f.setFloat64(0,u,!1),new Uint8Array(f.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let u=1;u<t.length;++u)t[u]^=r?255:0;return t}Ee(e){const t=255&e;t===0?(this.ke(0),this.ke(255)):t===255?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;t===0?(this.Me(0),this.Me(255)):t===255?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const u=new Uint8Array(r);u.set(this.buffer),this.buffer=u}}class D3{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class P3{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class kf{constructor(){this.$e=new M3,this.Be=new D3(this.$e),this.Le=new P3(this.$e)}seed(e){this.$e.seed(e)}qe(e){return e===0?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(e,t,r,u){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=u}Ue(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new mc(this.indexId,this.documentKey,this.arrayValue,r)}}function qa(i,e){let t=i.indexId-e.indexId;return t!==0?t:(t=HE(i.arrayValue,e.arrayValue),t!==0?t:(t=HE(i.directionalValue,e.directionalValue),t!==0?t:Tt.comparator(i.documentKey,e.documentKey)))}function HE(i,e){for(let t=0;t<i.length&&t<e.length;++t){const r=i[t]-e[t];if(r!==0)return r}return i.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R3{constructor(e){this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const r=t;r.isInequality()?this.Qe=r:this.Ge.push(r)}}je(e){jt(e.collectionGroup===this.collectionId);const t=Z0(e);if(t!==void 0&&!this.We(t))return!1;const r=hc(e);let u=0,f=0;for(;u<r.length&&this.We(r[u]);++u);if(u===r.length)return!0;if(this.Qe!==void 0){const y=r[u];if(!this.ze(this.Qe,y)||!this.He(this.Ke[f++],y))return!1;++u}for(;u<r.length;++u){const y=r[u];if(f>=this.Ke.length||!this.He(this.Ke[f++],y))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WA(i){var e,t;if(jt(i instanceof Dn||i instanceof ti),i instanceof Dn){if(i instanceof lA){const u=((t=(e=i.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(f=>Dn.create(i.field,"==",f)))||[];return ti.create(u,"or")}return i}const r=i.filters.map(u=>WA(u));return ti.create(r,i.op)}function L3(i){if(i.getFilters().length===0)return[];const e=sx(WA(i));return jt(ZA(e)),ix(e)||rx(e)?[e]:e.getFilters()}function ix(i){return i instanceof Dn}function rx(i){return i instanceof ti&&tA(i)}function ZA(i){return ix(i)||rx(i)||function(e){if(e instanceof ti&&K0(e)){for(const t of e.getFilters())if(!ix(t)&&!rx(t))return!1;return!0}return!1}(i)}function sx(i){if(jt(i instanceof Dn||i instanceof ti),i instanceof Dn)return i;if(i.filters.length===1)return sx(i.filters[0]);const e=i.filters.map(r=>sx(r));let t=ti.create(e,i.op);return t=R_(t),ZA(t)?t:(jt(t instanceof ti),jt(Sh(t)),jt(t.filters.length>1),t.filters.reduce((r,u)=>s1(r,u)))}function s1(i,e){let t;return jt(i instanceof Dn||i instanceof ti),jt(e instanceof Dn||e instanceof ti),t=i instanceof Dn?e instanceof Dn?function(r,u){return ti.create([r,u],"and")}(i,e):XE(i,e):e instanceof Dn?XE(e,i):function(r,u){if(jt(r.filters.length>0&&u.filters.length>0),Sh(r)&&Sh(u))return sA(r,u.getFilters());const f=K0(r)?r:u,y=K0(r)?u:r,l=f.filters.map(T=>s1(T,y));return ti.create(l,"or")}(i,e),R_(t)}function XE(i,e){if(Sh(e))return sA(e,i.getFilters());{const t=e.filters.map(r=>s1(i,r));return ti.create(t,"or")}}function R_(i){if(jt(i instanceof Dn||i instanceof ti),i instanceof Dn)return i;const e=i.getFilters();if(e.length===1)return R_(e[0]);if(nA(i))return i;const t=e.map(u=>R_(u)),r=[];return t.forEach(u=>{u instanceof Dn?r.push(u):u instanceof ti&&(u.op===i.op?r.push(...u.filters):r.push(u))}),r.length===1?r[0]:ti.create(r,i.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z3{constructor(){this.Je=new o1}addToCollectionParentIndex(e,t){return this.Je.add(t),Me.resolve()}getCollectionParents(e,t){return Me.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return Me.resolve()}deleteFieldIndex(e,t){return Me.resolve()}getDocumentsMatchingTarget(e,t){return Me.resolve(null)}getIndexType(e,t){return Me.resolve(0)}getFieldIndexes(e,t){return Me.resolve([])}getNextCollectionGroupToUpdate(e){return Me.resolve(null)}getMinOffset(e,t){return Me.resolve(hs.min())}getMinOffsetFromCollectionGroup(e,t){return Me.resolve(hs.min())}updateCollectionGroup(e,t,r){return Me.resolve()}updateIndexEntries(e,t){return Me.resolve()}}class o1{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),u=this.index[t]||new si(On.comparator),f=!u.has(r);return this.index[t]=u.add(r),f}has(e){const t=e.lastSegment(),r=e.popLast(),u=this.index[t];return u&&u.has(r)}getEntries(e){return(this.index[e]||new si(On.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qg=new Uint8Array(0);class O3{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new o1,this.Xe=new Tl(r=>Rc(r),(r,u)=>Up(r,u)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const r=t.lastSegment(),u=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const f={collectionId:r,parent:Fr(u)};return KE(e).put(f)}return Me.resolve()}getCollectionParents(e,t){const r=[],u=IDBKeyRange.bound([t,""],[qS(t),""],!1,!0);return KE(e).W(u).next(f=>{for(const y of f){if(y.collectionId!==t)break;r.push(xo(y.parent))}return r})}addFieldIndex(e,t){const r=Wg(e),u=function(y){return{indexId:y.indexId,collectionGroup:y.collectionGroup,fields:y.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete u.indexId;const f=r.add(u);if(t.indexState){const y=Df(e);return f.next(l=>{y.put($E(l,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return f.next()}deleteFieldIndex(e,t){const r=Wg(e),u=Df(e),f=Mf(e);return r.delete(t.indexId).next(()=>u.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>f.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=Mf(e);let u=!0;const f=new Map;return Me.forEach(this.Ze(t),y=>this.tn(e,y).next(l=>{u&&(u=!!l),f.set(y,l)})).next(()=>{if(u){let y=yn();const l=[];return Me.forEach(f,(T,A)=>{var R;ot("IndexedDbIndexManager",`Using index ${R=T,`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(dt=>`${dt.fieldPath}:${dt.kind}`).join(",")}`} to execute ${Rc(t)}`);const z=function(dt,Ue){const ge=Z0(Ue);if(ge===void 0)return null;for(const Ke of M_(dt,ge.fieldPath))switch(Ke.op){case"array-contains-any":return Ke.value.arrayValue.values||[];case"array-contains":return[Ke.value]}return null}(A,T),j=function(dt,Ue){const ge=new Map;for(const Ke of hc(Ue))for(const He of M_(dt,Ke.fieldPath))switch(He.op){case"==":case"in":ge.set(Ke.fieldPath.canonicalString(),He.value);break;case"not-in":case"!=":return ge.set(Ke.fieldPath.canonicalString(),He.value),Array.from(ge.values())}return null}(A,T),ee=function(dt,Ue){const ge=[];let Ke=!0;for(const He of hc(Ue)){const en=He.kind===0?kE(dt,He.fieldPath,dt.startAt):ME(dt,He.fieldPath,dt.startAt);ge.push(en.value),Ke&&(Ke=en.inclusive)}return new ul(ge,Ke)}(A,T),se=function(dt,Ue){const ge=[];let Ke=!0;for(const He of hc(Ue)){const en=He.kind===0?ME(dt,He.fieldPath,dt.endAt):kE(dt,He.fieldPath,dt.endAt);ge.push(en.value),Ke&&(Ke=en.inclusive)}return new ul(ge,Ke)}(A,T),be=this.en(T,A,ee),Re=this.en(T,A,se),Ge=this.nn(T,A,j),it=this.sn(T.indexId,z,be,ee.inclusive,Re,se.inclusive,Ge);return Me.forEach(it,dt=>r.J(dt,t.limit).next(Ue=>{Ue.forEach(ge=>{const Ke=Tt.fromSegments(ge.documentKey);y.has(Ke)||(y=y.add(Ke),l.push(Ke))})}))}).next(()=>l)}return Me.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(e.filters.length===0?t=[e]:t=L3(ti.create(e.filters,"and")).map(r=>Y0(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,r,u,f,y,l){const T=(t!=null?t.length:1)*Math.max(r.length,f.length),A=T/(t!=null?t.length:1),R=[];for(let z=0;z<T;++z){const j=t?this.rn(t[z/A]):qg,ee=this.on(e,j,r[z%A],u),se=this.un(e,j,f[z%A],y),be=l.map(Re=>this.on(e,j,Re,!0));R.push(...this.createRange(ee,se,be))}return R}on(e,t,r,u){const f=new mc(e,Tt.empty(),t,r);return u?f:f.Ue()}un(e,t,r,u){const f=new mc(e,Tt.empty(),t,r);return u?f.Ue():f}tn(e,t){const r=new R3(t),u=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,u).next(f=>{let y=null;for(const l of f)r.je(l)&&(!y||l.fields.length>y.fields.length)&&(y=l);return y})}getIndexType(e,t){let r=2;const u=this.Ze(t);return Me.forEach(u,f=>this.tn(e,f).next(y=>{y?r!==0&&y.fields.length<function(l){let T=new si(Li.comparator),A=!1;for(const R of l.filters)for(const z of R.getFlattenedFilters())z.field.isKeyField()||(z.op==="array-contains"||z.op==="array-contains-any"?A=!0:T=T.add(z.field));for(const R of l.orderBy)R.field.isKeyField()||(T=T.add(R.field));return T.size+(A?1:0)}(f)&&(r=1):r=0})).next(()=>function(f){return f.limit!==null}(t)&&u.length>1&&r===2?1:r)}cn(e,t){const r=new kf;for(const u of hc(e)){const f=t.data.field(u.fieldPath);if(f==null)return null;const y=r.qe(u.kind);pc.Ie.ue(f,y)}return r.Fe()}rn(e){const t=new kf;return pc.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const r=new kf;return pc.Ie.ue(Pc(this.databaseId,t),r.qe(function(u){const f=hc(u);return f.length===0?0:f[f.length-1].kind}(e))),r.Fe()}nn(e,t,r){if(r===null)return[];let u=[];u.push(new kf);let f=0;for(const y of hc(e)){const l=r[f++];for(const T of u)if(this.hn(t,y.fieldPath)&&up(l))u=this.ln(u,y,l);else{const A=T.qe(y.kind);pc.Ie.ue(l,A)}}return this.fn(u)}en(e,t,r){return this.nn(e,t,r.position)}fn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Fe();return t}ln(e,t,r){const u=[...e],f=[];for(const y of r.arrayValue.values||[])for(const l of u){const T=new kf;T.seed(l.Fe()),pc.Ie.ue(y,T.qe(t.kind)),f.push(T)}return f}hn(e,t){return!!e.filters.find(r=>r instanceof Dn&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Wg(e),u=Df(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(f=>{const y=[];return Me.forEach(f,l=>u.get([l.indexId,this.uid]).next(T=>{y.push(function(A,R){const z=R?new op(R.sequenceNumber,new hs(Bc(R.readTime),new Tt(xo(R.documentKey)),R.largestBatchId)):op.empty(),j=A.fields.map(([ee,se])=>new Qg(Li.fromServerFormat(ee),se));return new C_(A.indexId,A.collectionGroup,j,z)}(l,T))})).next(()=>y)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,u)=>{const f=r.indexState.sequenceNumber-u.indexState.sequenceNumber;return f!==0?f:hn(r.collectionGroup,u.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const u=Wg(e),f=Df(e);return this.dn(e).next(y=>u.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>Me.forEach(l,T=>f.put($E(T.indexId,this.user,y,r)))))}updateIndexEntries(e,t){const r=new Map;return Me.forEach(t,(u,f)=>{const y=r.get(u.collectionGroup);return(y?Me.resolve(y):this.getFieldIndexes(e,u.collectionGroup)).next(l=>(r.set(u.collectionGroup,l),Me.forEach(l,T=>this._n(e,u,T).next(A=>{const R=this.wn(f,T);return A.isEqual(R)?Me.resolve():this.mn(e,f,T,A,R)}))))})}gn(e,t,r,u){return Mf(e).put({indexId:u.indexId,uid:this.uid,arrayValue:u.arrayValue,directionalValue:u.directionalValue,orderedDocumentKey:this.an(r,t.key),documentKey:t.key.path.toArray()})}yn(e,t,r,u){return Mf(e).delete([u.indexId,this.uid,u.arrayValue,u.directionalValue,this.an(r,t.key),t.key.path.toArray()])}_n(e,t,r){const u=Mf(e);let f=new si(qa);return u.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.an(r,t)])},(y,l)=>{f=f.add(new mc(r.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>f)}wn(e,t){let r=new si(qa);const u=this.cn(t,e);if(u==null)return r;const f=Z0(t);if(f!=null){const y=e.data.field(f.fieldPath);if(up(y))for(const l of y.arrayValue.values||[])r=r.add(new mc(t.indexId,e.key,this.rn(l),u))}else r=r.add(new mc(t.indexId,e.key,qg,u));return r}mn(e,t,r,u,f){ot("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const y=[];return function(l,T,A,R,z){const j=l.getIterator(),ee=T.getIterator();let se=ih(j),be=ih(ee);for(;se||be;){let Re=!1,Ge=!1;if(se&&be){const it=A(se,be);it<0?Ge=!0:it>0&&(Re=!0)}else se!=null?Ge=!0:Re=!0;Re?(R(be),be=ih(ee)):Ge?(z(se),se=ih(j)):(se=ih(j),be=ih(ee))}}(u,f,qa,l=>{y.push(this.gn(e,t,r,l))},l=>{y.push(this.yn(e,t,r,l))}),Me.waitFor(y)}dn(e){let t=1;return Df(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,u,f)=>{f.done(),t=u.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((y,l)=>qa(y,l)).filter((y,l,T)=>!l||qa(y,T[l-1])!==0);const u=[];u.push(e);for(const y of r){const l=qa(y,e),T=qa(y,t);if(l===0)u[0]=e.Ue();else if(l>0&&T<0)u.push(y),u.push(y.Ue());else if(T>0)break}u.push(t);const f=[];for(let y=0;y<u.length;y+=2){if(this.pn(u[y],u[y+1]))return[];const l=[u[y].indexId,this.uid,u[y].arrayValue,u[y].directionalValue,qg,[]],T=[u[y+1].indexId,this.uid,u[y+1].arrayValue,u[y+1].directionalValue,qg,[]];f.push(IDBKeyRange.bound(l,T))}return f}pn(e,t){return qa(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(YE)}getMinOffset(e,t){return Me.mapArray(this.Ze(t),r=>this.tn(e,r).next(u=>u||Pt())).next(YE)}}function KE(i){return sr(i,"collectionParents")}function Mf(i){return sr(i,"indexEntries")}function Wg(i){return sr(i,"indexConfiguration")}function Df(i){return sr(i,"indexState")}function YE(i){jt(i.length!==0);let e=i[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<i.length;r++){const u=i[r].indexState.offset;Wx(u,e)<0&&(e=u),t<u.largestBatchId&&(t=u.largestBatchId)}return new hs(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Zr{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Zr(e,Zr.DEFAULT_COLLECTION_PERCENTILE,Zr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HA(i,e,t){const r=i.store("mutations"),u=i.store("documentMutations"),f=[],y=IDBKeyRange.only(t.batchId);let l=0;const T=r.Z({range:y},(R,z,j)=>(l++,j.delete()));f.push(T.next(()=>{jt(l===1)}));const A=[];for(const R of t.mutations){const z=UA(e,R.key.path,t.batchId);f.push(u.delete(z)),A.push(R.key)}return Me.waitFor(f).next(()=>A)}function L_(i){if(!i)return 0;let e;if(i.document)e=i.document;else if(i.unknownDocument)e=i.unknownDocument;else{if(!i.noDocument)throw Pt();e=i.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zr.DEFAULT_COLLECTION_PERCENTILE=10,Zr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zr.DEFAULT=new Zr(41943040,Zr.DEFAULT_COLLECTION_PERCENTILE,Zr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zr.DISABLED=new Zr(-1,0,0);class hy{constructor(e,t,r,u){this.userId=e,this.yt=t,this.indexManager=r,this.referenceDelegate=u,this.In={}}static re(e,t,r,u){jt(e.uid!=="");const f=e.isAuthenticated()?e.uid:"";return new hy(f,t,r,u)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Wa(e).Z({index:"userMutationsIndex",range:r},(u,f,y)=>{t=!1,y.done()}).next(()=>t)}addMutationBatch(e,t,r,u){const f=ah(e),y=Wa(e);return y.add({}).next(l=>{jt(typeof l=="number");const T=new t1(l,t,r,u),A=function(j,ee,se){const be=se.baseMutations.map(Ge=>fp(j.ie,Ge)),Re=se.mutations.map(Ge=>fp(j.ie,Ge));return{userId:ee,batchId:se.batchId,localWriteTimeMs:se.localWriteTime.toMillis(),baseMutations:be,mutations:Re}}(this.yt,this.userId,T),R=[];let z=new si((j,ee)=>hn(j.canonicalString(),ee.canonicalString()));for(const j of u){const ee=UA(this.userId,j.key.path,l);z=z.add(j.key.path.popLast()),R.push(y.put(A)),R.push(f.put(ee,u3))}return z.forEach(j=>{R.push(this.indexManager.addToCollectionParentIndex(e,j))}),e.addOnCommittedListener(()=>{this.In[l]=T.keys()}),Me.waitFor(R).next(()=>T)})}lookupMutationBatch(e,t){return Wa(e).get(t).next(r=>r?(jt(r.userId===this.userId),fc(this.yt,r)):null)}Tn(e,t){return this.In[t]?Me.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const u=r.keys();return this.In[t]=u,u}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,u=IDBKeyRange.lowerBound([this.userId,r]);let f=null;return Wa(e).Z({index:"userMutationsIndex",range:u},(y,l,T)=>{l.userId===this.userId&&(jt(l.batchId>=r),f=fc(this.yt,l)),T.done()}).next(()=>f)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Wa(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(u,f,y)=>{r=f.batchId,y.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Wa(e).W("userMutationsIndex",t).next(r=>r.map(u=>fc(this.yt,u)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=i_(this.userId,t.path),u=IDBKeyRange.lowerBound(r),f=[];return ah(e).Z({range:u},(y,l,T)=>{const[A,R,z]=y,j=xo(R);if(A===this.userId&&t.path.isEqual(j))return Wa(e).get(z).next(ee=>{if(!ee)throw Pt();jt(ee.userId===this.userId),f.push(fc(this.yt,ee))});T.done()}).next(()=>f)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new si(hn);const u=[];return t.forEach(f=>{const y=i_(this.userId,f.path),l=IDBKeyRange.lowerBound(y),T=ah(e).Z({range:l},(A,R,z)=>{const[j,ee,se]=A,be=xo(ee);j===this.userId&&f.path.isEqual(be)?r=r.add(se):z.done()});u.push(T)}),Me.waitFor(u).next(()=>this.En(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,u=r.length+1,f=i_(this.userId,r),y=IDBKeyRange.lowerBound(f);let l=new si(hn);return ah(e).Z({range:y},(T,A,R)=>{const[z,j,ee]=T,se=xo(j);z===this.userId&&r.isPrefixOf(se)?se.length===u&&(l=l.add(ee)):R.done()}).next(()=>this.En(e,l))}En(e,t){const r=[],u=[];return t.forEach(f=>{u.push(Wa(e).get(f).next(y=>{if(y===null)throw Pt();jt(y.userId===this.userId),r.push(fc(this.yt,y))}))}),Me.waitFor(u).next(()=>r)}removeMutationBatch(e,t){return HA(e.se,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),Me.forEach(r,u=>this.referenceDelegate.markPotentiallyOrphaned(e,u))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return Me.resolve();const r=IDBKeyRange.lowerBound([this.userId]),u=[];return ah(e).Z({range:r},(f,y,l)=>{if(f[0]===this.userId){const T=xo(f[1]);u.push(T)}else l.done()}).next(()=>{jt(u.length===0)})})}containsKey(e,t){return XA(e,this.userId,t)}Rn(e){return KA(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function XA(i,e,t){const r=i_(e,t.path),u=r[1],f=IDBKeyRange.lowerBound(r);let y=!1;return ah(i).Z({range:f,X:!0},(l,T,A)=>{const[R,z,j]=l;R===e&&z===u&&(y=!0),A.done()}).next(()=>y)}function Wa(i){return sr(i,"mutations")}function ah(i){return sr(i,"documentMutations")}function KA(i){return sr(i,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Fc(0)}static vn(){return new Fc(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B3{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const r=new Fc(t.highestTargetId);return t.highestTargetId=r.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>Ht.fromTimestamp(new xi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Vn(e).next(u=>(u.highestListenSequenceNumber=t,r&&(u.lastRemoteSnapshotVersion=r.toTimestamp()),t>u.highestListenSequenceNumber&&(u.highestListenSequenceNumber=t),this.Sn(e,u)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(r=>(r.targetCount+=1,this.Cn(t,r),this.Sn(e,r))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>rh(e).delete(t.targetId)).next(()=>this.Vn(e)).next(r=>(jt(r.targetCount>0),r.targetCount-=1,this.Sn(e,r)))}removeTargets(e,t,r){let u=0;const f=[];return rh(e).Z((y,l)=>{const T=Vf(l);T.sequenceNumber<=t&&r.get(T.targetId)===null&&(u++,f.push(this.removeTargetData(e,T)))}).next(()=>Me.waitFor(f)).next(()=>u)}forEachTarget(e,t){return rh(e).Z((r,u)=>{const f=Vf(u);t(f)})}Vn(e){return JE(e).get("targetGlobalKey").next(t=>(jt(t!==null),t))}Sn(e,t){return JE(e).put("targetGlobalKey",t)}Dn(e,t){return rh(e).put(qA(this.yt,t))}Cn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Rc(t),u=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let f=null;return rh(e).Z({range:u,index:"queryTargetsIndex"},(y,l,T)=>{const A=Vf(l);Up(t,A.target)&&(f=A,T.done())}).next(()=>f)}addMatchingKeys(e,t,r){const u=[],f=Ha(e);return t.forEach(y=>{const l=Fr(y.path);u.push(f.put({targetId:r,path:l})),u.push(this.referenceDelegate.addReference(e,r,y))}),Me.waitFor(u)}removeMatchingKeys(e,t,r){const u=Ha(e);return Me.forEach(t,f=>{const y=Fr(f.path);return Me.waitFor([u.delete([r,y]),this.referenceDelegate.removeReference(e,r,f)])})}removeMatchingKeysForTargetId(e,t){const r=Ha(e),u=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(u)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),u=Ha(e);let f=yn();return u.Z({range:r,X:!0},(y,l,T)=>{const A=xo(y[1]),R=new Tt(A);f=f.add(R)}).next(()=>f)}containsKey(e,t){const r=Fr(t.path),u=IDBKeyRange.bound([r],[qS(r)],!1,!0);let f=0;return Ha(e).Z({index:"documentTargetsIndex",X:!0,range:u},([y,l],T,A)=>{y!==0&&(f++,A.done())}).next(()=>f>0)}ne(e,t){return rh(e).get(t).next(r=>r?Vf(r):null)}}function rh(i){return sr(i,"targets")}function JE(i){return sr(i,"targetGlobal")}function Ha(i){return sr(i,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eI([i,e],[t,r]){const u=hn(i,t);return u===0?hn(e,r):u}class F3{constructor(e){this.xn=e,this.buffer=new si(eI),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();eI(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class N3{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Mn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return this.Mn!==null}Fn(e){ot("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){wl(t)?ot("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await bl(t)}await this.Fn(3e5)})}}class U3{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return Me.resolve(Xr.at);const r=new F3(t);return this.$n.forEachTarget(e,u=>r.On(u.sequenceNumber)).next(()=>this.$n.Ln(e,u=>r.On(u))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.$n.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ot("LruGarbageCollector","Garbage collection skipped; disabled"),Me.resolve(QE)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ot("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),QE):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let r,u,f,y,l,T,A;const R=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(z=>(z>this.params.maximumSequenceNumbersToCollect?(ot("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${z}`),u=this.params.maximumSequenceNumbersToCollect):u=z,y=Date.now(),this.nthSequenceNumber(e,u))).next(z=>(r=z,l=Date.now(),this.removeTargets(e,r,t))).next(z=>(f=z,T=Date.now(),this.removeOrphanedDocuments(e,r))).next(z=>(A=Date.now(),W0()<=$n.DEBUG&&ot("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${y-R}ms
	Determined least recently used ${u} in `+(l-y)+`ms
	Removed ${f} targets in `+(T-l)+`ms
	Removed ${z} documents in `+(A-T)+`ms
Total Duration: ${A-R}ms`),Me.resolve({didRun:!0,sequenceNumbersCollected:u,targetsRemoved:f,documentsRemoved:z})))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V3{constructor(e,t){this.db=e,this.garbageCollector=function(r,u){return new U3(r,u)}(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(u=>r+u))}Un(e){let t=0;return this.Ln(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(r,u)=>t(u))}addReference(e,t,r){return Zg(e,r)}removeReference(e,t,r){return Zg(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Zg(e,t)}Gn(e,t){return function(r,u){let f=!1;return KA(r).tt(y=>XA(r,y,u).next(l=>(l&&(f=!0),Me.resolve(!l)))).next(()=>f)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),u=[];let f=0;return this.Kn(e,(y,l)=>{if(l<=t){const T=this.Gn(e,y).next(A=>{if(!A)return f++,r.getEntry(e,y).next(()=>(r.removeEntry(y,Ht.min()),Ha(e).delete([0,Fr(y.path)])))});u.push(T)}}).next(()=>Me.waitFor(u)).next(()=>r.apply(e)).next(()=>f)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Zg(e,t)}Kn(e,t){const r=Ha(e);let u,f=Xr.at;return r.Z({index:"documentTargetsIndex"},([y,l],{path:T,sequenceNumber:A})=>{y===0?(f!==Xr.at&&t(new Tt(xo(u)),f),f=A,u=T):f=Xr.at}).next(()=>{f!==Xr.at&&t(new Tt(xo(u)),f)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Zg(i,e){return Ha(i).put(function(t,r){return{targetId:0,path:Fr(t.path),sequenceNumber:r}}(e,i.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YA{constructor(){this.changes=new Tl(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ui.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?Me.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j3{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return cc(e).put(r)}removeEntry(e,t,r){return cc(e).delete(function(u,f){const y=u.path.toArray();return[y.slice(0,y.length-2),y[y.length-2],P_(f),y[y.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Qn(e,r)))}getEntry(e,t){let r=ui.newInvalidDocument(t);return cc(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Pf(t))},(u,f)=>{r=this.jn(t,f)}).next(()=>r)}Wn(e,t){let r={size:0,document:ui.newInvalidDocument(t)};return cc(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Pf(t))},(u,f)=>{r={document:this.jn(t,f),size:L_(f)}}).next(()=>r)}getEntries(e,t){let r=Kr();return this.zn(e,t,(u,f)=>{const y=this.jn(u,f);r=r.insert(u,y)}).next(()=>r)}Hn(e,t){let r=Kr(),u=new ki(Tt.comparator);return this.zn(e,t,(f,y)=>{const l=this.jn(f,y);r=r.insert(f,l),u=u.insert(f,L_(y))}).next(()=>({documents:r,Jn:u}))}zn(e,t,r){if(t.isEmpty())return Me.resolve();let u=new si(iI);t.forEach(T=>u=u.add(T));const f=IDBKeyRange.bound(Pf(u.first()),Pf(u.last())),y=u.getIterator();let l=y.getNext();return cc(e).Z({index:"documentKeyIndex",range:f},(T,A,R)=>{const z=Tt.fromSegments([...A.prefixPath,A.collectionGroup,A.documentId]);for(;l&&iI(l,z)<0;)r(l,null),l=y.getNext();l&&l.isEqual(z)&&(r(l,A),l=y.hasNext()?y.getNext():null),l?R.j(Pf(l)):R.done()}).next(()=>{for(;l;)r(l,null),l=y.hasNext()?y.getNext():null})}getAllFromCollection(e,t,r){const u=[t.popLast().toArray(),t.lastSegment(),P_(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],f=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return cc(e).W(IDBKeyRange.bound(u,f,!0)).next(y=>{let l=Kr();for(const T of y){const A=this.jn(Tt.fromSegments(T.prefixPath.concat(T.collectionGroup,T.documentId)),T);l=l.insert(A.key,A)}return l})}getAllFromCollectionGroup(e,t,r,u){let f=Kr();const y=nI(t,r),l=nI(t,hs.max());return cc(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(y,l,!0)},(T,A,R)=>{const z=this.jn(Tt.fromSegments(A.prefixPath.concat(A.collectionGroup,A.documentId)),A);f=f.insert(z.key,z),f.size===u&&R.done()}).next(()=>f)}newChangeBuffer(e){return new G3(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return tI(e).get("remoteDocumentGlobalKey").next(t=>(jt(!!t),t))}Qn(e,t){return tI(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const r=A3(this.yt,t);if(!(r.isNoDocument()&&r.version.isEqual(Ht.min())))return r}return ui.newInvalidDocument(e)}}function QA(i){return new j3(i)}class G3 extends YA{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Tl(r=>r.toString(),(r,u)=>r.isEqual(u))}applyChanges(e){const t=[];let r=0,u=new si((f,y)=>hn(f.canonicalString(),y.canonicalString()));return this.changes.forEach((f,y)=>{const l=this.Xn.get(f);if(t.push(this.Yn.removeEntry(e,f,l.readTime)),y.isValidDocument()){const T=jE(this.Yn.yt,y);u=u.add(f.path.popLast());const A=L_(T);r+=A-l.size,t.push(this.Yn.addEntry(e,f,T))}else if(r-=l.size,this.trackRemovals){const T=jE(this.Yn.yt,y.convertToNoDocument(Ht.min()));t.push(this.Yn.addEntry(e,f,T))}}),u.forEach(f=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,f))}),t.push(this.Yn.updateMetadata(e,r)),Me.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(r=>(this.Xn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:r,Jn:u})=>(u.forEach((f,y)=>{this.Xn.set(f,{size:y,readTime:r.get(f).readTime})}),r))}}function tI(i){return sr(i,"remoteDocumentGlobal")}function cc(i){return sr(i,"remoteDocumentsV14")}function Pf(i){const e=i.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function nI(i,e){const t=e.documentKey.path.toArray();return[i,P_(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function iI(i,e){const t=i.path.toArray(),r=e.path.toArray();let u=0;for(let f=0;f<t.length-2&&f<r.length-2;++f)if(u=hn(t[f],r[f]),u)return u;return u=hn(t.length,r.length),u||(u=hn(t[t.length-2],r[r.length-2]),u||hn(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $3{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JA{constructor(e,t,r,u){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=u}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(u=>(r=u,this.remoteDocumentCache.getEntry(e,t))).next(u=>(r!==null&&Hf(r.mutation,u,ls.empty(),xi.now()),u))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,yn()).next(()=>r))}getLocalViewOfDocuments(e,t,r=yn()){const u=vo();return this.populateOverlays(e,u,t).next(()=>this.computeViews(e,t,u,r).next(f=>{let y=Uf();return f.forEach((l,T)=>{y=y.insert(l,T.overlayedDocument)}),y}))}getOverlayedDocuments(e,t){const r=vo();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,yn()))}populateOverlays(e,t,r){const u=[];return r.forEach(f=>{t.has(f)||u.push(f)}),this.documentOverlayCache.getOverlays(e,u).next(f=>{f.forEach((y,l)=>{t.set(y,l)})})}computeViews(e,t,r,u){let f=Kr();const y=Xf(),l=Xf();return t.forEach((T,A)=>{const R=r.get(A.key);u.has(A.key)&&(R===void 0||R.mutation instanceof oa)?f=f.insert(A.key,A):R!==void 0&&(y.set(A.key,R.mutation.getFieldMask()),Hf(R.mutation,A,R.mutation.getFieldMask(),xi.now()))}),this.recalculateAndSaveOverlays(e,f).next(T=>(T.forEach((A,R)=>y.set(A,R)),t.forEach((A,R)=>{var z;return l.set(A,new $3(R,(z=y.get(A))!==null&&z!==void 0?z:null))}),l))}recalculateAndSaveOverlays(e,t){const r=Xf();let u=new ki((y,l)=>y-l),f=yn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(y=>{for(const l of y)l.keys().forEach(T=>{const A=t.get(T);if(A===null)return;let R=r.get(T)||ls.empty();R=l.applyToLocalView(A,R),r.set(T,R);const z=(u.get(l.batchId)||yn()).add(T);u=u.insert(l.batchId,z)})}).next(()=>{const y=[],l=u.getReverseIterator();for(;l.hasNext();){const T=l.getNext(),A=T.key,R=T.value,z=AA();R.forEach(j=>{if(!f.has(j)){const ee=bA(t.get(j),r.get(j));ee!==null&&z.set(j,ee),f=f.add(j)}}),y.push(this.documentOverlayCache.saveOverlays(e,A,z))}return Me.waitFor(y)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return function(u){return Tt.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Kx(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r)}getNextDocuments(e,t,r,u){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,u).next(f=>{const y=u-f.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,u-f.size):Me.resolve(vo());let l=-1,T=f;return y.next(A=>Me.forEach(A,(R,z)=>(l<z.largestBatchId&&(l=z.largestBatchId),f.get(R)?Me.resolve():this.remoteDocumentCache.getEntry(e,R).next(j=>{T=T.insert(R,j)}))).next(()=>this.populateOverlays(e,A,f)).next(()=>this.computeViews(e,T,A,yn())).next(R=>({batchId:l,changes:SA(R)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Tt(t)).next(r=>{let u=Uf();return r.isFoundDocument()&&(u=u.insert(r.key,r)),u})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const u=t.collectionGroup;let f=Uf();return this.indexManager.getCollectionParents(e,u).next(y=>Me.forEach(y,l=>{const T=function(A,R){return new sa(R,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(t,l.child(u));return this.getDocumentsMatchingCollectionQuery(e,T,r).next(A=>{A.forEach((R,z)=>{f=f.insert(R,z)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(e,t,r){let u;return this.remoteDocumentCache.getAllFromCollection(e,t.path,r).next(f=>(u=f,this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId))).next(f=>{f.forEach((l,T)=>{const A=T.getKey();u.get(A)===null&&(u=u.insert(A,ui.newInvalidDocument(A)))});let y=Uf();return u.forEach((l,T)=>{const A=f.get(l);A!==void 0&&Hf(A.mutation,T,ls.empty(),xi.now()),Yx(t,T)&&(y=y.insert(l,T))}),y})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q3{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return Me.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var r;return this.Zn.set(t.id,{id:(r=t).id,version:r.version,createTime:zi(r.createTime)}),Me.resolve()}getNamedQuery(e,t){return Me.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,function(r){return{name:r.name,query:r1(r.bundledQuery),readTime:zi(r.readTime)}}(t)),Me.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W3{constructor(){this.overlays=new ki(Tt.comparator),this.es=new Map}getOverlay(e,t){return Me.resolve(this.overlays.get(t))}getOverlays(e,t){const r=vo();return Me.forEach(t,u=>this.getOverlay(e,u).next(f=>{f!==null&&r.set(u,f)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((u,f)=>{this.oe(e,t,f)}),Me.resolve()}removeOverlaysForBatchId(e,t,r){const u=this.es.get(r);return u!==void 0&&(u.forEach(f=>this.overlays=this.overlays.remove(f)),this.es.delete(r)),Me.resolve()}getOverlaysForCollection(e,t,r){const u=vo(),f=t.length+1,y=new Tt(t.child("")),l=this.overlays.getIteratorFrom(y);for(;l.hasNext();){const T=l.getNext().value,A=T.getKey();if(!t.isPrefixOf(A.path))break;A.path.length===f&&T.largestBatchId>r&&u.set(T.getKey(),T)}return Me.resolve(u)}getOverlaysForCollectionGroup(e,t,r,u){let f=new ki((A,R)=>A-R);const y=this.overlays.getIterator();for(;y.hasNext();){const A=y.getNext().value;if(A.getKey().getCollectionGroup()===t&&A.largestBatchId>r){let R=f.get(A.largestBatchId);R===null&&(R=vo(),f=f.insert(A.largestBatchId,R)),R.set(A.getKey(),A)}}const l=vo(),T=f.getIterator();for(;T.hasNext()&&(T.getNext().value.forEach((A,R)=>l.set(A,R)),!(l.size()>=u)););return Me.resolve(l)}oe(e,t,r){const u=this.overlays.get(r.key);if(u!==null){const y=this.es.get(u.largestBatchId).delete(r.key);this.es.set(u.largestBatchId,y)}this.overlays=this.overlays.insert(r.key,new i1(t,r));let f=this.es.get(t);f===void 0&&(f=yn(),this.es.set(t,f)),this.es.set(t,f.add(r.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a1{constructor(){this.ns=new si(nr.ss),this.rs=new si(nr.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const r=new nr(e,t);this.ns=this.ns.add(r),this.rs=this.rs.add(r)}us(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.cs(new nr(e,t))}hs(e,t){e.forEach(r=>this.removeReference(r,t))}ls(e){const t=new Tt(new On([])),r=new nr(t,e),u=new nr(t,e+1),f=[];return this.rs.forEachInRange([r,u],y=>{this.cs(y),f.push(y.key)}),f}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new Tt(new On([])),r=new nr(t,e),u=new nr(t,e+1);let f=yn();return this.rs.forEachInRange([r,u],y=>{f=f.add(y.key)}),f}containsKey(e){const t=new nr(e,0),r=this.ns.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class nr{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return Tt.comparator(e.key,t.key)||hn(e._s,t._s)}static os(e,t){return hn(e._s,t._s)||Tt.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new si(nr.ss)}checkEmpty(e){return Me.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,u){const f=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const y=new t1(f,t,r,u);this.mutationQueue.push(y);for(const l of u)this.gs=this.gs.add(new nr(l.key,f)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return Me.resolve(y)}lookupMutationBatch(e,t){return Me.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,u=this.ps(r),f=u<0?0:u;return Me.resolve(this.mutationQueue.length>f?this.mutationQueue[f]:null)}getHighestUnacknowledgedBatchId(){return Me.resolve(this.mutationQueue.length===0?-1:this.ws-1)}getAllMutationBatches(e){return Me.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new nr(t,0),u=new nr(t,Number.POSITIVE_INFINITY),f=[];return this.gs.forEachInRange([r,u],y=>{const l=this.ys(y._s);f.push(l)}),Me.resolve(f)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new si(hn);return t.forEach(u=>{const f=new nr(u,0),y=new nr(u,Number.POSITIVE_INFINITY);this.gs.forEachInRange([f,y],l=>{r=r.add(l._s)})}),Me.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,u=r.length+1;let f=r;Tt.isDocumentKey(f)||(f=f.child(""));const y=new nr(new Tt(f),0);let l=new si(hn);return this.gs.forEachWhile(T=>{const A=T.key.path;return!!r.isPrefixOf(A)&&(A.length===u&&(l=l.add(T._s)),!0)},y),Me.resolve(this.Is(l))}Is(e){const t=[];return e.forEach(r=>{const u=this.ys(r);u!==null&&t.push(u)}),t}removeMutationBatch(e,t){jt(this.Ts(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.gs;return Me.forEach(t.mutations,u=>{const f=new nr(u.key,t.batchId);return r=r.delete(f),this.referenceDelegate.markPotentiallyOrphaned(e,u.key)}).next(()=>{this.gs=r})}An(e){}containsKey(e,t){const r=new nr(t,0),u=this.gs.firstAfterOrEqual(r);return Me.resolve(t.isEqual(u&&u.key))}performConsistencyCheck(e){return this.mutationQueue.length,Me.resolve()}Ts(e,t){return this.ps(e)}ps(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H3{constructor(e){this.Es=e,this.docs=new ki(Tt.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,u=this.docs.get(r),f=u?u.size:0,y=this.Es(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:y}),this.size+=y-f,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return Me.resolve(r?r.document.mutableCopy():ui.newInvalidDocument(t))}getEntries(e,t){let r=Kr();return t.forEach(u=>{const f=this.docs.get(u);r=r.insert(u,f?f.document.mutableCopy():ui.newInvalidDocument(u))}),Me.resolve(r)}getAllFromCollection(e,t,r){let u=Kr();const f=new Tt(t.child("")),y=this.docs.getIteratorFrom(f);for(;y.hasNext();){const{key:l,value:{document:T}}=y.getNext();if(!t.isPrefixOf(l.path))break;l.path.length>t.length+1||Wx(ZS(T),r)<=0||(u=u.insert(T.key,T.mutableCopy()))}return Me.resolve(u)}getAllFromCollectionGroup(e,t,r,u){Pt()}As(e,t){return Me.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new X3(this)}getSize(e){return Me.resolve(this.size)}}class X3 extends YA{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((r,u)=>{u.isValidDocument()?t.push(this.Yn.addEntry(e,u)):this.Yn.removeEntry(r)}),Me.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K3{constructor(e){this.persistence=e,this.Rs=new Tl(t=>Rc(t),Up),this.lastRemoteSnapshotVersion=Ht.min(),this.highestTargetId=0,this.bs=0,this.Ps=new a1,this.targetCount=0,this.vs=Fc.Pn()}forEachTarget(e,t){return this.Rs.forEach((r,u)=>t(u)),Me.resolve()}getLastRemoteSnapshotVersion(e){return Me.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Me.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),Me.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.bs&&(this.bs=t),Me.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Fc(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,Me.resolve()}updateTargetData(e,t){return this.Dn(t),Me.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,Me.resolve()}removeTargets(e,t,r){let u=0;const f=[];return this.Rs.forEach((y,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.Rs.delete(y),f.push(this.removeMatchingKeysForTargetId(e,l.targetId)),u++)}),Me.waitFor(f).next(()=>u)}getTargetCount(e){return Me.resolve(this.targetCount)}getTargetData(e,t){const r=this.Rs.get(t)||null;return Me.resolve(r)}addMatchingKeys(e,t,r){return this.Ps.us(t,r),Me.resolve()}removeMatchingKeys(e,t,r){this.Ps.hs(t,r);const u=this.persistence.referenceDelegate,f=[];return u&&t.forEach(y=>{f.push(u.markPotentiallyOrphaned(e,y))}),Me.waitFor(f)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),Me.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Ps.ds(t);return Me.resolve(r)}containsKey(e,t){return Me.resolve(this.Ps.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new Xr(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new K3(this),this.indexManager=new z3,this.remoteDocumentCache=function(r){return new H3(r)}(r=>this.referenceDelegate.xs(r)),this.yt=new $A(t),this.Ns=new q3(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new W3,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Vs[e.toKey()];return r||(r=new Z3(t,this.referenceDelegate),this.Vs[e.toKey()]=r),r}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,r){ot("MemoryPersistence","Starting transaction:",e);const u=new Y3(this.Ss.next());return this.referenceDelegate.ks(),r(u).next(f=>this.referenceDelegate.Os(u).next(()=>f)).toPromise().then(f=>(u.raiseOnCommittedEvent(),f))}Ms(e,t){return Me.or(Object.values(this.Vs).map(r=>()=>r.containsKey(e,t)))}}class Y3 extends XS{constructor(e){super(),this.currentSequenceNumber=e}}class dy{constructor(e){this.persistence=e,this.Fs=new a1,this.$s=null}static Bs(e){return new dy(e)}get Ls(){if(this.$s)return this.$s;throw Pt()}addReference(e,t,r){return this.Fs.addReference(r,t),this.Ls.delete(r.toString()),Me.resolve()}removeReference(e,t,r){return this.Fs.removeReference(r,t),this.Ls.add(r.toString()),Me.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),Me.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(u=>this.Ls.add(u.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(u=>{u.forEach(f=>this.Ls.add(f.toString()))}).next(()=>r.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Me.forEach(this.Ls,r=>{const u=Tt.fromPath(r);return this.qs(e,u).next(f=>{f||t.removeEntry(u,Ht.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(r=>{r?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return Me.or([()=>Me.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q3{constructor(e){this.yt=e}$(e,t,r,u){const f=new sy("createOrUpgrade",t);r<1&&u>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",VE,{unique:!0}),l.createObjectStore("documentMutations")}(e),rI(e),function(l){l.createObjectStore("remoteDocuments")}(e));let y=Me.resolve();return r<3&&u>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),rI(e)),y=y.next(()=>function(l){const T=l.store("targetGlobal"),A={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ht.min().toTimestamp(),targetCount:0};return T.put("targetGlobalKey",A)}(f))),r<4&&u>=4&&(r!==0&&(y=y.next(()=>function(l,T){return T.store("mutations").W().next(A=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",VE,{unique:!0});const R=T.store("mutations"),z=A.map(j=>R.put(j));return Me.waitFor(z)})}(e,f))),y=y.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&u>=5&&(y=y.next(()=>this.Us(f))),r<6&&u>=6&&(y=y.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(f)))),r<7&&u>=7&&(y=y.next(()=>this.Gs(f))),r<8&&u>=8&&(y=y.next(()=>this.Qs(e,f))),r<9&&u>=9&&(y=y.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&u>=10&&(y=y.next(()=>this.js(f))),r<11&&u>=11&&(y=y.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&u>=12&&(y=y.next(()=>{(function(l){const T=l.createObjectStore("documentOverlays",{keyPath:w3});T.createIndex("collectionPathOverlayIndex",T3,{unique:!1}),T.createIndex("collectionGroupOverlayIndex",E3,{unique:!1})})(e)})),r<13&&u>=13&&(y=y.next(()=>function(l){const T=l.createObjectStore("remoteDocumentsV14",{keyPath:h3});T.createIndex("documentKeyIndex",d3),T.createIndex("collectionGroupIndex",f3)}(e)).next(()=>this.Ws(e,f)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&u>=14&&(y=y.next(()=>this.zs(e,f))),r<15&&u>=15&&(y=y.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:y3}).createIndex("sequenceNumberIndex",v3,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:x3}).createIndex("documentKeyIndex",b3,{unique:!1})}(e))),y}Ks(e){let t=0;return e.store("remoteDocuments").Z((r,u)=>{t+=L_(u)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Us(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(u=>Me.forEach(u,f=>{const y=IDBKeyRange.bound([f.userId,-1],[f.userId,f.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",y).next(l=>Me.forEach(l,T=>{jt(T.userId===f.userId);const A=fc(this.yt,T);return HA(e,f.userId,A).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(u=>{const f=[];return r.Z((y,l)=>{const T=new On(y),A=function(R){return[0,Fr(R)]}(T);f.push(t.get(A).next(R=>R?Me.resolve():(z=>t.put({targetId:0,path:Fr(z),sequenceNumber:u.highestListenSequenceNumber}))(T)))}).next(()=>Me.waitFor(f))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:_3});const r=t.store("collectionParents"),u=new o1,f=y=>{if(u.add(y)){const l=y.lastSegment(),T=y.popLast();return r.put({collectionId:l,parent:Fr(T)})}};return t.store("remoteDocuments").Z({X:!0},(y,l)=>{const T=new On(y);return f(T.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([y,l,T],A)=>{const R=xo(l);return f(R.popLast())}))}js(e){const t=e.store("targets");return t.Z((r,u)=>{const f=Vf(u),y=qA(this.yt,f);return t.put(y)})}Ws(e,t){const r=t.store("remoteDocuments"),u=[];return r.Z((f,y)=>{const l=t.store("remoteDocumentsV14"),T=(A=y,A.document?new Tt(On.fromString(A.document.name).popFirst(5)):A.noDocument?Tt.fromSegments(A.noDocument.path):A.unknownDocument?Tt.fromSegments(A.unknownDocument.path):Pt()).path.toArray();var A;/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const R={prefixPath:T.slice(0,T.length-2),collectionGroup:T[T.length-2],documentId:T[T.length-1],readTime:y.readTime||[0,0],unknownDocument:y.unknownDocument,noDocument:y.noDocument,document:y.document,hasCommittedMutations:!!y.hasCommittedMutations};u.push(l.put(R))}).next(()=>Me.waitFor(u))}zs(e,t){const r=t.store("mutations"),u=QA(this.yt),f=new eC(dy.Bs,this.yt.ie);return r.W().next(y=>{const l=new Map;return y.forEach(T=>{var A;let R=(A=l.get(T.userId))!==null&&A!==void 0?A:yn();fc(this.yt,T).keys().forEach(z=>R=R.add(z)),l.set(T.userId,R)}),Me.forEach(l,(T,A)=>{const R=new ir(A),z=uy.re(this.yt,R),j=f.getIndexManager(R),ee=hy.re(R,this.yt,j,f.referenceDelegate);return new JA(u,ee,z,j).recalculateAndSaveOverlaysForDocumentKeys(new nx(t,Xr.at),T).next()})})}}function rI(i){i.createObjectStore("targetDocuments",{keyPath:m3}).createIndex("documentTargetsIndex",g3,{unique:!0}),i.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",p3,{unique:!0}),i.createObjectStore("targetGlobal")}const y0="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class l1{constructor(e,t,r,u,f,y,l,T,A,R,z=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Hs=f,this.window=y,this.document=l,this.Js=A,this.Ys=R,this.Xs=z,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=j=>Promise.resolve(),!l1.C())throw new nt(ze.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new V3(this,u),this.ii=t+"main",this.yt=new $A(T),this.ri=new Gs(this.ii,this.Xs,new Q3(this.yt)),this.Cs=new B3(this.referenceDelegate,this.yt),this.remoteDocumentCache=QA(this.yt),this.Ns=new C3,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,R===!1&&Ri("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new nt(ze.FAILED_PRECONDITION,y0);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new Xr(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){return this.si=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Hg(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(wl(e))return ot("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ot("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return Rf(e).get("owner").next(t=>Me.resolve(this.mi(t)))}gi(e){return Hg(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=sr(t,"clientMetadata");return r.W().next(u=>{const f=this.Ii(u,18e5),y=u.filter(l=>f.indexOf(l)===-1);return Me.forEach(y,l=>r.delete(l.clientId)).next(()=>y)})}).catch(()=>[]);if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?Me.resolve(!0):Rf(e).get("owner").next(t=>{if(t!==null&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new nt(ze.FAILED_PRECONDITION,y0);return!1}}return!(!this.networkEnabled||!this.inForeground)||Hg(e).W().next(r=>this.Ii(r,5e3).find(u=>{if(this.clientId!==u.clientId){const f=!this.networkEnabled&&u.networkEnabled,y=!this.inForeground&&u.inForeground,l=this.networkEnabled===u.networkEnabled;if(f||y&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&ot("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new nx(e,Xr.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(r=>this.pi(r.updateTimeMs,t)&&!this.Ei(r.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>Hg(e).W().next(t=>this.Ii(t,18e5).map(r=>r.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return hy.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new O3(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return uy.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,r){ot("IndexedDbPersistence","Starting transaction:",e);const u=t==="readonly"?"readonly":"readwrite",f=(y=this.Xs)===15?S3:y===14?GA:y===13?jA:y===12?I3:y===11?VA:void Pt();var y;let l;return this.ri.runTransaction(e,u,f,T=>(l=new nx(T,this.Ss?this.Ss.next():Xr.at),t==="readwrite-primary"?this.fi(l).next(A=>!!A||this.di(l)).next(A=>{if(!A)throw Ri(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new nt(ze.FAILED_PRECONDITION,HS);return r(l)}).next(A=>this.wi(l).next(()=>A)):this.Vi(l).next(()=>r(l)))).then(T=>(l.raiseOnCommittedEvent(),T))}Vi(e){return Rf(e).get("owner").next(t=>{if(t!==null&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new nt(ze.FAILED_PRECONDITION,y0)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Rf(e).put("owner",t)}static C(){return Gs.C()}_i(e){const t=Rf(e);return t.get("owner").next(r=>this.mi(r)?(ot("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Me.resolve())}pi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Ri(`Detected an update time that is in the future: ${e} > ${r}`),!1))}ci(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground=this.document.visibilityState==="visible")}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Zs=()=>{this.Ai(),FR()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const r=((t=this.oi)===null||t===void 0?void 0:t.getItem(this.Ti(e)))!==null;return ot("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ri("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){Ri("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch{}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Rf(i){return sr(i,"owner")}function Hg(i){return sr(i,"clientMetadata")}function c1(i,e){let t=i.projectId;return i.isDefaultDatabase||(t+="."+i.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u1{constructor(e,t,r,u){this.targetId=e,this.fromCache=t,this.Si=r,this.Di=u}static Ci(e,t){let r=yn(),u=yn();for(const f of t.docChanges)switch(f.type){case 0:r=r.add(f.doc.key);break;case 1:u=u.add(f.doc.key)}return new u1(e,t.fromCache,r,u)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tC{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,r,u){return this.ki(e,t).next(f=>f||this.Oi(e,t,u,r)).next(f=>f||this.Mi(e,t))}ki(e,t){if(DE(t))return Me.resolve(null);let r=Nr(t);return this.indexManager.getIndexType(e,r).next(u=>u===0?null:(t.limit!==null&&u===1&&(t=D_(t,null,"F"),r=Nr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(f=>{const y=yn(...f);return this.Ni.getDocuments(e,y).next(l=>this.indexManager.getMinOffset(e,r).next(T=>{const A=this.Fi(t,l);return this.$i(t,A,y,T.readTime)?this.ki(e,D_(t,null,"F")):this.Bi(e,A,t,T)}))})))}Oi(e,t,r,u){return DE(t)||u.isEqual(Ht.min())?this.Mi(e,t):this.Ni.getDocuments(e,r).next(f=>{const y=this.Fi(t,f);return this.$i(t,y,r,u)?this.Mi(e,t):(W0()<=$n.DEBUG&&ot("QueryEngine","Re-using previous result from %s to execute query: %s",u.toString(),J0(t)),this.Bi(e,y,t,WS(u,-1)))})}Fi(e,t){let r=new si(fA(e));return t.forEach((u,f)=>{Yx(e,f)&&(r=r.add(f))}),r}$i(e,t,r,u){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const f=e.limitType==="F"?t.last():t.first();return!!f&&(f.hasPendingWrites||f.version.compareTo(u)>0)}Mi(e,t){return W0()<=$n.DEBUG&&ot("QueryEngine","Using full collection scan to execute query:",J0(t)),this.Ni.getDocumentsMatchingQuery(e,t,hs.min())}Bi(e,t,r,u){return this.Ni.getDocumentsMatchingQuery(e,r,u).next(f=>(t.forEach(y=>{f=f.insert(y.key,y)}),f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J3{constructor(e,t,r,u){this.persistence=e,this.Li=t,this.yt=u,this.qi=new ki(hn),this.Ui=new Tl(f=>Rc(f),Up),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(r)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new JA(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function nC(i,e,t,r){return new J3(i,e,t,r)}async function iC(i,e){const t=Et(i);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let u;return t.mutationQueue.getAllMutationBatches(r).next(f=>(u=f,t.Qi(e),t.mutationQueue.getAllMutationBatches(r))).next(f=>{const y=[],l=[];let T=yn();for(const A of u){y.push(A.batchId);for(const R of A.mutations)T=T.add(R.key)}for(const A of f){l.push(A.batchId);for(const R of A.mutations)T=T.add(R.key)}return t.localDocuments.getDocuments(r,T).next(A=>({ji:A,removedBatchIds:y,addedBatchIds:l}))})})}function eB(i,e){const t=Et(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const u=e.batch.keys(),f=t.Gi.newChangeBuffer({trackRemovals:!0});return function(y,l,T,A){const R=T.batch,z=R.keys();let j=Me.resolve();return z.forEach(ee=>{j=j.next(()=>A.getEntry(l,ee)).next(se=>{const be=T.docVersions.get(ee);jt(be!==null),se.version.compareTo(be)<0&&(R.applyToRemoteDocument(se,T),se.isValidDocument()&&(se.setReadTime(T.commitVersion),A.addEntry(se)))})}),j.next(()=>y.mutationQueue.removeMutationBatch(l,R))}(t,r,e,f).next(()=>f.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,u,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(y){let l=yn();for(let T=0;T<y.mutationResults.length;++T)y.mutationResults[T].transformResults.length>0&&(l=l.add(y.batch.mutations[T].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,u))})}function rC(i){const e=Et(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function tB(i,e){const t=Et(i),r=e.snapshotVersion;let u=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const y=t.Gi.newChangeBuffer({trackRemovals:!0});u=t.qi;const l=[];e.targetChanges.forEach((R,z)=>{const j=u.get(z);if(!j)return;l.push(t.Cs.removeMatchingKeys(f,R.removedDocuments,z).next(()=>t.Cs.addMatchingKeys(f,R.addedDocuments,z)));let ee=j.withSequenceNumber(f.currentSequenceNumber);e.targetMismatches.has(z)?ee=ee.withResumeToken(Xi.EMPTY_BYTE_STRING,Ht.min()).withLastLimboFreeSnapshotVersion(Ht.min()):R.resumeToken.approximateByteSize()>0&&(ee=ee.withResumeToken(R.resumeToken,r)),u=u.insert(z,ee),function(se,be,Re){return se.resumeToken.approximateByteSize()===0||be.snapshotVersion.toMicroseconds()-se.snapshotVersion.toMicroseconds()>=3e8?!0:Re.addedDocuments.size+Re.modifiedDocuments.size+Re.removedDocuments.size>0}(j,ee,R)&&l.push(t.Cs.updateTargetData(f,ee))});let T=Kr(),A=yn();if(e.documentUpdates.forEach(R=>{e.resolvedLimboDocuments.has(R)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(f,R))}),l.push(sC(f,y,e.documentUpdates).next(R=>{T=R.Wi,A=R.zi})),!r.isEqual(Ht.min())){const R=t.Cs.getLastRemoteSnapshotVersion(f).next(z=>t.Cs.setTargetsMetadata(f,f.currentSequenceNumber,r));l.push(R)}return Me.waitFor(l).next(()=>y.apply(f)).next(()=>t.localDocuments.getLocalViewOfDocuments(f,T,A)).next(()=>T)}).then(f=>(t.qi=u,f))}function sC(i,e,t){let r=yn(),u=yn();return t.forEach(f=>r=r.add(f)),e.getEntries(i,r).next(f=>{let y=Kr();return t.forEach((l,T)=>{const A=f.get(l);T.isFoundDocument()!==A.isFoundDocument()&&(u=u.add(l)),T.isNoDocument()&&T.version.isEqual(Ht.min())?(e.removeEntry(l,T.readTime),y=y.insert(l,T)):!A.isValidDocument()||T.version.compareTo(A.version)>0||T.version.compareTo(A.version)===0&&A.hasPendingWrites?(e.addEntry(T),y=y.insert(l,T)):ot("LocalStore","Ignoring outdated watch update for ",l,". Current version:",A.version," Watch version:",T.version)}),{Wi:y,zi:u}})}function nB(i,e){const t=Et(i);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Mh(i,e){const t=Et(i);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let u;return t.Cs.getTargetData(r,e).next(f=>f?(u=f,Me.resolve(u)):t.Cs.allocateTargetId(r).next(y=>(u=new rl(e,y,0,r.currentSequenceNumber),t.Cs.addTargetData(r,u).next(()=>u))))}).then(r=>{const u=t.qi.get(r.targetId);return(u===null||r.snapshotVersion.compareTo(u.snapshotVersion)>0)&&(t.qi=t.qi.insert(r.targetId,r),t.Ui.set(e,r.targetId)),r})}async function Dh(i,e,t){const r=Et(i),u=r.qi.get(e),f=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",f,y=>r.persistence.referenceDelegate.removeTarget(y,u))}catch(y){if(!wl(y))throw y;ot("LocalStore",`Failed to update sequence numbers for target ${e}: ${y}`)}r.qi=r.qi.remove(e),r.Ui.delete(u.target)}function z_(i,e,t){const r=Et(i);let u=Ht.min(),f=yn();return r.persistence.runTransaction("Execute query","readonly",y=>function(l,T,A){const R=Et(l),z=R.Ui.get(A);return z!==void 0?Me.resolve(R.qi.get(z)):R.Cs.getTargetData(T,A)}(r,y,Nr(e)).next(l=>{if(l)return u=l.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(y,l.targetId).next(T=>{f=T})}).next(()=>r.Li.getDocumentsMatchingQuery(y,e,t?u:Ht.min(),t?f:yn())).next(l=>(lC(r,dA(e),l),{documents:l,Hi:f})))}function oC(i,e){const t=Et(i),r=Et(t.Cs),u=t.qi.get(e);return u?Promise.resolve(u.target):t.persistence.runTransaction("Get target data","readonly",f=>r.ne(f,e).next(y=>y?y.target:null))}function aC(i,e){const t=Et(i),r=t.Ki.get(e)||Ht.min();return t.persistence.runTransaction("Get new document changes","readonly",u=>t.Gi.getAllFromCollectionGroup(u,e,WS(r,-1),Number.MAX_SAFE_INTEGER)).then(u=>(lC(t,e,u),u))}function lC(i,e,t){let r=i.Ki.get(e)||Ht.min();t.forEach((u,f)=>{f.readTime.compareTo(r)>0&&(r=f.readTime)}),i.Ki.set(e,r)}async function iB(i,e,t,r){const u=Et(i);let f=yn(),y=Kr();for(const A of t){const R=e.Ji(A.metadata.name);A.document&&(f=f.add(R));const z=e.Yi(A);z.setReadTime(e.Xi(A.metadata.readTime)),y=y.insert(R,z)}const l=u.Gi.newChangeBuffer({trackRemovals:!0}),T=await Mh(u,function(A){return Nr(Vh(On.fromString(`__bundle__/docs/${A}`)))}(r));return u.persistence.runTransaction("Apply bundle documents","readwrite",A=>sC(A,l,y).next(R=>(l.apply(A),R)).next(R=>u.Cs.removeMatchingKeysForTargetId(A,T.targetId).next(()=>u.Cs.addMatchingKeys(A,f,T.targetId)).next(()=>u.localDocuments.getLocalViewOfDocuments(A,R.Wi,R.zi)).next(()=>R.Wi)))}async function rB(i,e,t=yn()){const r=await Mh(i,Nr(r1(e.bundledQuery))),u=Et(i);return u.persistence.runTransaction("Save named query","readwrite",f=>{const y=zi(e.readTime);if(r.snapshotVersion.compareTo(y)>=0)return u.Ns.saveNamedQuery(f,e);const l=r.withResumeToken(Xi.EMPTY_BYTE_STRING,y);return u.qi=u.qi.insert(l.targetId,l),u.Cs.updateTargetData(f,l).next(()=>u.Cs.removeMatchingKeysForTargetId(f,r.targetId)).next(()=>u.Cs.addMatchingKeys(f,t,r.targetId)).next(()=>u.Ns.saveNamedQuery(f,e))})}function sI(i,e){return`firestore_clients_${i}_${e}`}function oI(i,e,t){let r=`firestore_mutations_${i}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function v0(i,e){return`firestore_targets_${i}_${e}`}class O_{constructor(e,t,r,u){this.user=e,this.batchId=t,this.state=r,this.error=u}static Zi(e,t,r){const u=JSON.parse(r);let f,y=typeof u=="object"&&["pending","acknowledged","rejected"].indexOf(u.state)!==-1&&(u.error===void 0||typeof u.error=="object");return y&&u.error&&(y=typeof u.error.message=="string"&&typeof u.error.code=="string",y&&(f=new nt(u.error.code,u.error.message))),y?new O_(e,t,u.state,f):(Ri("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Kf{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Zi(e,t){const r=JSON.parse(t);let u,f=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return f&&r.error&&(f=typeof r.error.message=="string"&&typeof r.error.code=="string",f&&(u=new nt(r.error.code,r.error.message))),f?new Kf(e,r.state,u):(Ri("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class B_{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const r=JSON.parse(t);let u=typeof r=="object"&&r.activeTargetIds instanceof Array,f=cy();for(let y=0;u&&y<r.activeTargetIds.length;++y)u=YS(r.activeTargetIds[y]),f=f.add(r.activeTargetIds[y]);return u?new B_(e,f):(Ri("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class h1{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new h1(t.clientId,t.onlineState):(Ri("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ox{constructor(){this.activeTargetIds=cy()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class x0{constructor(e,t,r,u,f){this.window=e,this.Hs=t,this.persistenceKey=r,this.sr=u,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new ki(hn),this.started=!1,this.cr=[];const y=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=f,this.ar=sI(this.persistenceKey,this.sr),this.hr=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.ur=this.ur.insert(this.sr,new ox),this.lr=new RegExp(`^firestore_clients_${y}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${y}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${y}_(\\d+)$`),this.wr=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.mr=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const r of e){if(r===this.sr)continue;const u=this.getItem(sI(this.persistenceKey,r));if(u){const f=B_.Zi(r,u);f&&(this.ur=this.ur.insert(f.clientId,f))}}this.gr();const t=this.storage.getItem(this.wr);if(t){const r=this.yr(t);r&&this.pr(r)}for(const r of this.cr)this.rr(r);this.cr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((r,u)=>{u.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,r){this.Tr(e,t,r),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(v0(this.persistenceKey,e));if(r){const u=Kf.Zi(e,r);u&&(t=u.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(v0(this.persistenceKey,e))}updateQueryState(e,t,r){this.Rr(e,t,r)}handleUserChange(e,t,r){t.forEach(u=>{this.Er(u)}),this.currentUser=e,r.forEach(u=>{this.addPendingMutation(u)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ot("SharedClientState","READ",e,t),t}setItem(e,t){ot("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ot("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const t=e;if(t.storageArea===this.storage){if(ot("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ar)return void Ri("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.lr.test(t.key)){if(t.newValue==null){const r=this.vr(t.key);return this.Vr(r,null)}{const r=this.Sr(t.key,t.newValue);if(r)return this.Vr(r.clientId,r)}}else if(this.dr.test(t.key)){if(t.newValue!==null){const r=this.Dr(t.key,t.newValue);if(r)return this.Cr(r)}}else if(this._r.test(t.key)){if(t.newValue!==null){const r=this.Nr(t.key,t.newValue);if(r)return this.kr(r)}}else if(t.key===this.wr){if(t.newValue!==null){const r=this.yr(t.newValue);if(r)return this.pr(r)}}else if(t.key===this.hr){const r=function(u){let f=Xr.at;if(u!=null)try{const y=JSON.parse(u);jt(typeof y=="number"),f=y}catch(y){Ri("SharedClientState","Failed to read sequence number from WebStorage",y)}return f}(t.newValue);r!==Xr.at&&this.sequenceNumberHandler(r)}else if(t.key===this.mr){const r=this.Or(t.newValue);await Promise.all(r.map(u=>this.syncEngine.Mr(u)))}}}else this.cr.push(t)})}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,r){const u=new O_(this.currentUser,e,t,r),f=oI(this.persistenceKey,this.currentUser,e);this.setItem(f,u.tr())}Er(e){const t=oI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){const t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Rr(e,t,r){const u=v0(this.persistenceKey,e),f=new Kf(e,t,r);this.setItem(u,f.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const r=this.vr(e);return B_.Zi(r,t)}Dr(e,t){const r=this.dr.exec(e),u=Number(r[1]),f=r[2]!==void 0?r[2]:null;return O_.Zi(new ir(f),u,t)}Nr(e,t){const r=this._r.exec(e),u=Number(r[1]);return Kf.Zi(u,t)}yr(e){return h1.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);ot("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const r=t?this.ur.insert(e,t):this.ur.remove(e),u=this.Ir(this.ur),f=this.Ir(r),y=[],l=[];return f.forEach(T=>{u.has(T)||y.push(T)}),u.forEach(T=>{f.has(T)||l.push(T)}),this.syncEngine.Br(y,l).then(()=>{this.ur=r})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=cy();return e.forEach((r,u)=>{t=t.unionWith(u.activeTargetIds)}),t}}class cC{constructor(){this.Lr=new ox,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,r){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new ox,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sB{Ur(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aI{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){ot("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){ot("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oB={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aB{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lB extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,r,u,f){const y=this.ho(e,t);ot("RestConnection","Sending: ",y,r);const l={};return this.lo(l,u,f),this.fo(e,y,l,r).then(T=>(ot("RestConnection","Received: ",T),T),T=>{throw Th("RestConnection",`${e} failed with error: `,T,"url: ",y,"request:",r),T})}_o(e,t,r,u,f,y){return this.ao(e,t,r,u,f)}lo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Uh,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((u,f)=>e[f]=u),r&&r.headers.forEach((u,f)=>e[f]=u)}ho(e,t){const r=oB[e];return`${this.oo}/v1/${t}:${r}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,r,u){return new Promise((f,y)=>{const l=new uO;l.setWithCredentials(!0),l.listenOnce(aO.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case g0.NO_ERROR:const A=l.getResponseJson();ot("Connection","XHR received:",JSON.stringify(A)),f(A);break;case g0.TIMEOUT:ot("Connection",'RPC "'+e+'" timed out'),y(new nt(ze.DEADLINE_EXCEEDED,"Request time out"));break;case g0.HTTP_ERROR:const R=l.getStatus();if(ot("Connection",'RPC "'+e+'" failed with status:',R,"response text:",l.getResponseText()),R>0){let z=l.getResponseJson();Array.isArray(z)&&(z=z[0]);const j=z==null?void 0:z.error;if(j&&j.status&&j.message){const ee=function(se){const be=se.toLowerCase().replace(/_/g,"-");return Object.values(ze).indexOf(be)>=0?be:ze.UNKNOWN}(j.status);y(new nt(ee,j.message))}else y(new nt(ze.UNKNOWN,"Server responded with status "+l.getStatus()))}else y(new nt(ze.UNAVAILABLE,"Connection failed."));break;default:Pt()}}finally{ot("Connection",'RPC "'+e+'" completed.')}});const T=JSON.stringify(u);l.send(t,"POST",T,r,15)})}wo(e,t,r){const u=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=sO(),y=oO(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(l.xmlHttpFactory=new cO({})),this.lo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const T=u.join("");ot("Connection","Creating WebChannel: "+T,l);const A=f.createWebChannel(T,l);let R=!1,z=!1;const j=new aB({Hr:se=>{z?ot("Connection","Not sending because WebChannel is closed:",se):(R||(ot("Connection","Opening WebChannel transport."),A.open(),R=!0),ot("Connection","WebChannel sending:",se),A.send(se))},Jr:()=>A.close()}),ee=(se,be,Re)=>{se.listen(be,Ge=>{try{Re(Ge)}catch(it){setTimeout(()=>{throw it},0)}})};return ee(A,Gg.EventType.OPEN,()=>{z||ot("Connection","WebChannel transport opened.")}),ee(A,Gg.EventType.CLOSE,()=>{z||(z=!0,ot("Connection","WebChannel transport closed"),j.io())}),ee(A,Gg.EventType.ERROR,se=>{z||(z=!0,Th("Connection","WebChannel transport errored:",se),j.io(new nt(ze.UNAVAILABLE,"The operation could not be completed")))}),ee(A,Gg.EventType.MESSAGE,se=>{var be;if(!z){const Re=se.data[0];jt(!!Re);const Ge=Re,it=Ge.error||((be=Ge[0])===null||be===void 0?void 0:be.error);if(it){ot("Connection","WebChannel received error:",it);const dt=it.status;let Ue=function(Ke){const He=Bi[Ke];if(He!==void 0)return EA(He)}(dt),ge=it.message;Ue===void 0&&(Ue=ze.INTERNAL,ge="Unknown error status: "+dt+" with message "+it.message),z=!0,j.io(new nt(Ue,ge)),A.close()}else ot("Connection","WebChannel received:",Re),j.ro(Re)}}),ee(y,lO.STAT_EVENT,se=>{se.stat===_E.PROXY?ot("Connection","Detected buffering proxy"):se.stat===_E.NOPROXY&&ot("Connection","Detected no buffering proxy")}),setTimeout(()=>{j.so()},0),j}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uC(){return typeof window<"u"?window:null}function r_(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qp(i){return new JO(i,!0)}class d1{constructor(e,t,r=1e3,u=1.5,f=6e4){this.Hs=e,this.timerId=t,this.mo=r,this.yo=u,this.po=f,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),u=Math.max(0,t-r);u>0&&ot("ExponentialBackoff",`Backing off for ${u} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,u,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){this.To!==null&&(this.To.skipDelay(),this.To=null)}cancel(){this.To!==null&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(e,t,r,u,f,y,l,T){this.Hs=e,this.vo=r,this.Vo=u,this.connection=f,this.authCredentialsProvider=y,this.appCheckCredentialsProvider=l,this.listener=T,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new d1(e,t)}No(){return this.state===1||this.state===5||this.ko()}ko(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&this.Do===null&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,e!==4?this.xo.reset():t&&t.code===ze.RESOURCE_EXHAUSTED?(Ri(t.toString()),Ri("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===ze.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,u])=>{this.So===t&&this.Go(r,u)},r=>{e(()=>{const u=new nt(ze.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Qo(u)})})}Go(e,t){const r=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{r(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(u=>{r(()=>this.Qo(u))}),this.stream.onMessage(u=>{r(()=>this.onMessage(u))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return ot("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(ot("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class cB extends hC{constructor(e,t,r,u,f,y){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,u,y),this.yt=f}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=n3(this.yt,e),r=function(u){if(!("targetChange"in u))return Ht.min();const f=u.targetChange;return f.targetIds&&f.targetIds.length?Ht.min():f.readTime?zi(f.readTime):Ht.min()}(e);return this.listener.Wo(t,r)}zo(e){const t={};t.database=dp(this.yt),t.addTarget=function(u,f){let y;const l=f.target;return y=k_(l)?{documents:zA(u,l)}:{query:e1(u,l)},y.targetId=f.targetId,f.resumeToken.approximateByteSize()>0?y.resumeToken=MA(u,f.resumeToken):f.snapshotVersion.compareTo(Ht.min())>0&&(y.readTime=kh(u,f.snapshotVersion.toTimestamp())),y}(this.yt,e);const r=r3(this.yt,e);r&&(t.labels=r),this.Bo(t)}Ho(e){const t={};t.database=dp(this.yt),t.removeTarget=e,this.Bo(t)}}class uB extends hC{constructor(e,t,r,u,f,y){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,u,y),this.yt=f,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(jt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=i3(e.writeResults,e.commitTime),r=zi(e.commitTime);return this.listener.Zo(r,t)}return jt(!e.writeResults||e.writeResults.length===0),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=dp(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>fp(this.yt,r))};this.Bo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hB extends class{}{constructor(e,t,r,u){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.yt=u,this.nu=!1}su(){if(this.nu)throw new nt(ze.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,f])=>this.connection.ao(e,t,r,u,f)).catch(u=>{throw u.name==="FirebaseError"?(u.code===ze.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new nt(ze.UNKNOWN,u.toString())})}_o(e,t,r,u){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,y])=>this.connection._o(e,t,r,f,y,u)).catch(f=>{throw f.name==="FirebaseError"?(f.code===ze.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new nt(ze.UNKNOWN,f.toString())})}terminate(){this.nu=!0}}async function dB(i,e){const t=Et(i),r=function(f,y){const l=e1(f,y);return{structuredAggregationQuery:{aggregations:[{count:{},alias:"count_alias"}],structuredQuery:l.structuredQuery},parent:l.parent}}(t.yt,Nr(e)),u=r.parent;return t.connection.co||delete r.parent,(await t._o("RunAggregationQuery",u,r,1)).filter(f=>!!f.result).map(f=>f.result.aggregateFields)}class fB{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){this.iu===0&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){this.state==="Online"?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,e==="Online"&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(Ri(t),this.ou=!1):ot("OnlineStateTracker",t)}lu(){this.ru!==null&&(this.ru.cancel(),this.ru=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pB{constructor(e,t,r,u,f){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=f,this.mu.Ur(y=>{r.enqueueAndForget(async()=>{aa(this)&&(ot("RemoteStore","Restarting streams for network reachability change."),await async function(l){const T=Et(l);T._u.add(4),await $h(T),T.gu.set("Unknown"),T._u.delete(4),await Wp(T)}(this))})}),this.gu=new fB(r,u)}}async function Wp(i){if(aa(i))for(const e of i.wu)await e(!0)}async function $h(i){for(const e of i.wu)await e(!1)}function fy(i,e){const t=Et(i);t.du.has(e.targetId)||(t.du.set(e.targetId,e),m1(t)?p1(t):Wh(t).ko()&&f1(t,e))}function pp(i,e){const t=Et(i),r=Wh(t);t.du.delete(e),r.ko()&&dC(t,e),t.du.size===0&&(r.ko()?r.Fo():aa(t)&&t.gu.set("Unknown"))}function f1(i,e){i.yu.Ot(e.targetId),Wh(i).zo(e)}function dC(i,e){i.yu.Ot(e),Wh(i).Ho(e)}function p1(i){i.yu=new XO({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>i.du.get(e)||null}),Wh(i).start(),i.gu.uu()}function m1(i){return aa(i)&&!Wh(i).No()&&i.du.size>0}function aa(i){return Et(i)._u.size===0}function fC(i){i.yu=void 0}async function mB(i){i.du.forEach((e,t)=>{f1(i,e)})}async function gB(i,e){fC(i),m1(i)?(i.gu.hu(e),p1(i)):i.gu.set("Unknown")}async function _B(i,e,t){if(i.gu.set("Online"),e instanceof kA&&e.state===2&&e.cause)try{await async function(r,u){const f=u.cause;for(const y of u.targetIds)r.du.has(y)&&(await r.remoteSyncer.rejectListen(y,f),r.du.delete(y),r.yu.removeTarget(y))}(i,e)}catch(r){ot("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await F_(i,r)}else if(e instanceof n_?i.yu.Kt(e):e instanceof CA?i.yu.Jt(e):i.yu.jt(e),!t.isEqual(Ht.min()))try{const r=await rC(i.localStore);t.compareTo(r)>=0&&await function(u,f){const y=u.yu.Zt(f);return y.targetChanges.forEach((l,T)=>{if(l.resumeToken.approximateByteSize()>0){const A=u.du.get(T);A&&u.du.set(T,A.withResumeToken(l.resumeToken,f))}}),y.targetMismatches.forEach(l=>{const T=u.du.get(l);if(!T)return;u.du.set(l,T.withResumeToken(Xi.EMPTY_BYTE_STRING,T.snapshotVersion)),dC(u,l);const A=new rl(T.target,l,1,T.sequenceNumber);f1(u,A)}),u.remoteSyncer.applyRemoteEvent(y)}(i,t)}catch(r){ot("RemoteStore","Failed to raise snapshot:",r),await F_(i,r)}}async function F_(i,e,t){if(!wl(e))throw e;i._u.add(1),await $h(i),i.gu.set("Offline"),t||(t=()=>rC(i.localStore)),i.asyncQueue.enqueueRetryable(async()=>{ot("RemoteStore","Retrying IndexedDB access"),await t(),i._u.delete(1),await Wp(i)})}function pC(i,e){return e().catch(t=>F_(i,t,e))}async function qh(i){const e=Et(i),t=hl(e);let r=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;yB(e);)try{const u=await nB(e.localStore,r);if(u===null){e.fu.length===0&&t.Fo();break}r=u.batchId,vB(e,u)}catch(u){await F_(e,u)}mC(e)&&gC(e)}function yB(i){return aa(i)&&i.fu.length<10}function vB(i,e){i.fu.push(e);const t=hl(i);t.ko()&&t.Yo&&t.Xo(e.mutations)}function mC(i){return aa(i)&&!hl(i).No()&&i.fu.length>0}function gC(i){hl(i).start()}async function xB(i){hl(i).eu()}async function bB(i){const e=hl(i);for(const t of i.fu)e.Xo(t.mutations)}async function wB(i,e,t){const r=i.fu.shift(),u=n1.from(r,e,t);await pC(i,()=>i.remoteSyncer.applySuccessfulWrite(u)),await qh(i)}async function TB(i,e){e&&hl(i).Yo&&await async function(t,r){if(u=r.code,TA(u)&&u!==ze.ABORTED){const f=t.fu.shift();hl(t).Mo(),await pC(t,()=>t.remoteSyncer.rejectFailedWrite(f.batchId,r)),await qh(t)}var u}(i,e),mC(i)&&gC(i)}async function lI(i,e){const t=Et(i);t.asyncQueue.verifyOperationInProgress(),ot("RemoteStore","RemoteStore received new credentials");const r=aa(t);t._u.add(3),await $h(t),r&&t.gu.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),await Wp(t)}async function ax(i,e){const t=Et(i);e?(t._u.delete(2),await Wp(t)):e||(t._u.add(2),await $h(t),t.gu.set("Unknown"))}function Wh(i){return i.pu||(i.pu=function(e,t,r){const u=Et(e);return u.su(),new cB(t,u.connection,u.authCredentials,u.appCheckCredentials,u.yt,r)}(i.datastore,i.asyncQueue,{Yr:mB.bind(null,i),Zr:gB.bind(null,i),Wo:_B.bind(null,i)}),i.wu.push(async e=>{e?(i.pu.Mo(),m1(i)?p1(i):i.gu.set("Unknown")):(await i.pu.stop(),fC(i))})),i.pu}function hl(i){return i.Iu||(i.Iu=function(e,t,r){const u=Et(e);return u.su(),new uB(t,u.connection,u.authCredentials,u.appCheckCredentials,u.yt,r)}(i.datastore,i.asyncQueue,{Yr:xB.bind(null,i),Zr:TB.bind(null,i),tu:bB.bind(null,i),Zo:wB.bind(null,i)}),i.wu.push(async e=>{e?(i.Iu.Mo(),await qh(i)):(await i.Iu.stop(),i.fu.length>0&&(ot("RemoteStore",`Stopping write stream with ${i.fu.length} pending writes`),i.fu=[]))})),i.Iu}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g1{constructor(e,t,r,u,f){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=u,this.removalCallback=f,this.deferred=new Zi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(y=>{})}static createAndSchedule(e,t,r,u,f){const y=Date.now()+r,l=new g1(e,t,y,u,f);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new nt(ze.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Zh(i,e){if(Ri("AsyncQueue",`${e}: ${i}`),wl(i))return new nt(ze.UNAVAILABLE,`${e}: ${i}`);throw i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hh{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Tt.comparator(t.key,r.key):(t,r)=>Tt.comparator(t.key,r.key),this.keyedMap=Uf(),this.sortedSet=new ki(this.comparator)}static emptySet(e){return new hh(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof hh)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const u=t.getNext().key,f=r.getNext().key;if(!u.isEqual(f))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new hh;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{constructor(){this.Tu=new ki(Tt.comparator)}track(e){const t=e.doc.key,r=this.Tu.get(t);r?e.type!==0&&r.type===3?this.Tu=this.Tu.insert(t,e):e.type===3&&r.type!==1?this.Tu=this.Tu.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Tu=this.Tu.remove(t):e.type===1&&r.type===2?this.Tu=this.Tu.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):Pt():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ph{constructor(e,t,r,u,f,y,l,T,A){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=u,this.mutatedKeys=f,this.fromCache=y,this.syncStateChanged=l,this.excludesMetadataChanges=T,this.hasCachedResults=A}static fromInitialDocuments(e,t,r,u,f){const y=[];return t.forEach(l=>{y.push({type:0,doc:l})}),new Ph(e,t,hh.emptySet(t),y,r,u,!0,!1,f)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Vp(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let u=0;u<t.length;u++)if(t[u].type!==r[u].type||!t[u].doc.isEqual(r[u].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EB{constructor(){this.Au=void 0,this.listeners=[]}}class IB{constructor(){this.queries=new Tl(e=>hA(e),Vp),this.onlineState="Unknown",this.Ru=new Set}}async function _1(i,e){const t=Et(i),r=e.query;let u=!1,f=t.queries.get(r);if(f||(u=!0,f=new EB),u)try{f.Au=await t.onListen(r)}catch(y){const l=Zh(y,`Initialization of query '${J0(e.query)}' failed`);return void e.onError(l)}t.queries.set(r,f),f.listeners.push(e),e.bu(t.onlineState),f.Au&&e.Pu(f.Au)&&v1(t)}async function y1(i,e){const t=Et(i),r=e.query;let u=!1;const f=t.queries.get(r);if(f){const y=f.listeners.indexOf(e);y>=0&&(f.listeners.splice(y,1),u=f.listeners.length===0)}if(u)return t.queries.delete(r),t.onUnlisten(r)}function SB(i,e){const t=Et(i);let r=!1;for(const u of e){const f=u.query,y=t.queries.get(f);if(y){for(const l of y.listeners)l.Pu(u)&&(r=!0);y.Au=u}}r&&v1(t)}function AB(i,e,t){const r=Et(i),u=r.queries.get(e);if(u)for(const f of u.listeners)f.onError(t);r.queries.delete(e)}function v1(i){i.Ru.forEach(e=>{e.next()})}class x1{constructor(e,t,r){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=r||{}}Pu(e){if(!this.options.includeMetadataChanges){const r=[];for(const u of e.docChanges)u.type!==3&&r.push(u);e=new Ph(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){if(!e.fromCache)return!0;const r=t!=="Offline";return(!this.options.Nu||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Du(e){if(e.docChanges.length>0)return!0;const t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}xu(e){e=Ph.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CB{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uI{constructor(e){this.yt=e}Ji(e){return wo(this.yt,e)}Yi(e){return e.metadata.exists?LA(this.yt,e.document,!1):ui.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return zi(e)}}class kB{constructor(e,t,r){this.Mu=e,this.localStore=t,this.yt=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=_C(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const r=On.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,r=new uI(this.yt);for(const u of e)if(u.metadata.queries){const f=r.Ji(u.metadata.name);for(const y of u.metadata.queries){const l=(t.get(y)||yn()).add(f);t.set(y,l)}}return t}async complete(){const e=await iB(this.localStore,new uI(this.yt),this.documents,this.Mu.id),t=this.$u(this.documents);for(const r of this.queries)await rB(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function _C(i){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{constructor(e){this.key=e}}class vC{constructor(e){this.key=e}}class xC{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=yn(),this.mutatedKeys=yn(),this.Gu=fA(e),this.Qu=new hh(this.Gu)}get ju(){return this.qu}Wu(e,t){const r=t?t.zu:new cI,u=t?t.Qu:this.Qu;let f=t?t.mutatedKeys:this.mutatedKeys,y=u,l=!1;const T=this.query.limitType==="F"&&u.size===this.query.limit?u.last():null,A=this.query.limitType==="L"&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal((R,z)=>{const j=u.get(R),ee=Yx(this.query,z)?z:null,se=!!j&&this.mutatedKeys.has(j.key),be=!!ee&&(ee.hasLocalMutations||this.mutatedKeys.has(ee.key)&&ee.hasCommittedMutations);let Re=!1;j&&ee?j.data.isEqual(ee.data)?se!==be&&(r.track({type:3,doc:ee}),Re=!0):this.Hu(j,ee)||(r.track({type:2,doc:ee}),Re=!0,(T&&this.Gu(ee,T)>0||A&&this.Gu(ee,A)<0)&&(l=!0)):!j&&ee?(r.track({type:0,doc:ee}),Re=!0):j&&!ee&&(r.track({type:1,doc:j}),Re=!0,(T||A)&&(l=!0)),Re&&(ee?(y=y.add(ee),f=be?f.add(R):f.delete(R)):(y=y.delete(R),f=f.delete(R)))}),this.query.limit!==null)for(;y.size>this.query.limit;){const R=this.query.limitType==="F"?y.last():y.first();y=y.delete(R.key),f=f.delete(R.key),r.track({type:1,doc:R})}return{Qu:y,zu:r,$i:l,mutatedKeys:f}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const u=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const f=e.zu.Eu();f.sort((A,R)=>function(z,j){const ee=se=>{switch(se){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Pt()}};return ee(z)-ee(j)}(A.type,R.type)||this.Gu(A.doc,R.doc)),this.Ju(r);const y=t?this.Yu():[],l=this.Ku.size===0&&this.current?1:0,T=l!==this.Uu;return this.Uu=l,f.length!==0||T?{snapshot:new Ph(this.query,e.Qu,u,f,e.mutatedKeys,l===0,T,!1,!!r&&r.resumeToken.approximateByteSize()>0),Xu:y}:{Xu:y}}bu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new cI,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=yn(),this.Qu.forEach(r=>{this.Zu(r.key)&&(this.Ku=this.Ku.add(r.key))});const t=[];return e.forEach(r=>{this.Ku.has(r)||t.push(new vC(r))}),this.Ku.forEach(r=>{e.has(r)||t.push(new yC(r))}),t}tc(e){this.qu=e.Hi,this.Ku=yn();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Ph.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,this.Uu===0,this.hasCachedResults)}}class MB{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class DB{constructor(e){this.key=e,this.nc=!1}}class PB{constructor(e,t,r,u,f,y){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=u,this.currentUser=f,this.maxConcurrentLimboResolutions=y,this.sc={},this.ic=new Tl(l=>hA(l),Vp),this.rc=new Map,this.oc=new Set,this.uc=new ki(Tt.comparator),this.cc=new Map,this.ac=new a1,this.hc={},this.lc=new Map,this.fc=Fc.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return this.dc===!0}}async function RB(i,e){const t=I1(i);let r,u;const f=t.ic.get(e);if(f)r=f.targetId,t.sharedClientState.addLocalQueryTarget(r),u=f.view.ec();else{const y=await Mh(t.localStore,Nr(e));t.isPrimaryClient&&fy(t.remoteStore,y);const l=t.sharedClientState.addLocalQueryTarget(y.targetId);r=y.targetId,u=await b1(t,e,r,l==="current",y.resumeToken)}return u}async function b1(i,e,t,r,u){i._c=(z,j,ee)=>async function(se,be,Re,Ge){let it=be.view.Wu(Re);it.$i&&(it=await z_(se.localStore,be.query,!1).then(({documents:ge})=>be.view.Wu(ge,it)));const dt=Ge&&Ge.targetChanges.get(be.targetId),Ue=be.view.applyChanges(it,se.isPrimaryClient,dt);return lx(se,be.targetId,Ue.Xu),Ue.snapshot}(i,z,j,ee);const f=await z_(i.localStore,e,!0),y=new xC(e,f.Hi),l=y.Wu(f.documents),T=$p.createSynthesizedTargetChangeForCurrentChange(t,r&&i.onlineState!=="Offline",u),A=y.applyChanges(l,i.isPrimaryClient,T);lx(i,t,A.Xu);const R=new MB(e,t,y);return i.ic.set(e,R),i.rc.has(t)?i.rc.get(t).push(e):i.rc.set(t,[e]),A.snapshot}async function LB(i,e){const t=Et(i),r=t.ic.get(e),u=t.rc.get(r.targetId);if(u.length>1)return t.rc.set(r.targetId,u.filter(f=>!Vp(f,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||await Dh(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),pp(t.remoteStore,r.targetId),Rh(t,r.targetId)}).catch(bl)):(Rh(t,r.targetId),await Dh(t.localStore,r.targetId,!0))}async function zB(i,e,t){const r=S1(i);try{const u=await function(f,y){const l=Et(f),T=xi.now(),A=y.reduce((j,ee)=>j.add(ee.key),yn());let R,z;return l.persistence.runTransaction("Locally write mutations","readwrite",j=>{let ee=Kr(),se=yn();return l.Gi.getEntries(j,A).next(be=>{ee=be,ee.forEach((Re,Ge)=>{Ge.isValidDocument()||(se=se.add(Re))})}).next(()=>l.localDocuments.getOverlayedDocuments(j,ee)).next(be=>{R=be;const Re=[];for(const Ge of y){const it=GO(Ge,R.get(Ge.key).overlayedDocument);it!=null&&Re.push(new oa(Ge.key,it,cA(it.value.mapValue),mi.exists(!0)))}return l.mutationQueue.addMutationBatch(j,T,Re,y)}).next(be=>{z=be;const Re=be.applyToLocalDocumentSet(R,se);return l.documentOverlayCache.saveOverlays(j,be.batchId,Re)})}).then(()=>({batchId:z.batchId,changes:SA(R)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(u.batchId),function(f,y,l){let T=f.hc[f.currentUser.toKey()];T||(T=new ki(hn)),T=T.insert(y,l),f.hc[f.currentUser.toKey()]=T}(r,u.batchId,t),await la(r,u.changes),await qh(r.remoteStore)}catch(u){const f=Zh(u,"Failed to persist write");t.reject(f)}}async function bC(i,e){const t=Et(i);try{const r=await tB(t.localStore,e);e.targetChanges.forEach((u,f)=>{const y=t.cc.get(f);y&&(jt(u.addedDocuments.size+u.modifiedDocuments.size+u.removedDocuments.size<=1),u.addedDocuments.size>0?y.nc=!0:u.modifiedDocuments.size>0?jt(y.nc):u.removedDocuments.size>0&&(jt(y.nc),y.nc=!1))}),await la(t,r,e)}catch(r){await bl(r)}}function hI(i,e,t){const r=Et(i);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const u=[];r.ic.forEach((f,y)=>{const l=y.view.bu(e);l.snapshot&&u.push(l.snapshot)}),function(f,y){const l=Et(f);l.onlineState=y;let T=!1;l.queries.forEach((A,R)=>{for(const z of R.listeners)z.bu(y)&&(T=!0)}),T&&v1(l)}(r.eventManager,e),u.length&&r.sc.Wo(u),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function OB(i,e,t){const r=Et(i);r.sharedClientState.updateQueryState(e,"rejected",t);const u=r.cc.get(e),f=u&&u.key;if(f){let y=new ki(Tt.comparator);y=y.insert(f,ui.newNoDocument(f,Ht.min()));const l=yn().add(f),T=new Gp(Ht.min(),new Map,new si(hn),y,l);await bC(r,T),r.uc=r.uc.remove(f),r.cc.delete(e),E1(r)}else await Dh(r.localStore,e,!1).then(()=>Rh(r,e,t)).catch(bl)}async function BB(i,e){const t=Et(i),r=e.batch.batchId;try{const u=await eB(t.localStore,e);T1(t,r,null),w1(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await la(t,u)}catch(u){await bl(u)}}async function FB(i,e,t){const r=Et(i);try{const u=await function(f,y){const l=Et(f);return l.persistence.runTransaction("Reject batch","readwrite-primary",T=>{let A;return l.mutationQueue.lookupMutationBatch(T,y).next(R=>(jt(R!==null),A=R.keys(),l.mutationQueue.removeMutationBatch(T,R))).next(()=>l.mutationQueue.performConsistencyCheck(T)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(T,A,y)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(T,A)).next(()=>l.localDocuments.getDocuments(T,A))})}(r.localStore,e);T1(r,e,t),w1(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await la(r,u)}catch(u){await bl(u)}}async function NB(i,e){const t=Et(i);aa(t.remoteStore)||ot("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(f){const y=Et(f);return y.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>y.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const u=t.lc.get(r)||[];u.push(e),t.lc.set(r,u)}catch(r){const u=Zh(r,"Initialization of waitForPendingWrites() operation failed");e.reject(u)}}function w1(i,e){(i.lc.get(e)||[]).forEach(t=>{t.resolve()}),i.lc.delete(e)}function T1(i,e,t){const r=Et(i);let u=r.hc[r.currentUser.toKey()];if(u){const f=u.get(e);f&&(t?f.reject(t):f.resolve(),u=u.remove(e)),r.hc[r.currentUser.toKey()]=u}}function Rh(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(const r of i.rc.get(e))i.ic.delete(r),t&&i.sc.wc(r,t);i.rc.delete(e),i.isPrimaryClient&&i.ac.ls(e).forEach(r=>{i.ac.containsKey(r)||wC(i,r)})}function wC(i,e){i.oc.delete(e.path.canonicalString());const t=i.uc.get(e);t!==null&&(pp(i.remoteStore,t),i.uc=i.uc.remove(e),i.cc.delete(t),E1(i))}function lx(i,e,t){for(const r of t)r instanceof yC?(i.ac.addReference(r.key,e),UB(i,r)):r instanceof vC?(ot("SyncEngine","Document no longer in limbo: "+r.key),i.ac.removeReference(r.key,e),i.ac.containsKey(r.key)||wC(i,r.key)):Pt()}function UB(i,e){const t=e.key,r=t.path.canonicalString();i.uc.get(t)||i.oc.has(r)||(ot("SyncEngine","New document in limbo: "+t),i.oc.add(r),E1(i))}function E1(i){for(;i.oc.size>0&&i.uc.size<i.maxConcurrentLimboResolutions;){const e=i.oc.values().next().value;i.oc.delete(e);const t=new Tt(On.fromString(e)),r=i.fc.next();i.cc.set(r,new DB(t)),i.uc=i.uc.insert(t,r),fy(i.remoteStore,new rl(Nr(Vh(t.path)),r,2,Xr.at))}}async function la(i,e,t){const r=Et(i),u=[],f=[],y=[];r.ic.isEmpty()||(r.ic.forEach((l,T)=>{y.push(r._c(T,e,t).then(A=>{if((A||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(T.targetId,A!=null&&A.fromCache?"not-current":"current"),A){u.push(A);const R=u1.Ci(T.targetId,A);f.push(R)}}))}),await Promise.all(y),r.sc.Wo(u),await async function(l,T){const A=Et(l);try{await A.persistence.runTransaction("notifyLocalViewChanges","readwrite",R=>Me.forEach(T,z=>Me.forEach(z.Si,j=>A.persistence.referenceDelegate.addReference(R,z.targetId,j)).next(()=>Me.forEach(z.Di,j=>A.persistence.referenceDelegate.removeReference(R,z.targetId,j)))))}catch(R){if(!wl(R))throw R;ot("LocalStore","Failed to update sequence numbers: "+R)}for(const R of T){const z=R.targetId;if(!R.fromCache){const j=A.qi.get(z),ee=j.snapshotVersion,se=j.withLastLimboFreeSnapshotVersion(ee);A.qi=A.qi.insert(z,se)}}}(r.localStore,f))}async function VB(i,e){const t=Et(i);if(!t.currentUser.isEqual(e)){ot("SyncEngine","User change. New user:",e.toKey());const r=await iC(t.localStore,e);t.currentUser=e,function(u,f){u.lc.forEach(y=>{y.forEach(l=>{l.reject(new nt(ze.CANCELLED,f))})}),u.lc.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await la(t,r.ji)}}function jB(i,e){const t=Et(i),r=t.cc.get(e);if(r&&r.nc)return yn().add(r.key);{let u=yn();const f=t.rc.get(e);if(!f)return u;for(const y of f){const l=t.ic.get(y);u=u.unionWith(l.view.ju)}return u}}async function GB(i,e){const t=Et(i),r=await z_(t.localStore,e.query,!0),u=e.view.tc(r);return t.isPrimaryClient&&lx(t,e.targetId,u.Xu),u}async function $B(i,e){const t=Et(i);return aC(t.localStore,e).then(r=>la(t,r))}async function qB(i,e,t,r){const u=Et(i),f=await function(y,l){const T=Et(y),A=Et(T.mutationQueue);return T.persistence.runTransaction("Lookup mutation documents","readonly",R=>A.Tn(R,l).next(z=>z?T.localDocuments.getDocuments(R,z):Me.resolve(null)))}(u.localStore,e);f!==null?(t==="pending"?await qh(u.remoteStore):t==="acknowledged"||t==="rejected"?(T1(u,e,r||null),w1(u,e),function(y,l){Et(Et(y).mutationQueue).An(l)}(u.localStore,e)):Pt(),await la(u,f)):ot("SyncEngine","Cannot apply mutation batch with id: "+e)}async function WB(i,e){const t=Et(i);if(I1(t),S1(t),e===!0&&t.dc!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),u=await dI(t,r.toArray());t.dc=!0,await ax(t.remoteStore,!0);for(const f of u)fy(t.remoteStore,f)}else if(e===!1&&t.dc!==!1){const r=[];let u=Promise.resolve();t.rc.forEach((f,y)=>{t.sharedClientState.isLocalQueryTarget(y)?r.push(y):u=u.then(()=>(Rh(t,y),Dh(t.localStore,y,!0))),pp(t.remoteStore,y)}),await u,await dI(t,r),function(f){const y=Et(f);y.cc.forEach((l,T)=>{pp(y.remoteStore,T)}),y.ac.fs(),y.cc=new Map,y.uc=new ki(Tt.comparator)}(t),t.dc=!1,await ax(t.remoteStore,!1)}}async function dI(i,e,t){const r=Et(i),u=[],f=[];for(const y of e){let l;const T=r.rc.get(y);if(T&&T.length!==0){l=await Mh(r.localStore,Nr(T[0]));for(const A of T){const R=r.ic.get(A),z=await GB(r,R);z.snapshot&&f.push(z.snapshot)}}else{const A=await oC(r.localStore,y);l=await Mh(r.localStore,A),await b1(r,TC(A),y,!1,l.resumeToken)}u.push(l)}return r.sc.Wo(f),u}function TC(i){return uA(i.path,i.collectionGroup,i.orderBy,i.filters,i.limit,"F",i.startAt,i.endAt)}function ZB(i){const e=Et(i);return Et(Et(e.localStore).persistence).vi()}async function HB(i,e,t,r){const u=Et(i);if(u.dc)return void ot("SyncEngine","Ignoring unexpected query state notification.");const f=u.rc.get(e);if(f&&f.length>0)switch(t){case"current":case"not-current":{const y=await aC(u.localStore,dA(f[0])),l=Gp.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Xi.EMPTY_BYTE_STRING);await la(u,y,l);break}case"rejected":await Dh(u.localStore,e,!0),Rh(u,e,r);break;default:Pt()}}async function XB(i,e,t){const r=I1(i);if(r.dc){for(const u of e){if(r.rc.has(u)){ot("SyncEngine","Adding an already active target "+u);continue}const f=await oC(r.localStore,u),y=await Mh(r.localStore,f);await b1(r,TC(f),y.targetId,!1,y.resumeToken),fy(r.remoteStore,y)}for(const u of t)r.rc.has(u)&&await Dh(r.localStore,u,!1).then(()=>{pp(r.remoteStore,u),Rh(r,u)}).catch(bl)}}function I1(i){const e=Et(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=bC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=jB.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=OB.bind(null,e),e.sc.Wo=SB.bind(null,e.eventManager),e.sc.wc=AB.bind(null,e.eventManager),e}function S1(i){const e=Et(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=BB.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=FB.bind(null,e),e}function KB(i,e,t){const r=Et(i);(async function(u,f,y){try{const l=await f.getMetadata();if(await function(z,j){const ee=Et(z),se=zi(j.createTime);return ee.persistence.runTransaction("hasNewerBundle","readonly",be=>ee.Ns.getBundleMetadata(be,j.id)).then(be=>!!be&&be.createTime.compareTo(se)>=0)}(u.localStore,l))return await f.close(),y._completeWith(function(z){return{taskState:"Success",documentsLoaded:z.totalDocuments,bytesLoaded:z.totalBytes,totalDocuments:z.totalDocuments,totalBytes:z.totalBytes}}(l)),Promise.resolve(new Set);y._updateProgress(_C(l));const T=new kB(l,u.localStore,f.yt);let A=await f.mc();for(;A;){const z=await T.Fu(A);z&&y._updateProgress(z),A=await f.mc()}const R=await T.complete();return await la(u,R.Lu,void 0),await function(z,j){const ee=Et(z);return ee.persistence.runTransaction("Save bundle","readwrite",se=>ee.Ns.saveBundleMetadata(se,j))}(u.localStore,l),y._completeWith(R.progress),Promise.resolve(R.Bu)}catch(l){return Th("SyncEngine",`Loading bundle failed with ${l}`),y._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(u=>{r.sharedClientState.notifyBundleLoaded(u)})}class EC{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=qp(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return nC(this.persistence,new tC,e.initialUser,this.yt)}yc(e){return new eC(dy.Bs,this.yt)}gc(e){return new cC}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class IC extends EC{constructor(e,t,r){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await S1(this.Ac.syncEngine),await qh(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){return nC(this.persistence,new tC,e.initialUser,this.yt)}Tc(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new N3(r,e.asyncQueue,t)}Ec(e,t){const r=new EO(t,this.persistence);return new TO(e.asyncQueue,r)}yc(e){const t=c1(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Zr.withCacheSize(this.cacheSizeBytes):Zr.DEFAULT;return new l1(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,uC(),r_(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new cC}}class YB extends IC{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ac.syncEngine;this.sharedClientState instanceof x0&&(this.sharedClientState.syncEngine={Fr:qB.bind(null,t),$r:HB.bind(null,t),Br:XB.bind(null,t),vi:ZB.bind(null,t),Mr:$B.bind(null,t)},await this.sharedClientState.start()),await this.persistence.li(async r=>{await WB(this.Ac.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}gc(e){const t=uC();if(!x0.C(t))throw new nt(ze.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=c1(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new x0(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class A1{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>hI(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=VB.bind(null,this.syncEngine),await ax(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new IB}createDatastore(e){const t=qp(e.databaseInfo.databaseId),r=(u=e.databaseInfo,new lB(u));var u;return function(f,y,l,T){return new hB(f,y,l,T)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,u=e.asyncQueue,f=l=>hI(this.syncEngine,l,0),y=aI.C()?new aI:new sB,new pB(t,r,u,f,y);var t,r,u,f,y}createSyncEngine(e,t){return function(r,u,f,y,l,T,A){const R=new PB(r,u,f,y,l,T);return A&&(R.dc=!0),R}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Et(e);ot("RemoteStore","RemoteStore shutting down."),t._u.add(5),await $h(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C1(i,e,t){if(!t)throw new nt(ze.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function QB(i,e,t,r){if(e===!0&&r===!0)throw new nt(ze.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function fI(i){if(!Tt.isDocumentKey(i))throw new nt(ze.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function pI(i){if(Tt.isDocumentKey(i))throw new nt(ze.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function py(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":Pt()}function Rn(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new nt(ze.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=py(i);throw new nt(ze.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function SC(i,e){if(e<=0)throw new nt(ze.INVALID_ARGUMENT,`Function ${i}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mI=new Map;class gI{constructor(e){var t;if(e.host===void 0){if(e.ssl!==void 0)throw new nt(ze.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new nt(ze.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,QB("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e,t,r,u){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=u,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gI({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new nt(ze.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new nt(ze.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gI(e),e.credentials!==void 0&&(this._authCredentials=function(t){if(!t)return new hO;switch(t.type){case"gapi":const r=t.client;return new mO(r,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new nt(ze.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=mI.get(e);t&&(ot("ComponentProvider","Removing Datastore"),mI.delete(e),t.terminate())}(this),Promise.resolve()}}function JB(i,e,t,r={}){var u;const f=(i=Rn(i,Zp))._getSettings();if(f.host!=="firestore.googleapis.com"&&f.host!==e&&Th("Host has been set in both settings() and useEmulator(), emulator host will be used"),i._setSettings(Object.assign(Object.assign({},f),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let y,l;if(typeof r.mockUserToken=="string")y=r.mockUserToken,l=ir.MOCK_USER;else{y=ZR(r.mockUserToken,(u=i._app)===null||u===void 0?void 0:u.options.projectId);const T=r.mockUserToken.sub||r.mockUserToken.user_id;if(!T)throw new nt(ze.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ir(T)}i._authCredentials=new dO(new jS(y,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new To(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Oi(this.firestore,e,this._key)}}class yr{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new yr(this.firestore,e,this._query)}}class To extends yr{constructor(e,t,r){super(e,t,Vh(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Oi(this.firestore,null,new Tt(e))}withConverter(e){return new To(this.firestore,e,this._path)}}function eF(i,e,...t){if(i=Gt(i),C1("collection","path",e),i instanceof Zp){const r=On.fromString(e,...t);return pI(r),new To(i,null,r)}{if(!(i instanceof Oi||i instanceof To))throw new nt(ze.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=i._path.child(On.fromString(e,...t));return pI(r),new To(i.firestore,null,r)}}function QU(i,e){if(i=Rn(i,Zp),C1("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new nt(ze.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new yr(i,null,function(t){return new sa(On.emptyPath(),t)}(e))}function tF(i,e,...t){if(i=Gt(i),arguments.length===1&&(e=$S.R()),C1("doc","path",e),i instanceof Zp){const r=On.fromString(e,...t);return fI(r),new Oi(i,null,new Tt(r))}{if(!(i instanceof Oi||i instanceof To))throw new nt(ze.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=i._path.child(On.fromString(e,...t));return fI(r),new Oi(i.firestore,i instanceof To?i.converter:null,new Tt(r))}}function JU(i,e){return i=Gt(i),e=Gt(e),(i instanceof Oi||i instanceof To)&&(e instanceof Oi||e instanceof To)&&i.firestore===e.firestore&&i.path===e.path&&i.converter===e.converter}function AC(i,e){return i=Gt(i),e=Gt(e),i instanceof yr&&e instanceof yr&&i.firestore===e.firestore&&Vp(i._query,e._query)&&i.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _I(i,e=10240){let t=0;return{async read(){if(t<i.byteLength){const r={value:i.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):Ri("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nF{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new Zi,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(r=>{r&&r.Ou()?this.metadata.resolve(r.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.ku)}`))},r=>this.metadata.reject(r))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){const e=await this.Sc();if(e===null)return null;const t=this.vc.decode(e),r=Number(t);isNaN(r)&&this.Dc(`length string (${t}) is not valid number`);const u=await this.Cc(r);return new CB(JSON.parse(u),e.length+r)}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Sc(){for(;this.xc()<0&&!await this.Nc(););if(this.buffer.length===0)return null;const e=this.xc();e<0&&this.Dc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");const t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Nc(){const e=await this.Pc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eV{constructor(){this.type="AggregateField"}}class iF{constructor(e,t){this._data=t,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._data}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rF{constructor(e,t,r){this.query=e,this.datastore=t,this.userDataWriter=r}run(){return dB(this.datastore,this.query._query).then(e=>{jt(e[0]!==void 0);const t=Object.entries(e[0]).filter(([r,u])=>r==="count_alias").map(([r,u])=>this.userDataWriter.convertValue(u))[0];return jt(typeof t=="number"),Promise.resolve(new iF(this.query,{count:t}))})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sF{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new nt(ze.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(r,u){const f=Et(r),y=dp(f.yt)+"/documents",l={documents:u.map(z=>hp(f.yt,z))},T=await f._o("BatchGetDocuments",y,l,u.length),A=new Map;T.forEach(z=>{const j=t3(f.yt,z);A.set(j.key.toString(),j)});const R=[];return u.forEach(z=>{const j=A.get(z.toString());jt(!!j),R.push(j)}),R}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Gh(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const u=Tt.fromPath(r);this.mutations.push(new Qx(u,this.precondition(u)))}),await async function(t,r){const u=Et(t),f=dp(u.yt)+"/documents",y={writes:r.map(l=>fp(u.yt,l))};await u.ao("Commit",f,y)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Pt();t=Ht.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new nt(ze.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ht.min())?mi.exists(!1):mi.updateTime(t):mi.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ht.min()))throw new nt(ze.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return mi.updateTime(t)}return mi.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oF{constructor(e,t,r,u,f){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=u,this.deferred=f,this.kc=r.maxAttempts,this.xo=new d1(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){this.xo.Ro(async()=>{const e=new sF(this.datastore),t=this.Mc(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(u=>{this.Fc(u)}))}).catch(r=>{this.Fc(r)})})}Mc(e){try{const t=this.updateFunction(e);return!Np(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!TA(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aF{constructor(e,t,r,u){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=u,this.user=ir.UNAUTHENTICATED,this.clientId=$S.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async f=>{ot("FirestoreClient","Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(r,f=>(ot("FirestoreClient","Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new nt(ze.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Zi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Zh(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function CC(i,e){i.asyncQueue.verifyOperationInProgress(),ot("FirestoreClient","Initializing OfflineComponentProvider");const t=await i.getConfiguration();await e.initialize(t);let r=t.initialUser;i.setCredentialChangeListener(async u=>{r.isEqual(u)||(await iC(e.localStore,u),r=u)}),e.persistence.setDatabaseDeletedListener(()=>i.terminate()),i.offlineComponents=e}async function kC(i,e){i.asyncQueue.verifyOperationInProgress();const t=await k1(i);ot("FirestoreClient","Initializing OnlineComponentProvider");const r=await i.getConfiguration();await e.initialize(t,r),i.setCredentialChangeListener(u=>lI(e.remoteStore,u)),i.setAppCheckTokenChangeListener((u,f)=>lI(e.remoteStore,f)),i.onlineComponents=e}async function k1(i){return i.offlineComponents||(ot("FirestoreClient","Using default OfflineComponentProvider"),await CC(i,new EC)),i.offlineComponents}async function gy(i){return i.onlineComponents||(ot("FirestoreClient","Using default OnlineComponentProvider"),await kC(i,new A1)),i.onlineComponents}function MC(i){return k1(i).then(e=>e.persistence)}function _y(i){return k1(i).then(e=>e.localStore)}function M1(i){return gy(i).then(e=>e.remoteStore)}function D1(i){return gy(i).then(e=>e.syncEngine)}function DC(i){return gy(i).then(e=>e.datastore)}async function Lh(i){const e=await gy(i),t=e.eventManager;return t.onListen=RB.bind(null,e.syncEngine),t.onUnlisten=LB.bind(null,e.syncEngine),t}function lF(i){return i.asyncQueue.enqueue(async()=>{const e=await MC(i),t=await M1(i);return e.setNetworkEnabled(!0),function(r){const u=Et(r);return u._u.delete(0),Wp(u)}(t)})}function cF(i){return i.asyncQueue.enqueue(async()=>{const e=await MC(i),t=await M1(i);return e.setNetworkEnabled(!1),async function(r){const u=Et(r);u._u.add(0),await $h(u),u.gu.set("Offline")}(t)})}function uF(i,e){const t=new Zi;return i.asyncQueue.enqueueAndForget(async()=>async function(r,u,f){try{const y=await function(l,T){const A=Et(l);return A.persistence.runTransaction("read document","readonly",R=>A.localDocuments.getDocument(R,T))}(r,u);y.isFoundDocument()?f.resolve(y):y.isNoDocument()?f.resolve(null):f.reject(new nt(ze.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(y){const l=Zh(y,`Failed to get document '${u} from cache`);f.reject(l)}}(await _y(i),e,t)),t.promise}function PC(i,e,t={}){const r=new Zi;return i.asyncQueue.enqueueAndForget(async()=>function(u,f,y,l,T){const A=new my({next:z=>{f.enqueueAndForget(()=>y1(u,R));const j=z.docs.has(y);!j&&z.fromCache?T.reject(new nt(ze.UNAVAILABLE,"Failed to get document because the client is offline.")):j&&z.fromCache&&l&&l.source==="server"?T.reject(new nt(ze.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):T.resolve(z)},error:z=>T.reject(z)}),R=new x1(Vh(y.path),A,{includeMetadataChanges:!0,Nu:!0});return _1(u,R)}(await Lh(i),i.asyncQueue,e,t,r)),r.promise}function hF(i,e){const t=new Zi;return i.asyncQueue.enqueueAndForget(async()=>async function(r,u,f){try{const y=await z_(r,u,!0),l=new xC(u,y.Hi),T=l.Wu(y.documents),A=l.applyChanges(T,!1);f.resolve(A.snapshot)}catch(y){const l=Zh(y,`Failed to execute query '${u} against cache`);f.reject(l)}}(await _y(i),e,t)),t.promise}function RC(i,e,t={}){const r=new Zi;return i.asyncQueue.enqueueAndForget(async()=>function(u,f,y,l,T){const A=new my({next:z=>{f.enqueueAndForget(()=>y1(u,R)),z.fromCache&&l.source==="server"?T.reject(new nt(ze.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):T.resolve(z)},error:z=>T.reject(z)}),R=new x1(y,A,{includeMetadataChanges:!0,Nu:!0});return _1(u,R)}(await Lh(i),i.asyncQueue,e,t,r)),r.promise}function dF(i,e){const t=new my(e);return i.asyncQueue.enqueueAndForget(async()=>function(r,u){Et(r).Ru.add(u),u.next()}(await Lh(i),t)),()=>{t.bc(),i.asyncQueue.enqueueAndForget(async()=>function(r,u){Et(r).Ru.delete(u)}(await Lh(i),t))}}function fF(i,e,t,r){const u=function(f,y){let l;return l=typeof f=="string"?new TextEncoder().encode(f):f,function(T,A){return new nF(T,A)}(function(T,A){if(T instanceof Uint8Array)return _I(T,A);if(T instanceof ArrayBuffer)return _I(new Uint8Array(T),A);if(T instanceof ReadableStream)return T.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),y)}(t,qp(e));i.asyncQueue.enqueueAndForget(async()=>{KB(await D1(i),u,r)})}function pF(i,e){return i.asyncQueue.enqueue(async()=>function(t,r){const u=Et(t);return u.persistence.runTransaction("Get named query","readonly",f=>u.Ns.getNamedQuery(f,r))}(await _y(i),e))}class mF{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new d1(this,"async_queue_retry"),this.Wc=()=>{const t=r_();t&&ot("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=r_();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=r_();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new Zi;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(this.Lc.length!==0){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!wl(e))throw e;ot("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro(()=>this.Jc())}}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(r=>{this.Kc=r,this.Gc=!1;const u=function(f){let y=f.message||"";return f.stack&&(y=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),y}(r);throw Ri("INTERNAL UNHANDLED ERROR: ",u),r}).then(r=>(this.Gc=!1,r))));return this.Bc=t,t}enqueueAfterDelay(e,t,r){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const u=g1.createAndSchedule(this,e,t,r,f=>this.Yc(f));return this.Uc.push(u),u}zc(){this.Kc&&Pt()}verifyOperationInProgress(){}async Xc(){let e;do e=this.Bc,await e;while(e!==this.Bc)}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function cx(i){return function(e,t){if(typeof e!="object"||e===null)return!1;const r=e;for(const u of t)if(u in r&&typeof r[u]=="function")return!0;return!1}(i,["next","error","complete"])}class gF{constructor(){this._progressObserver={},this._taskCompletionResolver=new Zi,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tV=-1;class hi extends Zp{constructor(e,t,r,u){super(e,t,r,u),this.type="firestore",this._queue=new mF,this._persistenceKey=(u==null?void 0:u.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||LC(this),this._firestoreClient.terminate()}}function nV(i,e,t){t||(t="(default)");const r=Cp(i,"firestore");if(r.isInitialized(t)){const u=r.getImmediate({identifier:t}),f=r.getOptions(t);if(xh(f,e))return u;throw new nt(ze.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new nt(ze.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function _F(i,e){const t=typeof i=="object"?i:B2(),r=typeof i=="string"?i:e||"(default)",u=Cp(t,"firestore").getImmediate({identifier:r});if(!u._initialized){const f=$R("firestore");f&&JB(u,...f)}return u}function Ni(i){return i._firestoreClient||LC(i),i._firestoreClient.verifyNotTerminated(),i._firestoreClient}function LC(i){var e;const t=i._freezeSettings(),r=function(u,f,y,l){return new IO(u,f,y,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,l.useFetchStreams)}(i._databaseId,((e=i._app)===null||e===void 0?void 0:e.options.appId)||"",i._persistenceKey,t);i._firestoreClient=new aF(i._authCredentials,i._appCheckCredentials,i._queue,r)}function iV(i,e){OC(i=Rn(i,hi));const t=Ni(i),r=i._freezeSettings(),u=new A1;return zC(t,u,new IC(u,r.cacheSizeBytes,e==null?void 0:e.forceOwnership))}function rV(i){OC(i=Rn(i,hi));const e=Ni(i),t=i._freezeSettings(),r=new A1;return zC(e,r,new YB(r,t.cacheSizeBytes))}function zC(i,e,t){const r=new Zi;return i.asyncQueue.enqueue(async()=>{try{await CC(i,t),await kC(i,e),r.resolve()}catch(u){const f=u;if(!function(y){return y.name==="FirebaseError"?y.code===ze.FAILED_PRECONDITION||y.code===ze.UNIMPLEMENTED:typeof DOMException<"u"&&y instanceof DOMException?y.code===22||y.code===20||y.code===11:!0}(f))throw f;Th("Error enabling offline persistence. Falling back to persistence disabled: "+f),r.reject(f)}}).then(()=>r.promise)}function sV(i){if(i._initialized&&!i._terminated)throw new nt(ze.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Zi;return i._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(t){if(!Gs.C())return Promise.resolve();const r=t+"main";await Gs.delete(r)}(c1(i._databaseId,i._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function oV(i){return function(e){const t=new Zi;return e.asyncQueue.enqueueAndForget(async()=>NB(await D1(e),t)),t.promise}(Ni(i=Rn(i,hi)))}function aV(i){return lF(Ni(i=Rn(i,hi)))}function lV(i){return cF(Ni(i=Rn(i,hi)))}function cV(i){return XL(i.app,"firestore",i._databaseId.database),i._delete()}function uV(i,e){const t=Ni(i=Rn(i,hi)),r=new gF;return fF(t,i._databaseId,e,r),r}function hV(i,e){return pF(Ni(i=Rn(i,hi)),e).then(t=>t?new yr(i,null,t.query):null)}function OC(i){if(i._initialized||i._terminated)throw new nt(ze.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Nc(Xi.fromBase64String(e))}catch(t){throw new nt(ze.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Nc(Xi.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jc{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new nt(ze.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Li(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function dV(){return new jc("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new nt(ze.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new nt(ze.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return hn(this._lat,e._lat)||hn(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yF=/^__.*__$/;class vF{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new oa(e,this.data,this.fieldMask,t,this.fieldTransforms):new jh(e,this.data,t,this.fieldTransforms)}}class BC{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new oa(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function FC(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Pt()}}class yy{constructor(e,t,r,u,f,y){this.settings=e,this.databaseId=t,this.yt=r,this.ignoreUndefinedProperties=u,f===void 0&&this.na(),this.fieldTransforms=f||[],this.fieldMask=y||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new yy(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),u=this.ia({path:r,oa:!1});return u.ua(e),u}ca(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),u=this.ia({path:r,oa:!1});return u.na(),u}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return N_(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(e.length===0)throw this.ha("Document fields must not be empty");if(FC(this.sa)&&yF.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class xF{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=r||qp(e)}da(e,t,r,u=!1){return new yy({sa:e,methodName:t,fa:r,path:Li.emptyPath(),oa:!1,la:u},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function $c(i){const e=i._freezeSettings(),t=qp(i._databaseId);return new xF(i._databaseId,!!e.ignoreUndefinedProperties,t)}function vy(i,e,t,r,u,f={}){const y=i.da(f.merge||f.mergeFields?2:0,e,t,u);O1("Data must be an object, but it was:",y,r);const l=VC(r,y);let T,A;if(f.merge)T=new ls(y.fieldMask),A=y.fieldTransforms;else if(f.mergeFields){const R=[];for(const z of f.mergeFields){const j=ux(e,z,t);if(!y.contains(j))throw new nt(ze.INVALID_ARGUMENT,`Field '${j}' is specified in your field mask but missing from your input data.`);GC(R,j)||R.push(j)}T=new ls(R),A=y.fieldTransforms.filter(z=>T.covers(z.field))}else T=null,A=y.fieldTransforms;return new vF(new pr(l),T,A)}class Hp extends Gc{_toFieldTransform(e){if(e.sa!==2)throw e.sa===1?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Hp}}function NC(i,e,t){return new yy({sa:3,fa:e.settings.fa,methodName:i._methodName,oa:t},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class R1 extends Gc{_toFieldTransform(e){return new jp(e.path,new Ah)}isEqual(e){return e instanceof R1}}class bF extends Gc{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=NC(this,e,!0),r=this._a.map(f=>qc(f,t)),u=new Lc(r);return new jp(e.path,u)}isEqual(e){return this===e}}class wF extends Gc{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=NC(this,e,!0),r=this._a.map(f=>qc(f,t)),u=new zc(r);return new jp(e.path,u)}isEqual(e){return this===e}}class TF extends Gc{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new Ch(e.yt,gA(e.yt,this.wa));return new jp(e.path,t)}isEqual(e){return this===e}}function L1(i,e,t,r){const u=i.da(1,e,t);O1("Data must be an object, but it was:",u,r);const f=[],y=pr.empty();Vc(r,(T,A)=>{const R=xy(e,T,t);A=Gt(A);const z=u.ca(R);if(A instanceof Hp)f.push(R);else{const j=qc(A,z);j!=null&&(f.push(R),y.set(R,j))}});const l=new ls(f);return new BC(y,l,u.fieldTransforms)}function z1(i,e,t,r,u,f){const y=i.da(1,e,t),l=[ux(e,r,t)],T=[u];if(f.length%2!=0)throw new nt(ze.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let j=0;j<f.length;j+=2)l.push(ux(e,f[j])),T.push(f[j+1]);const A=[],R=pr.empty();for(let j=l.length-1;j>=0;--j)if(!GC(A,l[j])){const ee=l[j];let se=T[j];se=Gt(se);const be=y.ca(ee);if(se instanceof Hp)A.push(ee);else{const Re=qc(se,be);Re!=null&&(A.push(ee),R.set(ee,Re))}}const z=new ls(A);return new BC(R,z,y.fieldTransforms)}function UC(i,e,t,r=!1){return qc(t,i.da(r?4:3,e))}function qc(i,e){if(jC(i=Gt(i)))return O1("Unsupported field value:",e,i),VC(i,e);if(i instanceof Gc)return function(t,r){if(!FC(r.sa))throw r.ha(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.ha(`${t._methodName}() is not currently supported inside arrays`);const u=t._toFieldTransform(r);u&&r.fieldTransforms.push(u)}(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.oa&&e.sa!==4)throw e.ha("Nested arrays are not supported");return function(t,r){const u=[];let f=0;for(const y of t){let l=qc(y,r.aa(f));l==null&&(l={nullValue:"NULL_VALUE"}),u.push(l),f++}return{arrayValue:{values:u}}}(i,e)}return function(t,r){if((t=Gt(t))===null)return{nullValue:"NULL_VALUE"};if(typeof t=="number")return gA(r.yt,t);if(typeof t=="boolean")return{booleanValue:t};if(typeof t=="string")return{stringValue:t};if(t instanceof Date){const u=xi.fromDate(t);return{timestampValue:kh(r.yt,u)}}if(t instanceof xi){const u=new xi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:kh(r.yt,u)}}if(t instanceof P1)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Nc)return{bytesValue:MA(r.yt,t._byteString)};if(t instanceof Oi){const u=r.databaseId,f=t.firestore._databaseId;if(!f.isEqual(u))throw r.ha(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:Jx(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.ha(`Unsupported field value: ${py(t)}`)}(i,e)}function VC(i,e){const t={};return KS(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Vc(i,(r,u)=>{const f=qc(u,e.ra(r));f!=null&&(t[r]=f)}),{mapValue:{fields:t}}}function jC(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof xi||i instanceof P1||i instanceof Nc||i instanceof Oi||i instanceof Gc)}function O1(i,e,t){if(!jC(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){const r=py(t);throw r==="an object"?e.ha(i+" a custom object"):e.ha(i+" "+r)}}function ux(i,e,t){if((e=Gt(e))instanceof jc)return e._internalPath;if(typeof e=="string")return xy(i,e);throw N_("Field path arguments must be of type string or ",i,!1,void 0,t)}const EF=new RegExp("[~\\*/\\[\\]]");function xy(i,e,t){if(e.search(EF)>=0)throw N_(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new jc(...e.split("."))._internalPath}catch{throw N_(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function N_(i,e,t,r,u){const f=r&&!r.isEmpty(),y=u!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let T="";return(f||y)&&(T+=" (found",f&&(T+=` in field ${r}`),y&&(T+=` in document ${u}`),T+=")"),new nt(ze.INVALID_ARGUMENT,l+i+T)}function GC(i,e){return i.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mp{constructor(e,t,r,u,f){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=u,this._converter=f}get id(){return this._key.path.lastSegment()}get ref(){return new Oi(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new IF(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(by("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class IF extends mp{data(){return super.data()}}function by(i,e){return typeof e=="string"?xy(i,e):e instanceof jc?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $C(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new nt(ze.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class B1{}class Xp extends B1{}function SF(i,e,...t){let r=[];e instanceof B1&&r.push(e),r=r.concat(t),function(u){const f=u.filter(l=>l instanceof Hh).length,y=u.filter(l=>l instanceof Kp).length;if(f>1||f>0&&y>0)throw new nt(ze.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const u of r)i=u._apply(i);return i}class Kp extends Xp{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Kp(e,t,r)}_apply(e){const t=this._parse(e);return WC(e._query,t),new yr(e.firestore,e.converter,Q0(e._query,t))}_parse(e){const t=$c(e.firestore);return function(u,f,y,l,T,A,R){let z;if(T.isKeyField()){if(A==="array-contains"||A==="array-contains-any")throw new nt(ze.INVALID_ARGUMENT,`Invalid Query. You can't perform '${A}' queries on documentId().`);if(A==="in"||A==="not-in"){vI(R,A);const j=[];for(const ee of R)j.push(yI(l,u,ee));z={arrayValue:{values:j}}}else z=yI(l,u,R)}else A!=="in"&&A!=="not-in"&&A!=="array-contains-any"||vI(R,A),z=UC(y,f,R,A==="in"||A==="not-in");return Dn.create(T,A,z)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function AF(i,e,t){const r=e,u=by("where",i);return Kp._create(u,r,t)}class Hh extends B1{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Hh(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ti.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,u){let f=r;const y=u.getFlattenedFilters();for(const l of y)WC(f,l),f=Q0(f,l)}(e._query,t),new yr(e.firestore,e.converter,Q0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function fV(...i){return i.forEach(e=>HC("or",e)),Hh._create("or",i)}function pV(...i){return i.forEach(e=>HC("and",e)),Hh._create("and",i)}class F1 extends Xp{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new F1(e,t)}_apply(e){const t=function(r,u,f){if(r.startAt!==null)throw new nt(ze.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new nt(ze.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const y=new uh(u,f);return function(l,T){if(Xx(l)===null){const A=oy(l);A!==null&&ZC(l,A,T.field)}}(r,y),y}(e._query,this._field,this._direction);return new yr(e.firestore,e.converter,function(r,u){const f=r.explicitOrderBy.concat([u]);return new sa(r.path,r.collectionGroup,f,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function mV(i,e="asc"){const t=e,r=by("orderBy",i);return F1._create(r,t)}class wy extends Xp{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new wy(e,t,r)}_apply(e){return new yr(e.firestore,e.converter,D_(e._query,this._limit,this._limitType))}}function gV(i){return SC("limit",i),wy._create("limit",i,"F")}function _V(i){return SC("limitToLast",i),wy._create("limitToLast",i,"L")}class Ty extends Xp{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ty(e,t,r)}_apply(e){const t=qC(e,this.type,this._docOrFields,this._inclusive);return new yr(e.firestore,e.converter,function(r,u){return new sa(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,u,r.endAt)}(e._query,t))}}function yV(...i){return Ty._create("startAt",i,!0)}function vV(...i){return Ty._create("startAfter",i,!1)}class Ey extends Xp{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ey(e,t,r)}_apply(e){const t=qC(e,this.type,this._docOrFields,this._inclusive);return new yr(e.firestore,e.converter,function(r,u){return new sa(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,u)}(e._query,t))}}function xV(...i){return Ey._create("endBefore",i,!1)}function bV(...i){return Ey._create("endAt",i,!0)}function qC(i,e,t,r){if(t[0]=Gt(t[0]),t[0]instanceof mp)return function(u,f,y,l,T){if(!l)throw new nt(ze.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${y}().`);const A=[];for(const R of wc(u))if(R.field.isKeyField())A.push(Pc(f,l.key));else{const z=l.data.field(R.field);if(Hx(z))throw new nt(ze.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+R.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(z===null){const j=R.field.canonicalString();throw new nt(ze.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${j}' (used as the orderBy) does not exist.`)}A.push(z)}return new ul(A,T)}(i._query,i.firestore._databaseId,e,t[0]._document,r);{const u=$c(i.firestore);return function(f,y,l,T,A,R){const z=f.explicitOrderBy;if(A.length>z.length)throw new nt(ze.INVALID_ARGUMENT,`Too many arguments provided to ${T}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const j=[];for(let ee=0;ee<A.length;ee++){const se=A[ee];if(z[ee].field.isKeyField()){if(typeof se!="string")throw new nt(ze.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${T}(), but got a ${typeof se}`);if(!Kx(f)&&se.indexOf("/")!==-1)throw new nt(ze.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${T}() must be a plain document ID, but '${se}' contains a slash.`);const be=f.path.child(On.fromString(se));if(!Tt.isDocumentKey(be))throw new nt(ze.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${T}() must result in a valid document path, but '${be}' is not because it contains an odd number of segments.`);const Re=new Tt(be);j.push(Pc(y,Re))}else{const be=UC(l,T,se);j.push(be)}}return new ul(j,R)}(i._query,i.firestore._databaseId,u,e,t,r)}}function yI(i,e,t){if(typeof(t=Gt(t))=="string"){if(t==="")throw new nt(ze.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Kx(e)&&t.indexOf("/")!==-1)throw new nt(ze.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(On.fromString(t));if(!Tt.isDocumentKey(r))throw new nt(ze.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Pc(i,new Tt(r))}if(t instanceof Oi)return Pc(i,t._key);throw new nt(ze.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${py(t)}.`)}function vI(i,e){if(!Array.isArray(i)||i.length===0)throw new nt(ze.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(i.length>10)throw new nt(ze.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function WC(i,e){if(e.isInequality()){const r=oy(i),u=e.field;if(r!==null&&!r.isEqual(u))throw new nt(ze.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${u.toString()}'`);const f=Xx(i);f!==null&&ZC(i,u,f)}const t=function(r,u){for(const f of r)for(const y of f.getFlattenedFilters())if(u.indexOf(y.op)>=0)return y.op;return null}(i.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new nt(ze.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new nt(ze.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function ZC(i,e,t){if(!t.isEqual(e))throw new nt(ze.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}function HC(i,e){if(!(e instanceof Kp||e instanceof Hh))throw new nt(ze.INVALID_ARGUMENT,`Function ${i}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class XC{convertValue(e,t="none"){switch(Dc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ai(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Mc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Pt()}}convertObject(e,t){const r={};return Vc(e.fields,(u,f)=>{r[u]=this.convertValue(f,t)}),r}convertGeoPoint(e){return new P1(Ai(e.latitude),Ai(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=QS(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(lp(e));default:return null}}convertTimestamp(e){const t=ll(e);return new xi(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=On.fromString(e);jt(NA(r));const u=new kc(r.get(1),r.get(3)),f=new Tt(r.popFirst(5));return u.isEqual(t)||Ri(`Document ${f} contains a document reference within a different database (${u.projectId}/${u.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iy(i,e,t){let r;return r=i?t&&(t.merge||t.mergeFields)?i.toFirestore(e,t):i.toFirestore(e):e,r}class CF extends XC{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Oi(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class zh extends mp{constructor(e,t,r,u,f,y){super(e,t,r,u,y),this._firestore=e,this._firestoreImpl=e,this.metadata=f}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new s_(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(by("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class s_ extends zh{data(e={}){return super.data(e)}}class Oh{constructor(e,t,r,u){this._firestore=e,this._userDataWriter=t,this._snapshot=u,this.metadata=new vc(u.hasPendingWrites,u.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new s_(this._firestore,this._userDataWriter,r.key,r,new vc(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new nt(ze.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,u){if(r._snapshot.oldDocs.isEmpty()){let f=0;return r._snapshot.docChanges.map(y=>{const l=new s_(r._firestore,r._userDataWriter,y.doc.key,y.doc,new vc(r._snapshot.mutatedKeys.has(y.doc.key),r._snapshot.fromCache),r.query.converter);return y.doc,{type:"added",doc:l,oldIndex:-1,newIndex:f++}})}{let f=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(y=>u||y.type!==3).map(y=>{const l=new s_(r._firestore,r._userDataWriter,y.doc.key,y.doc,new vc(r._snapshot.mutatedKeys.has(y.doc.key),r._snapshot.fromCache),r.query.converter);let T=-1,A=-1;return y.type!==0&&(T=f.indexOf(y.doc.key),f=f.delete(y.doc.key)),y.type!==1&&(f=f.add(y.doc),A=f.indexOf(y.doc.key)),{type:kF(y.type),doc:l,oldIndex:T,newIndex:A}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function kF(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Pt()}}function wV(i,e){return i instanceof zh&&e instanceof zh?i._firestore===e._firestore&&i._key.isEqual(e._key)&&(i._document===null?e._document===null:i._document.isEqual(e._document))&&i._converter===e._converter:i instanceof Oh&&e instanceof Oh&&i._firestore===e._firestore&&AC(i.query,e.query)&&i.metadata.isEqual(e.metadata)&&i._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TV(i){i=Rn(i,Oi);const e=Rn(i.firestore,hi);return PC(Ni(e),i._key).then(t=>N1(e,i,t))}class El extends XC{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Oi(this.firestore,null,t)}}function EV(i){i=Rn(i,Oi);const e=Rn(i.firestore,hi),t=Ni(e),r=new El(e);return uF(t,i._key).then(u=>new zh(e,r,i._key,u,new vc(u!==null&&u.hasLocalMutations,!0),i.converter))}function IV(i){i=Rn(i,Oi);const e=Rn(i.firestore,hi);return PC(Ni(e),i._key,{source:"server"}).then(t=>N1(e,i,t))}function MF(i){i=Rn(i,yr);const e=Rn(i.firestore,hi),t=Ni(e),r=new El(e);return $C(i._query),RC(t,i._query).then(u=>new Oh(e,r,i,u))}function SV(i){i=Rn(i,yr);const e=Rn(i.firestore,hi),t=Ni(e),r=new El(e);return hF(t,i._query).then(u=>new Oh(e,r,i,u))}function AV(i){i=Rn(i,yr);const e=Rn(i.firestore,hi),t=Ni(e),r=new El(e);return RC(t,i._query,{source:"server"}).then(u=>new Oh(e,r,i,u))}function CV(i,e,t){i=Rn(i,Oi);const r=Rn(i.firestore,hi),u=Iy(i.converter,e,t);return Yp(r,[vy($c(r),"setDoc",i._key,u,i.converter!==null,t).toMutation(i._key,mi.none())])}function kV(i,e,t,...r){i=Rn(i,Oi);const u=Rn(i.firestore,hi),f=$c(u);let y;return y=typeof(e=Gt(e))=="string"||e instanceof jc?z1(f,"updateDoc",i._key,e,t,r):L1(f,"updateDoc",i._key,e),Yp(u,[y.toMutation(i._key,mi.exists(!0))])}function MV(i){return Yp(Rn(i.firestore,hi),[new Gh(i._key,mi.none())])}function DV(i,e){const t=Rn(i.firestore,hi),r=tF(i),u=Iy(i.converter,e);return Yp(t,[vy($c(i.firestore),"addDoc",r._key,u,i.converter!==null,{}).toMutation(r._key,mi.exists(!1))]).then(()=>r)}function PV(i,...e){var t,r,u;i=Gt(i);let f={includeMetadataChanges:!1},y=0;typeof e[y]!="object"||cx(e[y])||(f=e[y],y++);const l={includeMetadataChanges:f.includeMetadataChanges};if(cx(e[y])){const z=e[y];e[y]=(t=z.next)===null||t===void 0?void 0:t.bind(z),e[y+1]=(r=z.error)===null||r===void 0?void 0:r.bind(z),e[y+2]=(u=z.complete)===null||u===void 0?void 0:u.bind(z)}let T,A,R;if(i instanceof Oi)A=Rn(i.firestore,hi),R=Vh(i._key.path),T={next:z=>{e[y]&&e[y](N1(A,i,z))},error:e[y+1],complete:e[y+2]};else{const z=Rn(i,yr);A=Rn(z.firestore,hi),R=z._query;const j=new El(A);T={next:ee=>{e[y]&&e[y](new Oh(A,j,z,ee))},error:e[y+1],complete:e[y+2]},$C(i._query)}return function(z,j,ee,se){const be=new my(se),Re=new x1(j,be,ee);return z.asyncQueue.enqueueAndForget(async()=>_1(await Lh(z),Re)),()=>{be.bc(),z.asyncQueue.enqueueAndForget(async()=>y1(await Lh(z),Re))}}(Ni(A),R,l,T)}function RV(i,e){return dF(Ni(i=Rn(i,hi)),cx(e)?e:{next:e})}function Yp(i,e){return function(t,r){const u=new Zi;return t.asyncQueue.enqueueAndForget(async()=>zB(await D1(t),r,u)),u.promise}(Ni(i),e)}function N1(i,e,t){const r=t.docs.get(e._key),u=new El(i);return new zh(i,u,e._key,r,new vc(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LV(i,e){return AC(i.query,e.query)&&xh(i.data(),e.data())}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zV(i){const e=Rn(i.firestore,hi);return function(t,r,u){const f=new Zi;return t.asyncQueue.enqueueAndForget(async()=>{try{if(aa(await M1(t))){const y=await DC(t),l=new rF(r,y,u).run();f.resolve(l)}else f.reject(new nt(ze.UNAVAILABLE,"Failed to get count result because the client is offline."))}catch(y){f.reject(y)}}),f.promise}(Ni(e),i,new El(e))}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DF={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PF{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=$c(e)}set(e,t,r){this._verifyNotCommitted();const u=Xa(e,this._firestore),f=Iy(u.converter,t,r),y=vy(this._dataReader,"WriteBatch.set",u._key,f,u.converter!==null,r);return this._mutations.push(y.toMutation(u._key,mi.none())),this}update(e,t,r,...u){this._verifyNotCommitted();const f=Xa(e,this._firestore);let y;return y=typeof(t=Gt(t))=="string"||t instanceof jc?z1(this._dataReader,"WriteBatch.update",f._key,t,r,u):L1(this._dataReader,"WriteBatch.update",f._key,t),this._mutations.push(y.toMutation(f._key,mi.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Xa(e,this._firestore);return this._mutations=this._mutations.concat(new Gh(t._key,mi.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new nt(ze.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Xa(i,e){if((i=Gt(i)).firestore!==e)throw new nt(ze.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RF extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=$c(e)}get(e){const t=Xa(e,this._firestore),r=new CF(this._firestore);return this._transaction.lookup([t._key]).then(u=>{if(!u||u.length!==1)return Pt();const f=u[0];if(f.isFoundDocument())return new mp(this._firestore,r,f.key,f,t.converter);if(f.isNoDocument())return new mp(this._firestore,r,t._key,null,t.converter);throw Pt()})}set(e,t,r){const u=Xa(e,this._firestore),f=Iy(u.converter,t,r),y=vy(this._dataReader,"Transaction.set",u._key,f,u.converter!==null,r);return this._transaction.set(u._key,y),this}update(e,t,r,...u){const f=Xa(e,this._firestore);let y;return y=typeof(t=Gt(t))=="string"||t instanceof jc?z1(this._dataReader,"Transaction.update",f._key,t,r,u):L1(this._dataReader,"Transaction.update",f._key,t),this._transaction.update(f._key,y),this}delete(e){const t=Xa(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Xa(e,this._firestore),r=new El(this._firestore);return super.get(e).then(u=>new zh(this._firestore,r,t._key,u._document,new vc(!1,!1),t.converter))}}function OV(i,e,t){i=Rn(i,hi);const r=Object.assign(Object.assign({},DF),t);return function(u){if(u.maxAttempts<1)throw new nt(ze.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(u,f,y){const l=new Zi;return u.asyncQueue.enqueueAndForget(async()=>{const T=await DC(u);new oF(u.asyncQueue,T,y,f,l).run()}),l.promise}(Ni(i),u=>e(new RF(i,u)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BV(){return new Hp("deleteField")}function FV(){return new R1("serverTimestamp")}function NV(...i){return new bF("arrayUnion",i)}function UV(...i){return new wF("arrayRemove",i)}function VV(i){return new TF("increment",i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jV(i){return Ni(i=Rn(i,hi)),new PF(i,e=>Yp(i,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GV(i,e){var t;const r=Ni(i=Rn(i,hi));if(!(!((t=r.offlineComponents)===null||t===void 0)&&t.indexBackfillerScheduler))return Th("Cannot enable indexes when persistence is disabled"),Promise.resolve();const u=function(f){const y=typeof f=="string"?function(T){try{return JSON.parse(T)}catch(A){throw new nt(ze.INVALID_ARGUMENT,"Failed to parse JSON: "+(A==null?void 0:A.message))}}(f):f,l=[];if(Array.isArray(y.indexes))for(const T of y.indexes){const A=xI(T,"collectionGroup"),R=[];if(Array.isArray(T.fields))for(const z of T.fields){const j=xy("setIndexConfiguration",xI(z,"fieldPath"));z.arrayConfig==="CONTAINS"?R.push(new Qg(j,2)):z.order==="ASCENDING"?R.push(new Qg(j,0)):z.order==="DESCENDING"&&R.push(new Qg(j,1))}l.push(new C_(C_.UNKNOWN_ID,A,R,op.empty()))}return l}(e);return _y(r).then(f=>async function(y,l){const T=Et(y),A=T.indexManager,R=[];return T.persistence.runTransaction("Configure indexes","readwrite",z=>A.getFieldIndexes(z).next(j=>function(ee,se,be,Re,Ge){ee=[...ee],se=[...se],ee.sort(be),se.sort(be);const it=ee.length,dt=se.length;let Ue=0,ge=0;for(;Ue<dt&&ge<it;){const Ke=be(ee[ge],se[Ue]);Ke<0?Ge(ee[ge++]):Ke>0?Re(se[Ue++]):(Ue++,ge++)}for(;Ue<dt;)Re(se[Ue++]);for(;ge<it;)Ge(ee[ge++])}(j,l,vO,ee=>{R.push(A.addFieldIndex(z,ee))},ee=>{R.push(A.deleteFieldIndex(z,ee))})).next(()=>Me.waitFor(R)))}(f,u))}function xI(i,e){if(typeof i[e]!="string")throw new nt(ze.INVALID_ARGUMENT,"Missing string value for: "+e);return i[e]}(function(i,e=!0){(function(t){Uh=t})(kp),bh(new Ac("firestore",(t,{instanceIdentifier:r,options:u})=>{const f=t.getProvider("app").getImmediate(),y=new hi(new fO(t.getProvider("auth-internal")),new gO(t.getProvider("app-check-internal")),function(l,T){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new nt(ze.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new kc(l.options.projectId,T)}(f,r),f);return u=Object.assign({useFetchStreams:e},u),y._setSettings(u),y},"PUBLIC").setMultipleInstances(!0)),il(yE,"3.8.0",i),il(yE,"3.8.0","esm2017")})();function U1(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,r=Object.getOwnPropertySymbols(i);u<r.length;u++)e.indexOf(r[u])<0&&Object.prototype.propertyIsEnumerable.call(i,r[u])&&(t[r[u]]=i[r[u]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $V={PHONE:"phone"},qV={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},WV={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},ZV={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},HV={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LF(){return{["admin-restricted-operation"]:"This operation is restricted to administrators only.",["argument-error"]:"",["app-not-authorized"]:"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.",["app-not-installed"]:"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.",["captcha-check-failed"]:"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.",["code-expired"]:"The SMS code has expired. Please re-send the verification code to try again.",["cordova-not-ready"]:"Cordova framework is not ready.",["cors-unsupported"]:"This browser is not supported.",["credential-already-in-use"]:"This credential is already associated with a different user account.",["custom-token-mismatch"]:"The custom token corresponds to a different audience.",["requires-recent-login"]:"This operation is sensitive and requires recent authentication. Log in again before retrying this request.",["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.",["dynamic-link-not-activated"]:"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.",["email-change-needs-verification"]:"Multi-factor users must always have a verified email.",["email-already-in-use"]:"The email address is already in use by another account.",["emulator-config-failed"]:'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',["expired-action-code"]:"The action code has expired.",["cancelled-popup-request"]:"This operation has been cancelled due to another conflicting popup being opened.",["internal-error"]:"An internal AuthError has occurred.",["invalid-app-credential"]:"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.",["invalid-app-id"]:"The mobile app identifier is not registed for the current project.",["invalid-user-token"]:"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.",["invalid-auth-event"]:"An internal AuthError has occurred.",["invalid-verification-code"]:"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.",["invalid-continue-uri"]:"The continue URL provided in the request is invalid.",["invalid-cordova-configuration"]:"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.",["invalid-custom-token"]:"The custom token format is incorrect. Please check the documentation.",["invalid-dynamic-link-domain"]:"The provided dynamic link domain is not configured or authorized for the current project.",["invalid-email"]:"The email address is badly formatted.",["invalid-emulator-scheme"]:"Emulator URL must start with a valid scheme (http:// or https://).",["invalid-api-key"]:"Your API key is invalid, please check you have copied it correctly.",["invalid-cert-hash"]:"The SHA-1 certificate hash provided is invalid.",["invalid-credential"]:"The supplied auth credential is malformed or has expired.",["invalid-message-payload"]:"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-multi-factor-session"]:"The request does not contain a valid proof of first factor successful sign-in.",["invalid-oauth-provider"]:"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.",["invalid-oauth-client-id"]:"The OAuth client ID provided is either invalid or does not match the specified API key.",["unauthorized-domain"]:"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.",["invalid-action-code"]:"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.",["wrong-password"]:"The password is invalid or the user does not have a password.",["invalid-persistence-type"]:"The specified persistence type is invalid. It can only be local, session or none.",["invalid-phone-number"]:"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].",["invalid-provider-id"]:"The specified provider ID is invalid.",["invalid-recipient-email"]:"The email corresponding to this action failed to send as the provided recipient email address is invalid.",["invalid-sender"]:"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-verification-id"]:"The verification ID used to create the phone auth credential is invalid.",["invalid-tenant-id"]:"The Auth instance's tenant ID is invalid.",["login-blocked"]:"Login blocked by user-provided method: {$originalMessage}",["missing-android-pkg-name"]:"An Android Package Name must be provided if the Android App is required to be installed.",["auth-domain-config-required"]:"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.",["missing-app-credential"]:"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.",["missing-verification-code"]:"The phone auth credential was created with an empty SMS verification code.",["missing-continue-uri"]:"A continue URL must be provided in the request.",["missing-iframe-start"]:"An internal AuthError has occurred.",["missing-ios-bundle-id"]:"An iOS Bundle ID must be provided if an App Store ID is provided.",["missing-or-invalid-nonce"]:"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.",["missing-multi-factor-info"]:"No second factor identifier is provided.",["missing-multi-factor-session"]:"The request is missing proof of first factor successful sign-in.",["missing-phone-number"]:"To send verification codes, provide a phone number for the recipient.",["missing-verification-id"]:"The phone auth credential was created with an empty verification ID.",["app-deleted"]:"This instance of FirebaseApp has been deleted.",["multi-factor-info-not-found"]:"The user does not have a second factor matching the identifier provided.",["multi-factor-auth-required"]:"Proof of ownership of a second factor is required to complete sign-in.",["account-exists-with-different-credential"]:"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.",["network-request-failed"]:"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.",["no-auth-event"]:"An internal AuthError has occurred.",["no-such-provider"]:"User was not linked to an account with the given provider.",["null-user"]:"A null user object was provided as the argument for an operation which requires a non-null user object.",["operation-not-allowed"]:"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.",["operation-not-supported-in-this-environment"]:'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',["popup-blocked"]:"Unable to establish a connection with the popup. It may have been blocked by the browser.",["popup-closed-by-user"]:"The popup has been closed by the user before finalizing the operation.",["provider-already-linked"]:"User can only be linked to one identity for the given provider.",["quota-exceeded"]:"The project's quota for this operation has been exceeded.",["redirect-cancelled-by-user"]:"The redirect operation has been cancelled by the user before finalizing.",["redirect-operation-pending"]:"A redirect sign-in operation is already pending.",["rejected-credential"]:"The request contains malformed or mismatching credentials.",["second-factor-already-in-use"]:"The second factor is already enrolled on this account.",["maximum-second-factor-count-exceeded"]:"The maximum allowed number of second factors on a user has been exceeded.",["tenant-id-mismatch"]:"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.",["user-token-expired"]:"The user's credential is no longer valid. The user must sign in again.",["too-many-requests"]:"We have blocked all requests from this device due to unusual activity. Try again later.",["unauthorized-continue-uri"]:"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.",["unsupported-first-factor"]:"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.",["unsupported-persistence-type"]:"The current environment does not support the specified persistence type.",["unsupported-tenant-operation"]:"This operation is not supported in a multi-tenant context.",["unverified-email"]:"The operation requires a verified email.",["user-cancelled"]:"The user did not grant your application the permissions it requested.",["user-not-found"]:"There is no user record corresponding to this identifier. The user may have been deleted.",["user-disabled"]:"The user account has been disabled by an administrator.",["user-mismatch"]:"The supplied credentials do not correspond to the previously signed in user.",["user-signed-out"]:"",["weak-password"]:"The password must be 6 characters long or more.",["web-storage-unsupported"]:"This browser is not supported or 3rd party cookies and data may be disabled.",["already-initialized"]:"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}function KC(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const XV=LF,zF=KC,YC=new Ap("auth","Firebase",KC()),KV={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bI=new wx("@firebase/auth");function o_(i,...e){bI.logLevel<=$n.ERROR&&bI.error(`Auth (${kp}): ${i}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qr(i,...e){throw V1(i,...e)}function cs(i,...e){return V1(i,...e)}function QC(i,e,t){const r=Object.assign(Object.assign({},zF()),{[e]:t});return new Ap("auth","Firebase",r).create(e,{appName:i.name})}function Xh(i,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Qr(i,"argument-error"),QC(i,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function V1(i,...e){if(typeof i!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=i.name),i._errorFactory.create(t,...r)}return YC.create(i,...e)}function bt(i,e,...t){if(!i)throw V1(e,...t)}function bo(i){const e="INTERNAL ASSERTION FAILED: "+i;throw o_(e),new Error(e)}function ea(i,e){i||bo(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wI=new Map;function Ho(i){ea(i instanceof Function,"Expected a class definition");let e=wI.get(i);return e?(ea(e instanceof i,"Instance stored in cache mismatched with class"),e):(e=new i,wI.set(i,e),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OF(i,e){const t=Cp(i,"auth");if(t.isInitialized()){const u=t.getImmediate(),f=t.getOptions();if(xh(f,e!=null?e:{}))return u;Qr(u,"already-initialized")}return t.initialize({options:e})}function BF(i,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Ho);e!=null&&e.errorMap&&i._updateErrorMap(e.errorMap),i._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gp(){var i;return typeof self<"u"&&((i=self.location)===null||i===void 0?void 0:i.href)||""}function j1(){return TI()==="http:"||TI()==="https:"}function TI(){var i;return typeof self<"u"&&((i=self.location)===null||i===void 0?void 0:i.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FF(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(j1()||zR()||"connection"in navigator)?navigator.onLine:!0}function NF(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(e,t){this.shortDelay=e,this.longDelay=t,ea(t>e,"Short delay should be less than long delay!"),this.isMobile=RR()||OR()}get(){return FF()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G1(i,e){ea(i.emulator,"Emulator should always be set here");const{url:t}=i.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;bo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;bo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;bo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UF={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VF=new Qp(3e4,6e4);function Ki(i,e){return i.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:i.tenantId}):e}async function or(i,e,t,r,u={}){return ek(i,u,async()=>{let f={},y={};r&&(e==="GET"?y=r:f={body:JSON.stringify(r)});const l=Bh(Object.assign({key:i.config.apiKey},y)).slice(1),T=await i._getAdditionalHeaders();return T["Content-Type"]="application/json",i.languageCode&&(T["X-Firebase-Locale"]=i.languageCode),JC.fetch()(tk(i,i.config.apiHost,t,l),Object.assign({method:e,headers:T,referrerPolicy:"no-referrer"},f))})}async function ek(i,e,t){i._canInitEmulator=!1;const r=Object.assign(Object.assign({},UF),e);try{const u=new jF(i),f=await Promise.race([t(),u.promise]);u.clearNetworkTimeout();const y=await f.json();if("needConfirmation"in y)throw jf(i,"account-exists-with-different-credential",y);if(f.ok&&!("errorMessage"in y))return y;{const l=f.ok?y.errorMessage:y.error.message,[T,A]=l.split(" : ");if(T==="FEDERATED_USER_ID_ALREADY_LINKED")throw jf(i,"credential-already-in-use",y);if(T==="EMAIL_EXISTS")throw jf(i,"email-already-in-use",y);if(T==="USER_DISABLED")throw jf(i,"user-disabled",y);const R=r[T]||T.toLowerCase().replace(/[_\s]+/g,"-");if(A)throw QC(i,R,A);Qr(i,R)}}catch(u){if(u instanceof ra)throw u;Qr(i,"network-request-failed")}}async function ca(i,e,t,r,u={}){const f=await or(i,e,t,r,u);return"mfaPendingCredential"in f&&Qr(i,"multi-factor-auth-required",{_serverResponse:f}),f}function tk(i,e,t,r){const u=`${e}${t}?${r}`;return i.config.emulator?G1(i.config,u):`${i.config.apiScheme}://${u}`}class jF{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(cs(this.auth,"network-request-failed")),VF.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function jf(i,e,t){const r={appName:i.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const u=cs(i,e,r);return u.customData._tokenResponse=t,u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GF(i,e){return or(i,"POST","/v1/accounts:delete",e)}async function $F(i,e){return or(i,"POST","/v1/accounts:update",e)}async function qF(i,e){return or(i,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yf(i){if(!!i)try{const e=new Date(Number(i));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YV(i,e=!1){return Gt(i).getIdToken(e)}async function WF(i,e=!1){const t=Gt(i),r=await t.getIdToken(e),u=Sy(r);bt(u&&u.exp&&u.auth_time&&u.iat,t.auth,"internal-error");const f=typeof u.firebase=="object"?u.firebase:void 0,y=f==null?void 0:f.sign_in_provider;return{claims:u,token:r,authTime:Yf(b0(u.auth_time)),issuedAtTime:Yf(b0(u.iat)),expirationTime:Yf(b0(u.exp)),signInProvider:y||null,signInSecondFactor:(f==null?void 0:f.sign_in_second_factor)||null}}function b0(i){return Number(i)*1e3}function Sy(i){const[e,t,r]=i.split(".");if(e===void 0||t===void 0||r===void 0)return o_("JWT malformed, contained fewer than 3 sections"),null;try{const u=M2(t);return u?JSON.parse(u):(o_("Failed to decode base64 JWT payload"),null)}catch(u){return o_("Caught error parsing JWT payload as JSON",u==null?void 0:u.toString()),null}}function ZF(i){const e=Sy(i);return bt(e,"internal-error"),bt(typeof e.exp<"u","internal-error"),bt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ta(i,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ra&&HF(r)&&i.auth.currentUser===i&&await i.auth.signOut(),r}}function HF({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XF{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const u=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,u)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Yf(this.lastLoginAt),this.creationTime=Yf(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _p(i){var e;const t=i.auth,r=await i.getIdToken(),u=await ta(i,qF(t,{idToken:r}));bt(u==null?void 0:u.users.length,t,"internal-error");const f=u.users[0];i._notifyReloadListener(f);const y=!((e=f.providerUserInfo)===null||e===void 0)&&e.length?QF(f.providerUserInfo):[],l=YF(i.providerData,y),T=i.isAnonymous,A=!(i.email&&f.passwordHash)&&!(l!=null&&l.length),R=T?A:!1,z={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:l,metadata:new nk(f.createdAt,f.lastLoginAt),isAnonymous:R};Object.assign(i,z)}async function KF(i){const e=Gt(i);await _p(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function YF(i,e){return[...i.filter(r=>!e.some(u=>u.providerId===r.providerId)),...e]}function QF(i){return i.map(e=>{var{providerId:t}=e,r=U1(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JF(i,e){const t=await ek(i,{},async()=>{const r=Bh({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:u,apiKey:f}=i.config,y=tk(i,u,"/v1/token",`key=${f}`),l=await i._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",JC.fetch()(y,{method:"POST",headers:l,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){bt(e.idToken,"internal-error"),bt(typeof e.idToken<"u","internal-error"),bt(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ZF(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return bt(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:u,expiresIn:f}=await JF(e,t);this.updateTokensAndExpiration(r,u,Number(f))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:u,expirationTime:f}=t,y=new yp;return r&&(bt(typeof r=="string","internal-error",{appName:e}),y.refreshToken=r),u&&(bt(typeof u=="string","internal-error",{appName:e}),y.accessToken=u),f&&(bt(typeof f=="number","internal-error",{appName:e}),y.expirationTime=f),y}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new yp,this.toJSON())}_performRefresh(){return bo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Za(i,e){bt(typeof i=="string"||typeof i>"u","internal-error",{appName:e})}class Tc{constructor(e){var{uid:t,auth:r,stsTokenManager:u}=e,f=U1(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new XF(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=u,this.accessToken=u.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new nk(f.createdAt||void 0,f.lastLoginAt||void 0)}async getIdToken(e){const t=await ta(this,this.stsTokenManager.getToken(this.auth,e));return bt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return WF(this,e)}reload(){return KF(this)}_assign(e){this!==e&&(bt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Tc(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){bt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await _p(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await ta(this,GF(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,u,f,y,l,T,A,R;const z=(r=t.displayName)!==null&&r!==void 0?r:void 0,j=(u=t.email)!==null&&u!==void 0?u:void 0,ee=(f=t.phoneNumber)!==null&&f!==void 0?f:void 0,se=(y=t.photoURL)!==null&&y!==void 0?y:void 0,be=(l=t.tenantId)!==null&&l!==void 0?l:void 0,Re=(T=t._redirectEventId)!==null&&T!==void 0?T:void 0,Ge=(A=t.createdAt)!==null&&A!==void 0?A:void 0,it=(R=t.lastLoginAt)!==null&&R!==void 0?R:void 0,{uid:dt,emailVerified:Ue,isAnonymous:ge,providerData:Ke,stsTokenManager:He}=t;bt(dt&&He,e,"internal-error");const en=yp.fromJSON(this.name,He);bt(typeof dt=="string",e,"internal-error"),Za(z,e.name),Za(j,e.name),bt(typeof Ue=="boolean",e,"internal-error"),bt(typeof ge=="boolean",e,"internal-error"),Za(ee,e.name),Za(se,e.name),Za(be,e.name),Za(Re,e.name),Za(Ge,e.name),Za(it,e.name);const vt=new Tc({uid:dt,auth:e,email:j,emailVerified:Ue,displayName:z,isAnonymous:ge,photoURL:se,phoneNumber:ee,tenantId:be,stsTokenManager:en,createdAt:Ge,lastLoginAt:it});return Ke&&Array.isArray(Ke)&&(vt.providerData=Ke.map(Ft=>Object.assign({},Ft))),Re&&(vt._redirectEventId=Re),vt}static async _fromIdTokenResponse(e,t,r=!1){const u=new yp;u.updateFromServerResponse(t);const f=new Tc({uid:t.localId,auth:e,stsTokenManager:u,isAnonymous:r});return await _p(f),f}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ik.type="NONE";const EI=ik;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a_(i,e,t){return`firebase:${i}:${e}:${t}`}class dh{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:u,name:f}=this.auth;this.fullUserKey=a_(this.userKey,u.apiKey,f),this.fullPersistenceKey=a_("persistence",u.apiKey,f),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Tc._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new dh(Ho(EI),e,r);const u=(await Promise.all(t.map(async A=>{if(await A._isAvailable())return A}))).filter(A=>A);let f=u[0]||Ho(EI);const y=a_(r,e.config.apiKey,e.name);let l=null;for(const A of t)try{const R=await A._get(y);if(R){const z=Tc._fromJSON(e,R);A!==f&&(l=z),f=A;break}}catch{}const T=u.filter(A=>A._shouldAllowMigration);return!f._shouldAllowMigration||!T.length?new dh(f,e,r):(f=T[0],l&&await f._set(y,l.toJSON()),await Promise.all(t.map(async A=>{if(A!==f)try{await A._remove(y)}catch{}})),new dh(f,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function II(i){const e=i.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(ok(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(rk(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(lk(e))return"Blackberry";if(ck(e))return"Webos";if($1(e))return"Safari";if((e.includes("chrome/")||sk(e))&&!e.includes("edge/"))return"Chrome";if(ak(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=i.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function rk(i=Hi()){return/firefox\//i.test(i)}function $1(i=Hi()){const e=i.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function sk(i=Hi()){return/crios\//i.test(i)}function ok(i=Hi()){return/iemobile/i.test(i)}function ak(i=Hi()){return/android/i.test(i)}function lk(i=Hi()){return/blackberry/i.test(i)}function ck(i=Hi()){return/webos/i.test(i)}function Ay(i=Hi()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function eN(i=Hi()){var e;return Ay(i)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function tN(){return BR()&&document.documentMode===10}function uk(i=Hi()){return Ay(i)||ak(i)||ck(i)||lk(i)||/windows phone/i.test(i)||ok(i)}function nN(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hk(i,e=[]){let t;switch(i){case"Browser":t=II(Hi());break;case"Worker":t=`${II(Hi())}-${i}`;break;default:t=i}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${kp}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=f=>new Promise((y,l)=>{try{const T=e(f);y(T)}catch(T){l(T)}});r.onAbort=t,this.queue.push(r);const u=this.queue.length-1;return()=>{this.queue[u]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const u of t)try{u()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN{constructor(e,t,r){this.app=e,this.heartbeatServiceProvider=t,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new SI(this),this.idTokenSubscription=new SI(this),this.beforeStateQueue=new iN(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=YC,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ho(t)),this._initializationPromise=this.queue(async()=>{var r,u;if(!this._deleted&&(this.persistenceManager=await dh.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((u=this.currentUser)===null||u===void 0?void 0:u.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;const r=await this.assertedPersistence.getCurrentUser();let u=r,f=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const y=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,l=u==null?void 0:u._redirectEventId,T=await this.tryRedirectSignIn(e);(!y||y===l)&&(T==null?void 0:T.user)&&(u=T.user,f=!0)}if(!u)return this.directlySetCurrentUser(null);if(!u._redirectEventId){if(f)try{await this.beforeStateQueue.runMiddleware(u)}catch(y){u=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(y))}return u?this.reloadAndSetCurrentUserOrClear(u):this.directlySetCurrentUser(null)}return bt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===u._redirectEventId?this.directlySetCurrentUser(u):this.reloadAndSetCurrentUserOrClear(u)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await _p(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=NF()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Gt(e):null;return t&&bt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&bt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Ho(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ap("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ho(e)||this._popupRedirectResolver;bt(t,this,"argument-error"),this.redirectPersistenceManager=await dh.create(this,[Ho(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,u){if(this._deleted)return()=>{};const f=typeof t=="function"?t:t.next.bind(t),y=this._isInitialized?Promise.resolve():this._initializationPromise;return bt(y,this,"internal-error"),y.then(()=>f(this.currentUser)),typeof t=="function"?e.addObserver(t,r,u):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return bt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=hk(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());return r&&(t["X-Firebase-Client"]=r),t}}function Ur(i){return Gt(i)}class SI{constructor(e){this.auth=e,this.observer=null,this.addObserver=QR(t=>this.observer=t)}get next(){return bt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function sN(i,e,t){const r=Ur(i);bt(r._canInitEmulator,r,"emulator-config-failed"),bt(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const u=!!(t!=null&&t.disableWarnings),f=dk(e),{host:y,port:l}=oN(e),T=l===null?"":`:${l}`;r.config.emulator={url:`${f}//${y}${T}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:y,port:l,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:u})}),u||aN()}function dk(i){const e=i.indexOf(":");return e<0?"":i.substr(0,e+1)}function oN(i){const e=dk(i),t=/(\/\/)?([^?#/]+)/.exec(i.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",u=/^(\[[^\]]+\])(:|$)/.exec(r);if(u){const f=u[1];return{host:f,port:AI(r.substr(f.length+1))}}else{const[f,y]=r.split(":");return{host:f,port:AI(y)}}}function AI(i){if(!i)return null;const e=Number(i);return isNaN(e)?null:e}function aN(){function i(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return bo("not implemented")}_getIdTokenResponse(e){return bo("not implemented")}_linkToIdToken(e,t){return bo("not implemented")}_getReauthenticationResolver(e){return bo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fk(i,e){return or(i,"POST","/v1/accounts:resetPassword",Ki(i,e))}async function pk(i,e){return or(i,"POST","/v1/accounts:update",e)}async function lN(i,e){return or(i,"POST","/v1/accounts:update",Ki(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cN(i,e){return ca(i,"POST","/v1/accounts:signInWithPassword",Ki(i,e))}async function Cy(i,e){return or(i,"POST","/v1/accounts:sendOobCode",Ki(i,e))}async function uN(i,e){return Cy(i,e)}async function hN(i,e){return Cy(i,e)}async function dN(i,e){return Cy(i,e)}async function fN(i,e){return Cy(i,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pN(i,e){return ca(i,"POST","/v1/accounts:signInWithEmailLink",Ki(i,e))}async function mN(i,e){return ca(i,"POST","/v1/accounts:signInWithEmailLink",Ki(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp extends Jp{constructor(e,t,r,u=null){super("password",r),this._email=e,this._password=t,this._tenantId=u}static _fromEmailAndPassword(e,t){return new vp(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new vp(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if((t==null?void 0:t.email)&&(t==null?void 0:t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return cN(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return pN(e,{email:this._email,oobCode:this._password});default:Qr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return pk(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return mN(e,{idToken:t,email:this._email,oobCode:this._password});default:Qr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ko(i,e){return ca(i,"POST","/v1/accounts:signInWithIdp",Ki(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gN="http://localhost";class na extends Jp{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new na(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Qr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:u}=t,f=U1(t,["providerId","signInMethod"]);if(!r||!u)return null;const y=new na(r,u);return y.idToken=f.idToken||void 0,y.accessToken=f.accessToken||void 0,y.secret=f.secret,y.nonce=f.nonce,y.pendingToken=f.pendingToken||null,y}_getIdTokenResponse(e){const t=this.buildRequest();return Ko(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ko(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ko(e,t)}buildRequest(){const e={requestUri:gN,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Bh(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _N(i,e){return or(i,"POST","/v1/accounts:sendVerificationCode",Ki(i,e))}async function yN(i,e){return ca(i,"POST","/v1/accounts:signInWithPhoneNumber",Ki(i,e))}async function vN(i,e){const t=await ca(i,"POST","/v1/accounts:signInWithPhoneNumber",Ki(i,e));if(t.temporaryProof)throw jf(i,"account-exists-with-different-credential",t);return t}const xN={USER_NOT_FOUND:"user-not-found"};async function bN(i,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return ca(i,"POST","/v1/accounts:signInWithPhoneNumber",Ki(i,t),xN)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec extends Jp{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ec({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ec({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return yN(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return vN(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return bN(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:u}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:u}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:u,temporaryProof:f}=e;return!r&&!t&&!u&&!f?null:new Ec({verificationId:t,verificationCode:r,phoneNumber:u,temporaryProof:f})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wN(i){switch(i){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function TN(i){const e=Of(Bf(i)).link,t=e?Of(Bf(e)).deep_link_id:null,r=Of(Bf(i)).deep_link_id;return(r?Of(Bf(r)).link:null)||r||t||e||i}class em{constructor(e){var t,r,u,f,y,l;const T=Of(Bf(e)),A=(t=T.apiKey)!==null&&t!==void 0?t:null,R=(r=T.oobCode)!==null&&r!==void 0?r:null,z=wN((u=T.mode)!==null&&u!==void 0?u:null);bt(A&&R&&z,"argument-error"),this.apiKey=A,this.operation=z,this.code=R,this.continueUrl=(f=T.continueUrl)!==null&&f!==void 0?f:null,this.languageCode=(y=T.languageCode)!==null&&y!==void 0?y:null,this.tenantId=(l=T.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const t=TN(e);try{return new em(t)}catch{return null}}}function QV(i){return em.parseLink(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(){this.providerId=Wc.PROVIDER_ID}static credential(e,t){return vp._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=em.parseLink(t);return bt(r,"argument-error"),vp._fromEmailAndCode(e,r.code,r.tenantId)}}Wc.PROVIDER_ID="password";Wc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Wc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh extends ua{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class l_ extends Kh{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return bt("providerId"in t&&"signInMethod"in t,"argument-error"),na._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return bt(e.idToken||e.accessToken,"argument-error"),na._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return l_.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return l_.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:u,pendingToken:f,nonce:y,providerId:l}=e;if(!r&&!u&&!t&&!f||!l)return null;try{return new l_(l)._credential({idToken:t,accessToken:r,nonce:y,pendingToken:f})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ka extends Kh{constructor(){super("facebook.com")}static credential(e){return na._fromParams({providerId:Ka.PROVIDER_ID,signInMethod:Ka.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ka.credentialFromTaggedObject(e)}static credentialFromError(e){return Ka.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ka.credential(e.oauthAccessToken)}catch{return null}}}Ka.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ka.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya extends Kh{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return na._fromParams({providerId:Ya.PROVIDER_ID,signInMethod:Ya.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ya.credentialFromTaggedObject(e)}static credentialFromError(e){return Ya.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ya.credential(t,r)}catch{return null}}}Ya.GOOGLE_SIGN_IN_METHOD="google.com";Ya.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa extends Kh{constructor(){super("github.com")}static credential(e){return na._fromParams({providerId:Qa.PROVIDER_ID,signInMethod:Qa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qa.credentialFromTaggedObject(e)}static credentialFromError(e){return Qa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qa.credential(e.oauthAccessToken)}catch{return null}}}Qa.GITHUB_SIGN_IN_METHOD="github.com";Qa.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EN="http://localhost";class xp extends Jp{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Ko(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ko(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ko(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:u,pendingToken:f}=t;return!r||!u||!f||r!==u?null:new xp(r,f)}static _create(e,t){return new xp(e,t)}buildRequest(){return{requestUri:EN,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IN="saml.";class hx extends ua{constructor(e){bt(e.startsWith(IN),"argument-error"),super(e)}static credentialFromResult(e){return hx.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return hx.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=xp.fromJSON(e);return bt(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return xp._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja extends Kh{constructor(){super("twitter.com")}static credential(e,t){return na._fromParams({providerId:Ja.PROVIDER_ID,signInMethod:Ja.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ja.credentialFromTaggedObject(e)}static credentialFromError(e){return Ja.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Ja.credential(t,r)}catch{return null}}}Ja.TWITTER_SIGN_IN_METHOD="twitter.com";Ja.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mk(i,e){return ca(i,"POST","/v1/accounts:signUp",Ki(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,u=!1){const f=await Tc._fromIdTokenResponse(e,r,u),y=CI(r);return new Ss({user:f,providerId:y,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const u=CI(r);return new Ss({user:e,providerId:u,_tokenResponse:r,operationType:t})}}function CI(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JV(i){var e;const t=Ur(i);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Ss({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await mk(t,{returnSecureToken:!0}),u=await Ss._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(u.user),u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U_ extends ra{constructor(e,t,r,u){var f;super(t.code,t.message),this.operationType=r,this.user=u,Object.setPrototypeOf(this,U_.prototype),this.customData={appName:e.name,tenantId:(f=e.tenantId)!==null&&f!==void 0?f:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,u){return new U_(e,t,r,u)}}function gk(i,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(i):t._getIdTokenResponse(i)).catch(f=>{throw f.code==="auth/multi-factor-auth-required"?U_._fromErrorAndOperation(i,f,e,r):f})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _k(i){return new Set(i.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e6(i,e){const t=Gt(i);await ky(!0,t,e);const{providerUserInfo:r}=await $F(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),u=_k(r||[]);return t.providerData=t.providerData.filter(f=>u.has(f.providerId)),u.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function q1(i,e,t=!1){const r=await ta(i,e._linkToIdToken(i.auth,await i.getIdToken()),t);return Ss._forOperation(i,"link",r)}async function ky(i,e,t){await _p(e);const r=_k(e.providerData),u=i===!1?"provider-already-linked":"no-such-provider";bt(r.has(t)===i,e.auth,u)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yk(i,e,t=!1){const{auth:r}=i,u="reauthenticate";try{const f=await ta(i,gk(r,u,e,i),t);bt(f.idToken,r,"internal-error");const y=Sy(f.idToken);bt(y,r,"internal-error");const{sub:l}=y;return bt(i.uid===l,r,"user-mismatch"),Ss._forOperation(i,u,f)}catch(f){throw(f==null?void 0:f.code)==="auth/user-not-found"&&Qr(r,"user-mismatch"),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vk(i,e,t=!1){const r="signIn",u=await gk(i,r,e),f=await Ss._fromIdTokenResponse(i,r,u);return t||await i._updateCurrentUser(f.user),f}async function W1(i,e){return vk(Ur(i),e)}async function SN(i,e){const t=Gt(i);return await ky(!1,t,e.providerId),q1(t,e)}async function AN(i,e){return yk(Gt(i),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CN(i,e){return ca(i,"POST","/v1/accounts:signInWithCustomToken",Ki(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t6(i,e){const t=Ur(i),r=await CN(t,{token:e,returnSecureToken:!0}),u=await Ss._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(u.user),u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Z1._fromServerResponse(e,t):Qr(e,"internal-error")}}class Z1 extends My{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Z1(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dy(i,e,t){var r;bt(((r=t.url)===null||r===void 0?void 0:r.length)>0,i,"invalid-continue-uri"),bt(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,i,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(bt(t.iOS.bundleId.length>0,i,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(bt(t.android.packageName.length>0,i,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n6(i,e,t){const r=Gt(i),u={requestType:"PASSWORD_RESET",email:e};t&&Dy(r,u,t),await hN(r,u)}async function i6(i,e,t){await fk(Gt(i),{oobCode:e,newPassword:t})}async function r6(i,e){await lN(Gt(i),{oobCode:e})}async function kN(i,e){const t=Gt(i),r=await fk(t,{oobCode:e}),u=r.requestType;switch(bt(u,t,"internal-error"),u){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":bt(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":bt(r.mfaInfo,t,"internal-error");default:bt(r.email,t,"internal-error")}let f=null;return r.mfaInfo&&(f=My._fromServerResponse(Ur(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:f},operation:u}}async function s6(i,e){const{data:t}=await kN(Gt(i),e);return t.email}async function o6(i,e,t){const r=Ur(i),u=await mk(r,{returnSecureToken:!0,email:e,password:t}),f=await Ss._fromIdTokenResponse(r,"signIn",u);return await r._updateCurrentUser(f.user),f}function a6(i,e,t){return W1(Gt(i),Wc.credential(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l6(i,e,t){const r=Gt(i),u={requestType:"EMAIL_SIGNIN",email:e};bt(t.handleCodeInApp,r,"argument-error"),t&&Dy(r,u,t),await dN(r,u)}function c6(i,e){const t=em.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function u6(i,e,t){const r=Gt(i),u=Wc.credentialWithLink(e,t||gp());return bt(u._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),W1(r,u)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MN(i,e){return or(i,"POST","/v1/accounts:createAuthUri",Ki(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h6(i,e){const t=j1()?gp():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:u}=await MN(Gt(i),r);return u||[]}async function d6(i,e){const t=Gt(i),u={requestType:"VERIFY_EMAIL",idToken:await i.getIdToken()};e&&Dy(t.auth,u,e);const{email:f}=await uN(t.auth,u);f!==i.email&&await i.reload()}async function f6(i,e,t){const r=Gt(i),f={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await i.getIdToken(),newEmail:e};t&&Dy(r.auth,f,t);const{email:y}=await fN(r.auth,f);y!==i.email&&await i.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DN(i,e){return or(i,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p6(i,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Gt(i),f={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},y=await ta(r,DN(r.auth,f));r.displayName=y.displayName||null,r.photoURL=y.photoUrl||null;const l=r.providerData.find(({providerId:T})=>T==="password");l&&(l.displayName=r.displayName,l.photoURL=r.photoURL),await r._updateTokensIfNecessary(y)}function m6(i,e){return xk(Gt(i),e,null)}function g6(i,e){return xk(Gt(i),null,e)}async function xk(i,e,t){const{auth:r}=i,f={idToken:await i.getIdToken(),returnSecureToken:!0};e&&(f.email=e),t&&(f.password=t);const y=await ta(i,pk(r,f));await i._updateTokensIfNecessary(y,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PN(i){var e,t;if(!i)return null;const{providerId:r}=i,u=i.rawUserInfo?JSON.parse(i.rawUserInfo):{},f=i.isNewUser||i.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(i==null?void 0:i.idToken)){const y=(t=(e=Sy(i.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(y){const l=y!=="anonymous"&&y!=="custom"?y:null;return new fh(f,l)}}if(!r)return null;switch(r){case"facebook.com":return new RN(f,u);case"github.com":return new LN(f,u);case"google.com":return new zN(f,u);case"twitter.com":return new ON(f,u,i.screenName||null);case"custom":case"anonymous":return new fh(f,null);default:return new fh(f,r,u)}}class fh{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class bk extends fh{constructor(e,t,r,u){super(e,t,r),this.username=u}}class RN extends fh{constructor(e,t){super(e,"facebook.com",t)}}class LN extends bk{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class zN extends fh{constructor(e,t){super(e,"google.com",t)}}class ON extends bk{constructor(e,t,r){super(e,"twitter.com",t,r)}}function _6(i){const{user:e,_tokenResponse:t}=i;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:PN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y6(i,e){return Gt(i).setPersistence(e)}function BN(i,e,t,r){return Gt(i).onIdTokenChanged(e,t,r)}function FN(i,e,t){return Gt(i).beforeAuthStateChanged(e,t)}function NN(i,e,t,r){return Gt(i).onAuthStateChanged(e,t,r)}function v6(i){Gt(i).useDeviceLanguage()}function x6(i,e){return Gt(i).updateCurrentUser(e)}function b6(i){return Gt(i).signOut()}async function w6(i){return Gt(i).delete()}class xc{constructor(e,t,r){this.type=e,this.credential=t,this.auth=r}static _fromIdtoken(e,t){return new xc("enroll",e,t)}static _fromMfaPendingCredential(e){return new xc("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return xc._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return xc._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H1{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Ur(e),u=t.customData._serverResponse,f=(u.mfaInfo||[]).map(l=>My._fromServerResponse(r,l));bt(u.mfaPendingCredential,r,"internal-error");const y=xc._fromMfaPendingCredential(u.mfaPendingCredential);return new H1(y,f,async l=>{const T=await l._process(r,y);delete u.mfaInfo,delete u.mfaPendingCredential;const A=Object.assign(Object.assign({},u),{idToken:T.idToken,refreshToken:T.refreshToken});switch(t.operationType){case"signIn":const R=await Ss._fromIdTokenResponse(r,t.operationType,A);return await r._updateCurrentUser(R.user),R;case"reauthenticate":return bt(t.user,r,"internal-error"),Ss._forOperation(t.user,t.operationType,A);default:Qr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function T6(i,e){var t;const r=Gt(i),u=e;return bt(e.customData.operationType,r,"argument-error"),bt((t=u.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),H1._fromError(r,u)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UN(i,e){return or(i,"POST","/v2/accounts/mfaEnrollment:start",Ki(i,e))}function VN(i,e){return or(i,"POST","/v2/accounts/mfaEnrollment:finalize",Ki(i,e))}function jN(i,e){return or(i,"POST","/v2/accounts/mfaEnrollment:withdraw",Ki(i,e))}class X1{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>My._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new X1(e)}async getSession(){return xc._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const r=e,u=await this.getSession(),f=await ta(this.user,r._process(this.user.auth,u,t));return await this.user._updateTokensIfNecessary(f),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken(),u=await ta(this.user,jN(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:f})=>f!==t),await this.user._updateTokensIfNecessary(u);try{await this.user.reload()}catch(f){if((f==null?void 0:f.code)!=="auth/user-token-expired")throw f}}}const w0=new WeakMap;function E6(i){const e=Gt(i);return w0.has(e)||w0.set(e,X1._fromUser(e)),w0.get(e)}const V_="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(V_,"1"),this.storage.removeItem(V_),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GN(){const i=Hi();return $1(i)||Ay(i)}const $N=1e3,qN=10;class Tk extends wk{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=GN()&&nN(),this.fallbackToPolling=uk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),u=this.localCache[t];r!==u&&e(t,u,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((y,l,T)=>{this.notifyListeners(y,T)});return}const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const y=this.storage.getItem(r);if(e.newValue!==y)e.newValue!==null?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}const u=()=>{const y=this.storage.getItem(r);!t&&this.localCache[r]===y||this.notifyListeners(r,y)},f=this.storage.getItem(r);tN()&&f!==e.newValue&&e.newValue!==e.oldValue?setTimeout(u,qN):u()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const u of Array.from(r))u(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},$N)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Tk.type="LOCAL";const WN=Tk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek extends wk{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ek.type="SESSION";const Ik=Ek;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZN(i){return Promise.all(i.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Py{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(u=>u.isListeningto(e));if(t)return t;const r=new Py(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:u,data:f}=t.data,y=this.handlersMap[u];if(!(y!=null&&y.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:u});const l=Array.from(y).map(async A=>A(t.origin,f)),T=await ZN(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:u,response:T})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Py.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ry(i="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return i+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const u=typeof MessageChannel<"u"?new MessageChannel:null;if(!u)throw new Error("connection_unavailable");let f,y;return new Promise((l,T)=>{const A=Ry("",20);u.port1.start();const R=setTimeout(()=>{T(new Error("unsupported_event"))},r);y={messageChannel:u,onMessage(z){const j=z;if(j.data.eventId===A)switch(j.data.status){case"ack":clearTimeout(R),f=setTimeout(()=>{T(new Error("timeout"))},3e3);break;case"done":clearTimeout(f),l(j.data.response);break;default:clearTimeout(R),clearTimeout(f),T(new Error("invalid_response"));break}}},this.handlers.add(y),u.port1.addEventListener("message",y.onMessage),this.target.postMessage({eventType:e,eventId:A,data:t},[u.port2])}).finally(()=>{y&&this.removeMessageHandler(y)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wi(){return window}function XN(i){Wi().location.href=i}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K1(){return typeof Wi().WorkerGlobalScope<"u"&&typeof Wi().importScripts=="function"}async function KN(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function YN(){var i;return((i=navigator==null?void 0:navigator.serviceWorker)===null||i===void 0?void 0:i.controller)||null}function QN(){return K1()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk="firebaseLocalStorageDb",JN=1,j_="firebaseLocalStorage",Ak="fbase_key";class tm{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ly(i,e){return i.transaction([j_],e?"readwrite":"readonly").objectStore(j_)}function e4(){const i=indexedDB.deleteDatabase(Sk);return new tm(i).toPromise()}function dx(){const i=indexedDB.open(Sk,JN);return new Promise((e,t)=>{i.addEventListener("error",()=>{t(i.error)}),i.addEventListener("upgradeneeded",()=>{const r=i.result;try{r.createObjectStore(j_,{keyPath:Ak})}catch(u){t(u)}}),i.addEventListener("success",async()=>{const r=i.result;r.objectStoreNames.contains(j_)?e(r):(r.close(),await e4(),e(await dx()))})})}async function kI(i,e,t){const r=Ly(i,!0).put({[Ak]:e,value:t});return new tm(r).toPromise()}async function t4(i,e){const t=Ly(i,!1).get(e),r=await new tm(t).toPromise();return r===void 0?null:r.value}function MI(i,e){const t=Ly(i,!0).delete(e);return new tm(t).toPromise()}const n4=800,i4=3;class Ck{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await dx(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>i4)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return K1()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Py._getInstance(QN()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await KN(),!this.activeServiceWorker)return;this.sender=new HN(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);!r||((e=r[0])===null||e===void 0?void 0:e.fulfilled)&&((t=r[0])===null||t===void 0?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||YN()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await dx();return await kI(e,V_,"1"),await MI(e,V_),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>kI(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>t4(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>MI(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(u=>{const f=Ly(u,!1).getAll();return new tm(f).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;for(const{fbase_key:u,value:f}of e)r.add(u),JSON.stringify(this.localCache[u])!==JSON.stringify(f)&&(this.notifyListeners(u,f),t.push(u));for(const u of Object.keys(this.localCache))this.localCache[u]&&!r.has(u)&&(this.notifyListeners(u,null),t.push(u));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const u of Array.from(r))u(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),n4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Ck.type="LOCAL";const r4=Ck;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s4(i,e){return or(i,"POST","/v2/accounts/mfaSignIn:start",Ki(i,e))}function o4(i,e){return or(i,"POST","/v2/accounts/mfaSignIn:finalize",Ki(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a4(i){return(await or(i,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l4(){var i,e;return(e=(i=document.getElementsByTagName("head"))===null||i===void 0?void 0:i[0])!==null&&e!==void 0?e:document}function kk(i){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",i),r.onload=e,r.onerror=u=>{const f=cs("internal-error");f.customData=u,t(f)},r.type="text/javascript",r.charset="UTF-8",l4().appendChild(r)})}function Mk(i){return`__${i}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c4=500,u4=6e4,Xg=1e12;class h4{constructor(e){this.auth=e,this.counter=Xg,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new d4(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Xg;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Xg;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Xg;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class d4{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const u=typeof e=="string"?document.getElementById(e):e;bt(u,"argument-error",{appName:t}),this.container=u,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=f4(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},u4)},c4))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function f4(i){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<i;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T0=Mk("rcb"),p4=new Qp(3e4,6e4),m4="https://www.google.com/recaptcha/api.js?";class g4{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Wi().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return bt(_4(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(Wi().grecaptcha):new Promise((r,u)=>{const f=Wi().setTimeout(()=>{u(cs(e,"network-request-failed"))},p4.get());Wi()[T0]=()=>{Wi().clearTimeout(f),delete Wi()[T0];const l=Wi().grecaptcha;if(!l){u(cs(e,"internal-error"));return}const T=l.render;l.render=(A,R)=>{const z=T(A,R);return this.counter++,z},this.hostLanguage=t,r(l)};const y=`${m4}?${Bh({onload:T0,render:"explicit",hl:t})}`;kk(y).catch(()=>{clearTimeout(f),u(cs(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Wi().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function _4(i){return i.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(i)}class y4{async load(e){return new h4(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dk="recaptcha",v4={theme:"light",type:"image"};class I6{constructor(e,t=Object.assign({},v4),r){this.parameters=t,this.type=Dk,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ur(r),this.isInvisible=this.parameters.size==="invisible",bt(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const u=typeof e=="string"?document.getElementById(e):e;bt(u,this.auth,"argument-error"),this.container=u,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new y4:new g4,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(u=>{const f=y=>{!y||(this.tokenChangeListeners.delete(f),u(y))};this.tokenChangeListeners.add(f),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){bt(!this.parameters.sitekey,this.auth,"argument-error"),bt(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),bt(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Wi()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){bt(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){bt(j1()&&!K1(),this.auth,"internal-error"),await x4(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await a4(this.auth);bt(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return bt(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function x4(){let i=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}i=()=>e(),window.addEventListener("load",i)}).catch(e=>{throw i&&window.removeEventListener("load",i),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Ec._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function S6(i,e,t){const r=Ur(i),u=await zy(r,e,Gt(t));return new Y1(u,f=>W1(r,f))}async function A6(i,e,t){const r=Gt(i);await ky(!1,r,"phone");const u=await zy(r.auth,e,Gt(t));return new Y1(u,f=>SN(r,f))}async function C6(i,e,t){const r=Gt(i),u=await zy(r.auth,e,Gt(t));return new Y1(u,f=>AN(r,f))}async function zy(i,e,t){var r;const u=await t.verify();try{bt(typeof u=="string",i,"argument-error"),bt(t.type===Dk,i,"argument-error");let f;if(typeof e=="string"?f={phoneNumber:e}:f=e,"session"in f){const y=f.session;if("phoneNumber"in f)return bt(y.type==="enroll",i,"internal-error"),(await UN(i,{idToken:y.credential,phoneEnrollmentInfo:{phoneNumber:f.phoneNumber,recaptchaToken:u}})).phoneSessionInfo.sessionInfo;{bt(y.type==="signin",i,"internal-error");const l=((r=f.multiFactorHint)===null||r===void 0?void 0:r.uid)||f.multiFactorUid;return bt(l,i,"missing-multi-factor-info"),(await s4(i,{mfaPendingCredential:y.credential,mfaEnrollmentId:l,phoneSignInInfo:{recaptchaToken:u}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:y}=await _N(i,{phoneNumber:f.phoneNumber,recaptchaToken:u});return y}}finally{t._reset()}}async function k6(i,e){await q1(Gt(i),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ph{constructor(e){this.providerId=ph.PROVIDER_ID,this.auth=Ur(e)}verifyPhoneNumber(e,t){return zy(this.auth,e,Gt(t))}static credential(e,t){return Ec._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ph.credentialFromTaggedObject(t)}static credentialFromError(e){return ph.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Ec._fromTokenResponse(t,r):null}}ph.PROVIDER_ID="phone";ph.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zc(i,e){return e?Ho(e):(bt(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q1 extends Jp{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ko(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ko(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ko(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function b4(i){return vk(i.auth,new Q1(i),i.bypassAuthState)}function w4(i){const{auth:e,user:t}=i;return bt(t,e,"internal-error"),yk(t,new Q1(i),i.bypassAuthState)}async function T4(i){const{auth:e,user:t}=i;return bt(t,e,"internal-error"),q1(t,new Q1(i),i.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pk{constructor(e,t,r,u,f=!1){this.auth=e,this.resolver=r,this.user=u,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:u,tenantId:f,error:y,type:l}=e;if(y){this.reject(y);return}const T={auth:this.auth,requestUri:t,sessionId:r,tenantId:f||void 0,postBody:u||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(T))}catch(A){this.reject(A)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return b4;case"linkViaPopup":case"linkViaRedirect":return T4;case"reauthViaPopup":case"reauthViaRedirect":return w4;default:Qr(this.auth,"internal-error")}}resolve(e){ea(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ea(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E4=new Qp(2e3,1e4);async function M6(i,e,t){const r=Ur(i);Xh(i,e,ua);const u=Zc(r,t);return new Xo(r,"signInViaPopup",e,u).executeNotNull()}async function D6(i,e,t){const r=Gt(i);Xh(r.auth,e,ua);const u=Zc(r.auth,t);return new Xo(r.auth,"reauthViaPopup",e,u,r).executeNotNull()}async function P6(i,e,t){const r=Gt(i);Xh(r.auth,e,ua);const u=Zc(r.auth,t);return new Xo(r.auth,"linkViaPopup",e,u,r).executeNotNull()}class Xo extends Pk{constructor(e,t,r,u,f){super(e,t,u,f),this.provider=r,this.authWindow=null,this.pollId=null,Xo.currentPopupAction&&Xo.currentPopupAction.cancel(),Xo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return bt(e,this.auth,"internal-error"),e}async onExecution(){ea(this.filter.length===1,"Popup operations only handle one event");const e=Ry();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(cs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(cs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Xo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(cs(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,E4.get())};e()}}Xo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I4="pendingRedirect",c_=new Map;class S4 extends Pk{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=c_.get(this.auth._key());if(!e){try{const r=await A4(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}c_.set(this.auth._key(),e)}return this.bypassAuthState||c_.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function A4(i,e){const t=Lk(e),r=Rk(i);if(!await r._isAvailable())return!1;const u=await r._get(t)==="true";return await r._remove(t),u}async function J1(i,e){return Rk(i)._set(Lk(e),"true")}function C4(i,e){c_.set(i._key(),e)}function Rk(i){return Ho(i._redirectPersistence)}function Lk(i){return a_(I4,i.config.apiKey,i.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R6(i,e,t){return k4(i,e,t)}async function k4(i,e,t){const r=Ur(i);Xh(i,e,ua);const u=Zc(r,t);return await J1(u,r),u._openRedirect(r,e,"signInViaRedirect")}function L6(i,e,t){return M4(i,e,t)}async function M4(i,e,t){const r=Gt(i);Xh(r.auth,e,ua);const u=Zc(r.auth,t);await J1(u,r.auth);const f=await Ok(r);return u._openRedirect(r.auth,e,"reauthViaRedirect",f)}function z6(i,e,t){return D4(i,e,t)}async function D4(i,e,t){const r=Gt(i);Xh(r.auth,e,ua);const u=Zc(r.auth,t);await ky(!1,r,e.providerId),await J1(u,r.auth);const f=await Ok(r);return u._openRedirect(r.auth,e,"linkViaRedirect",f)}async function O6(i,e){return await Ur(i)._initializationPromise,zk(i,e,!1)}async function zk(i,e,t=!1){const r=Ur(i),u=Zc(r,e),y=await new S4(r,u,t).execute();return y&&!t&&(delete y.user._redirectEventId,await r._persistUserIfCurrent(y.user),await r._setRedirectUser(null,e)),y}async function Ok(i){const e=Ry(`${i.uid}:::`);return i._redirectEventId=e,await i.auth._setRedirectUser(i),await i.auth._persistUserIfCurrent(i),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P4=10*60*1e3;class R4{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!L4(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Bk(e)){const u=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(cs(this.auth,u))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=P4&&this.cachedEventUids.clear(),this.cachedEventUids.has(DI(e))}saveEventToCache(e){this.cachedEventUids.add(DI(e)),this.lastProcessedEventTime=Date.now()}}function DI(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(e=>e).join("-")}function Bk({type:i,error:e}){return i==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function L4(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Bk(i);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z4(i,e={}){return or(i,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O4=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,B4=/^https?/;async function F4(i){if(i.config.emulator)return;const{authorizedDomains:e}=await z4(i);for(const t of e)try{if(N4(t))return}catch{}Qr(i,"unauthorized-domain")}function N4(i){const e=gp(),{protocol:t,hostname:r}=new URL(e);if(i.startsWith("chrome-extension://")){const y=new URL(i);return y.hostname===""&&r===""?t==="chrome-extension:"&&i.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&y.hostname===r}if(!B4.test(t))return!1;if(O4.test(i))return r===i;const u=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+u+"|"+u+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U4=new Qp(3e4,6e4);function PI(){const i=Wi().___jsl;if(i!=null&&i.H){for(const e of Object.keys(i.H))if(i.H[e].r=i.H[e].r||[],i.H[e].L=i.H[e].L||[],i.H[e].r=[...i.H[e].L],i.CP)for(let t=0;t<i.CP.length;t++)i.CP[t]=null}}function V4(i){return new Promise((e,t)=>{var r,u,f;function y(){PI(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{PI(),t(cs(i,"network-request-failed"))},timeout:U4.get()})}if(!((u=(r=Wi().gapi)===null||r===void 0?void 0:r.iframes)===null||u===void 0)&&u.Iframe)e(gapi.iframes.getContext());else if(!((f=Wi().gapi)===null||f===void 0)&&f.load)y();else{const l=Mk("iframefcb");return Wi()[l]=()=>{gapi.load?y():t(cs(i,"network-request-failed"))},kk(`https://apis.google.com/js/api.js?onload=${l}`).catch(T=>t(T))}}).catch(e=>{throw u_=null,e})}let u_=null;function j4(i){return u_=u_||V4(i),u_}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G4=new Qp(5e3,15e3),$4="__/auth/iframe",q4="emulator/auth/iframe",W4={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Z4=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function H4(i){const e=i.config;bt(e.authDomain,i,"auth-domain-config-required");const t=e.emulator?G1(e,q4):`https://${i.config.authDomain}/${$4}`,r={apiKey:e.apiKey,appName:i.name,v:kp},u=Z4.get(i.config.apiHost);u&&(r.eid=u);const f=i._getFrameworks();return f.length&&(r.fw=f.join(",")),`${t}?${Bh(r).slice(1)}`}async function X4(i){const e=await j4(i),t=Wi().gapi;return bt(t,i,"internal-error"),e.open({where:document.body,url:H4(i),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:W4,dontclear:!0},r=>new Promise(async(u,f)=>{await r.restyle({setHideOnLeave:!1});const y=cs(i,"network-request-failed"),l=Wi().setTimeout(()=>{f(y)},G4.get());function T(){Wi().clearTimeout(l),u(r)}r.ping(T).then(T,()=>{f(y)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K4={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Y4=500,Q4=600,J4="_blank",e5="http://localhost";class RI{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function t5(i,e,t,r=Y4,u=Q4){const f=Math.max((window.screen.availHeight-u)/2,0).toString(),y=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const T=Object.assign(Object.assign({},K4),{width:r.toString(),height:u.toString(),top:f,left:y}),A=Hi().toLowerCase();t&&(l=sk(A)?J4:t),rk(A)&&(e=e||e5,T.scrollbars="yes");const R=Object.entries(T).reduce((j,[ee,se])=>`${j}${ee}=${se},`,"");if(eN(A)&&l!=="_self")return n5(e||"",l),new RI(null);const z=window.open(e||"",l,R);bt(z,i,"popup-blocked");try{z.focus()}catch{}return new RI(z)}function n5(i,e){const t=document.createElement("a");t.href=i,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i5="__/auth/handler",r5="emulator/auth/handler";function LI(i,e,t,r,u,f){bt(i.config.authDomain,i,"auth-domain-config-required"),bt(i.config.apiKey,i,"invalid-api-key");const y={apiKey:i.config.apiKey,appName:i.name,authType:t,redirectUrl:r,v:kp,eventId:u};if(e instanceof ua){e.setDefaultLanguage(i.languageCode),y.providerId=e.providerId||"",YR(e.getCustomParameters())||(y.customParameters=JSON.stringify(e.getCustomParameters()));for(const[T,A]of Object.entries(f||{}))y[T]=A}if(e instanceof Kh){const T=e.getScopes().filter(A=>A!=="");T.length>0&&(y.scopes=T.join(","))}i.tenantId&&(y.tid=i.tenantId);const l=y;for(const T of Object.keys(l))l[T]===void 0&&delete l[T];return`${s5(i)}?${Bh(l).slice(1)}`}function s5({config:i}){return i.emulator?G1(i,r5):`https://${i.authDomain}/${i5}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E0="webStorageSupport";class o5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ik,this._completeRedirectFn=zk,this._overrideRedirectResult=C4}async _openPopup(e,t,r,u){var f;ea((f=this.eventManagers[e._key()])===null||f===void 0?void 0:f.manager,"_initialize() not called before _openPopup()");const y=LI(e,t,r,gp(),u);return t5(e,y,Ry())}async _openRedirect(e,t,r,u){return await this._originValidation(e),XN(LI(e,t,r,gp(),u)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:u,promise:f}=this.eventManagers[t];return u?Promise.resolve(u):(ea(f,"If manager is not set, promise should be"),f)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await X4(e),r=new R4(e);return t.register("authEvent",u=>(bt(u==null?void 0:u.authEvent,e,"invalid-auth-event"),{status:r.onEvent(u.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(E0,{type:E0},u=>{var f;const y=(f=u==null?void 0:u[0])===null||f===void 0?void 0:f[E0];y!==void 0&&t(!!y),Qr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=F4(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return uk()||$1()||Ay()}}const a5=o5;class l5{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return bo("unexpected MultiFactorSessionType")}}}class eb extends l5{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new eb(e)}_finalizeEnroll(e,t,r){return VN(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return o4(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class c5{constructor(){}static assertion(e){return eb._fromCredential(e)}}c5.FACTOR_ID="phone";var zI="@firebase/auth",OI="0.21.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){bt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h5(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function d5(i){bh(new Ac("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),u=e.getProvider("heartbeat"),{apiKey:f,authDomain:y}=r.options;return((l,T)=>{bt(f&&!f.includes(":"),"invalid-api-key",{appName:l.name}),bt(!(y!=null&&y.includes(":")),"argument-error",{appName:l.name});const A={apiKey:f,authDomain:y,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:hk(i)},R=new rN(l,T,A);return BF(R,t),R})(r,u)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),bh(new Ac("auth-internal",e=>{const t=Ur(e.getProvider("auth").getImmediate());return(r=>new u5(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),il(zI,OI,h5(i)),il(zI,OI,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f5=5*60,p5=R2("authIdTokenMaxAge")||f5;let BI=null;const m5=i=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>p5)return;const u=t==null?void 0:t.token;BI!==u&&(BI=u,await fetch(i,{method:u?"POST":"DELETE",headers:u?{Authorization:`Bearer ${u}`}:{}}))};function g5(i=B2()){const e=Cp(i,"auth");if(e.isInitialized())return e.getImmediate();const t=OF(i,{popupRedirectResolver:a5,persistence:[r4,WN,Ik]}),r=R2("authTokenSyncURL");if(r){const f=m5(r);FN(t,f,()=>f(t.currentUser)),BN(t,y=>f(y))}const u=P2("auth");return u&&sN(t,`http://${u}`),t}d5("Browser");const Fk=O2({apiKey:"AIzaSyDRKn6W3LGzU0y1DFBS-u3-EjGTZAa8Sls",authDomain:"buyandsell-eabc9.firebaseapp.com",projectId:"buyandsell-eabc9",storageBucket:"buyandsell-eabc9.appspot.com",messagingSenderId:"76272197810",appId:"1:76272197810:web:d1a1603567fe681978a9ab",measurementId:"G-NN7547WX2M"}),Nk=_F(Fk),fx=g5(Fk),Uk=Object.freeze(Object.defineProperty({__proto__:null,db:Nk,auth:fx},Symbol.toStringTag,{value:"Module"}));function _5(i){let e;const{subscribe:t}=js(i.currentUser,r=>(e=NN(i,u=>{r(u)}),()=>e()));return{subscribe:t}}const y5=i=>({component:i&1}),FI=i=>({component:i[0],retry:i[5]}),v5=i=>({component:i&1}),NI=i=>({component:i[0],retry:i[5]}),x5=i=>({component:i&1}),UI=i=>({component:i[0],retry:i[5]}),b5=i=>({component:i&1}),VI=i=>({component:i[0],retry:i[5]}),w5=i=>({error:i&2,component:i&1}),jI=i=>({error:i[1],component:i[0],retry:i[5]});function T5(i){let e,t,r,u;const f=[k5,C5,A5],y=[];function l(T,A){return T[4]&&T[4].success?0:T[4]&&T[4].default?1:2}return e=l(i),t=y[e]=f[e](i),{c(){t.c(),r=gl()},m(T,A){y[e].m(T,A),yt(T,r,A),u=!0},p(T,A){t.p(T,A)},i(T){u||(_t(t),u=!0)},o(T){wt(t),u=!1},d(T){y[e].d(T),T&&mt(r)}}}function E5(i){let e;const t=i[11].loading,r=dl(t,i,i[10],UI);return{c(){r&&r.c()},m(u,f){r&&r.m(u,f),e=!0},p(u,f){r&&r.p&&(!e||f&1025)&&pl(r,t,u,u[10],e?fl(t,u[10],f,x5):ml(u[10]),UI)},i(u){e||(_t(r,u),e=!0)},o(u){wt(r,u),e=!1},d(u){r&&r.d(u)}}}function I5(i){let e;const t=i[11].timeout,r=dl(t,i,i[10],VI);return{c(){r&&r.c()},m(u,f){r&&r.m(u,f),e=!0},p(u,f){r&&r.p&&(!e||f&1025)&&pl(r,t,u,u[10],e?fl(t,u[10],f,b5):ml(u[10]),VI)},i(u){e||(_t(r,u),e=!0)},o(u){wt(r,u),e=!1},d(u){r&&r.d(u)}}}function S5(i){let e;const t=i[11].error,r=dl(t,i,i[10],jI);return{c(){r&&r.c()},m(u,f){r&&r.m(u,f),e=!0},p(u,f){r&&r.p&&(!e||f&1027)&&pl(r,t,u,u[10],e?fl(t,u[10],f,w5):ml(u[10]),jI)},i(u){e||(_t(r,u),e=!0)},o(u){wt(r,u),e=!1},d(u){r&&r.d(u)}}}function A5(i){let e,t,r;const u=[i[3]];var f=i[0];function y(l){let T={};for(let A=0;A<u.length;A+=1)T=Yr(T,u[A]);return{props:T}}return f&&(e=p_(f,y())),{c(){e&&bn(e.$$.fragment),t=gl()},m(l,T){e&&gn(e,l,T),yt(l,t,T),r=!0},p(l,T){const A=T&8?Ic(u,[A0(l[3])]):{};if(f!==(f=l[0])){if(e){gr();const R=e;wt(R.$$.fragment,1,0,()=>{_n(R,1)}),_r()}f?(e=p_(f,y()),bn(e.$$.fragment),_t(e.$$.fragment,1),gn(e,t.parentNode,t)):e=null}else f&&e.$set(A)},i(l){r||(e&&_t(e.$$.fragment,l),r=!0)},o(l){e&&wt(e.$$.fragment,l),r=!1},d(l){l&&mt(t),e&&_n(e,l)}}}function C5(i){let e;const t=i[11].default,r=dl(t,i,i[10],FI);return{c(){r&&r.c()},m(u,f){r&&r.m(u,f),e=!0},p(u,f){r&&r.p&&(!e||f&1025)&&pl(r,t,u,u[10],e?fl(t,u[10],f,y5):ml(u[10]),FI)},i(u){e||(_t(r,u),e=!0)},o(u){wt(r,u),e=!1},d(u){r&&r.d(u)}}}function k5(i){let e;const t=i[11].success,r=dl(t,i,i[10],NI);return{c(){r&&r.c()},m(u,f){r&&r.m(u,f),e=!0},p(u,f){r&&r.p&&(!e||f&1025)&&pl(r,t,u,u[10],e?fl(t,u[10],f,v5):ml(u[10]),NI)},i(u){e||(_t(r,u),e=!0)},o(u){wt(r,u),e=!1},d(u){r&&r.d(u)}}}function M5(i){let e,t,r,u;const f=[S5,I5,E5,T5],y=[];function l(T,A){return T[2]===Is.ERROR?0:T[2]===Is.TIMEOUT?1:T[2]===Is.LOADING?2:T[2]===Is.SUCCESS?3:-1}return~(e=l(i))&&(t=y[e]=f[e](i)),{c(){t&&t.c(),r=gl()},m(T,A){~e&&y[e].m(T,A),yt(T,r,A),u=!0},p(T,[A]){let R=e;e=l(T),e===R?~e&&y[e].p(T,A):(t&&(gr(),wt(y[R],1,1,()=>{y[R]=null}),_r()),~e?(t=y[e],t?t.p(T,A):(t=y[e]=f[e](T),t.c()),_t(t,1),t.m(r.parentNode,r)):t=null)},i(T){u||(_t(t),u=!0)},o(T){wt(t),u=!1},d(T){~e&&y[e].d(T),T&&mt(r)}}}const D5=new Map,px=new Map,Is=Object.freeze({INITIALIZED:0,LOADING:1,SUCCESS:2,ERROR:3,TIMEOUT:4});async function P5(i,e){const t=await i(),r=t.default||t;return e||px.set(i,r),r}function R5(i,e,t){let{$$slots:r={},$$scope:u}=e,{delay:f=200}=e,{timeout:y=null}=e,{loader:l=null}=e,{unloader:T=!1}=e,{component:A=null}=e,{error:R=null}=e;const z=e.$$slots;let j=null,ee=null,se=Is.INITIALIZED,be,Re=!1;const Ge=n2(),it=Qo("svelte-loadable-capture");typeof it=="function"&&D5.has(l)&&it(l);function dt(){clearTimeout(j),clearTimeout(ee)}async function Ue(){if(dt(),typeof l=="function"){t(1,R=null),t(0,A=null),f>0?(t(2,se=Is.INITIALIZED),j=setTimeout(()=>{t(2,se=Is.LOADING)},parseFloat(f))):t(2,se=Is.LOADING),y&&(ee=setTimeout(()=>{t(2,se=Is.TIMEOUT)},parseFloat(y)));try{t(0,A=await P5(l,T)),t(2,se=Is.SUCCESS)}catch(ge){if(t(2,se=Is.ERROR),t(1,R=ge),z==null||z.error==null)throw ge}dt()}}return px.has(l)?(se=Is.SUCCESS,A=px.get(l)):wp(()=>(Re=!0,Ue().then(()=>{Re&&Ge("load")}),()=>{Re=!1,typeof T=="function"&&T()})),i.$$set=ge=>{t(18,e=Yr(Yr({},e),_h(ge))),"delay"in ge&&t(6,f=ge.delay),"timeout"in ge&&t(7,y=ge.timeout),"loader"in ge&&t(8,l=ge.loader),"unloader"in ge&&t(9,T=ge.unloader),"component"in ge&&t(0,A=ge.component),"error"in ge&&t(1,R=ge.error),"$$scope"in ge&&t(10,u=ge.$$scope)},i.$$.update=()=>{{const{delay:ge,timeout:Ke,loader:He,component:en,error:vt,...Ft}=e;t(3,be=Ft)}},e=_h(e),[A,R,se,be,z,Ue,f,y,l,T,u,r]}class Oy extends yl{constructor(e){super(),_l(this,e,R5,M5,ia,{delay:6,timeout:7,loader:8,unloader:9,component:0,error:1})}}function GI(i,e,t){const r=i.slice();return r[24]=e[t],r[26]=t,r}function L5(i){let e,t,r,u,f,y;function l(z,j){return z[1]!=!0?B5:O5}let T=l(i),A=T(i),R=i[1]==!0&&$I(i);return{c(){e=tt("div"),t=tt("h2"),r=un("Filters "),A.c(),u=Dt(),R&&R.c(),st(t,"class","svelte-um67s0"),st(e,"class","filtersmobile svelte-um67s0")},m(z,j){yt(z,e,j),Pe(e,t),Pe(t,r),A.m(t,null),Pe(e,u),R&&R.m(e,null),f||(y=[Gn(e,"keypress",i[16]),Gn(e,"click",i[18])],f=!0)},p(z,j){T!==(T=l(z))&&(A.d(1),A=T(z),A&&(A.c(),A.m(t,null))),z[1]==!0?R?R.p(z,j):(R=$I(z),R.c(),R.m(e,null)):R&&(R.d(1),R=null)},d(z){z&&mt(e),A.d(),R&&R.d(),f=!1,Pr(y)}}}function z5(i){let e,t,r,u,f,y,l,T,A,R;return{c(){e=tt("div"),t=tt("h1"),t.textContent="Filters",r=Dt(),u=tt("button"),u.textContent="Lowest Price",f=Dt(),y=tt("button"),y.textContent="Highest Price",l=Dt(),T=tt("button"),T.textContent="Clear Filters",st(u,"class","svelte-um67s0"),st(y,"class","svelte-um67s0"),st(T,"class","svelte-um67s0"),st(e,"class","filters svelte-um67s0")},m(z,j){yt(z,e,j),Pe(e,t),Pe(e,r),Pe(e,u),Pe(e,f),Pe(e,y),Pe(e,l),Pe(e,T),A||(R=[Gn(u,"click",i[13]),Gn(y,"click",i[14]),Gn(T,"click",i[12])],A=!0)},p:pn,d(z){z&&mt(e),A=!1,Pr(R)}}}function O5(i){let e,t;return{c(){e=sl("svg"),t=sl("path"),st(t,"d","M233.4 105.4c12.5-12.5 32.8-12.5 45.3 0l192 192c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L256 173.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l192-192z"),st(e,"xmlns","http://www.w3.org/2000/svg"),st(e,"viewBox","0 0 512 512")},m(r,u){yt(r,e,u),Pe(e,t)},d(r){r&&mt(e)}}}function B5(i){let e,t;return{c(){e=sl("svg"),t=sl("path"),st(t,"d","M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"),st(e,"xmlns","http://www.w3.org/2000/svg"),st(e,"viewBox","0 0 512 512")},m(r,u){yt(r,e,u),Pe(e,t)},d(r){r&&mt(e)}}}function $I(i){let e,t,r,u,f,y,l;return{c(){e=tt("button"),e.textContent="Lowest Price",t=Dt(),r=tt("button"),r.textContent="Highest Price",u=Dt(),f=tt("button"),f.textContent="Clear Filters",st(e,"class","svelte-um67s0"),st(r,"class","svelte-um67s0"),st(f,"class","svelte-um67s0")},m(T,A){yt(T,e,A),yt(T,t,A),yt(T,r,A),yt(T,u,A),yt(T,f,A),y||(l=[Gn(e,"click",i[13]),Gn(r,"click",i[14]),Gn(f,"click",i[12])],y=!0)},p:pn,d(T){T&&mt(e),T&&mt(t),T&&mt(r),T&&mt(u),T&&mt(f),y=!1,Pr(l)}}}function F5(i){let e;return{c(){e=tt("h1"),e.textContent="Loading ..."},m(t,r){yt(t,e,r)},p:pn,i:pn,o:pn,d(t){t&&mt(e)}}}function N5(i){let e,t,r,u=i[0].charAt(0).toUpperCase()+i[0].slice(1)+"",f,y,l,T=i[2],A=[];for(let z=0;z<T.length;z+=1)A[z]=WI(GI(i,T,z));const R=z=>wt(A[z],1,1,()=>{A[z]=null});return{c(){e=tt("div"),t=tt("h1"),r=un("Results For "),f=un(u),y=Dt();for(let z=0;z<A.length;z+=1)A[z].c();st(e,"class","results svelte-um67s0")},m(z,j){yt(z,e,j),Pe(e,t),Pe(t,r),Pe(t,f),Pe(e,y);for(let ee=0;ee<A.length;ee+=1)A[ee].m(e,null);l=!0},p(z,j){if((!l||j&1)&&u!==(u=z[0].charAt(0).toUpperCase()+z[0].slice(1)+"")&&Fi(f,u),j&508){T=z[2];let ee;for(ee=0;ee<T.length;ee+=1){const se=GI(z,T,ee);A[ee]?(A[ee].p(se,j),_t(A[ee],1)):(A[ee]=WI(se),A[ee].c(),_t(A[ee],1),A[ee].m(e,null))}for(gr(),ee=T.length;ee<A.length;ee+=1)R(ee);_r()}},i(z){if(!l){for(let j=0;j<T.length;j+=1)_t(A[j]);l=!0}},o(z){A=A.filter(Boolean);for(let j=0;j<A.length;j+=1)wt(A[j]);l=!1},d(z){z&&mt(e),e2(A,z)}}}function qI(i){let e,t;return e=new Pi({props:{to:"/viewad/"+i[2][i[26]],$$slots:{default:[U5]},$$scope:{ctx:i}}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p(r,u){const f={};u&4&&(f.to="/viewad/"+r[2][r[26]]),u&134218232&&(f.$$scope={dirty:u,ctx:r}),e.$set(f)},i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function U5(i){let e,t,r,u,f,y,l,T,A=i[8][i[26]]+"",R,z,j,ee,se=i[6][i[26]]+"",be,Re,Ge,it,dt=i[5][i[26]]+"",Ue,ge,Ke=new Date(i[7][i[26]]).toString().split("GMT")[0]+"",He,en,vt,Ft,Lt,kt=i[3][i[26]]+"",Qt,lt;return{c(){e=tt("div"),t=tt("div"),r=tt("img"),f=Dt(),y=tt("div"),l=tt("div"),T=tt("h2"),R=un(A),z=Dt(),j=tt("h2"),ee=un("$ "),be=un(se),Re=Dt(),Ge=tt("div"),it=tt("h4"),Ue=un(dt),ge=un(" | "),He=un(Ke),en=Dt(),vt=tt("div"),Ft=tt("h3"),Lt=un("Descripton : "),Qt=un(kt),lt=Dt(),mh(r.src,u=i[4][i[26]])||st(r,"src",u),st(r,"alt","ad img"),st(r,"class","svelte-um67s0"),st(t,"class","resultleft svelte-um67s0"),st(l,"class","resultrow svelte-um67s0"),st(Ge,"class","resultrow svelte-um67s0"),st(vt,"class","resultrow svelte-um67s0"),st(y,"class","resultright svelte-um67s0"),st(e,"class","result svelte-um67s0")},m(Xe,an){yt(Xe,e,an),Pe(e,t),Pe(t,r),Pe(e,f),Pe(e,y),Pe(y,l),Pe(l,T),Pe(T,R),Pe(l,z),Pe(l,j),Pe(j,ee),Pe(j,be),Pe(y,Re),Pe(y,Ge),Pe(Ge,it),Pe(it,Ue),Pe(it,ge),Pe(it,He),Pe(y,en),Pe(y,vt),Pe(vt,Ft),Pe(Ft,Lt),Pe(Ft,Qt),yt(Xe,lt,an)},p(Xe,an){an&16&&!mh(r.src,u=Xe[4][Xe[26]])&&st(r,"src",u),an&256&&A!==(A=Xe[8][Xe[26]]+"")&&Fi(R,A),an&64&&se!==(se=Xe[6][Xe[26]]+"")&&Fi(be,se),an&32&&dt!==(dt=Xe[5][Xe[26]]+"")&&Fi(Ue,dt),an&128&&Ke!==(Ke=new Date(Xe[7][Xe[26]]).toString().split("GMT")[0]+"")&&Fi(He,Ke),an&8&&kt!==(kt=Xe[3][Xe[26]]+"")&&Fi(Qt,kt)},d(Xe){Xe&&mt(e),Xe&&mt(lt)}}}function WI(i){let e,t,r=i[2][i[26]]!=null&&qI(i);return{c(){r&&r.c(),e=gl()},m(u,f){r&&r.m(u,f),yt(u,e,f),t=!0},p(u,f){u[2][u[26]]!=null?r?(r.p(u,f),f&4&&_t(r,1)):(r=qI(u),r.c(),_t(r,1),r.m(e.parentNode,e)):r&&(gr(),wt(r,1,1,()=>{r=null}),_r())},i(u){t||(_t(r),t=!0)},o(u){wt(r),t=!1},d(u){r&&r.d(u),u&&mt(e)}}}function V5(i){let e,t,r,u,f,y,l;yh(i[17]);function T(se,be){return se[10]>1e3?z5:L5}let A=T(i),R=A(i);const z=[N5,F5],j=[];function ee(se,be){return se[9]?0:1}return r=ee(i),u=j[r]=z[r](i),{c(){e=tt("div"),R.c(),t=Dt(),u.c(),st(e,"class","searchpage svelte-um67s0")},m(se,be){yt(se,e,be),R.m(e,null),Pe(e,t),j[r].m(e,null),f=!0,y||(l=Gn(window,"resize",i[17]),y=!0)},p(se,[be]){A===(A=T(se))&&R?R.p(se,be):(R.d(1),R=A(se),R&&(R.c(),R.m(e,t)));let Re=r;r=ee(se),r===Re?j[r].p(se,be):(gr(),wt(j[Re],1,1,()=>{j[Re]=null}),_r(),u=j[r],u?u.p(se,be):(u=j[r]=z[r](se),u.c()),_t(u,1),u.m(e,null))},i(se){f||(_t(u),f=!0)},o(se){wt(u),f=!1},d(se){se&&mt(e),R.d(),j[r].d(),y=!1,l()}}}function j5(i,e,t){let r;const u=Sp();Hr(i,u,Lt=>t(15,r=Lt));let{id:f}=e;var y=[],l=[],T=[],A=[],R=[],z=[],j=[],ee=[],se=[],be=[],Re=[],Ge=[],it=!1;wp(()=>dt());async function dt(){const{collection:Lt,query:kt,where:Qt,getDocs:lt}=await Yo(()=>import("./index.esm.8955433d.js"),[]),{db:Xe}=await Yo(()=>Promise.resolve().then(()=>Uk),void 0);console.log("searching..."),t(2,y=[]),l=[],T=[],A=[],t(3,R=[]),t(4,z=[]),t(5,j=[]),t(6,ee=[]),se=[],t(7,be=[]),t(8,Re=[]),Ge=[];const an=kt(Lt(Xe,"ads"),Qt("title","array-contains-any",[f.toLowerCase().replace(/^\s+/g,"")]));(await lt(an)).forEach(ni=>{const{description:ii,userid:rn,time:It,images:ri,adownerid:Tn,adowner:bi,location:et,tags:Nt,title:vn,adid:Hn,price:Vr,contact:wi}=ni.data();var ar="";for(let xn=0;xn<vn.length;xn++)vn[xn].charAt(0).toUpperCase()+vn[xn].slice(1),ar=ar+" "+vn[xn];y.includes(Hn)||y.length>10?console.log("Ad Already In Array!"):(y.push(Hn),l.push(bi),T.push(Tn),A.push(wi),R.push(ii),z.push(ri),j.push(et),ee.push(Vr),se.push(Nt),be.push(It),Re.push(ar),Ge.push(rn)),t(2,y),l=l,T=T,A=A,t(3,R),t(4,z),t(5,j),t(6,ee),se=se,t(7,be),t(8,Re),Ge=Ge}),t(9,it=!0)}async function Ue(){if(ee.length==1)return;await dt();const Lt=ee,kt=Math.min(...Lt),Qt=Lt.indexOf(kt.toString());console.log(kt,Qt);for(let lt=0;lt<y.length;lt++)lt!=Qt&&(t(2,y[lt]=null,y),l[lt]=null,T[lt]=null,A[lt]=null,t(3,R[lt]=null,R),t(4,z[lt]=null,z),t(5,j[lt]=null,j),t(6,ee[lt]=null,ee),se[lt]=null,t(7,be[lt]=null,be),t(8,Re[lt]=null,Re),Ge[lt]=null),t(2,y),l=l,T=T,A=A,t(3,R),t(4,z),t(5,j),t(6,ee),se=se,t(7,be),t(8,Re),Ge=Ge}async function ge(){if(ee.length==1)return;await dt();const Lt=ee;console.log(Lt);const kt=Math.max(...Lt),Qt=Lt.indexOf(kt.toString());console.log(kt,Qt);for(let lt=0;lt<y.length;lt++)lt!=Qt&&(t(2,y[lt]=null,y),l[lt]=null,T[lt]=null,A[lt]=null,t(3,R[lt]=null,R),t(4,z[lt]=null,z),t(5,j[lt]=null,j),t(6,ee[lt]=null,ee),se[lt]=null,t(7,be[lt]=null,be),t(8,Re[lt]=null,Re),Ge[lt]=null),t(2,y),l=l,T=T,A=A,t(3,R),t(4,z),t(5,j),t(6,ee),se=se,t(7,be),t(8,Re),Ge=Ge}let Ke=!1,He;function en(Lt){m_.call(this,i,Lt)}function vt(){t(10,He=window.innerWidth)}const Ft=()=>t(1,Ke=!Ke);return i.$$set=Lt=>{"id"in Lt&&t(0,f=Lt.id)},i.$$.update=()=>{i.$$.dirty&32768&&dt(),i.$$.dirty&2&&console.log(Ke)},[f,Ke,y,R,z,j,ee,be,Re,it,He,u,dt,Ue,ge,r,en,vt,Ft]}class G5 extends yl{constructor(e){super(),_l(this,e,j5,V5,ia,{id:0})}}var $5=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vk={exports:{}};(function(i,e){(function(t,r){i.exports=r()})($5,function(){var t,r,u;function f(l,T){if(!t)t=T;else if(!r)r=T;else{var A="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",R={};t(R),u=T(R),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}f(["exports"],function(l){var T=typeof self<"u"?self:{},A="2.11.1";let R;const z={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(R==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{R={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):s}catch{R=s}}return R},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},j={supported:!1,testSupport:function(s){!be&&se&&(Re?Ge(s):ee=s)}};let ee,se,be=!1,Re=!1;function Ge(s){const n=s.createTexture();s.bindTexture(s.TEXTURE_2D,n);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,se),s.isContextLost())return;j.supported=!0}catch{}s.deleteTexture(n),be=!0}T.document&&(se=T.document.createElement("img"),se.onload=function(){ee&&Ge(ee),ee=null,Re=!0},se.onerror=function(){be=!0,ee=null},se.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const it="01";var dt=Ue;function Ue(s,n,o,c){this.cx=3*s,this.bx=3*(o-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(c-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=n,this.p2x=o,this.p2y=c}Ue.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,n){if(n===void 0&&(n=1e-6),s<0)return 0;if(s>1)return 1;for(var o=s,c=0;c<8;c++){var d=this.sampleCurveX(o)-s;if(Math.abs(d)<n)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=d/m}var _=0,x=1;for(o=s,c=0;c<20&&(d=this.sampleCurveX(o),!(Math.abs(d-s)<n));c++)s>d?_=o:x=o,o=.5*(x-_)+_;return o},solve:function(s,n){return this.sampleCurveY(this.solveCurveX(s,n))}};var ge=Ke;function Ke(s,n){this.x=s,this.y=n}Ke.prototype={clone:function(){return new Ke(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,n){return this.clone()._rotateAround(s,n)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var n=s.x-this.x,o=s.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,n){return Math.atan2(this.x*n-this.y*s,this.x*s+this.y*n)},_matMult:function(s){var n=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=n,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var n=Math.cos(s),o=Math.sin(s),c=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=c,this},_rotateAround:function(s,n){var o=Math.cos(s),c=Math.sin(s),d=n.y+c*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-c*(this.y-n.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ke.convert=function(s){return s instanceof Ke?s:Array.isArray(s)?new Ke(s[0],s[1]):s};const He=Math.PI/180,en=180/Math.PI;function vt(s){return s*He}function Ft(s){return s*en}const Lt=[[0,0],[1,0],[1,1],[0,1]];function kt(s){if(s<=0)return 0;if(s>=1)return 1;const n=s*s,o=n*s;return 4*(s<.5?o:3*(s-n)+o-.75)}function Qt(s,n,o,c){const d=new dt(s,n,o,c);return function(m){return d.solve(m)}}const lt=Qt(.25,.1,.25,1);function Xe(s,n,o){return Math.min(o,Math.max(n,s))}function an(s,n,o){return(o=Xe((o-s)/(n-s),0,1))*o*(3-2*o)}function li(s,n,o){const c=o-n,d=((s-n)%c+c)%c+n;return d===n?o:d}function ni(s,n,o){if(!s.length)return o(null,[]);let c=s.length;const d=new Array(s.length);let m=null;s.forEach((_,x)=>{n(_,(w,E)=>{w&&(m=w),d[x]=E,--c==0&&o(m,d)})})}function ii(s){const n=[];for(const o in s)n.push(s[o]);return n}function rn(s,...n){for(const o of n)for(const c in o)s[c]=o[c];return s}let It=1;function ri(){return It++}function Tn(){return function s(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function bi(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function et(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Nt(s,n){s.forEach(o=>{n[o]&&(n[o]=n[o].bind(n))})}function vn(s,n){return s.indexOf(n,s.length-n.length)!==-1}function Hn(s,n,o){const c={};for(const d in s)c[d]=n.call(o||this,s[d],d,s);return c}function Vr(s,n,o){const c={};for(const d in s)n.call(o||this,s[d],d,s)&&(c[d]=s[d]);return c}function wi(s){return Array.isArray(s)?s.map(wi):typeof s=="object"&&s?Hn(s,wi):s}const ar={};function xn(s){ar[s]||(typeof console<"u"&&console.warn(s),ar[s]=!0)}function xr(s,n,o){return(o.y-s.y)*(n.x-s.x)>(n.y-s.y)*(o.x-s.x)}function mn(s){let n=0;for(let o,c,d=0,m=s.length,_=m-1;d<m;_=d++)o=s[d],c=s[_],n+=(c.x-o.x)*(o.y+c.y);return n}function br(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function $s(s){const n={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,c,d,m)=>{const _=d||m;return n[c]=!_||_.toLowerCase(),""}),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let jr=null;function As(s){if(jr==null){const n=s.navigator?s.navigator.userAgent:null;jr=!!s.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return jr}function qs(s){try{const n=T[s];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}function Jr(s,n){return[s[4*n],s[4*n+1],s[4*n+2],s[4*n+3]]}const So="mapbox-tiles";let lr,Ws,ha=500,Il=50;function da(){try{return T.caches}catch{}}function Zs(){da()&&!lr&&(lr=T.caches.open(So))}function Sl(s){const n=s.indexOf("?");if(n<0)return s;const o=function(d){const m=d.indexOf("?");return m>0?d.slice(m+1).split("&"):[]}(s),c=o.filter(d=>{const m=d.split("=");return m[0]==="language"||m[0]==="worldview"});return c.length?`${s.slice(0,n)}?${c.join("&")}`:s.slice(0,n)}let fa=1/0;const Rr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Rr);class Al extends Error{constructor(n,o,c){o===401&&ya(c)&&(n+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pa=br()?()=>self.worker&&self.worker.referrer:()=>(T.location.protocol==="blob:"?T.parent:T).location.href,Hs=function(s,n){if(!(/^file:/.test(o=s.url)||/^file:/.test(pa())&&!/^\w+:/.test(o))){if(T.fetch&&T.Request&&T.AbortController&&T.Request.prototype.hasOwnProperty("signal"))return function(c,d){const m=new T.AbortController,_=new T.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:pa(),signal:m.signal});let x=!1,w=!1;const E=(S=_.url).indexOf("sku=")>0&&ya(S);var S;c.type==="json"&&_.headers.set("Accept","application/json");const M=(O,B,U)=>{if(w)return;if(O&&O.message!=="SecurityError"&&xn(O),B&&U)return D(B);const $=Date.now();T.fetch(_).then(ne=>{if(ne.ok){const ue=E?ne.clone():null;return D(ne,ue,$)}return d(new Al(ne.statusText,ne.status,c.url))}).catch(ne=>{ne.code!==20&&d(new Error(ne.message))})},D=(O,B,U)=>{(c.type==="arrayBuffer"?O.arrayBuffer():c.type==="json"?O.json():O.text()).then($=>{w||(B&&U&&function(ne,ue,te){if(Zs(),!lr)return;const oe={status:ue.status,statusText:ue.statusText,headers:new T.Headers};ue.headers.forEach((Se,Ee)=>oe.headers.set(Ee,Se));const fe=$s(ue.headers.get("Cache-Control")||"");if(fe["no-store"])return;fe["max-age"]&&oe.headers.set("Expires",new Date(te+1e3*fe["max-age"]).toUTCString());const ae=oe.headers.get("Expires");ae&&(new Date(ae).getTime()-te<42e4||function(Se,Ee){if(Ws===void 0)try{new Response(new ReadableStream),Ws=!0}catch{Ws=!1}Ws?Ee(Se.body):Se.blob().then(Ee)}(ue,Se=>{const Ee=new T.Response(Se,oe);Zs(),lr&&lr.then(Le=>Le.put(Sl(ne.url),Ee)).catch(Le=>xn(Le.message))}))}(_,B,U),x=!0,d(null,$,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch($=>{w||d(new Error($.message))})};return E?function(O,B){if(Zs(),!lr)return B(null);const U=Sl(O.url);lr.then($=>{$.match(U).then(ne=>{const ue=function(te){if(!te)return!1;const oe=new Date(te.headers.get("Expires")||0),fe=$s(te.headers.get("Cache-Control")||"");return oe>Date.now()&&!fe["no-cache"]}(ne);$.delete(U),ue&&$.put(U,ne.clone()),B(null,ne,ue)}).catch(B)}).catch(B)}(_,M):M(null,null),{cancel:()=>{w=!0,x||m.abort()}}}(s,n);if(br()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,n,void 0,!0)}var o;return function(c,d){const m=new T.XMLHttpRequest;m.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const _ in c.headers)m.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=c.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let _=m.response;if(c.type==="json")try{_=JSON.parse(m.response)}catch(x){return d(x)}d(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else d(new Al(m.statusText,m.status,c.url))},m.send(c.body),{cancel:()=>m.abort()}}(s,n)},Xs=function(s,n){return Hs(rn(s,{type:"arrayBuffer"}),n)};function Cl(s){const n=T.document.createElement("a");return n.href=s,n.protocol===T.document.location.protocol&&n.host===T.document.location.host}const Hc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ma,Ks;ma=[],Ks=0;const ga=function(s,n){if(j.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Ks>=z.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:s,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return ma.push(m),m}Ks++;let o=!1;const c=()=>{if(!o)for(o=!0,Ks--;ma.length&&Ks<z.MAX_PARALLEL_IMAGE_REQUESTS;){const m=ma.shift(),{requestParameters:_,callback:x,cancelled:w}=m;w||(m.cancel=ga(_,x).cancel)}},d=Xs(s,(m,_,x,w)=>{c(),m?n(m):_&&(T.createImageBitmap?function(E,S){const M=new T.Blob([new Uint8Array(E)],{type:"image/png"});T.createImageBitmap(M).then(D=>{S(null,D)}).catch(D=>{S(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(E,S)=>n(E,S,x,w)):function(E,S){const M=new T.Image,D=T.URL;M.onload=()=>{S(null,M),D.revokeObjectURL(M.src),M.onload=null,T.requestAnimationFrame(()=>{M.src=Hc})},M.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new T.Blob([new Uint8Array(E)],{type:"image/png"});M.src=E.byteLength?D.createObjectURL(O):Hc}(_,(E,S)=>n(E,S,x,w)))});return{cancel:()=>{d.cancel(),c()}}},_a="NO_ACCESS_TOKEN";function es(s){return s.indexOf("mapbox:")===0}function ya(s){return z.API_URL_REGEX.test(s)}function Xc(s){return z.API_STYLE_REGEX.test(s)&&!va(s)}function va(s){return z.API_SPRITE_REGEX.test(s)}const xa=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function wr(s){const n=s.match(xa);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Ao(s){const n=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${n}`}function kl(s){if(!s)return null;const n=s.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(T.atob(n[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Co{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const o=kl(z.ACCESS_TOKEN);let c="";return c=o&&o.u?T.btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(d,m)=>String.fromCharCode(Number("0x"+m)))):z.ACCESS_TOKEN||"",n?`mapbox.eventData.${n}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const n=qs("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid");if(n)try{const d=T.localStorage.getItem(o);d&&(this.eventData=JSON.parse(d));const m=T.localStorage.getItem(c);m&&(this.anonId=m)}catch{xn("Unable to read from LocalStorage")}}saveEventData(){const n=qs("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid");if(n)try{T.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&T.localStorage.setItem(o,JSON.stringify(this.eventData))}catch{xn("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,o,c,d){if(!z.EVENTS_URL)return;const m=wr(z.EVENTS_URL);m.params.push(`access_token=${d||z.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(n).toISOString()},x=o?rn(_,o):_,w={url:Ao(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=function(E,S){return Hs(rn(E,{method:"POST"}),S)}(w,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(d)})}queueRequest(n,o){this.queue.push(n),this.processRequests(o)}}const J=new class extends Co{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,n){z.EVENTS_URL&&z.ACCESS_TOKEN&&Array.isArray(s)&&s.some(o=>es(o)||ya(o))&&this.queueRequest(Date.now(),n)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=kl(z.ACCESS_TOKEN),o=n?n.u:z.ACCESS_TOKEN;let c=o!==this.eventData.tokenU;et(this.anonId)||(this.anonId=Tn(),c=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(d),x=(d-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||m.getDate()!==_.getDate()}else c=!0;c?this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:it,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=d,this.eventData.tokenU=o)},s):this.processRequests()}},F=J.postTurnstileEvent.bind(J),V=new class extends Co{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,n,o,c){this.skuToken=n,this.errorCb=c,z.EVENTS_URL&&(o||z.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},o):this.errorCb(new Error(_a)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),et(this.anonId)||(this.anonId=Tn()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:it,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):n&&(this.success[n]=!0)},s))}},Y=V.postMapLoadEvent.bind(V),re=new class extends Co{constructor(){super("gljs.performance")}postPerformanceEvent(s,n){z.EVENTS_URL&&(s||z.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:o}=this.queue.shift(),c=function(d){const m=T.performance.getEntriesByType("resource"),_=T.performance.getEntriesByType("mark"),x=function(D){const O={};if(D){for(const B in D)if(B!=="other")for(const U of D[B]){const $=`${B}RequestCount`,ne=`${B}ResolveRangeMin`,ue=`${B}ResolveRangeMax`;O[ne]=Math.min(O[ne]||1/0,U.startTime),O[ue]=Math.max(O[ue]||-1/0,U.responseEnd),O[$]===void 0&&(O[$]=0),++O[$]}}return O}(function(D,O){const B={};if(D)for(const U of D){const $=O(U);B[$]===void 0&&(B[$]=[]),B[$].push(U)}return B}(m,pt)),w=T.devicePixelRatio,E=T.navigator.connection||T.navigator.mozConnection||T.navigator.webkitConnection,S={counters:[],metadata:[],attributes:[]},M=(D,O,B)=>{B!=null&&D.push({name:O,value:B.toString()})};for(const D in x)M(S.counters,D,x[D]);if(d.interactionRange[0]!==1/0&&d.interactionRange[1]!==-1/0&&(M(S.counters,"interactionRangeMin",d.interactionRange[0]),M(S.counters,"interactionRangeMax",d.interactionRange[1])),_)for(const D of Object.keys(Te)){const O=Te[D],B=_.find(U=>U.name===O);B&&M(S.counters,O,B.startTime)}return M(S.counters,"visibilityHidden",d.visibilityHidden),M(S.attributes,"style",function(D){if(D)for(const O of D){const B=O.name.split("?")[0];if(Xc(B)){const U=B.split("/").slice(-2);if(U.length===2)return`mapbox://styles/${U[0]}/${U[1]}`}}}(m)),M(S.attributes,"terrainEnabled",d.terrainEnabled?"true":"false"),M(S.attributes,"fogEnabled",d.fogEnabled?"true":"false"),M(S.attributes,"projection",d.projection.name),M(S.attributes,"zoom",d.zoom),M(S.metadata,"devicePixelRatio",w),M(S.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),M(S.metadata,"navigatorUserAgent",T.navigator.userAgent),M(S.metadata,"screenWidth",T.screen.width),M(S.metadata,"screenHeight",T.screen.height),M(S.metadata,"windowWidth",T.innerWidth),M(S.metadata,"windowHeight",T.innerHeight),M(S.metadata,"mapWidth",d.width/w),M(S.metadata,"mapHeight",d.height/w),M(S.metadata,"webglRenderer",d.renderer),M(S.metadata,"webglVendor",d.vendor),M(S.metadata,"sdkVersion",A),M(S.metadata,"sdkIdentifier","mapbox-gl-js"),S}(o);for(const d of c.metadata);for(const d of c.counters);for(const d of c.attributes);this.postEvent(n,c,()=>{},s)}},de=re.postPerformanceEvent.bind(re),ve=new class extends Co{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,n,o,c){if(!z.API_URL||!z.SESSION_PATH)return;const d=wr(z.API_URL+z.SESSION_PATH);d.params.push(`sku=${n||""}`),d.params.push(`access_token=${c||z.ACCESS_TOKEN||""}`);const m={url:Ao(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(_,x){return Hs(rn(_,{method:"GET"}),x)}(m,_=>{this.pendingRequest=null,o(_),this.saveEventData(),this.processRequests(c)})}getSessionAPI(s,n,o,c){this.skuToken=n,this.errorCb=c,z.SESSION_PATH&&z.API_URL&&(o||z.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},o):this.errorCb(new Error(_a)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||this.getSession(o,this.skuToken,c=>{c?this.errorCb(c):n&&(this.success[n]=!0)},s)}},ye=ve.getSessionAPI.bind(ve),pe=new Set,Te={create:"create",load:"load",fullLoad:"fullLoad"},Ve={mark(s){T.performance.mark(s)},measure(s,n,o){T.performance.measure(s,n,o)}};function pt(s){const n=s.name.split("?")[0];return n.includes("mapbox-gl.js")?"javascript":n.includes("mapbox-gl.css")?"css":function(o){return z.API_FONTS_REGEX.test(o)}(n)?"fontRange":va(n)?"sprite":Xc(n)?"style":function(o){return z.API_TILEJSON_REGEX.test(o)}(n)?"tilejson":"other"}const $e=T.performance;function zt(s){const n=s?s.url.toString():void 0;return $e.getEntriesByName(n)}let Rt,Mt,Wt,sn;const Sn={now:()=>Wt!==void 0?Wt:T.performance.now(),setNow(s){Wt=s},restoreNow(){Wt=void 0},frame(s){const n=T.requestAnimationFrame(s);return{cancel:()=>T.cancelAnimationFrame(n)}},getImageData(s,n=0){const{width:o,height:c}=s;sn||(sn=T.document.createElement("canvas"));const d=sn.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return(o>sn.width||c>sn.height)&&(sn.width=o,sn.height=c),d.clearRect(-n,-n,o+2*n,c+2*n),d.drawImage(s,0,0,o,c),d.getImageData(-n,-n,o+2*n,c+2*n)},resolveURL:s=>(Rt||(Rt=T.document.createElement("a")),Rt.href=s,Rt.href),get devicePixelRatio(){return T.devicePixelRatio},get prefersReducedMotion(){return!!T.matchMedia&&(Mt==null&&(Mt=T.matchMedia("(prefers-reduced-motion: reduce)")),Mt.matches)}};function Ut(s,n,o){o[s]&&o[s].indexOf(n)!==-1||(o[s]=o[s]||[],o[s].push(n))}function Bn(s,n,o){if(o&&o[s]){const c=o[s].indexOf(n);c!==-1&&o[s].splice(c,1)}}class Fn{constructor(n,o={}){rn(this,o),this.type=n}}class Ys extends Fn{constructor(n,o={}){super("error",rn({error:n},o))}}class Cs{on(n,o){return this._listeners=this._listeners||{},Ut(n,o,this._listeners),this}off(n,o){return Bn(n,o,this._listeners),Bn(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Ut(n,o,this._oneTimeListeners),this):new Promise(c=>this.once(n,c))}fire(n,o){typeof n=="string"&&(n=new Fn(n,o||{}));const c=n.type;if(this.listens(c)){n.target=this;const d=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of d)x.call(this,n);const m=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of m)Bn(c,x,this._oneTimeListeners),x.call(this,n);const _=this._eventedParent;_&&(rn(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(n))}else n instanceof Ys&&console.error(n.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}var De=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ks(s,...n){for(const o of n)for(const c in o)s[c]=o[c];return s}function gi(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Qs(s){if(Array.isArray(s))return s.map(Qs);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const n={};for(const o in s)n[o]=Qs(s[o]);return n}return gi(s)}class nm extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}var ds=nm;class ba{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[c,d]of o)this.bindings[c]=d}concat(n){return new ba(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}var im=ba;const wa={kind:"null"},ht={kind:"number"},on={kind:"string"},ln={kind:"boolean"},fs={kind:"color"},Ta={kind:"object"},cn={kind:"value"},Ml={kind:"collator"},Ea={kind:"formatted"},Ia={kind:"resolvedImage"};function Lr(s,n){return{kind:"array",itemType:s,N:n}}function Qn(s){if(s.kind==="array"){const n=Qn(s.itemType);return typeof s.N=="number"?`array<${n}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${n}>`}return s.kind}const By=[wa,ht,on,ln,fs,Ea,Ta,Lr(cn),Ia];function ts(s,n){if(n.kind==="error")return null;if(s.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!ts(s.itemType,n.itemType))&&(typeof s.N!="number"||s.N===n.N))return null}else{if(s.kind===n.kind)return null;if(s.kind==="value"){for(const o of By)if(!ts(o,n))return null}}return`Expected ${Qn(s)} but found ${Qn(n)} instead.`}function Kc(s,n){return n.some(o=>o.kind===s.kind)}function Tr(s,n){return n.some(o=>o==="null"?s===null:o==="array"?Array.isArray(s):o==="object"?s&&!Array.isArray(s)&&typeof s=="object":o===typeof s)}var Yh,Yc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Qc(s){return(s=Math.round(s))<0?0:s>255?255:s}function Dl(s){return Qc(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function Pl(s){return(n=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:n>1?1:n;var n}function ko(s,n,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?s+(n-s)*o*6:2*o<1?n:3*o<2?s+(n-s)*(2/3-o)*6:s}try{Yh={}.parseCSSColor=function(s){var n,o=s.replace(/ /g,"").toLowerCase();if(o in Yc)return Yc[o].slice();if(o[0]==="#")return o.length===4?(n=parseInt(o.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:o.length===7&&(n=parseInt(o.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var c=o.indexOf("("),d=o.indexOf(")");if(c!==-1&&d+1===o.length){var m=o.substr(0,c),_=o.substr(c+1,d-(c+1)).split(","),x=1;switch(m){case"rgba":if(_.length!==4)return null;x=Pl(_.pop());case"rgb":return _.length!==3?null:[Dl(_[0]),Dl(_[1]),Dl(_[2]),x];case"hsla":if(_.length!==4)return null;x=Pl(_.pop());case"hsl":if(_.length!==3)return null;var w=(parseFloat(_[0])%360+360)%360/360,E=Pl(_[1]),S=Pl(_[2]),M=S<=.5?S*(E+1):S+E-S*E,D=2*S-M;return[Qc(255*ko(D,M,w+1/3)),Qc(255*ko(D,M,w)),Qc(255*ko(D,M,w-1/3)),x];default:return null}}return null}}catch{}class Yi{constructor(n,o,c,d=1){this.r=n,this.g=o,this.b=c,this.a=d}static parse(n){if(!n)return;if(n instanceof Yi)return n;if(typeof n!="string")return;const o=Yh(n);return o?new Yi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[n,o,c,d]=this.toArray();return`rgba(${Math.round(n)},${Math.round(o)},${Math.round(c)},${d})`}toArray(){const{r:n,g:o,b:c,a:d}=this;return d===0?[0,0,0,0]:[255*n/d,255*o/d,255*c/d,d]}toArray01(){const{r:n,g:o,b:c,a:d}=this;return d===0?[0,0,0,0]:[n/d,o/d,c/d,d]}toArray01PremultipliedAlpha(){const{r:n,g:o,b:c,a:d}=this;return[n,o,c,d]}}Yi.black=new Yi(0,0,0,1),Yi.white=new Yi(1,1,1,1),Yi.transparent=new Yi(0,0,0,0),Yi.red=new Yi(1,0,0,1),Yi.blue=new Yi(0,0,1,1);var di=Yi;class Qh{constructor(n,o,c){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Jh{constructor(n,o,c,d,m){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=c,this.fontStack=d,this.textColor=m}}class cr{constructor(n){this.sections=n}static fromString(n){return new cr([new Jh(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof cr?n:cr.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){n.push(["image",o.image.name]);continue}n.push(o.text);const c={};o.fontStack&&(c["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(c["font-scale"]=o.scale),o.textColor&&(c["text-color"]=["rgba"].concat(o.textColor.toArray())),n.push(c)}return n}}class Er{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Er({name:n,available:!1}):null}serialize(){return["image",this.name]}}function rm(s,n,o,c){return typeof s=="number"&&s>=0&&s<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[s,n,o,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[s,n,o,c]:[s,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Mo(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof di||s instanceof Qh||s instanceof cr||s instanceof Er)return!0;if(Array.isArray(s)){for(const n of s)if(!Mo(n))return!1;return!0}if(typeof s=="object"){for(const n in s)if(!Mo(s[n]))return!1;return!0}return!1}function Ti(s){if(s===null)return wa;if(typeof s=="string")return on;if(typeof s=="boolean")return ln;if(typeof s=="number")return ht;if(s instanceof di)return fs;if(s instanceof Qh)return Ml;if(s instanceof cr)return Ea;if(s instanceof Er)return Ia;if(Array.isArray(s)){const n=s.length;let o;for(const c of s){const d=Ti(c);if(o){if(o===d)continue;o=cn;break}o=d}return Lr(o||cn,n)}return Ta}function Rl(s){const n=typeof s;return s===null?"":n==="string"||n==="number"||n==="boolean"?String(s):s instanceof di||s instanceof cr||s instanceof Er?s.toString():JSON.stringify(s)}class ed{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Mo(n[1]))return o.error("invalid value");const c=n[1];let d=Ti(c);const m=o.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new ed(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof di?["rgba"].concat(this.value.toArray()):this.value instanceof cr?this.value.serialize():this.value}}var Ll=ed,Ui=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const td={string:on,number:ht,boolean:ln,object:Ta};class nd{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let c,d=1;const m=n[0];if(m==="array"){let x,w;if(n.length>2){const E=n[1];if(typeof E!="string"||!(E in td)||E==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=td[E],d++}else x=cn;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);w=n[2],d++}c=Lr(x,w)}else c=td[m];const _=[];for(;d<n.length;d++){const x=o.parse(n[d],d,cn);if(!x)return null;_.push(x)}return new nd(c,_)}evaluate(n){for(let o=0;o<this.args.length;o++){const c=this.args[o].evaluate(n);if(!ts(this.type,Ti(c)))return c;if(o===this.args.length-1)throw new Ui(`Expected value to be of type ${Qn(this.type)}, but found ${Qn(Ti(c))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const c=n.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){o.push(c.kind);const d=n.N;(typeof d=="number"||this.args.length>1)&&o.push(d)}}return o.concat(this.args.map(c=>c.serialize()))}}var ps=nd;class Js{constructor(n){this.type=Ea,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const c=n[1];if(!Array.isArray(c)&&typeof c=="object")return o.error("First argument must be an image or text section.");const d=[];let m=!1;for(let _=1;_<=n.length-1;++_){const x=n[_];if(m&&typeof x=="object"&&!Array.isArray(x)){m=!1;let w=null;if(x["font-scale"]&&(w=o.parse(x["font-scale"],1,ht),!w))return null;let E=null;if(x["text-font"]&&(E=o.parse(x["text-font"],1,Lr(on)),!E))return null;let S=null;if(x["text-color"]&&(S=o.parse(x["text-color"],1,fs),!S))return null;const M=d[d.length-1];M.scale=w,M.font=E,M.textColor=S}else{const w=o.parse(n[_],1,cn);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:w,scale:null,font:null,textColor:null})}}return new Js(d)}evaluate(n){return new cr(this.sections.map(o=>{const c=o.content.evaluate(n);return Ti(c)===Ia?new Jh("",c,null,null,null):new Jh(Rl(c),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const c={};o.scale&&(c["font-scale"]=o.scale.serialize()),o.font&&(c["text-font"]=o.font.serialize()),o.textColor&&(c["text-color"]=o.textColor.serialize()),n.push(c)}return n}}class Jc{constructor(n){this.type=Ia,this.input=n}static parse(n,o){if(n.length!==2)return o.error("Expected two arguments.");const c=o.parse(n[1],1,on);return c?new Jc(c):o.error("No image name provided.")}evaluate(n){const o=this.input.evaluate(n),c=Er.fromString(o);return c&&n.availableImages&&(c.available=n.availableImages.indexOf(o)>-1),c}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Fy={"to-boolean":ln,"to-color":fs,"to-number":ht,"to-string":on};class id{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const c=n[0];if((c==="to-boolean"||c==="to-string")&&n.length!==2)return o.error("Expected one argument.");const d=Fy[c],m=[];for(let _=1;_<n.length;_++){const x=o.parse(n[_],_,cn);if(!x)return null;m.push(x)}return new id(d,m)}evaluate(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){let o,c;for(const d of this.args){if(o=d.evaluate(n),c=null,o instanceof di)return o;if(typeof o=="string"){const m=n.parseColor(o);if(m)return m}else if(Array.isArray(o)&&(c=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:rm(o[0],o[1],o[2],o[3]),!c))return new di(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ui(c||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const c of this.args){if(o=c.evaluate(n),o===null)return 0;const d=Number(o);if(!isNaN(d))return d}throw new Ui(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?cr.fromString(Rl(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?Er.fromString(Rl(this.args[0].evaluate(n))):Rl(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Js([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Jc(this.args[0]).serialize();const n=[`to-${this.type.kind}`];return this.eachChild(o=>{n.push(o.serialize())}),n}}var Sa=id;const Ny=["Unknown","Point","LineString","Polygon"];var sm=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ny[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:o,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*n-s[0])+this.featureDistanceData.bearing[1]*(c*n-s[1])}return 0}parseColor(s){let n=this._parseColorCache[s];return n||(n=this._parseColorCache[s]=di.parse(s)),n}};class Do{constructor(n,o,c,d){this.name=n,this.type=o,this._evaluate=c,this.args=d}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,o){const c=n[0],d=Do.definitions[c];if(!d)return o.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,x=_.filter(([E])=>!Array.isArray(E)||E.length===n.length-1);let w=null;for(const[E,S]of x){w=new hd(o.registry,o.path,null,o.scope);const M=[];let D=!1;for(let O=1;O<n.length;O++){const B=n[O],U=Array.isArray(E)?E[O-1]:E.type,$=w.parse(B,1+M.length,U);if(!$){D=!0;break}M.push($)}if(!D)if(Array.isArray(E)&&E.length!==M.length)w.error(`Expected ${E.length} arguments, but found ${M.length} instead.`);else{for(let O=0;O<M.length;O++){const B=Array.isArray(E)?E[O]:E.type,U=M[O];w.concat(O+1).checkSubtype(B,U.type)}if(w.errors.length===0)return new Do(c,m,S,M)}}if(x.length===1)o.errors.push(...w.errors);else{const E=(x.length?x:_).map(([M])=>{return D=M,Array.isArray(D)?`(${D.map(Qn).join(", ")})`:`(${Qn(D.type)}...)`;var D}).join(" | "),S=[];for(let M=1;M<n.length;M++){const D=o.parse(n[M],1+S.length);if(!D)return null;S.push(Qn(D.type))}o.error(`Expected arguments of type ${E}, but found (${S.join(", ")}) instead.`)}return null}static register(n,o){Do.definitions=o;for(const c in o)n[c]=Do}}var ns=Do;class eu{constructor(n,o,c){this.type=Ml,this.locale=c,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const c=n[1];if(typeof c!="object"||Array.isArray(c))return o.error("Collator options argument must be an object.");const d=o.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,ln);if(!d)return null;const m=o.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,ln);if(!m)return null;let _=null;return c.locale&&(_=o.parse(c.locale,1,on),!_)?null:new eu(d,m,_)}evaluate(n){return new Qh(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}const eo=8192;function rd(s,n){s[0]=Math.min(s[0],n[0]),s[1]=Math.min(s[1],n[1]),s[2]=Math.max(s[2],n[0]),s[3]=Math.max(s[3],n[1])}function tu(s,n){return!(s[0]<=n[0]||s[2]>=n[2]||s[1]<=n[1]||s[3]>=n[3])}function ms(s,n){const o=(180+s[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,d=Math.pow(2,n.z);return[Math.round(o*d*eo),Math.round(c*d*eo)]}function om(s,n,o){const c=s[0]-n[0],d=s[1]-n[1],m=s[0]-o[0],_=s[1]-o[1];return c*_-m*d==0&&c*m<=0&&d*_<=0}function nu(s,n){let o=!1;for(let _=0,x=n.length;_<x;_++){const w=n[_];for(let E=0,S=w.length;E<S-1;E++){if(om(s,w[E],w[E+1]))return!1;(d=w[E])[1]>(c=s)[1]!=(m=w[E+1])[1]>c[1]&&c[0]<(m[0]-d[0])*(c[1]-d[1])/(m[1]-d[1])+d[0]&&(o=!o)}}var c,d,m;return o}function am(s,n){for(let o=0;o<n.length;o++)if(nu(s,n[o]))return!0;return!1}function sd(s,n,o,c){const d=c[0]-o[0],m=c[1]-o[1],_=(s[0]-o[0])*m-d*(s[1]-o[1]),x=(n[0]-o[0])*m-d*(n[1]-o[1]);return _>0&&x<0||_<0&&x>0}function lm(s,n,o){for(const E of o)for(let S=0;S<E.length-1;++S)if((x=[(_=E[S+1])[0]-(m=E[S])[0],_[1]-m[1]])[0]*(w=[(d=n)[0]-(c=s)[0],d[1]-c[1]])[1]-x[1]*w[0]!=0&&sd(c,d,m,_)&&sd(m,_,c,d))return!0;var c,d,m,_,x,w;return!1}function od(s,n){for(let o=0;o<s.length;++o)if(!nu(s[o],n))return!1;for(let o=0;o<s.length-1;++o)if(lm(s[o],s[o+1],n))return!1;return!0}function ad(s,n){for(let o=0;o<n.length;o++)if(od(s,n[o]))return!0;return!1}function Po(s,n,o){const c=[];for(let d=0;d<s.length;d++){const m=[];for(let _=0;_<s[d].length;_++){const x=ms(s[d][_],o);rd(n,x),m.push(x)}c.push(m)}return c}function ld(s,n,o){const c=[];for(let d=0;d<s.length;d++){const m=Po(s[d],n,o);c.push(m)}return c}function cd(s,n,o,c){if(s[0]<o[0]||s[0]>o[2]){const d=.5*c;let m=s[0]-o[0]>d?-c:o[0]-s[0]>d?c:0;m===0&&(m=s[0]-o[2]>d?-c:o[2]-s[0]>d?c:0),s[0]+=m}rd(n,s)}function iu(s,n,o,c){const d=Math.pow(2,c.z)*eo,m=[c.x*eo,c.y*eo],_=[];if(!s)return _;for(const x of s)for(const w of x){const E=[w.x+m[0],w.y+m[1]];cd(E,n,o,d),_.push(E)}return _}function ud(s,n,o,c){const d=Math.pow(2,c.z)*eo,m=[c.x*eo,c.y*eo],_=[];if(!s)return _;for(const w of s){const E=[];for(const S of w){const M=[S.x+m[0],S.y+m[1]];rd(n,M),E.push(M)}_.push(E)}if(n[2]-n[0]<=d/2){(x=n)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of _)for(const E of w)cd(E,n,o,d)}var x;return _}class gs{constructor(n,o){this.type=ln,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Mo(n[1])){const c=n[1];if(c.type==="FeatureCollection")for(let d=0;d<c.features.length;++d){const m=c.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new gs(c,c.features[d].geometry)}else if(c.type==="Feature"){const d=c.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new gs(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new gs(c,c)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,c){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const x=Po(c.coordinates,m,_),w=iu(o.geometry(),d,m,_);if(!tu(d,m))return!1;for(const E of w)if(!nu(E,x))return!1}if(c.type==="MultiPolygon"){const x=ld(c.coordinates,m,_),w=iu(o.geometry(),d,m,_);if(!tu(d,m))return!1;for(const E of w)if(!am(E,x))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,c){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const x=Po(c.coordinates,m,_),w=ud(o.geometry(),d,m,_);if(!tu(d,m))return!1;for(const E of w)if(!od(E,x))return!1}if(c.type==="MultiPolygon"){const x=ld(c.coordinates,m,_),w=ud(o.geometry(),d,m,_);if(!tu(d,m))return!1;for(const E of w)if(!ad(E,x))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var An=gs;function zl(s){if(s instanceof ns&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof An)return!1;let n=!0;return s.eachChild(o=>{n&&!zl(o)&&(n=!1)}),n}function ru(s){if(s instanceof ns&&s.name==="feature-state")return!1;let n=!0;return s.eachChild(o=>{n&&!ru(o)&&(n=!1)}),n}function su(s,n){if(s instanceof ns&&n.indexOf(s.name)>=0)return!1;let o=!0;return s.eachChild(c=>{o&&!su(c,n)&&(o=!1)}),o}class ou{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const c=n[1];return o.scope.has(c)?new ou(c,o.scope.get(c)):o.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var cm=ou;class au{constructor(n,o=[],c,d=new im,m=[]){this.registry=n,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=d,this.errors=m,this.expectedType=c}parse(n,o,c,d,m={}){return o?this.concat(o,c,d)._parse(n,m):this._parse(n,m)}_parse(n,o){function c(d,m,_){return _==="assert"?new ps(m,[d]):_==="coerce"?new Sa(m,[d]):d}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=n[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let _=m.parse(n,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,w=_.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||w.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(x,w))return null}else _=c(_,x,o.typeAnnotation||"coerce");else _=c(_,x,o.typeAnnotation||"assert")}if(!(_ instanceof Ll)&&_.type.kind!=="resolvedImage"&&lu(_)){const x=new sm;try{_=new Ll(_.type,_.evaluate(x))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,c){const d=typeof n=="number"?this.path.concat(n):this.path,m=c?this.scope.concat(c):this.scope;return new au(this.registry,d,o||null,m,this.errors)}error(n,...o){const c=`${this.key}${o.map(d=>`[${d}]`).join("")}`;this.errors.push(new ds(c,n))}checkSubtype(n,o){const c=ts(n,o);return c&&this.error(c),c}}var hd=au;function lu(s){if(s instanceof cm)return lu(s.boundExpression);if(s instanceof ns&&s.name==="error"||s instanceof eu||s instanceof An)return!1;const n=s instanceof Sa||s instanceof ps;let o=!0;return s.eachChild(c=>{o=n?o&&lu(c):o&&c instanceof Ll}),!!o&&zl(s)&&su(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ol(s,n){const o=s.length-1;let c,d,m=0,_=o,x=0;for(;m<=_;)if(x=Math.floor((m+_)/2),c=s[x],d=s[x+1],c<=n){if(x===o||n<d)return x;m=x+1}else{if(!(c>n))throw new Ui("Input is not a number.");_=x-1}return 0}class to{constructor(n,o,c){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[d,m]of c)this.labels.push(d),this.outputs.push(m)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const c=o.parse(n[1],1,ht);if(!c)return null;const d=[];let m=null;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);for(let _=1;_<n.length;_+=2){const x=_===1?-1/0:n[_],w=n[_+1],E=_,S=_+1;if(typeof x!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(d.length&&d[d.length-1][0]>=x)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const M=o.parse(w,S,m);if(!M)return null;m=m||M.type,d.push([x,M])}return new to(m,c,d)}evaluate(n){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(n);const d=this.input.evaluate(n);if(d<=o[0])return c[0].evaluate(n);const m=o.length;return d>=o[m-1]?c[m-1].evaluate(n):c[Ol(o,d)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}var Aa=to;function En(s,n,o){return s*(1-o)+n*o}var Ca=Object.freeze({__proto__:null,number:En,color:function(s,n,o){return new di(En(s.r,n.r,o),En(s.g,n.g,o),En(s.b,n.b,o),En(s.a,n.a,o))},array:function(s,n,o){return s.map((c,d)=>En(c,n[d],o))}});const dd=.95047,um=1.08883,hm=4/29,cu=6/29,dm=3*cu*cu,fm=Math.PI/180,pm=180/Math.PI;function fd(s){return s>.008856451679035631?Math.pow(s,1/3):s/dm+hm}function uu(s){return s>cu?s*s*s:dm*(s-hm)}function pd(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function hu(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function md(s){const n=hu(s.r),o=hu(s.g),c=hu(s.b),d=fd((.4124564*n+.3575761*o+.1804375*c)/dd),m=fd((.2126729*n+.7151522*o+.072175*c)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-fd((.0193339*n+.119192*o+.9503041*c)/um)),alpha:s.a}}function mm(s){let n=(s.l+16)/116,o=isNaN(s.a)?n:n+s.a/500,c=isNaN(s.b)?n:n-s.b/200;return n=1*uu(n),o=dd*uu(o),c=um*uu(c),new di(pd(3.2404542*o-1.5371385*n-.4985314*c),pd(-.969266*o+1.8760108*n+.041556*c),pd(.0556434*o-.2040259*n+1.0572252*c),s.alpha)}function Uy(s,n,o){const c=n-s;return s+o*(c>180||c<-180?c-360*Math.round(c/360):c)}const Bl={forward:md,reverse:mm,interpolate:function(s,n,o){return{l:En(s.l,n.l,o),a:En(s.a,n.a,o),b:En(s.b,n.b,o),alpha:En(s.alpha,n.alpha,o)}}},Fl={forward:function(s){const{l:n,a:o,b:c}=md(s),d=Math.atan2(c,o)*pm;return{h:d<0?d+360:d,c:Math.sqrt(o*o+c*c),l:n,alpha:s.a}},reverse:function(s){const n=s.h*fm,o=s.c;return mm({l:s.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:s.alpha})},interpolate:function(s,n,o){return{h:Uy(s.h,n.h,o),c:En(s.c,n.c,o),l:En(s.l,n.l,o),alpha:En(s.alpha,n.alpha,o)}}};var gm=Object.freeze({__proto__:null,lab:Bl,hcl:Fl});class du{constructor(n,o,c,d,m){this.type=n,this.operator=o,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[_,x]of m)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(n,o,c,d){let m=0;if(n.name==="exponential")m=fu(o,n.base,c,d);else if(n.name==="linear")m=fu(o,1,c,d);else if(n.name==="cubic-bezier"){const _=n.controlPoints;m=new dt(_[0],_[1],_[2],_[3]).solve(fu(o,1,c,d))}return m}static parse(n,o){let[c,d,m,..._]=n;if(!Array.isArray(d)||d.length===0)return o.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const E=d[1];if(typeof E!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:E}}else{if(d[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const E=d.slice(1);if(E.length!==4||E.some(S=>typeof S!="number"||S<0||S>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:E}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(m=o.parse(m,2,ht),!m)return null;const x=[];let w=null;c==="interpolate-hcl"||c==="interpolate-lab"?w=fs:o.expectedType&&o.expectedType.kind!=="value"&&(w=o.expectedType);for(let E=0;E<_.length;E+=2){const S=_[E],M=_[E+1],D=E+3,O=E+4;if(typeof S!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(x.length&&x[x.length-1][0]>=S)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=o.parse(M,O,w);if(!B)return null;w=w||B.type,x.push([S,B])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new du(w,c,d,m,x):o.error(`Type ${Qn(w)} is not interpolatable.`)}evaluate(n){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(n);const d=this.input.evaluate(n);if(d<=o[0])return c[0].evaluate(n);const m=o.length;if(d>=o[m-1])return c[m-1].evaluate(n);const _=Ol(o,d),x=du.interpolationFactor(this.interpolation,d,o[_],o[_+1]),w=c[_].evaluate(n),E=c[_+1].evaluate(n);return this.operator==="interpolate"?Ca[this.type.kind.toLowerCase()](w,E,x):this.operator==="interpolate-hcl"?Fl.reverse(Fl.interpolate(Fl.forward(w),Fl.forward(E),x)):Bl.reverse(Bl.interpolate(Bl.forward(w),Bl.forward(E),x))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,n,this.input.serialize()];for(let c=0;c<this.labels.length;c++)o.push(this.labels[c],this.outputs[c].serialize());return o}}function fu(s,n,o,c){const d=c-o,m=s-o;return d===0?0:n===1?m/d:(Math.pow(n,m)-1)/(Math.pow(n,d)-1)}var _s=du;class gd{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let c=null;const d=o.expectedType;d&&d.kind!=="value"&&(c=d);const m=[];for(const x of n.slice(1)){const w=o.parse(x,1+m.length,c,void 0,{typeAnnotation:"omit"});if(!w)return null;c=c||w.type,m.push(w)}const _=d&&m.some(x=>ts(d,x.type));return new gd(_?cn:c,m)}evaluate(n){let o,c=null,d=0;for(const m of this.args){if(d++,c=m.evaluate(n),c&&c instanceof Er&&!c.available&&(o||(o=c),c=null,d===this.args.length))return o;if(c!==null)break}return c}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(o=>{n.push(o.serialize())}),n}}var _m=gd;class _d{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const c=[];for(let m=1;m<n.length-1;m+=2){const _=n[m];if(typeof _!="string")return o.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return o.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=o.parse(n[m+1],m+1);if(!x)return null;c.push([_,x])}const d=o.parse(n[n.length-1],n.length-1,o.expectedType,c);return d?new _d(c,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,c]of this.bindings)n.push(o,c.serialize());return n.push(this.result.serialize()),n}}var yd=_d;class pu{constructor(n,o,c){this.type=n,this.index=o,this.input=c}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,ht),d=o.parse(n[2],2,Lr(o.expectedType||cn));return c&&d?new pu(d.type.itemType,c,d):null}evaluate(n){const o=this.index.evaluate(n),c=this.input.evaluate(n);if(o<0)throw new Ui(`Array index out of bounds: ${o} < 0.`);if(o>=c.length)throw new Ui(`Array index out of bounds: ${o} > ${c.length-1}.`);if(o!==Math.floor(o))throw new Ui(`Array index must be an integer, but found ${o} instead.`);return c[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var ym=pu;class vd{constructor(n,o){this.type=ln,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,cn),d=o.parse(n[2],2,cn);return c&&d?Kc(c.type,[ln,on,ht,wa,cn])?new vd(c,d):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(c.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(c==null)return!1;if(!Tr(o,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(Ti(o))} instead.`);if(!Tr(c,["string","array"]))throw new Ui(`Expected second argument to be of type array or string, but found ${Qn(Ti(c))} instead.`);return c.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Vy=vd;class Nl{constructor(n,o,c){this.type=ht,this.needle=n,this.haystack=o,this.fromIndex=c}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,cn),d=o.parse(n[2],2,cn);if(!c||!d)return null;if(!Kc(c.type,[ln,on,ht,wa,cn]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(c.type)} instead`);if(n.length===4){const m=o.parse(n[3],3,ht);return m?new Nl(c,d,m):null}return new Nl(c,d)}evaluate(n){const o=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(!Tr(o,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(Ti(o))} instead.`);if(!Tr(c,["string","array"]))throw new Ui(`Expected second argument to be of type array or string, but found ${Qn(Ti(c))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(n);return c.indexOf(o,d)}return c.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var vm=Nl;class mu{constructor(n,o,c,d,m,_){this.inputType=n,this.type=o,this.input=c,this.cases=d,this.outputs=m,this.otherwise=_}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let c,d;o.expectedType&&o.expectedType.kind!=="value"&&(d=o.expectedType);const m={},_=[];for(let E=2;E<n.length-1;E+=2){let S=n[E];const M=n[E+1];Array.isArray(S)||(S=[S]);const D=o.concat(E);if(S.length===0)return D.error("Expected at least one branch label.");for(const B of S){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(c){if(D.checkSubtype(c,Ti(B)))return null}else c=Ti(B);if(m[String(B)]!==void 0)return D.error("Branch labels must be unique.");m[String(B)]=_.length}const O=o.parse(M,E,d);if(!O)return null;d=d||O.type,_.push(O)}const x=o.parse(n[1],1,cn);if(!x)return null;const w=o.parse(n[n.length-1],n.length-1,d);return w?x.type.kind!=="value"&&o.concat(1).checkSubtype(c,x.type)?null:new mu(c,d,x,m,_,w):null}evaluate(n){const o=this.input.evaluate(n);return(Ti(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),c=[],d={};for(const _ of o){const x=d[this.cases[_]];x===void 0?(d[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[x][1].push(_)}const m=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,x]of c)n.push(x.length===1?m(x[0]):x.map(m)),n.push(this.outputs[_].serialize());return n.push(this.otherwise.serialize()),n}}var jy=mu;class xd{constructor(n,o,c){this.type=n,this.branches=o,this.otherwise=c}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let c;o.expectedType&&o.expectedType.kind!=="value"&&(c=o.expectedType);const d=[];for(let _=1;_<n.length-1;_+=2){const x=o.parse(n[_],_,ln);if(!x)return null;const w=o.parse(n[_+1],_+1,c);if(!w)return null;d.push([x,w]),c=c||w.type}const m=o.parse(n[n.length-1],n.length-1,c);return m?new xd(c,d,m):null}evaluate(n){for(const[o,c]of this.branches)if(o.evaluate(n))return c.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,c]of this.branches)n(o),n(c);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(o=>{n.push(o.serialize())}),n}}var Gy=xd;class gu{constructor(n,o,c,d){this.type=n,this.input=o,this.beginIndex=c,this.endIndex=d}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,cn),d=o.parse(n[2],2,ht);if(!c||!d)return null;if(!Kc(c.type,[Lr(cn),on,cn]))return o.error(`Expected first argument to be of type array or string, but found ${Qn(c.type)} instead`);if(n.length===4){const m=o.parse(n[3],3,ht);return m?new gu(c.type,c,d,m):null}return new gu(c.type,c,d)}evaluate(n){const o=this.input.evaluate(n),c=this.beginIndex.evaluate(n);if(!Tr(o,["string","array"]))throw new Ui(`Expected first argument to be of type array or string, but found ${Qn(Ti(o))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(n);return o.slice(c,d)}return o.slice(c)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var _u=gu;function bd(s,n){return s==="=="||s==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function wd(s,n,o,c){return c.compare(n,o)===0}function ka(s,n,o){const c=s!=="=="&&s!=="!=";return class jk{constructor(m,_,x){this.type=ln,this.lhs=m,this.rhs=_,this.collator=x,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}static parse(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");const x=m[0];let w=_.parse(m[1],1,cn);if(!w)return null;if(!bd(x,w.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${Qn(w.type)}'.`);let E=_.parse(m[2],2,cn);if(!E)return null;if(!bd(x,E.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${Qn(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return _.error(`Cannot compare types '${Qn(w.type)}' and '${Qn(E.type)}'.`);c&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new ps(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new ps(w.type,[E])));let S=null;if(m.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(S=_.parse(m[3],3,Ml),!S)return null}return new jk(w,E,S)}evaluate(m){const _=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){const w=Ti(_),E=Ti(x);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new Ui(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const w=Ti(_),E=Ti(x);if(w.kind!=="string"||E.kind!=="string")return n(m,_,x)}return this.collator?o(m,_,x,this.collator.evaluate(m)):n(m,_,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[s];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const $y=ka("==",function(s,n,o){return n===o},wd),qy=ka("!=",function(s,n,o){return n!==o},function(s,n,o,c){return!wd(0,n,o,c)}),xm=ka("<",function(s,n,o){return n<o},function(s,n,o,c){return c.compare(n,o)<0}),bm=ka(">",function(s,n,o){return n>o},function(s,n,o,c){return c.compare(n,o)>0}),wm=ka("<=",function(s,n,o){return n<=o},function(s,n,o,c){return c.compare(n,o)<=0}),Td=ka(">=",function(s,n,o){return n>=o},function(s,n,o,c){return c.compare(n,o)>=0});class Ed{constructor(n,o,c,d,m,_){this.type=on,this.number=n,this.locale=o,this.currency=c,this.unit=d,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const c=o.parse(n[1],1,ht);if(!c)return null;const d=n[2];if(typeof d!="object"||Array.isArray(d))return o.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=o.parse(d.locale,1,on),!m))return null;let _=null;if(d.currency&&(_=o.parse(d.currency,1,on),!_))return null;let x=null;if(d.unit&&(x=o.parse(d.unit,1,on),!x))return null;let w=null;if(d["min-fraction-digits"]&&(w=o.parse(d["min-fraction-digits"],1,ht),!w))return null;let E=null;return d["max-fraction-digits"]&&(E=o.parse(d["max-fraction-digits"],1,ht),!E)?null:new Ed(c,m,_,x,w,E)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Id{constructor(n){this.type=ht,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const c=o.parse(n[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Qn(c.type)} instead.`):new Id(c):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ui(`Expected value to be of type string or array, but found ${Qn(Ti(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(o=>{n.push(o.serialize())}),n}}const Tm={"==":$y,"!=":qy,">":bm,"<":xm,">=":Td,"<=":wm,array:ps,at:ym,boolean:ps,case:Gy,coalesce:_m,collator:eu,format:Js,image:Jc,in:Vy,"index-of":vm,interpolate:_s,"interpolate-hcl":_s,"interpolate-lab":_s,length:Id,let:yd,literal:Ll,match:jy,number:ps,"number-format":Ed,object:ps,slice:_u,step:Aa,string:ps,"to-boolean":Sa,"to-color":Sa,"to-number":Sa,"to-string":Sa,var:cm,within:An};function Em(s,[n,o,c,d]){n=n.evaluate(s),o=o.evaluate(s),c=c.evaluate(s);const m=d?d.evaluate(s):1,_=rm(n,o,c,m);if(_)throw new Ui(_);return new di(n/255*m,o/255*m,c/255*m,m)}function Im(s,n){return s in n}function Sd(s,n){const o=n[s];return o===void 0?null:o}function Ro(s){return{type:s}}ns.register(Tm,{error:[{kind:"error"},[on],(s,[n])=>{throw new Ui(n.evaluate(s))}],typeof:[on,[cn],(s,[n])=>Qn(Ti(n.evaluate(s)))],"to-rgba":[Lr(ht,4),[fs],(s,[n])=>n.evaluate(s).toArray()],rgb:[fs,[ht,ht,ht],Em],rgba:[fs,[ht,ht,ht,ht],Em],has:{type:ln,overloads:[[[on],(s,[n])=>Im(n.evaluate(s),s.properties())],[[on,Ta],(s,[n,o])=>Im(n.evaluate(s),o.evaluate(s))]]},get:{type:cn,overloads:[[[on],(s,[n])=>Sd(n.evaluate(s),s.properties())],[[on,Ta],(s,[n,o])=>Sd(n.evaluate(s),o.evaluate(s))]]},"feature-state":[cn,[on],(s,[n])=>Sd(n.evaluate(s),s.featureState||{})],properties:[Ta,[],s=>s.properties()],"geometry-type":[on,[],s=>s.geometryType()],id:[cn,[],s=>s.id()],zoom:[ht,[],s=>s.globals.zoom],pitch:[ht,[],s=>s.globals.pitch||0],"distance-from-center":[ht,[],s=>s.distanceFromCenter()],"heatmap-density":[ht,[],s=>s.globals.heatmapDensity||0],"line-progress":[ht,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[ht,[],s=>s.globals.skyRadialProgress||0],accumulated:[cn,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[ht,Ro(ht),(s,n)=>{let o=0;for(const c of n)o+=c.evaluate(s);return o}],"*":[ht,Ro(ht),(s,n)=>{let o=1;for(const c of n)o*=c.evaluate(s);return o}],"-":{type:ht,overloads:[[[ht,ht],(s,[n,o])=>n.evaluate(s)-o.evaluate(s)],[[ht],(s,[n])=>-n.evaluate(s)]]},"/":[ht,[ht,ht],(s,[n,o])=>n.evaluate(s)/o.evaluate(s)],"%":[ht,[ht,ht],(s,[n,o])=>n.evaluate(s)%o.evaluate(s)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(s,[n,o])=>Math.pow(n.evaluate(s),o.evaluate(s))],sqrt:[ht,[ht],(s,[n])=>Math.sqrt(n.evaluate(s))],log10:[ht,[ht],(s,[n])=>Math.log(n.evaluate(s))/Math.LN10],ln:[ht,[ht],(s,[n])=>Math.log(n.evaluate(s))],log2:[ht,[ht],(s,[n])=>Math.log(n.evaluate(s))/Math.LN2],sin:[ht,[ht],(s,[n])=>Math.sin(n.evaluate(s))],cos:[ht,[ht],(s,[n])=>Math.cos(n.evaluate(s))],tan:[ht,[ht],(s,[n])=>Math.tan(n.evaluate(s))],asin:[ht,[ht],(s,[n])=>Math.asin(n.evaluate(s))],acos:[ht,[ht],(s,[n])=>Math.acos(n.evaluate(s))],atan:[ht,[ht],(s,[n])=>Math.atan(n.evaluate(s))],min:[ht,Ro(ht),(s,n)=>Math.min(...n.map(o=>o.evaluate(s)))],max:[ht,Ro(ht),(s,n)=>Math.max(...n.map(o=>o.evaluate(s)))],abs:[ht,[ht],(s,[n])=>Math.abs(n.evaluate(s))],round:[ht,[ht],(s,[n])=>{const o=n.evaluate(s);return o<0?-Math.round(-o):Math.round(o)}],floor:[ht,[ht],(s,[n])=>Math.floor(n.evaluate(s))],ceil:[ht,[ht],(s,[n])=>Math.ceil(n.evaluate(s))],"filter-==":[ln,[on,cn],(s,[n,o])=>s.properties()[n.value]===o.value],"filter-id-==":[ln,[cn],(s,[n])=>s.id()===n.value],"filter-type-==":[ln,[on],(s,[n])=>s.geometryType()===n.value],"filter-<":[ln,[on,cn],(s,[n,o])=>{const c=s.properties()[n.value],d=o.value;return typeof c==typeof d&&c<d}],"filter-id-<":[ln,[cn],(s,[n])=>{const o=s.id(),c=n.value;return typeof o==typeof c&&o<c}],"filter->":[ln,[on,cn],(s,[n,o])=>{const c=s.properties()[n.value],d=o.value;return typeof c==typeof d&&c>d}],"filter-id->":[ln,[cn],(s,[n])=>{const o=s.id(),c=n.value;return typeof o==typeof c&&o>c}],"filter-<=":[ln,[on,cn],(s,[n,o])=>{const c=s.properties()[n.value],d=o.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[ln,[cn],(s,[n])=>{const o=s.id(),c=n.value;return typeof o==typeof c&&o<=c}],"filter->=":[ln,[on,cn],(s,[n,o])=>{const c=s.properties()[n.value],d=o.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[ln,[cn],(s,[n])=>{const o=s.id(),c=n.value;return typeof o==typeof c&&o>=c}],"filter-has":[ln,[cn],(s,[n])=>n.value in s.properties()],"filter-has-id":[ln,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ln,[Lr(on)],(s,[n])=>n.value.indexOf(s.geometryType())>=0],"filter-id-in":[ln,[Lr(cn)],(s,[n])=>n.value.indexOf(s.id())>=0],"filter-in-small":[ln,[on,Lr(cn)],(s,[n,o])=>o.value.indexOf(s.properties()[n.value])>=0],"filter-in-large":[ln,[on,Lr(cn)],(s,[n,o])=>function(c,d,m,_){for(;m<=_;){const x=m+_>>1;if(d[x]===c)return!0;d[x]>c?_=x-1:m=x+1}return!1}(s.properties()[n.value],o.value,0,o.value.length-1)],all:{type:ln,overloads:[[[ln,ln],(s,[n,o])=>n.evaluate(s)&&o.evaluate(s)],[Ro(ln),(s,n)=>{for(const o of n)if(!o.evaluate(s))return!1;return!0}]]},any:{type:ln,overloads:[[[ln,ln],(s,[n,o])=>n.evaluate(s)||o.evaluate(s)],[Ro(ln),(s,n)=>{for(const o of n)if(o.evaluate(s))return!0;return!1}]]},"!":[ln,[ln],(s,[n])=>!n.evaluate(s)],"is-supported-script":[ln,[on],(s,[n])=>{const o=s.globals&&s.globals.isSupportedScript;return!o||o(n.evaluate(s))}],upcase:[on,[on],(s,[n])=>n.evaluate(s).toUpperCase()],downcase:[on,[on],(s,[n])=>n.evaluate(s).toLowerCase()],concat:[on,Ro(cn),(s,n)=>n.map(o=>Rl(o.evaluate(s))).join("")],"resolved-locale":[on,[Ml],(s,[n])=>n.evaluate(s).resolvedLocale()]});var Ma=Tm;function Ad(s){return{result:"success",value:s}}function Ms(s){return{result:"error",value:s}}function Da(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function Sm(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function ys(s){return!!s.expression&&s.expression.interpolated}function Cn(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Ds(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Wy(s){return s}function Am(s,n){const o=n.type==="color",c=s.stops&&typeof s.stops[0][0]=="object",d=c||!(c||s.property!==void 0),m=s.type||(ys(n)?"exponential":"interval");if(o&&((s=ks({},s)).stops&&(s.stops=s.stops.map(E=>[E[0],di.parse(E[1])])),s.default=di.parse(s.default?s.default:n.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!gm[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let _,x,w;if(m==="exponential")_=kd;else if(m==="interval")_=Cd;else if(m==="categorical"){_=Zy,x=Object.create(null);for(const E of s.stops)x[E[0]]=E[1];w=typeof s.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=Md}if(c){const E={},S=[];for(let O=0;O<s.stops.length;O++){const B=s.stops[O],U=B[0].zoom;E[U]===void 0&&(E[U]={zoom:U,type:s.type,property:s.property,default:s.default,stops:[]},S.push(U)),E[U].stops.push([B[0].value,B[1]])}const M=[];for(const O of S)M.push([E[O].zoom,Am(E[O],n)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:_s.interpolationFactor.bind(void 0,D),zoomStops:M.map(O=>O[0]),evaluate:({zoom:O},B)=>kd({stops:M,base:s.base},n,O).evaluate(O,B)}}if(d){const E=m==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:_s.interpolationFactor.bind(void 0,E),zoomStops:s.stops.map(S=>S[0]),evaluate:({zoom:S})=>_(s,n,S,x,w)}}return{kind:"source",evaluate(E,S){const M=S&&S.properties?S.properties[s.property]:void 0;return M===void 0?Pa(s.default,n.default):_(s,n,M,x,w)}}}function Pa(s,n,o){return s!==void 0?s:n!==void 0?n:o!==void 0?o:void 0}function Zy(s,n,o,c,d){return Pa(typeof o===d?c[o]:void 0,s.default,n.default)}function Cd(s,n,o){if(Cn(o)!=="number")return Pa(s.default,n.default);const c=s.stops.length;if(c===1||o<=s.stops[0][0])return s.stops[0][1];if(o>=s.stops[c-1][0])return s.stops[c-1][1];const d=Ol(s.stops.map(m=>m[0]),o);return s.stops[d][1]}function kd(s,n,o){const c=s.base!==void 0?s.base:1;if(Cn(o)!=="number")return Pa(s.default,n.default);const d=s.stops.length;if(d===1||o<=s.stops[0][0])return s.stops[0][1];if(o>=s.stops[d-1][0])return s.stops[d-1][1];const m=Ol(s.stops.map(S=>S[0]),o),_=function(S,M,D,O){const B=O-D,U=S-D;return B===0?0:M===1?U/B:(Math.pow(M,U)-1)/(Math.pow(M,B)-1)}(o,c,s.stops[m][0],s.stops[m+1][0]),x=s.stops[m][1],w=s.stops[m+1][1];let E=Ca[n.type]||Wy;if(s.colorSpace&&s.colorSpace!=="rgb"){const S=gm[s.colorSpace];E=(M,D)=>S.reverse(S.interpolate(S.forward(M),S.forward(D),_))}return typeof x.evaluate=="function"?{evaluate(...S){const M=x.evaluate.apply(void 0,S),D=w.evaluate.apply(void 0,S);if(M!==void 0&&D!==void 0)return E(M,D,_)}}:E(x,w,_)}function Md(s,n,o){return n.type==="color"?o=di.parse(o):n.type==="formatted"?o=cr.fromString(o.toString()):n.type==="resolvedImage"?o=Er.fromString(o.toString()):Cn(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),Pa(o,s.default,n.default)}class Ul{constructor(n,o){this.expression=n,this._warningHistory={},this._evaluator=new sm,this._defaultValue=o?function(c){return c.type==="color"&&(Ds(c.default)||Array.isArray(c.default))?new di(0,0,0,0):c.type==="color"?di.parse(c.default)||null:c.default===void 0?null:c.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(n,o,c,d,m,_,x,w){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=c,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,c,d,m,_,x,w){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Ui(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Vl(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ma}function Lo(s,n){const o=new hd(Ma,[],n?function(d){const m={color:fs,string:on,number:ht,enum:on,boolean:ln,formatted:Ea,resolvedImage:Ia};return d.type==="array"?Lr(m[d.value]||cn,d.length):m[d.type]}(n):void 0),c=o.parse(s,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Ad(new Ul(c,n)):Ms(o.errors)}class yu{constructor(n,o){this.kind=n,this._styleExpression=o,this.isStateDependent=n!=="constant"&&!ru(o.expression)}evaluateWithoutErrorHandling(n,o,c,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(n,o,c,d,m,_)}evaluate(n,o,c,d,m,_){return this._styleExpression.evaluate(n,o,c,d,m,_)}}class vu{constructor(n,o,c,d){this.kind=n,this.zoomStops=c,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!ru(o.expression),this.interpolationType=d}evaluateWithoutErrorHandling(n,o,c,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(n,o,c,d,m,_)}evaluate(n,o,c,d,m,_){return this._styleExpression.evaluate(n,o,c,d,m,_)}interpolationFactor(n,o,c){return this.interpolationType?_s.interpolationFactor(this.interpolationType,n,o,c):0}}function jl(s,n){if((s=Lo(s,n)).result==="error")return s;const o=s.value.expression,c=zl(o);if(!c&&!Da(n))return Ms([new ds("","data expressions not supported")]);const d=su(o,["zoom","pitch","distance-from-center"]);if(!d&&!Sm(n))return Ms([new ds("","zoom expressions not supported")]);const m=Gl(o);return m||d?m instanceof ds?Ms([m]):m instanceof _s&&!ys(n)?Ms([new ds("",'"interpolate" expressions cannot be used with this property')]):Ad(m?new vu(c?"camera":"composite",s.value,m.labels,m instanceof _s?m.interpolation:void 0):new yu(c?"constant":"source",s.value)):Ms([new ds("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ps{constructor(n,o){this._parameters=n,this._specification=o,ks(this,Am(this._parameters,this._specification))}static deserialize(n){return new Ps(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Gl(s){let n=null;if(s instanceof yd)n=Gl(s.result);else if(s instanceof _m){for(const o of s.args)if(n=Gl(o),n)break}else(s instanceof Aa||s instanceof _s)&&s.input instanceof ns&&s.input.name==="zoom"&&(n=s);return n instanceof ds||s.eachChild(o=>{const c=Gl(o);c instanceof ds?n=c:!n&&c?n=new ds("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&c&&n!==c&&(n=new ds("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}class gt{constructor(n,o,c,d){this.message=(n?`${n}: `:"")+c,d&&(this.identifier=d),o!=null&&o.__line__&&(this.line=o.__line__)}}function zr(s){const n=s.key,o=s.value,c=s.valueSpec||{},d=s.objectElementValidators||{},m=s.style,_=s.styleSpec;let x=[];const w=Cn(o);if(w!=="object")return[new gt(n,o,`object expected, ${w} found`)];for(const E in o){const S=E.split(".")[0],M=c[S]||c["*"];let D;d[S]?D=d[S]:c[S]?D=Qi:d["*"]?D=d["*"]:c["*"]&&(D=Qi),D?x=x.concat(D({key:(n&&`${n}.`)+E,value:o[E],valueSpec:M,style:m,styleSpec:_,object:o,objectKey:E},o)):x.push(new gt(n,o[E],`unknown property "${E}"`))}for(const E in c)d[E]||c[E].required&&c[E].default===void 0&&o[E]===void 0&&x.push(new gt(n,o,`missing required property "${E}"`));return x}function Dd(s){const n=s.value,o=s.valueSpec,c=s.style,d=s.styleSpec,m=s.key,_=s.arrayElementValidator||Qi;if(Cn(n)!=="array")return[new gt(m,n,`array expected, ${Cn(n)} found`)];if(o.length&&n.length!==o.length)return[new gt(m,n,`array length ${o.length} expected, length ${n.length} found`)];if(o["min-length"]&&n.length<o["min-length"])return[new gt(m,n,`array length at least ${o["min-length"]} expected, length ${n.length} found`)];let x={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};d.$version<7&&(x.function=o.function),Cn(o.value)==="object"&&(x=o.value);let w=[];for(let E=0;E<n.length;E++)w=w.concat(_({array:n,arrayIndex:E,value:n[E],valueSpec:x,style:c,styleSpec:d,key:`${m}[${E}]`}));return w}function Cm(s){const n=s.key,o=s.value,c=s.valueSpec;let d=Cn(o);if(d==="number"&&o!=o&&(d="NaN"),d!=="number")return[new gt(n,o,`number expected, ${d} found`)];if("minimum"in c){let m=c.minimum;if(Cn(c.minimum)==="array"&&(m=c.minimum[s.arrayIndex]),o<m)return[new gt(n,o,`${o} is less than the minimum value ${m}`)]}if("maximum"in c){let m=c.maximum;if(Cn(c.maximum)==="array"&&(m=c.maximum[s.arrayIndex]),o>m)return[new gt(n,o,`${o} is greater than the maximum value ${m}`)]}return[]}function Pd(s){const n=s.valueSpec,o=gi(s.value.type);let c,d,m,_={};const x=o!=="categorical"&&s.value.property===void 0,w=!x,E=Cn(s.value.stops)==="array"&&Cn(s.value.stops[0])==="array"&&Cn(s.value.stops[0][0])==="object",S=zr({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(O){if(o==="identity")return[new gt(O.key,O.value,'identity function may not have a "stops" property')];let B=[];const U=O.value;return B=B.concat(Dd({key:O.key,value:U,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:M})),Cn(U)==="array"&&U.length===0&&B.push(new gt(O.key,U,"array must have at least one stop")),B},default:function(O){return Qi({key:O.key,value:O.value,valueSpec:n,style:O.style,styleSpec:O.styleSpec})}}});return o==="identity"&&x&&S.push(new gt(s.key,s.value,'missing required property "property"')),o==="identity"||s.value.stops||S.push(new gt(s.key,s.value,'missing required property "stops"')),o==="exponential"&&s.valueSpec.expression&&!ys(s.valueSpec)&&S.push(new gt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(w&&!Da(s.valueSpec)?S.push(new gt(s.key,s.value,"property functions not supported")):x&&!Sm(s.valueSpec)&&S.push(new gt(s.key,s.value,"zoom functions not supported"))),o!=="categorical"&&!E||s.value.property!==void 0||S.push(new gt(s.key,s.value,'"property" property is required')),S;function M(O){let B=[];const U=O.value,$=O.key;if(Cn(U)!=="array")return[new gt($,U,`array expected, ${Cn(U)} found`)];if(U.length!==2)return[new gt($,U,`array length 2 expected, length ${U.length} found`)];if(E){if(Cn(U[0])!=="object")return[new gt($,U,`object expected, ${Cn(U[0])} found`)];if(U[0].zoom===void 0)return[new gt($,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new gt($,U,"object stop key must have value")];const ne=gi(U[0].zoom);if(typeof ne!="number")return[new gt($,U[0].zoom,"stop zoom values must be numbers")];if(m&&m>ne)return[new gt($,U[0].zoom,"stop zoom values must appear in ascending order")];ne!==m&&(m=ne,d=void 0,_={}),B=B.concat(zr({key:`${$}[0]`,value:U[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:Cm,value:D}}))}else B=B.concat(D({key:`${$}[0]`,value:U[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},U));return Vl(Qs(U[1]))?B.concat([new gt(`${$}[1]`,U[1],"expressions are not allowed in function stops.")]):B.concat(Qi({key:`${$}[1]`,value:U[1],valueSpec:n,style:O.style,styleSpec:O.styleSpec}))}function D(O,B){const U=Cn(O.value),$=gi(O.value),ne=O.value!==null?O.value:B;if(c){if(U!==c)return[new gt(O.key,ne,`${U} stop domain type must match previous stop domain type ${c}`)]}else c=U;if(U!=="number"&&U!=="string"&&U!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new gt(O.key,ne,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&o!=="categorical"){let ue=`number expected, ${U} found`;return Da(n)&&o===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new gt(O.key,ne,ue)]}return o!=="categorical"||U!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?o!=="categorical"&&U==="number"&&typeof $=="number"&&typeof d=="number"&&d!==void 0&&$<d?[new gt(O.key,ne,"stop domain values must appear in ascending order")]:(d=$,o==="categorical"&&$ in _?[new gt(O.key,ne,"stop domain values must be unique")]:(_[$]=!0,[])):[new gt(O.key,ne,`integer expected, found ${String($)}`)]}}function Rs(s){const n=(s.expressionContext==="property"?jl:Lo)(Qs(s.value),s.valueSpec);if(n.result==="error")return n.value.map(c=>new gt(`${s.key}${c.key}`,s.value,c.message));const o=n.value.expression||n.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!o.outputDefined())return[new gt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!ru(o))return[new gt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return km(o,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!su(o,["zoom","feature-state"]))return[new gt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!zl(o))return[new gt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function km(s,n){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const d of n.valueSpec.expression.parameters)o.delete(d);if(o.size===0)return[];const c=[];return s instanceof ns&&o.has(s.name)?[new gt(n.key,n.value,`["${s.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(s.eachChild(d=>{c.push(...km(d,n))}),c)}function xu(s){const n=s.key,o=s.value,c=s.valueSpec,d=[];return Array.isArray(c.values)?c.values.indexOf(gi(o))===-1&&d.push(new gt(n,o,`expected one of [${c.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(c.values).indexOf(gi(o))===-1&&d.push(new gt(n,o,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(o)} found`)),d}function Rd(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const n of s.slice(1))if(!Rd(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function bu(s,n="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Rd(s)||(s=Tu(s));const o=s;let c=!0;try{c=function(E){if(!Ls(E))return E;let S=Qs(E);return $l(S),S=Mm(S),S}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}const d=De[`filter_${n}`],m=Lo(c,d);let _=null;if(m.result==="error")throw new Error(m.value.map(E=>`${E.key}: ${E.message}`).join(", "));_=(E,S,M)=>m.value.evaluate(E,S,{},M);let x=null,w=null;if(c!==o){const E=Lo(o,d);if(E.result==="error")throw new Error(E.value.map(S=>`${S.key}: ${S.message}`).join(", "));x=(S,M,D,O,B)=>E.value.evaluate(S,M,{},D,void 0,void 0,O,B),w=!zl(E.value.expression)}return{filter:_,dynamicFilter:x||void 0,needGeometry:Dm(c),needFeature:!!w}}function Mm(s){if(!Array.isArray(s))return s;const n=function(o){if(Or.has(o[0])){for(let c=1;c<o.length;c++)if(Ls(o[c]))return!0}return o}(s);return n===!0?n:n.map(o=>Mm(o))}function $l(s){let n=!1;const o=[];if(s[0]==="case"){for(let c=1;c<s.length-1;c+=2)n=n||Ls(s[c]),o.push(s[c+1]);o.push(s[s.length-1])}else if(s[0]==="match"){n=n||Ls(s[1]);for(let c=2;c<s.length-1;c+=2)o.push(s[c+1]);o.push(s[s.length-1])}else if(s[0]==="step"){n=n||Ls(s[1]);for(let c=1;c<s.length-1;c+=2)o.push(s[c+1])}n&&(s.length=0,s.push("any",...o));for(let c=1;c<s.length;c++)$l(s[c])}function Ls(s){if(!Array.isArray(s))return!1;if((n=s[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<s.length;o++)if(Ls(s[o]))return!0;return!1}const Or=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wu(s,n){return s<n?-1:s>n?1:0}function Dm(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let n=1;n<s.length;n++)if(Dm(s[n]))return!0;return!1}function Tu(s){if(!s)return!0;const n=s[0];return s.length<=1?n!=="any":n==="=="?Ld(s[1],s[2],"=="):n==="!="?Iu(Ld(s[1],s[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Ld(s[1],s[2],n):n==="any"?(o=s.slice(1),["any"].concat(o.map(Tu))):n==="all"?["all"].concat(s.slice(1).map(Tu)):n==="none"?["all"].concat(s.slice(1).map(Tu).map(Iu)):n==="in"?Pm(s[1],s.slice(2)):n==="!in"?Iu(Pm(s[1],s.slice(2))):n==="has"?Eu(s[1]):n==="!has"?Iu(Eu(s[1])):n!=="within"||s;var o}function Ld(s,n,o){switch(s){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,s,n]}}function Pm(s,n){if(n.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",s,["literal",n.sort(wu)]]:["filter-in-small",s,["literal",n]]}}function Eu(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Iu(s){return["!",s]}function ql(s){return Rd(Qs(s.value))?Rs(ks({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Rm(s)}function Rm(s){const n=s.value,o=s.key;if(Cn(n)!=="array")return[new gt(o,n,`array expected, ${Cn(n)} found`)];const c=s.styleSpec;let d,m=[];if(n.length<1)return[new gt(o,n,"filter array must have at least 1 element")];switch(m=m.concat(xu({key:`${o}[0]`,value:n[0],valueSpec:c.filter_operator,style:s.style,styleSpec:s.styleSpec})),gi(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&gi(n[1])==="$type"&&m.push(new gt(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&m.push(new gt(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(d=Cn(n[1]),d!=="string"&&m.push(new gt(`${o}[1]`,n[1],`string expected, ${d} found`)));for(let _=2;_<n.length;_++)d=Cn(n[_]),gi(n[1])==="$type"?m=m.concat(xu({key:`${o}[${_}]`,value:n[_],valueSpec:c.geometry_type,style:s.style,styleSpec:s.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&m.push(new gt(`${o}[${_}]`,n[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<n.length;_++)m=m.concat(Rm({key:`${o}[${_}]`,value:n[_],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":d=Cn(n[1]),n.length!==2?m.push(new gt(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):d!=="string"&&m.push(new gt(`${o}[1]`,n[1],`string expected, ${d} found`));break;case"within":d=Cn(n[1]),n.length!==2?m.push(new gt(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):d!=="object"&&m.push(new gt(`${o}[1]`,n[1],`object expected, ${d} found`))}return m}function Lm(s,n){const o=s.key,c=s.style,d=s.styleSpec,m=s.value,_=s.objectKey,x=d[`${n}_${s.layerType}`];if(!x)return[];const w=_.match(/^(.*)-transition$/);if(n==="paint"&&w&&x[w[1]]&&x[w[1]].transition)return Qi({key:o,value:m,valueSpec:d.transition,style:c,styleSpec:d});const E=s.valueSpec||x[_];if(!E)return[new gt(o,m,`unknown property "${_}"`)];let S;if(Cn(m)==="string"&&Da(E)&&!E.tokens&&(S=/^{([^}]+)}$/.exec(m)))return[new gt(o,m,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const M=[];return s.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&M.push(new gt(o,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Ds(Qs(m))&&gi(m.type)==="identity"&&M.push(new gt(o,m,'"text-font" does not support identity functions'))),M.concat(Qi({key:s.key,value:m,valueSpec:E,style:c,styleSpec:d,expressionContext:"property",propertyType:n,propertyKey:_}))}function Su(s){return Lm(s,"paint")}function zm(s){return Lm(s,"layout")}function zd(s){let n=[];const o=s.value,c=s.key,d=s.style,m=s.styleSpec;o.type||o.ref||n.push(new gt(c,o,'either "type" or "ref" is required'));let _=gi(o.type);const x=gi(o.ref);if(o.id){const w=gi(o.id);for(let E=0;E<s.arrayIndex;E++){const S=d.layers[E];gi(S.id)===w&&n.push(new gt(c,o.id,`duplicate layer id "${o.id}", previously used at line ${S.id.__line__}`))}}if("ref"in o){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in o&&n.push(new gt(c,o[E],`"${E}" is prohibited for ref layers`))}),d.layers.forEach(E=>{gi(E.id)===x&&(w=E)}),w?w.ref?n.push(new gt(c,o.ref,"ref cannot reference another ref layer")):_=gi(w.type):typeof x=="string"&&n.push(new gt(c,o.ref,`ref layer "${x}" not found`))}else if(_!=="background"&&_!=="sky")if(o.source){const w=d.sources&&d.sources[o.source],E=w&&gi(w.type);w?E==="vector"&&_==="raster"?n.push(new gt(c,o.source,`layer "${o.id}" requires a raster source`)):E==="raster"&&_!=="raster"?n.push(new gt(c,o.source,`layer "${o.id}" requires a vector source`)):E!=="vector"||o["source-layer"]?E==="raster-dem"&&_!=="hillshade"?n.push(new gt(c,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||E==="geojson"&&w.lineMetrics||n.push(new gt(c,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new gt(c,o,`layer "${o.id}" must specify a "source-layer"`)):n.push(new gt(c,o.source,`source "${o.source}" not found`))}else n.push(new gt(c,o,'missing required property "source"'));return n=n.concat(zr({key:c,value:o,valueSpec:m.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Qi({key:`${c}.type`,value:o.type,valueSpec:m.layer.type,style:s.style,styleSpec:s.styleSpec,object:o,objectKey:"type"}),filter:w=>ql(ks({layerType:_},w)),layout:w=>zr({layer:o,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>zm(ks({layerType:_},E))}}),paint:w=>zr({layer:o,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Su(ks({layerType:_},E))}})}})),n}function zo(s){const n=s.value,o=s.key,c=Cn(n);return c!=="string"?[new gt(o,n,`string expected, ${c} found`)]:[]}const Om={promoteId:function({key:s,value:n}){if(Cn(n)==="string")return zo({key:s,value:n});{const o=[];for(const c in n)o.push(...zo({key:`${s}.${c}`,value:n[c]}));return o}}};function Au(s){const n=s.value,o=s.key,c=s.styleSpec,d=s.style;if(!n.type)return[new gt(o,n,'"type" is required')];const m=gi(n.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=zr({key:o,value:n,valueSpec:c[`source_${m.replace("-","_")}`],style:s.style,styleSpec:c,objectElementValidators:Om}),_;case"geojson":if(_=zr({key:o,value:n,valueSpec:c.source_geojson,style:d,styleSpec:c,objectElementValidators:Om}),n.cluster)for(const x in n.clusterProperties){const[w,E]=n.clusterProperties[x],S=typeof w=="string"?[w,["accumulated"],["get",x]]:w;_.push(...Rs({key:`${o}.${x}.map`,value:E,expressionContext:"cluster-map"})),_.push(...Rs({key:`${o}.${x}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return _;case"video":return zr({key:o,value:n,valueSpec:c.source_video,style:d,styleSpec:c});case"image":return zr({key:o,value:n,valueSpec:c.source_image,style:d,styleSpec:c});case"canvas":return[new gt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xu({key:`${o}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:c})}}function Wl(s){const n=s.value,o=s.styleSpec,c=o.light,d=s.style;let m=[];const _=Cn(n);if(n===void 0)return m;if(_!=="object")return m=m.concat([new gt("light",n,`object expected, ${_} found`)]),m;for(const x in n){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&c[w[1]]&&c[w[1]].transition?Qi({key:x,value:n[x],valueSpec:o.transition,style:d,styleSpec:o}):c[x]?Qi({key:x,value:n[x],valueSpec:c[x],style:d,styleSpec:o}):[new gt(x,n[x],`unknown property "${x}"`)])}return m}function Od(s){const n=s.value,o=s.key,c=s.style,d=s.styleSpec,m=d.terrain;let _=[];const x=Cn(n);if(n===void 0)return _;if(x!=="object")return _=_.concat([new gt("terrain",n,`object expected, ${x} found`)]),_;for(const w in n){const E=w.match(/^(.*)-transition$/);_=_.concat(E&&m[E[1]]&&m[E[1]].transition?Qi({key:w,value:n[w],valueSpec:d.transition,style:c,styleSpec:d}):m[w]?Qi({key:w,value:n[w],valueSpec:m[w],style:c,styleSpec:d}):[new gt(w,n[w],`unknown property "${w}"`)])}if(n.source){const w=c.sources&&c.sources[n.source],E=w&&gi(w.type);w?E!=="raster-dem"&&_.push(new gt(o,n.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):_.push(new gt(o,n.source,`source "${n.source}" not found`))}else _.push(new gt(o,n,'terrain is missing required property "source"'));return _}function Bm(s){const n=s.value,o=s.style,c=s.styleSpec,d=c.fog;let m=[];const _=Cn(n);if(n===void 0)return m;if(_!=="object")return m=m.concat([new gt("fog",n,`object expected, ${_} found`)]),m;for(const x in n){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&d[w[1]]&&d[w[1]].transition?Qi({key:x,value:n[x],valueSpec:c.transition,style:o,styleSpec:c}):d[x]?Qi({key:x,value:n[x],valueSpec:d[x],style:o,styleSpec:c}):[new gt(x,n[x],`unknown property "${x}"`)])}return m}const Bd={"*":()=>[],array:Dd,boolean:function(s){const n=s.value,o=s.key,c=Cn(n);return c!=="boolean"?[new gt(o,n,`boolean expected, ${c} found`)]:[]},number:Cm,color:function(s){const n=s.key,o=s.value,c=Cn(o);return c!=="string"?[new gt(n,o,`color expected, ${c} found`)]:Yh(o)===null?[new gt(n,o,`color expected, "${o}" found`)]:[]},enum:xu,filter:ql,function:Pd,layer:zd,object:zr,source:Au,light:Wl,terrain:Od,fog:Bm,string:zo,formatted:function(s){return zo(s).length===0?[]:Rs(s)},resolvedImage:function(s){return zo(s).length===0?[]:Rs(s)},projection:function(s){const n=s.value,o=s.styleSpec,c=o.projection,d=s.style;let m=[];const _=Cn(n);if(_==="object")for(const x in n)m=m.concat(Qi({key:x,value:n[x],valueSpec:c[x],style:d,styleSpec:o}));else _!=="string"&&(m=m.concat([new gt("projection",n,`object or string expected, ${_} found`)]));return m}};function Qi(s){const n=s.value,o=s.valueSpec,c=s.styleSpec;return o.expression&&Ds(gi(n))?Pd(s):o.expression&&Vl(Qs(n))?Rs(s):o.type&&Bd[o.type]?Bd[o.type](s):zr(ks({},s,{valueSpec:o.type?c[o.type]:o}))}function Fd(s){const n=s.value,o=s.key,c=zo(s);return c.length||(n.indexOf("{fontstack}")===-1&&c.push(new gt(o,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&c.push(new gt(o,n,'"glyphs" url must include a "{range}" token'))),c}function Fm(s,n=De){return zs(Qi({key:"",value:s,valueSpec:n.$root,styleSpec:n,style:s,objectElementValidators:{glyphs:Fd,"*":()=>[]}}))}const Hy=s=>zs(Su(s)),Xy=s=>zs(zm(s));function zs(s){return s.slice().sort((n,o)=>n.line&&o.line?n.line-o.line:0)}function Nd(s,n){let o=!1;if(n&&n.length)for(const c of n)s.fire(new Ys(new Error(c.message))),o=!0;return o}var Ra=vs;function vs(s,n,o){var c=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var d=new Int32Array(this.arrayBuffer);s=d[0],this.d=(n=d[1])+2*(o=d[2]);for(var m=0;m<this.d*this.d;m++){var _=d[3+m],x=d[3+m+1];c.push(_===x?null:d.subarray(_,x))}var w=d[3+c.length+1];this.keys=d.subarray(d[3+c.length],w),this.bboxes=d.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*o;for(var E=0;E<this.d*this.d;E++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=s,this.padding=o,this.scale=n/s,this.uid=0;var S=o/n*s;this.min=-S,this.max=s+S}vs.prototype.insert=function(s,n,o,c,d){this._forEachCell(n,o,c,d,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(d)},vs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},vs.prototype._insertCell=function(s,n,o,c,d,m){this.cells[d].push(m)},vs.prototype.query=function(s,n,o,c,d){var m=this.min,_=this.max;if(s<=m&&n<=m&&_<=o&&_<=c&&!d)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(s,n,o,c,this._queryCell,x,{},d),x},vs.prototype._queryCell=function(s,n,o,c,d,m,_,x){var w=this.cells[d];if(w!==null)for(var E=this.keys,S=this.bboxes,M=0;M<w.length;M++){var D=w[M];if(_[D]===void 0){var O=4*D;(x?x(S[O+0],S[O+1],S[O+2],S[O+3]):s<=S[O+2]&&n<=S[O+3]&&o>=S[O+0]&&c>=S[O+1])?(_[D]=!0,m.push(E[D])):_[D]=!1}}},vs.prototype._forEachCell=function(s,n,o,c,d,m,_,x){for(var w=this._convertToCellCoord(s),E=this._convertToCellCoord(n),S=this._convertToCellCoord(o),M=this._convertToCellCoord(c),D=w;D<=S;D++)for(var O=E;O<=M;O++){var B=this.d*O+D;if((!x||x(this._convertFromCellCoord(D),this._convertFromCellCoord(O),this._convertFromCellCoord(D+1),this._convertFromCellCoord(O+1)))&&d.call(this,s,n,o,c,B,m,_,x))return}},vs.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},vs.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},vs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,n=3+this.cells.length+1+1,o=0,c=0;c<this.cells.length;c++)o+=this.cells[c].length;var d=new Int32Array(n+o+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var m=n,_=0;_<s.length;_++){var x=s[_];d[3+_]=m,d.set(x,m),m+=x.length}return d[3+s.length]=m,d.set(this.keys,m),d[3+s.length+1]=m+=this.keys.length,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer};const Cu={};function xt(s,n,o={}){Object.defineProperty(s,"_classRegistryKey",{value:n,writeable:!1}),Cu[n]={klass:s,omit:o.omit||[]}}xt(Object,"Object"),Ra.serialize=function(s,n){const o=s.toArrayBuffer();return n&&n.push(o),{buffer:o}},Ra.deserialize=function(s){return new Ra(s.buffer)},Object.defineProperty(Ra,"name",{value:"Grid"}),xt(Ra,"Grid"),xt(di,"Color"),xt(Error,"Error"),xt(Al,"AJAXError"),xt(Er,"ResolvedImage"),xt(Ps,"StylePropertyFunction"),xt(Ul,"StyleExpression",{omit:["_evaluator"]}),xt(vu,"ZoomDependentExpression"),xt(yu,"ZoomConstantExpression"),xt(ns,"CompoundExpression",{omit:["_evaluate"]});for(const s in Ma)Cu[Ma[s]._classRegistryKey]||xt(Ma[s],`Expression${s}`);function Nm(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Um(s){return T.ImageBitmap&&s instanceof T.ImageBitmap}function Zl(s,n){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Nm(s)||Um(s))return n&&n.push(s),s;if(ArrayBuffer.isView(s)){const o=s;return n&&n.push(o.buffer),o}if(s instanceof T.ImageData)return n&&n.push(s.data.buffer),s;if(Array.isArray(s)){const o=[];for(const c of s)o.push(Zl(c,n));return o}if(typeof s=="object"){const o=s.constructor,c=o._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const d=o.serialize?o.serialize(s,n):{};if(!o.serialize){for(const m in s)s.hasOwnProperty(m)&&(Cu[c].omit.indexOf(m)>=0||(d[m]=Zl(s[m],n)));s instanceof Error&&(d.message=s.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(d.$name=c),d}throw new Error("can't serialize object of type "+typeof s)}function no(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Nm(s)||Um(s)||ArrayBuffer.isView(s)||s instanceof T.ImageData)return s;if(Array.isArray(s))return s.map(no);if(typeof s=="object"){const n=s.$name||"Object",{klass:o}=Cu[n];if(!o)throw new Error(`can't deserialize unregistered class ${n}`);if(o.deserialize)return o.deserialize(s);const c=Object.create(o.prototype);for(const d of Object.keys(s))d!=="$name"&&(c[d]=no(s[d]));return c}throw new Error("can't deserialize object of type "+typeof s)}class Vm{constructor(){this.first=!0}update(n,o){const c=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=o),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=c,!0))}}const jm=s=>s>=1536&&s<=1791,Hl=s=>s>=1872&&s<=1919,Gm=s=>s>=2208&&s<=2303,Ud=s=>s>=11904&&s<=12031,$m=s=>s>=12032&&s<=12255,Vd=s=>s>=12272&&s<=12287,Xl=s=>s>=12288&&s<=12351,ku=s=>s>=12352&&s<=12447,Kl=s=>s>=12448&&s<=12543,Mu=s=>s>=12544&&s<=12591,Du=s=>s>=12704&&s<=12735,qm=s=>s>=12736&&s<=12783,Wm=s=>s>=12784&&s<=12799,jd=s=>s>=12800&&s<=13055,Zm=s=>s>=13056&&s<=13311,Hm=s=>s>=13312&&s<=19903,Gd=s=>s>=19968&&s<=40959,Pu=s=>s>=40960&&s<=42127,Xm=s=>s>=42128&&s<=42191,Km=s=>s>=44032&&s<=55215,Ym=s=>s>=63744&&s<=64255,$d=s=>s>=64336&&s<=65023,Qm=s=>s>=65040&&s<=65055,Ru=s=>s>=65072&&s<=65103,Yl=s=>s>=65104&&s<=65135,p=s=>s>=65136&&s<=65279,a=s=>s>=65280&&s<=65519;function h(s){for(const n of s)if(b(n.charCodeAt(0)))return!0;return!1}function g(s){for(const n of s)if(!v(n.charCodeAt(0)))return!1;return!0}function v(s){return!(jm(s)||Hl(s)||Gm(s)||$d(s)||p(s))}function b(s){return!(s!==746&&s!==747&&(s<4352||!(Du(s)||Mu(s)||Ru(s)&&!(s>=65097&&s<=65103)||Ym(s)||Zm(s)||Ud(s)||qm(s)||!(!Xl(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Hm(s)||Gd(s)||jd(s)||(n=>n>=12592&&n<=12687)(s)||(n=>n>=43360&&n<=43391)(s)||(n=>n>=55216&&n<=55295)(s)||(n=>n>=4352&&n<=4607)(s)||Km(s)||ku(s)||Vd(s)||(n=>n>=12688&&n<=12703)(s)||$m(s)||Wm(s)||Kl(s)&&s!==12540||!(!a(s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Yl(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(n=>n>=5120&&n<=5759)(s)||(n=>n>=6320&&n<=6399)(s)||Qm(s)||(n=>n>=19904&&n<=19967)(s)||Pu(s)||Xm(s))))}function I(s){return!(b(s)||function(n){return!!((o=>o>=128&&o<=255)(n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||(o=>o>=8192&&o<=8303)(n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||(o=>o>=8448&&o<=8527)(n)||(o=>o>=8528&&o<=8591)(n)||(o=>o>=8960&&o<=9215)(n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||(o=>o>=9216&&o<=9279)(n)&&n!==9251||(o=>o>=9280&&o<=9311)(n)||(o=>o>=9312&&o<=9471)(n)||(o=>o>=9632&&o<=9727)(n)||(o=>o>=9728&&o<=9983)(n)&&!(n>=9754&&n<=9759)||(o=>o>=11008&&o<=11263)(n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Xl(n)||Kl(n)||(o=>o>=57344&&o<=63743)(n)||Ru(n)||Yl(n)||a(n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(s))}function C(s){return s>=1424&&s<=2303||$d(s)||p(s)}function k(s,n){return!(!n&&C(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(o=>o>=6016&&o<=6143)(s))}function P(s){for(const n of s)if(C(n.charCodeAt(0)))return!0;return!1}const L="deferred",N="loading",G="loaded";let X=null,W="unavailable",K=null;const Z=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(W="error"),X&&X(s)};function q(){Q.fire(new Fn("pluginStateChange",{pluginStatus:W,pluginURL:K}))}const Q=new Cs,H=function(){return W},le=function(){if(W!==L||!K)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");W=N,q(),K&&Xs({url:K},s=>{s?Z(s):(W=G,q())})},ce={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>W===G||ce.applyArabicShaping!=null,isLoading:()=>W===N,setState(s){W=s.pluginStatus,K=s.pluginURL},isParsed:()=>ce.applyArabicShaping!=null&&ce.processBidirectionalText!=null&&ce.processStyledBidirectionalText!=null,getPluginURL:()=>K};class ie{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition,this.pitch=o.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vm,this.transition={},this.pitch=0)}isSupportedScript(n){return function(o,c){for(const d of o)if(!k(d.charCodeAt(0),c))return!1;return!0}(n,ce.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,o=n-Math.floor(n),c=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*o}}}class he{constructor(n,o){this.property=n,this.value=o,this.expression=function(c,d){if(Ds(c))return new Ps(c,d);if(Vl(c)){const m=jl(c,d);if(m.result==="error")throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=c;return typeof c=="string"&&d.type==="color"&&(m=di.parse(c)),{kind:"constant",evaluate:()=>m}}}(o===void 0?n.specification.default:o,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,c){return this.property.possiblyEvaluate(this,n,o,c)}}class xe{constructor(n){this.property=n,this.value=new he(n,void 0)}transitioned(n,o){return new Ie(this.property,this.value,o,rn({},n.transition,this.transition),n.now)}untransitioned(){return new Ie(this.property,this.value,null,{},0)}}class Ae{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return wi(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new xe(this._values[n].property)),this._values[n].value=new he(this._values[n].property,o===null?void 0:wi(o))}getTransition(n){return wi(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new xe(this._values[n].property)),this._values[n].transition=wi(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(n[o]=c);const d=this.getTransition(o);d!==void 0&&(n[`${o}-transition`]=d)}return n}transitioned(n,o){const c=new qe(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(n,o._values[d]);return c}untransitioned(){const n=new qe(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class Ie{constructor(n,o,c,d,m){const _=d.delay||0,x=d.duration||0;m=m||0,this.property=n,this.value=o,this.begin=m+_,this.end=this.begin+x,n.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(n,o,c){const d=n.now||0,m=this.value.possiblyEvaluate(n,o,c),_=this.prior;if(_){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return _.possiblyEvaluate(n,o,c);{const x=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(n,o,c),m,kt(x))}}return m}}class qe{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,c){const d=new Be(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(n,o,c);return d}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class _e{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return wi(this._values[n].value)}setValue(n,o){this._values[n]=new he(this._values[n].property,o===null?void 0:wi(o))}serialize(){const n={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(n[o]=c)}return n}possiblyEvaluate(n,o,c){const d=new Be(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(n,o,c);return d}}class Fe{constructor(n,o,c){this.property=n,this.value=o,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,c,d){return this.property.evaluate(this.value,this.parameters,n,o,c,d)}}class Be{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class we{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,c){const d=Ca[this.specification.type];return d?d(n,o,c):n}}class me{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,c,d){return new Fe(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},c,d)}:n.expression,o)}interpolate(n,o,c){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new Fe(this,{kind:"constant",value:void 0},n.parameters);const d=Ca[this.specification.type];return d?new Fe(this,{kind:"constant",value:d(n.value.value,o.value.value,c)},n.parameters):n}evaluate(n,o,c,d,m,_){return n.kind==="constant"?n.value:n.evaluate(o,c,d,m,_)}}class ct extends me{possiblyEvaluate(n,o,c,d){if(n.value===void 0)return new Fe(this,{kind:"constant",value:void 0},o);if(n.expression.kind==="constant"){const m=n.expression.evaluate(o,null,{},c,d),_=n.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,x=this._calculate(_,_,_,o);return new Fe(this,{kind:"constant",value:x},o)}if(n.expression.kind==="camera"){const m=this._calculate(n.expression.evaluate({zoom:o.zoom-1}),n.expression.evaluate({zoom:o.zoom}),n.expression.evaluate({zoom:o.zoom+1}),o);return new Fe(this,{kind:"constant",value:m},o)}return new Fe(this,n.expression,o)}evaluate(n,o,c,d,m,_){if(n.kind==="source"){const x=n.evaluate(o,c,d,m,_);return this._calculate(x,x,x,o)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(o.zoom)-1},c,d),n.evaluate({zoom:Math.floor(o.zoom)},c,d),n.evaluate({zoom:Math.floor(o.zoom)+1},c,d),o):n.value}_calculate(n,o,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:n,to:o,other:c}:{from:c,to:o,other:n}}interpolate(n){return n}}class Ye{constructor(n){this.specification=n}possiblyEvaluate(n,o,c,d){if(n.value!==void 0){if(n.expression.kind==="constant"){const m=n.expression.evaluate(o,null,{},c,d);return this._calculate(m,m,m,o)}return this._calculate(n.expression.evaluate(new ie(Math.floor(o.zoom-1),o)),n.expression.evaluate(new ie(Math.floor(o.zoom),o)),n.expression.evaluate(new ie(Math.floor(o.zoom+1),o)),o)}}_calculate(n,o,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:n,to:o}:{from:c,to:o}}interpolate(n){return n}}class rt{constructor(n){this.specification=n}possiblyEvaluate(n,o,c,d){return!!n.expression.evaluate(o,null,{},c,d)}interpolate(){return!1}}class Qe{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new ie(0,{});for(const c in n){const d=n[c];d.specification.overridable&&this.overridableProperties.push(c);const m=this.defaultPropertyValues[c]=new he(d,void 0),_=this.defaultTransitionablePropertyValues[c]=new xe(d);this.defaultTransitioningPropertyValues[c]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=m.possiblyEvaluate(o)}}}function At(s,n){return 256*(s=Xe(Math.floor(s),0,255))+Xe(Math.floor(n),0,255)}xt(me,"DataDrivenProperty"),xt(we,"DataConstantProperty"),xt(ct,"CrossFadedDataDrivenProperty"),xt(Ye,"CrossFadedProperty"),xt(rt,"ColorRampProperty");const $t={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ot{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ct{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Je(s,n=1){let o=0,c=0;return{members:s.map(d=>{const m=$t[d.type].BYTES_PER_ELEMENT,_=o=Xt(o,Math.max(n,m)),x=d.components||1;return c=Math.max(c,m),o+=m*x,{name:d.name,type:d.type,components:x,offset:_}}),size:Xt(o,Math.max(c,n)),alignment:n}}function Xt(s,n){return Math.ceil(s/n)*n}class tn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const c=this.length;return this.resize(c+1),this.emplace(c,n,o)}emplace(n,o,c){const d=2*n;return this.int16[d+0]=o,this.int16[d+1]=c,n}}tn.prototype.bytesPerElement=4,xt(tn,"StructArrayLayout2i4");class Nn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,n,o,c)}emplace(n,o,c,d){const m=3*n;return this.int16[m+0]=o,this.int16[m+1]=c,this.int16[m+2]=d,n}}Nn.prototype.bytesPerElement=6,xt(Nn,"StructArrayLayout3i6");class Un extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,c,d)}emplace(n,o,c,d,m){const _=4*n;return this.int16[_+0]=o,this.int16[_+1]=c,this.int16[_+2]=d,this.int16[_+3]=m,n}}Un.prototype.bytesPerElement=8,xt(Un,"StructArrayLayout4i8");class Pn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,c,d,m,_,x)}emplace(n,o,c,d,m,_,x,w){const E=6*n,S=12*n,M=3*n;return this.int16[E+0]=o,this.int16[E+1]=c,this.uint8[S+4]=d,this.uint8[S+5]=m,this.uint8[S+6]=_,this.uint8[S+7]=x,this.float32[M+2]=w,n}}Pn.prototype.bytesPerElement=12,xt(Pn,"StructArrayLayout2i4ub1f12");class Mi extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,c,d)}emplace(n,o,c,d,m){const _=4*n;return this.float32[_+0]=o,this.float32[_+1]=c,this.float32[_+2]=d,this.float32[_+3]=m,n}}Mi.prototype.bytesPerElement=16,xt(Mi,"StructArrayLayout4f16");class ur extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m,_,x,w,E,S){const M=this.length;return this.resize(M+1),this.emplace(M,n,o,c,d,m,_,x,w,E,S)}emplace(n,o,c,d,m,_,x,w,E,S,M){const D=10*n;return this.uint16[D+0]=o,this.uint16[D+1]=c,this.uint16[D+2]=d,this.uint16[D+3]=m,this.uint16[D+4]=_,this.uint16[D+5]=x,this.uint16[D+6]=w,this.uint16[D+7]=E,this.uint16[D+8]=S,this.uint16[D+9]=M,n}}ur.prototype.bytesPerElement=20,xt(ur,"StructArrayLayout10ui20");class xs extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m,_,x,w){const E=this.length;return this.resize(E+1),this.emplace(E,n,o,c,d,m,_,x,w)}emplace(n,o,c,d,m,_,x,w,E){const S=8*n;return this.uint16[S+0]=o,this.uint16[S+1]=c,this.uint16[S+2]=d,this.uint16[S+3]=m,this.uint16[S+4]=_,this.uint16[S+5]=x,this.uint16[S+6]=w,this.uint16[S+7]=E,n}}xs.prototype.bytesPerElement=16,xt(xs,"StructArrayLayout8ui16");class Xn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,c,d,m,_)}emplace(n,o,c,d,m,_,x){const w=6*n;return this.int16[w+0]=o,this.int16[w+1]=c,this.int16[w+2]=d,this.int16[w+3]=m,this.int16[w+4]=_,this.int16[w+5]=x,n}}Xn.prototype.bytesPerElement=12,xt(Xn,"StructArrayLayout6i12");class oi extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m,_,x,w,E,S,M,D){const O=this.length;return this.resize(O+1),this.emplace(O,n,o,c,d,m,_,x,w,E,S,M,D)}emplace(n,o,c,d,m,_,x,w,E,S,M,D,O){const B=12*n;return this.int16[B+0]=o,this.int16[B+1]=c,this.int16[B+2]=d,this.int16[B+3]=m,this.uint16[B+4]=_,this.uint16[B+5]=x,this.uint16[B+6]=w,this.uint16[B+7]=E,this.int16[B+8]=S,this.int16[B+9]=M,this.int16[B+10]=D,this.int16[B+11]=O,n}}oi.prototype.bytesPerElement=24,xt(oi,"StructArrayLayout4i4ui4i24");class Mn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,c,d,m,_)}emplace(n,o,c,d,m,_,x){const w=10*n,E=5*n;return this.int16[w+0]=o,this.int16[w+1]=c,this.int16[w+2]=d,this.float32[E+2]=m,this.float32[E+3]=_,this.float32[E+4]=x,n}}Mn.prototype.bytesPerElement=20,xt(Mn,"StructArrayLayout3i3f20");class _i extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}_i.prototype.bytesPerElement=4,xt(_i,"StructArrayLayout1ul4");class Ji extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m,_,x,w,E,S,M,D,O){const B=this.length;return this.resize(B+1),this.emplace(B,n,o,c,d,m,_,x,w,E,S,M,D,O)}emplace(n,o,c,d,m,_,x,w,E,S,M,D,O,B){const U=20*n,$=10*n;return this.int16[U+0]=o,this.int16[U+1]=c,this.int16[U+2]=d,this.int16[U+3]=m,this.int16[U+4]=_,this.float32[$+3]=x,this.float32[$+4]=w,this.float32[$+5]=E,this.float32[$+6]=S,this.int16[U+14]=M,this.uint32[$+8]=D,this.uint16[U+18]=O,this.uint16[U+19]=B,n}}Ji.prototype.bytesPerElement=40,xt(Ji,"StructArrayLayout5i4f1i1ul2ui40");class qn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,c,d,m,_,x)}emplace(n,o,c,d,m,_,x,w){const E=8*n;return this.int16[E+0]=o,this.int16[E+1]=c,this.int16[E+2]=d,this.int16[E+4]=m,this.int16[E+5]=_,this.int16[E+6]=x,this.int16[E+7]=w,n}}qn.prototype.bytesPerElement=16,xt(qn,"StructArrayLayout3i2i2i16");class Ir extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,c,d,m)}emplace(n,o,c,d,m,_){const x=4*n,w=8*n;return this.float32[x+0]=o,this.float32[x+1]=c,this.float32[x+2]=d,this.int16[w+6]=m,this.int16[w+7]=_,n}}Ir.prototype.bytesPerElement=16,xt(Ir,"StructArrayLayout2f1f2i16");class Oo extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,c,d)}emplace(n,o,c,d,m){const _=12*n,x=3*n;return this.uint8[_+0]=o,this.uint8[_+1]=c,this.float32[x+1]=d,this.float32[x+2]=m,n}}Oo.prototype.bytesPerElement=12,xt(Oo,"StructArrayLayout2ub2f12");class is extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,n,o,c)}emplace(n,o,c,d){const m=3*n;return this.float32[m+0]=o,this.float32[m+1]=c,this.float32[m+2]=d,n}}is.prototype.bytesPerElement=12,xt(is,"StructArrayLayout3f12");class hr extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,n,o,c)}emplace(n,o,c,d){const m=3*n;return this.uint16[m+0]=o,this.uint16[m+1]=c,this.uint16[m+2]=d,n}}hr.prototype.bytesPerElement=6,xt(hr,"StructArrayLayout3ui6");class La extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m,_,x,w,E,S,M,D,O,B,U,$,ne,ue,te,oe,fe){const ae=this.length;return this.resize(ae+1),this.emplace(ae,n,o,c,d,m,_,x,w,E,S,M,D,O,B,U,$,ne,ue,te,oe,fe)}emplace(n,o,c,d,m,_,x,w,E,S,M,D,O,B,U,$,ne,ue,te,oe,fe,ae){const Se=30*n,Ee=15*n,Le=60*n;return this.int16[Se+0]=o,this.int16[Se+1]=c,this.int16[Se+2]=d,this.float32[Ee+2]=m,this.float32[Ee+3]=_,this.uint16[Se+8]=x,this.uint16[Se+9]=w,this.uint32[Ee+5]=E,this.uint32[Ee+6]=S,this.uint32[Ee+7]=M,this.uint16[Se+16]=D,this.uint16[Se+17]=O,this.uint16[Se+18]=B,this.float32[Ee+10]=U,this.float32[Ee+11]=$,this.uint8[Le+48]=ne,this.uint8[Le+49]=ue,this.uint8[Le+50]=te,this.uint32[Ee+13]=oe,this.int16[Se+28]=fe,this.uint8[Le+58]=ae,n}}La.prototype.bytesPerElement=60,xt(La,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class io extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m,_,x,w,E,S,M,D,O,B,U,$,ne,ue,te,oe,fe,ae,Se,Ee,Le,We,Ce,Oe,Ne,je){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,n,o,c,d,m,_,x,w,E,S,M,D,O,B,U,$,ne,ue,te,oe,fe,ae,Se,Ee,Le,We,Ce,Oe,Ne,je)}emplace(n,o,c,d,m,_,x,w,E,S,M,D,O,B,U,$,ne,ue,te,oe,fe,ae,Se,Ee,Le,We,Ce,Oe,Ne,je,Ze){const ke=38*n,at=19*n;return this.int16[ke+0]=o,this.int16[ke+1]=c,this.int16[ke+2]=d,this.float32[at+2]=m,this.float32[at+3]=_,this.int16[ke+8]=x,this.int16[ke+9]=w,this.int16[ke+10]=E,this.int16[ke+11]=S,this.int16[ke+12]=M,this.int16[ke+13]=D,this.uint16[ke+14]=O,this.uint16[ke+15]=B,this.uint16[ke+16]=U,this.uint16[ke+17]=$,this.uint16[ke+18]=ne,this.uint16[ke+19]=ue,this.uint16[ke+20]=te,this.uint16[ke+21]=oe,this.uint16[ke+22]=fe,this.uint16[ke+23]=ae,this.uint16[ke+24]=Se,this.uint16[ke+25]=Ee,this.uint16[ke+26]=Le,this.uint16[ke+27]=We,this.uint16[ke+28]=Ce,this.uint32[at+15]=Oe,this.float32[at+16]=Ne,this.float32[at+17]=je,this.float32[at+18]=Ze,n}}io.prototype.bytesPerElement=76,xt(io,"StructArrayLayout3i2f6i15ui1ul3f76");class Vi extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}Vi.prototype.bytesPerElement=4,xt(Vi,"StructArrayLayout1f4");class bs extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,c,d,m)}emplace(n,o,c,d,m,_){const x=5*n;return this.float32[x+0]=o,this.float32[x+1]=c,this.float32[x+2]=d,this.float32[x+3]=m,this.float32[x+4]=_,n}}bs.prototype.bytesPerElement=20,xt(bs,"StructArrayLayout5f20");class ro extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,c,d)}emplace(n,o,c,d,m){const _=6*n;return this.uint32[3*n+0]=o,this.uint16[_+2]=c,this.uint16[_+3]=d,this.uint16[_+4]=m,n}}ro.prototype.bytesPerElement=12,xt(ro,"StructArrayLayout1ul3ui12");class rs extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const c=this.length;return this.resize(c+1),this.emplace(c,n,o)}emplace(n,o,c){const d=2*n;return this.uint16[d+0]=o,this.uint16[d+1]=c,n}}rs.prototype.bytesPerElement=4,xt(rs,"StructArrayLayout2ui4");class qd extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}qd.prototype.bytesPerElement=2,xt(qd,"StructArrayLayout1ui2");class Jm extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const c=this.length;return this.resize(c+1),this.emplace(c,n,o)}emplace(n,o,c){const d=2*n;return this.float32[d+0]=o,this.float32[d+1]=c,n}}Jm.prototype.bytesPerElement=8,xt(Jm,"StructArrayLayout2f8");class tb extends Ot{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}tb.prototype.size=12;class nb extends Xn{get(n){return new tb(this,n)}}xt(nb,"FillExtrusionExtArray");class ib extends Ot{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ib.prototype.size=40;class Ky extends Ji{get(n){return new ib(this,n)}}xt(Ky,"CollisionBoxArray");class rb extends Ot{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}rb.prototype.size=60;class sb extends La{get(n){return new rb(this,n)}}xt(sb,"PlacedSymbolArray");class ob extends Ot{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(n){this._structArray.uint32[this._pos4+15]=n}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ob.prototype.size=76;class ab extends io{get(n){return new ob(this,n)}}xt(ab,"SymbolInstanceArray");class lb extends Vi{getoffsetX(n){return this.float32[1*n+0]}}xt(lb,"GlyphOffsetArray");class cb extends Nn{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}xt(cb,"SymbolLineVertexArray");class ub extends Ot{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ub.prototype.size=12;class hb extends ro{get(n){return new ub(this,n)}}xt(hb,"FeatureIndexArray");class db extends Ot{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}db.prototype.size=4;class fb extends rs{get(n){return new db(this,n)}}xt(fb,"FillExtrusionCentroidArray");class pb extends Ot{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}pb.prototype.size=12;class mb extends Xn{get(n){return new pb(this,n)}}xt(mb,"CircleGlobeExtArray");const Gk=Je([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),$k=Je([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Lu={exports:{}},gb={exports:{}};gb.exports=function(s,n){var o,c,d,m,_,x,w,E;for(c=s.length-(o=3&s.length),d=n,_=3432918353,x=461845907,E=0;E<c;)w=255&s.charCodeAt(E)|(255&s.charCodeAt(++E))<<8|(255&s.charCodeAt(++E))<<16|(255&s.charCodeAt(++E))<<24,++E,d=27492+(65535&(m=5*(65535&(d=(d^=w=(65535&(w=(w=(65535&w)*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,o){case 3:w^=(255&s.charCodeAt(E+2))<<16;case 2:w^=(255&s.charCodeAt(E+1))<<8;case 1:d^=w=(65535&(w=(w=(65535&(w^=255&s.charCodeAt(E)))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return d^=s.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var _b={exports:{}};_b.exports=function(s,n){for(var o,c=s.length,d=n^c,m=0;c>=4;)o=1540483477*(65535&(o=255&s.charCodeAt(m)|(255&s.charCodeAt(++m))<<8|(255&s.charCodeAt(++m))<<16|(255&s.charCodeAt(++m))<<24))+((1540483477*(o>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++m;switch(c){case 3:d^=(255&s.charCodeAt(m+2))<<16;case 2:d^=(255&s.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&s.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var yb=gb.exports,qk=_b.exports;Lu.exports=yb,Lu.exports.murmur3=yb,Lu.exports.murmur2=qk;class eg{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,o,c,d){this.ids.push(vb(n)),this.positions.push(o,c,d)}getPositions(n){const o=vb(n);let c=0,d=this.ids.length-1;for(;c<d;){const _=c+d>>1;this.ids[_]>=o?d=_:c=_+1}const m=[];for(;this.ids[c]===o;)m.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return m}static serialize(n,o){const c=new Float64Array(n.ids),d=new Uint32Array(n.positions);return Yy(c,d,0,c.length-1),o&&o.push(c.buffer,d.buffer),{ids:c,positions:d}}static deserialize(n){const o=new eg;return o.ids=n.ids,o.positions=n.positions,o.indexed=!0,o}}function vb(s){const n=+s;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:Lu.exports(String(s))}function Yy(s,n,o,c){for(;o<c;){const d=s[o+c>>1];let m=o-1,_=c+1;for(;;){do m++;while(s[m]<d);do _--;while(s[_]>d);if(m>=_)break;tg(s,m,_),tg(n,3*m,3*_),tg(n,3*m+1,3*_+1),tg(n,3*m+2,3*_+2)}_-o<c-_?(Yy(s,n,o,_),o=_+1):(Yy(s,n,_+1,c),c=_)}}function tg(s,n,o){const c=s[n];s[n]=s[o],s[o]=c}xt(eg,"FeaturePositionMap");class Bo{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}}class ng extends Bo{constructor(n){super(n),this.current=0}set(n,o,c){this.fetchUniformLocation(n,o)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class xb extends Bo{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,c){this.fetchUniformLocation(n,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class bb extends Bo{constructor(n){super(n),this.current=di.transparent}set(n,o,c){this.fetchUniformLocation(n,o)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const Wk=new Float32Array(16),Zk=new Float32Array(9),Hk=new Float32Array(4);function Qy(s){return[At(255*s.r,255*s.g),At(255*s.b,255*s.a)]}class Wd{constructor(n,o,c){this.value=n,this.uniformNames=o.map(d=>`u_${d}`),this.type=c}setUniform(n,o,c,d,m){o.set(n,m,d.constantOr(this.value))}getBinding(n,o){return this.type==="color"?new bb(n):new ng(n)}}class zu{constructor(n,o){this.uniformNames=o.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,o){this.pixelRatioFrom=o.pixelRatio||1,this.pixelRatioTo=n.pixelRatio||1,this.patternFrom=o.tl.concat(o.br),this.patternTo=n.tl.concat(n.br)}setUniform(n,o,c,d,m){const _=m==="u_pattern_to"||m==="u_dash_to"?this.patternTo:m==="u_pattern_from"||m==="u_dash_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&o.set(n,m,_)}getBinding(n,o){return o==="u_pattern_from"||o==="u_pattern_to"||o==="u_dash_from"||o==="u_dash_to"?new xb(n):new ng(n)}}class Fo{constructor(n,o,c,d){this.expression=n,this.type=c,this.maxValue=0,this.paintVertexAttributes=o.map(m=>({name:`a_${m}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(n,o,c,d,m,_){const x=this.paintVertexArray.length,w=this.expression.evaluate(new ie(0),o,{},m,d,_);this.paintVertexArray.resize(n),this._setPaintValue(x,n,w)}updatePaintArray(n,o,c,d,m){const _=this.expression.evaluate({zoom:0},c,d,void 0,m);this._setPaintValue(n,o,_)}_setPaintValue(n,o,c){if(this.type==="color"){const d=Qy(c);for(let m=n;m<o;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=n;d<o;d++)this.paintVertexArray.emplace(d,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Os{constructor(n,o,c,d,m,_){this.expression=n,this.uniformNames=o.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=o.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,o,c,d,m,_){const x=this.expression.evaluate(new ie(this.zoom),o,{},m,d,_),w=this.expression.evaluate(new ie(this.zoom+1),o,{},m,d,_),E=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(E,n,x,w)}updatePaintArray(n,o,c,d,m){const _=this.expression.evaluate({zoom:this.zoom},c,d,void 0,m),x=this.expression.evaluate({zoom:this.zoom+1},c,d,void 0,m);this._setPaintValue(n,o,_,x)}_setPaintValue(n,o,c,d){if(this.type==="color"){const m=Qy(c),_=Qy(d);for(let x=n;x<o;x++)this.paintVertexArray.emplace(x,m[0],m[1],_[0],_[1])}else{for(let m=n;m<o;m++)this.paintVertexArray.emplace(m,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,c,d,m){const _=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=Xe(this.expression.interpolationFactor(_,this.zoom,this.zoom+1),0,1);o.set(n,m,x)}getBinding(n,o){return new ng(n)}}class za{constructor(n,o,c,d,m,_,x){this.expression=n,this.type=c,this.useIntegerZoom=d,this.zoom=m,this.layerId=x,this.paintVertexAttributes=(c==="array"?$k:Gk).members;for(let w=0;w<o.length;++w);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(n,o,c){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(d,n,o.patterns&&o.patterns[this.layerId],c)}updatePaintArray(n,o,c,d,m,_){this._setPaintValues(n,o,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(n,o,c,d){if(!d||!c)return;const{min:m,mid:_,max:x}=c,w=d[m],E=d[_],S=d[x];if(w&&E&&S)for(let M=n;M<o;M++)this._setPaintValue(this.zoomInPaintVertexArray,M,E,w),this._setPaintValue(this.zoomOutPaintVertexArray,M,E,S)}_setPaintValue(n,o,c,d){n.emplace(o,c.tl[0],c.tl[1],c.br[0],c.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1],c.pixelRatio,d.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Oa{constructor(n,o,c=()=>!0){this.binders={},this._buffers=[];const d=[];for(const m in n.paint._values){if(!c(m))continue;const _=n.paint.get(m);if(!(_ instanceof Fe&&Da(_.property.specification)))continue;const x=Kk(m,n.type),w=_.value,E=_.property.specification.type,S=_.property.useIntegerZoom,M=_.property.specification["property-type"],D=M==="cross-faded"||M==="cross-faded-data-driven",O=String(m)==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||O)if(w.kind==="source"||O||D){const B=wb(m,E,"source");this.binders[m]=D?new za(w,x,E,S,o,B,n.id):new Fo(w,x,E,B),d.push(`/a_${m}`)}else{const B=wb(m,E,"composite");this.binders[m]=new Os(w,x,E,S,o,B),d.push(`/z_${m}`)}else this.binders[m]=D?new zu(w.value,x):new Wd(w.value,x,E),d.push(`/u_${m}`)}this.cacheKey=d.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof Fo||o instanceof Os?o.maxValue:0}populatePaintArrays(n,o,c,d,m,_){for(const x in this.binders){const w=this.binders[x];(w instanceof Fo||w instanceof Os||w instanceof za)&&w.populatePaintArray(n,o,c,d,m,_)}}setConstantPatternPositions(n,o){for(const c in this.binders){const d=this.binders[c];d instanceof zu&&d.setConstantPatternPositions(n,o)}}updatePaintArrays(n,o,c,d,m,_){let x=!1;for(const w in n){const E=o.getPositions(w);for(const S of E){const M=c.feature(S.index);for(const D in this.binders){const O=this.binders[D];if((O instanceof Fo||O instanceof Os||O instanceof za)&&O.expression.isStateDependent===!0){const B=d.paint.get(D);O.expression=B.value,O.updatePaintArray(S.start,S.end,M,n[w],m,_),x=!0}}}}return x}defines(){const n=[];for(const o in this.binders){const c=this.binders[o];(c instanceof Wd||c instanceof zu)&&n.push(...c.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return n}getBinderAttributes(){const n=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Fo||c instanceof Os||c instanceof za)for(let d=0;d<c.paintVertexAttributes.length;d++)n.push(c.paintVertexAttributes[d].name)}return n}getBinderUniforms(){const n=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Wd||c instanceof zu||c instanceof Os)for(const d of c.uniformNames)n.push(d)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Wd||d instanceof zu||d instanceof Os)for(const m of d.uniformNames)o.push({name:m,property:c,binding:d.getBinding(n,m)})}return o}setUniforms(n,o,c,d,m){for(const{name:_,property:x,binding:w}of c)this.binders[x].setUniform(n,w,m,d.get(x),_)}updatePaintBuffers(n){this._buffers=[];for(const o in this.binders){const c=this.binders[o];if(n&&c instanceof za){const d=n.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(c instanceof Fo||c instanceof Os)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(n){for(const o in this.binders){const c=this.binders[o];(c instanceof Fo||c instanceof Os||c instanceof za)&&c.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof Fo||o instanceof Os||o instanceof za)&&o.destroy()}}}class Ql{constructor(n,o,c=()=>!0){this.programConfigurations={};for(const d of n)this.programConfigurations[d.id]=new Oa(d,o,c);this.needsUpload=!1,this._featureMap=new eg,this._bufferOffset=0}populatePaintArrays(n,o,c,d,m,_,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(n,o,d,m,_,x);o.id!==void 0&&this._featureMap.add(o.id,c,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,c,d,m){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(n,this._featureMap,o,_,d,m)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const Xk={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Kk(s,n){return Xk[s]||[s.replace(`${n}-`,"").replace(/-/g,"_")]}const Yk={"line-pattern":{source:ur,composite:ur},"fill-pattern":{source:ur,composite:ur},"fill-extrusion-pattern":{source:ur,composite:ur},"line-dasharray":{source:xs,composite:xs}},Qk={color:{source:Jm,composite:Mi},number:{source:Vi,composite:Jm}};function wb(s,n,o){const c=Yk[s];return c&&c[o]||Qk[n][o]}xt(Wd,"ConstantBinder"),xt(zu,"CrossFadedConstantBinder"),xt(Fo,"SourceExpressionBinder"),xt(za,"CrossFadedCompositeBinder"),xt(Os,"CompositeExpressionBinder"),xt(Oa,"ProgramConfiguration",{omit:["_buffers"]}),xt(Ql,"ProgramConfigurationSet");const ig="-transition";class Bs extends Cs{constructor(n,o){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),o.layout&&(this._unevaluatedLayout=new _e(o.layout)),o.paint)){this._transitionablePaint=new Ae(o.paint);for(const c in n.paint)this.setPaintProperty(c,n.paint[c],{validate:!1});for(const c in n.layout)this.setLayoutProperty(c,n.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Be(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o,c={}){o!=null&&this._validate(Xy,`layers.${this.id}.layout.${n}`,n,o,c)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,o):this.visibility=o)}getPaintProperty(n){return vn(n,ig)?this._transitionablePaint.getTransition(n.slice(0,-ig.length)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o,c={}){if(o!=null&&this._validate(Hy,`layers.${this.id}.paint.${n}`,n,o,c))return!1;if(vn(n,ig))return this._transitionablePaint.setTransition(n.slice(0,-ig.length),o||void 0),!1;{const d=this._transitionablePaint._values[n],m=d.property.specification["property-type"]==="cross-faded-data-driven",_=d.value.isDataDriven(),x=d.value;this._transitionablePaint.setValue(n,o),this._handleSpecialPaintPropertyUpdate(n);const w=this._transitionablePaint._values[n].value;return w.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(n,x,w)}}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getProgramConfiguration(n){return null}_handleOverridablePaintPropertyUpdate(n,o,c){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Vr(n,(o,c)=>!(o===void 0||c==="layout"&&!Object.keys(o).length||c==="paint"&&!Object.keys(o).length))}_validate(n,o,c,d,m={}){return(!m||m.validate!==!1)&&Nd(this,n.call(Fm,{key:o,layerType:this.type,objectKey:c,value:d,styleSpec:De,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof Fe&&Da(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=bu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Jk=Je([{name:"a_pos",components:2,type:"Int16"}],4),eM=Je([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ei{constructor(n=[]){this.segments=n}prepareSegment(n,o,c,d){let m=this.segments[this.segments.length-1];return n>Ei.MAX_VERTEX_ARRAY_LENGTH&&xn(`Max vertices per segment is ${Ei.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!m||m.vertexLength+n>Ei.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:o.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,c,d){return new Ei([{vertexOffset:n,primitiveOffset:o,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}Ei.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xt(Ei,"SegmentVector");var Zt=8192;class Ba{constructor(n,o){n&&(o?this.setSouthWest(n).setNorthEast(o):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof kn?new kn(n.lng,n.lat):kn.convert(n),this}setSouthWest(n){return this._sw=n instanceof kn?new kn(n.lng,n.lat):kn.convert(n),this}extend(n){const o=this._sw,c=this._ne;let d,m;if(n instanceof kn)d=n,m=n;else{if(!(n instanceof Ba))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Ba.convert(n)):this.extend(kn.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&n.hasOwnProperty("lon")?this.extend(kn.convert(n)):this;if(d=n._sw,m=n._ne,!d||!m)return this}return o||c?(o.lng=Math.min(d.lng,o.lng),o.lat=Math.min(d.lat,o.lat),c.lng=Math.max(m.lng,c.lng),c.lat=Math.max(m.lat,c.lat)):(this._sw=new kn(d.lng,d.lat),this._ne=new kn(m.lng,m.lat)),this}getCenter(){return new kn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new kn(this.getWest(),this.getNorth())}getSouthEast(){return new kn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:c}=kn.convert(n);let d=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(n){return!n||n instanceof Ba?n:new Ba(n)}}const rg=63710088e-1;class kn{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kn(li(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,c=this.lat*o,d=n.lat*o,m=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((n.lng-this.lng)*o);return rg*Math.acos(Math.min(m,1))}toBounds(n=0){const o=360*n/40075017,c=o/Math.cos(Math.PI/180*this.lat);return new Ba(new kn(this.lng-c,this.lat-o),new kn(this.lng+c,this.lat+o))}static convert(n){if(n instanceof kn)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new kn(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new kn(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Tb=2*Math.PI*rg;function Jy(s){return Tb*Math.cos(s*Math.PI/180)}function so(s){return(180+s)/360}function oo(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function ws(s,n){return s/Jy(n)}function ss(s){return 360*s-180}function er(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Eb(s,n){return s*Jy(er(n))}const ao=85.051129;function Ib(s){return 1/Math.cos(s*Math.PI/180)}class Ou{constructor(n,o,c=0){this.x=+n,this.y=+o,this.z=+c}static fromLngLat(n,o=0){const c=kn.convert(n);return new Ou(so(c.lng),oo(c.lat),ws(o,c.lat))}toLngLat(){return new kn(ss(this.x),er(this.y))}toAltitude(){return Eb(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Tb*Ib(er(this.y))}}function ev(s,n,o,c,d,m,_,x,w){const E=(n+c)/2,S=(o+d)/2,M=new ge(E,S);x(M),function(D,O,B,U,$,ne){const ue=B-$,te=U-ne;return Math.abs((U-O)*ue-(B-D)*te)/Math.hypot(ue,te)}(M.x,M.y,m.x,m.y,_.x,_.y)>=w?(ev(s,n,o,E,S,m,M,x,w),ev(s,E,S,c,d,M,_,x,w)):s.push(_)}function Sb(s,n,o){let c=s[0],d=c.x,m=c.y;n(c);const _=[c];for(let x=1;x<s.length;x++){const w=s[x],{x:E,y:S}=w;n(w),ev(_,d,m,E,S,c,w,n,o),d=E,m=S,c=w}return _}function tv(s,n,o,c){if(c(n,o)){const d=n.add(o)._mult(.5);tv(s,n,d,c),tv(s,d,o,c)}else s.push(o)}function tM(s,n){let o=s[0];const c=[o];for(let d=1;d<s.length;d++){const m=s[d];tv(c,o,m,n),o=m}return c}const nv=Math.pow(2,14)-1,Ab=-nv-1;function nM(s,n){const o=Math.round(s.x*n),c=Math.round(s.y*n);return s.x=Xe(o,Ab,nv),s.y=Xe(c,Ab,nv),(o<s.x||o>s.x+1||c<s.y||c>s.y+1)&&xn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function No(s,n,o){const c=s.loadGeometry(),d=s.extent,m=Zt/d;if(n&&o&&o.projection.isReprojectedInTileSpace){const _=1<<n.z,{scale:x,x:w,y:E,projection:S}=o,M=D=>{const O=ss((n.x+D.x/d)/_),B=er((n.y+D.y/d)/_),U=S.project(O,B);D.x=(U.x*x-w)*d,D.y=(U.y*x-E)*d};for(let D=0;D<c.length;D++)if(s.type!==1)c[D]=Sb(c[D],M,1);else{const O=[];for(const B of c[D])B.x<0||B.x>=d||B.y<0||B.y>=d||(M(B),O.push(B));c[D]=O}}for(const _ of c)for(const x of _)nM(x,m);return c}function Jl(s,n){return{type:s.type,id:s.id,properties:s.properties,geometry:n?No(s):[]}}function sg(s,n,o,c,d){s.emplaceBack(2*n+(c+1)/2,2*o+(d+1)/2)}function og(s,n,o){s.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class iv{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new tn,this.indexArray=new hr,this.segments=new Ei,this.programConfigurations=new Ql(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,c,d){const m=this.layers[0],_=[];let x=null;m.type==="circle"&&(x=m.layout.get("circle-sort-key"));for(const{feature:E,id:S,index:M,sourceLayerIndex:D}of n){const O=this.layers[0]._featureFilter.needGeometry,B=Jl(E,O);if(!this.layers[0]._featureFilter.filter(new ie(this.zoom),B,c))continue;const U=x?x.evaluate(B,{},c):void 0,$={id:S,properties:E.properties,type:E.type,sourceLayerIndex:D,index:M,geometry:O?B.geometry:No(E,c,d),patterns:{},sortKey:U};_.push($)}x&&_.sort((E,S)=>E.sortKey-S.sortKey);let w=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new mb,w=d.projection);for(const E of _){const{geometry:S,index:M,sourceLayerIndex:D}=E,O=n[M].feature;this.addFeature(E,S,M,o.availableImages,c,w),o.featureIndex.insert(O,S,M,D,this.index)}}update(n,o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Jk.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,eM.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,o,c,d,m,_){for(const x of o)for(const w of x){const E=w.x,S=w.y;if(E<0||E>=Zt||S<0||S>=Zt)continue;if(_){const O=_.projectTilePoint(E,S,m),B=_.upVector(m,E,S),U=this.globeExtVertexArray;og(U,O,B),og(U,O,B),og(U,O,B),og(U,O,B)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),D=M.vertexLength;sg(this.layoutVertexArray,E,S,-1,-1),sg(this.layoutVertexArray,E,S,1,-1),sg(this.layoutVertexArray,E,S,1,1),sg(this.layoutVertexArray,E,S,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,{},d,m)}}function Cb(s,n){for(let o=0;o<s.length;o++)if(ec(n,s[o]))return!0;for(let o=0;o<n.length;o++)if(ec(s,n[o]))return!0;return!!rv(s,n)}function iM(s,n,o){return!!ec(s,n)||!!sv(n,s,o)}function kb(s,n){if(s.length===1)return Db(n,s[0]);for(let o=0;o<n.length;o++){const c=n[o];for(let d=0;d<c.length;d++)if(ec(s,c[d]))return!0}for(let o=0;o<s.length;o++)if(Db(n,s[o]))return!0;for(let o=0;o<n.length;o++)if(rv(s,n[o]))return!0;return!1}function rM(s,n,o){if(s.length>1){if(rv(s,n))return!0;for(let c=0;c<n.length;c++)if(sv(n[c],s,o))return!0}for(let c=0;c<s.length;c++)if(sv(s[c],n,o))return!0;return!1}function rv(s,n){if(s.length===0||n.length===0)return!1;for(let o=0;o<s.length-1;o++){const c=s[o],d=s[o+1];for(let m=0;m<n.length-1;m++)if(sM(c,d,n[m],n[m+1]))return!0}return!1}function sM(s,n,o,c){return xr(s,o,c)!==xr(n,o,c)&&xr(s,n,o)!==xr(s,n,c)}function sv(s,n,o){const c=o*o;if(n.length===1)return s.distSqr(n[0])<c;for(let d=1;d<n.length;d++)if(Mb(s,n[d-1],n[d])<c)return!0;return!1}function Mb(s,n,o){const c=n.distSqr(o);if(c===0)return s.distSqr(n);const d=((s.x-n.x)*(o.x-n.x)+(s.y-n.y)*(o.y-n.y))/c;return s.distSqr(d<0?n:d>1?o:o.sub(n)._mult(d)._add(n))}function Db(s,n){let o,c,d,m=!1;for(let _=0;_<s.length;_++){o=s[_];for(let x=0,w=o.length-1;x<o.length;w=x++)c=o[x],d=o[w],c.y>n.y!=d.y>n.y&&n.x<(d.x-c.x)*(n.y-c.y)/(d.y-c.y)+c.x&&(m=!m)}return m}function ec(s,n){let o=!1;for(let c=0,d=s.length-1;c<s.length;d=c++){const m=s[c],_=s[d];m.y>n.y!=_.y>n.y&&n.x<(_.x-m.x)*(n.y-m.y)/(_.y-m.y)+m.x&&(o=!o)}return o}function Pb(s,n,o,c,d){for(const _ of s)if(n<=_.x&&o<=_.y&&c>=_.x&&d>=_.y)return!0;const m=[new ge(n,o),new ge(n,d),new ge(c,d),new ge(c,o)];if(s.length>2){for(const _ of m)if(ec(s,_))return!0}for(let _=0;_<s.length-1;_++)if(oM(s[_],s[_+1],m))return!0;return!1}function oM(s,n,o){const c=o[0],d=o[2];if(s.x<c.x&&n.x<c.x||s.x>d.x&&n.x>d.x||s.y<c.y&&n.y<c.y||s.y>d.y&&n.y>d.y)return!1;const m=xr(s,n,o[0]);return m!==xr(s,n,o[1])||m!==xr(s,n,o[2])||m!==xr(s,n,o[3])}function Bu(s,n,o){const c=n.paint.get(s).value;return c.kind==="constant"?c.value:o.programConfigurations.get(n.id).getMaxValue(s)}function ag(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Rb(s,n,o,c,d){if(!n[0]&&!n[1])return s;const m=ge.convert(n)._mult(d);o==="viewport"&&m._rotate(-c);const _=[];for(let x=0;x<s.length;x++)_.push(s[x].sub(m));return _}function Lb(s,n,o,c){const d=ge.convert(s)._mult(c);return n==="viewport"&&d._rotate(-o),d}xt(iv,"CircleBucket",{omit:["layers"]});const aM=new Qe({"circle-sort-key":new me(De.layout_circle["circle-sort-key"])});var lM={paint:new Qe({"circle-radius":new me(De.paint_circle["circle-radius"]),"circle-color":new me(De.paint_circle["circle-color"]),"circle-blur":new me(De.paint_circle["circle-blur"]),"circle-opacity":new me(De.paint_circle["circle-opacity"]),"circle-translate":new we(De.paint_circle["circle-translate"]),"circle-translate-anchor":new we(De.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new we(De.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new we(De.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new me(De.paint_circle["circle-stroke-width"]),"circle-stroke-color":new me(De.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new me(De.paint_circle["circle-stroke-opacity"])}),layout:aM},lg=1e-6,Gr=typeof Float32Array<"u"?Float32Array:Array;function zb(){var s=new Gr(9);return Gr!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Ob(s,n,o){var c=n[0],d=n[1],m=n[2],_=n[3],x=n[4],w=n[5],E=n[6],S=n[7],M=n[8],D=o[0],O=o[1],B=o[2],U=o[3],$=o[4],ne=o[5],ue=o[6],te=o[7],oe=o[8];return s[0]=D*c+O*_+B*E,s[1]=D*d+O*x+B*S,s[2]=D*m+O*w+B*M,s[3]=U*c+$*_+ne*E,s[4]=U*d+$*x+ne*S,s[5]=U*m+$*w+ne*M,s[6]=ue*c+te*_+oe*E,s[7]=ue*d+te*x+oe*S,s[8]=ue*m+te*w+oe*M,s}function lo(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function ov(s,n){var o=n[0],c=n[1],d=n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],S=n[8],M=n[9],D=n[10],O=n[11],B=n[12],U=n[13],$=n[14],ne=n[15],ue=o*x-c*_,te=o*w-d*_,oe=o*E-m*_,fe=c*w-d*x,ae=c*E-m*x,Se=d*E-m*w,Ee=S*U-M*B,Le=S*$-D*B,We=S*ne-O*B,Ce=M*$-D*U,Oe=M*ne-O*U,Ne=D*ne-O*$,je=ue*Ne-te*Oe+oe*Ce+fe*We-ae*Le+Se*Ee;return je?(s[0]=(x*Ne-w*Oe+E*Ce)*(je=1/je),s[1]=(d*Oe-c*Ne-m*Ce)*je,s[2]=(U*Se-$*ae+ne*fe)*je,s[3]=(D*ae-M*Se-O*fe)*je,s[4]=(w*We-_*Ne-E*Le)*je,s[5]=(o*Ne-d*We+m*Le)*je,s[6]=($*oe-B*Se-ne*te)*je,s[7]=(S*Se-D*oe+O*te)*je,s[8]=(_*Oe-x*We+E*Ee)*je,s[9]=(c*We-o*Oe-m*Ee)*je,s[10]=(B*ae-U*oe+ne*ue)*je,s[11]=(M*oe-S*ae-O*ue)*je,s[12]=(x*Le-_*Ce-w*Ee)*je,s[13]=(o*Ce-c*Le+d*Ee)*je,s[14]=(U*te-B*fe-$*ue)*je,s[15]=(S*fe-M*te+D*ue)*je,s):null}function Fu(s,n,o){var c=n[0],d=n[1],m=n[2],_=n[3],x=n[4],w=n[5],E=n[6],S=n[7],M=n[8],D=n[9],O=n[10],B=n[11],U=n[12],$=n[13],ne=n[14],ue=n[15],te=o[0],oe=o[1],fe=o[2],ae=o[3];return s[0]=te*c+oe*x+fe*M+ae*U,s[1]=te*d+oe*w+fe*D+ae*$,s[2]=te*m+oe*E+fe*O+ae*ne,s[3]=te*_+oe*S+fe*B+ae*ue,s[4]=(te=o[4])*c+(oe=o[5])*x+(fe=o[6])*M+(ae=o[7])*U,s[5]=te*d+oe*w+fe*D+ae*$,s[6]=te*m+oe*E+fe*O+ae*ne,s[7]=te*_+oe*S+fe*B+ae*ue,s[8]=(te=o[8])*c+(oe=o[9])*x+(fe=o[10])*M+(ae=o[11])*U,s[9]=te*d+oe*w+fe*D+ae*$,s[10]=te*m+oe*E+fe*O+ae*ne,s[11]=te*_+oe*S+fe*B+ae*ue,s[12]=(te=o[12])*c+(oe=o[13])*x+(fe=o[14])*M+(ae=o[15])*U,s[13]=te*d+oe*w+fe*D+ae*$,s[14]=te*m+oe*E+fe*O+ae*ne,s[15]=te*_+oe*S+fe*B+ae*ue,s}function Zd(s,n,o){var c,d,m,_,x,w,E,S,M,D,O,B,U=o[0],$=o[1],ne=o[2];return n===s?(s[12]=n[0]*U+n[4]*$+n[8]*ne+n[12],s[13]=n[1]*U+n[5]*$+n[9]*ne+n[13],s[14]=n[2]*U+n[6]*$+n[10]*ne+n[14],s[15]=n[3]*U+n[7]*$+n[11]*ne+n[15]):(d=n[1],m=n[2],_=n[3],x=n[4],w=n[5],E=n[6],S=n[7],M=n[8],D=n[9],O=n[10],B=n[11],s[0]=c=n[0],s[1]=d,s[2]=m,s[3]=_,s[4]=x,s[5]=w,s[6]=E,s[7]=S,s[8]=M,s[9]=D,s[10]=O,s[11]=B,s[12]=c*U+x*$+M*ne+n[12],s[13]=d*U+w*$+D*ne+n[13],s[14]=m*U+E*$+O*ne+n[14],s[15]=_*U+S*$+B*ne+n[15]),s}function tc(s,n,o){var c=o[0],d=o[1],m=o[2];return s[0]=n[0]*c,s[1]=n[1]*c,s[2]=n[2]*c,s[3]=n[3]*c,s[4]=n[4]*d,s[5]=n[5]*d,s[6]=n[6]*d,s[7]=n[7]*d,s[8]=n[8]*m,s[9]=n[9]*m,s[10]=n[10]*m,s[11]=n[11]*m,s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s}function av(s,n,o){var c=Math.sin(o),d=Math.cos(o),m=n[4],_=n[5],x=n[6],w=n[7],E=n[8],S=n[9],M=n[10],D=n[11];return n!==s&&(s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[4]=m*d+E*c,s[5]=_*d+S*c,s[6]=x*d+M*c,s[7]=w*d+D*c,s[8]=E*d-m*c,s[9]=S*d-_*c,s[10]=M*d-x*c,s[11]=D*d-w*c,s}function cg(s,n,o){var c=Math.sin(o),d=Math.cos(o),m=n[0],_=n[1],x=n[2],w=n[3],E=n[8],S=n[9],M=n[10],D=n[11];return n!==s&&(s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[0]=m*d-E*c,s[1]=_*d-S*c,s[2]=x*d-M*c,s[3]=w*d-D*c,s[8]=m*c+E*d,s[9]=_*c+S*d,s[10]=x*c+M*d,s[11]=w*c+D*d,s}function Bb(s,n){return s[0]=n[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Fb(s,n,o){var c,d,m,_=o[0],x=o[1],w=o[2],E=Math.hypot(_,x,w);return E<lg?null:(_*=E=1/E,x*=E,w*=E,c=Math.sin(n),d=Math.cos(n),s[0]=_*_*(m=1-d)+d,s[1]=x*_*m+w*c,s[2]=w*_*m-x*c,s[3]=0,s[4]=_*x*m-w*c,s[5]=x*x*m+d,s[6]=w*x*m+_*c,s[7]=0,s[8]=_*w*m+x*c,s[9]=x*w*m-_*c,s[10]=w*w*m+d,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,n=arguments.length;n--;)s+=arguments[n]*arguments[n];return Math.sqrt(s)});var cM=Fu;function lv(){var s=new Gr(3);return Gr!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Nb(s){var n=new Gr(3);return n[0]=s[0],n[1]=s[1],n[2]=s[2],n}function Hd(s){return Math.hypot(s[0],s[1],s[2])}function Nu(s,n,o){var c=new Gr(3);return c[0]=s,c[1]=n,c[2]=o,c}function Uo(s,n,o){return s[0]=n[0]+o[0],s[1]=n[1]+o[1],s[2]=n[2]+o[2],s}function cv(s,n,o){return s[0]=n[0]-o[0],s[1]=n[1]-o[1],s[2]=n[2]-o[2],s}function Ub(s,n,o){return s[0]=n[0]*o[0],s[1]=n[1]*o[1],s[2]=n[2]*o[2],s}function Xd(s,n,o){return s[0]=Math.min(n[0],o[0]),s[1]=Math.min(n[1],o[1]),s[2]=Math.min(n[2],o[2]),s}function Kd(s,n,o){return s[0]=Math.max(n[0],o[0]),s[1]=Math.max(n[1],o[1]),s[2]=Math.max(n[2],o[2]),s}function os(s,n,o){return s[0]=n[0]*o,s[1]=n[1]*o,s[2]=n[2]*o,s}function Yd(s,n,o,c){return s[0]=n[0]+o[0]*c,s[1]=n[1]+o[1]*c,s[2]=n[2]+o[2]*c,s}function Sr(s,n){var o=n[0],c=n[1],d=n[2],m=o*o+c*c+d*d;return m>0&&(m=1/Math.sqrt(m)),s[0]=n[0]*m,s[1]=n[1]*m,s[2]=n[2]*m,s}function Ts(s,n){return s[0]*n[0]+s[1]*n[1]+s[2]*n[2]}function uv(s,n,o){var c=n[0],d=n[1],m=n[2],_=o[0],x=o[1],w=o[2];return s[0]=d*w-m*x,s[1]=m*_-c*w,s[2]=c*x-d*_,s}function Ii(s,n,o){var c=n[0],d=n[1],m=n[2],_=o[3]*c+o[7]*d+o[11]*m+o[15];return s[0]=(o[0]*c+o[4]*d+o[8]*m+o[12])/(_=_||1),s[1]=(o[1]*c+o[5]*d+o[9]*m+o[13])/_,s[2]=(o[2]*c+o[6]*d+o[10]*m+o[14])/_,s}function Vb(s,n,o){var c=o[0],d=o[1],m=o[2],_=n[0],x=n[1],w=n[2],E=d*w-m*x,S=m*_-c*w,M=c*x-d*_,D=d*M-m*S,O=m*E-c*M,B=c*S-d*E,U=2*o[3];return S*=U,M*=U,O*=2,B*=2,s[0]=_+(E*=U)+(D*=2),s[1]=x+S+O,s[2]=w+M+B,s}var Qd,Fs=cv,uM=Ub,hM=Hd;function jb(s,n,o){return s[0]=n[0]*o,s[1]=n[1]*o,s[2]=n[2]*o,s[3]=n[3]*o,s}function Gb(s,n){var o=n[0],c=n[1],d=n[2],m=n[3],_=o*o+c*c+d*d+m*m;return _>0&&(_=1/Math.sqrt(_)),s[0]=o*_,s[1]=c*_,s[2]=d*_,s[3]=m*_,s}function nc(s,n,o){var c=n[0],d=n[1],m=n[2],_=n[3];return s[0]=o[0]*c+o[4]*d+o[8]*m+o[12]*_,s[1]=o[1]*c+o[5]*d+o[9]*m+o[13]*_,s[2]=o[2]*c+o[6]*d+o[10]*m+o[14]*_,s[3]=o[3]*c+o[7]*d+o[11]*m+o[15]*_,s}function $b(){var s=new Gr(4);return Gr!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function qb(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Wb(s,n,o){o*=.5;var c=n[0],d=n[1],m=n[2],_=n[3],x=Math.sin(o),w=Math.cos(o);return s[0]=c*w+_*x,s[1]=d*w+m*x,s[2]=m*w-d*x,s[3]=_*w-c*x,s}function Zb(s,n,o){o*=.5;var c=n[0],d=n[1],m=n[2],_=n[3],x=Math.sin(o),w=Math.cos(o);return s[0]=c*w-m*x,s[1]=d*w+_*x,s[2]=m*w+c*x,s[3]=_*w-d*x,s}lv(),Qd=new Gr(4),Gr!=Float32Array&&(Qd[0]=0,Qd[1]=0,Qd[2]=0,Qd[3]=0);var dM=Gb;lv(),Nu(1,0,0),Nu(0,1,0),$b(),$b(),zb();class hv{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,c){const d=Ts(o,this.dir);if(Math.abs(d)<1e-6)return!1;const m=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/d;return c[0]=this.pos[0]+this.dir[0]*m,c[1]=this.pos[1]+this.dir[1]*m,c[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(n,o,c){if(function(O,B){var U=O[0],$=O[1],ne=O[2],ue=B[0],te=B[1],oe=B[2];return Math.abs(U-ue)<=lg*Math.max(1,Math.abs(U),Math.abs(ue))&&Math.abs($-te)<=lg*Math.max(1,Math.abs($),Math.abs(te))&&Math.abs(ne-oe)<=lg*Math.max(1,Math.abs(ne),Math.abs(oe))}(this.pos,n)||o===0)return c[0]=c[1]=c[2]=0,!1;const[d,m,_]=this.dir,x=this.pos[0]-n[0],w=this.pos[1]-n[1],E=this.pos[2]-n[2],S=d*d+m*m+_*_,M=2*(x*d+w*m+E*_),D=M*M-4*S*(x*x+w*w+E*E-o*o);if(D<0){const O=Math.max(-M/2,0),B=x+d*O,U=w+m*O,$=E+_*O,ne=Math.hypot(B,U,$);return c[0]=B*o/ne,c[1]=U*o/ne,c[2]=$*o/ne,!1}{const O=(-M-Math.sqrt(D))/(2*S);if(O<0){const B=Math.hypot(x,w,E);return c[0]=x*o/B,c[1]=w*o/B,c[2]=E*o/B,!1}return c[0]=x+d*O,c[1]=w+m*O,c[2]=E+_*O,!0}}}class dv{constructor(n,o,c,d,m){this.TL=n,this.TR=o,this.BR=c,this.BL=d,this.horizon=m}static fromInvProjectionMatrix(n,o,c){const d=[-1,1,1],m=[1,1,1],_=[1,-1,1],x=[-1,-1,1],w=Ii(d,d,n),E=Ii(m,m,n),S=Ii(_,_,n),M=Ii(x,x,n);return new dv(w,E,S,M,o/c)}}class fv{constructor(n,o){this.points=n,this.planes=o}static fromInvProjectionMatrix(n,o,c,d){const m=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=nc([],w,n),S=1/E[3]/o*m;return function(M,D,O){return M[0]=D[0]*O[0],M[1]=D[1]*O[1],M[2]=D[2]*O[2],M[3]=D[3]*O[3],M}(E,E,[S,S,d?1/E[3]:S,S])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=Sr([],uv([],Fs([],_[w[0]],_[w[1]]),Fs([],_[w[2]],_[w[1]]))),S=-Ts(E,_[w[1]]);return E.concat(S)});return new fv(_,x)}}class Ar{static fromPoints(n){const o=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const d of n)Xd(o,o,d),Kd(c,c,d);return new Ar(o,c)}static applyTransform(n,o){const c=n.getCorners();for(let d=0;d<c.length;++d)Ii(c[d],c[d],o);return Ar.fromPoints(c)}constructor(n,o){this.min=n,this.max=o,this.center=os([],Uo([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],c=Nb(this.min),d=Nb(this.max);for(let m=0;m<o.length;m++)c[m]=o[m]?this.min[m]:this.center[m],d[m]=o[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new Ar(c,d)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){const o=this.getCorners();let c=!0;for(let d=0;d<n.planes.length;d++){const m=n.planes[d];let _=0;for(let x=0;x<o.length;x++)_+=Ts(m,o[x])+m[3]>=0;if(_===0)return 0;_!==o.length&&(c=!1)}if(c)return 2;for(let d=0;d<3;d++){let m=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<n.points.length;x++){const w=n.points[x][d]-this.min[d];m=Math.min(m,w),_=Math.max(_,w)}if(_<0||m>this.max[d]-this.min[d])return 0}return 1}}function Hb(s,n,o,c,d,m,_,x,w){if(m&&s.queryGeometry.isAboveHorizon)return!1;m&&(w*=s.pixelToTileUnitsFactor);const E=s.tileID.canonical,S=o.projection.upVectorScale(E,o.center.lat,o.worldSize).metersToTile;for(const M of n)for(const D of M){const O=D.add(x),B=d&&o.elevation?o.elevation.exaggeration()*d.getElevationAt(O.x,O.y,!0):0,U=o.projection.projectTilePoint(O.x,O.y,E);if(B>0){const te=o.projection.upVector(E,O.x,O.y);U.x+=te[0]*S*B,U.y+=te[1]*S*B,U.z+=te[2]*S*B}const $=m?O:fM(U.x,U.y,U.z,c),ne=m?s.tilespaceRays.map(te=>mM(te,B)):s.queryGeometry.screenGeometry,ue=nc([],[U.x,U.y,U.z,1],c);if(!_&&m?w*=ue[3]/o.cameraToCenterDistance:_&&!m&&(w*=o.cameraToCenterDistance/ue[3]),m){const te=er((D.y/Zt+E.y)/(1<<E.z));w/=o.projection.pixelsPerMeter(te,1)/ws(1,te)}if(iM(ne,$,w))return!0}return!1}function fM(s,n,o,c){const d=nc([],[s,n,o,1],c);return new ge(d[0]/d[3],d[1]/d[3])}const Xb=Nu(0,0,0),pM=Nu(0,0,1);function mM(s,n){const o=lv();return Xb[2]=n,s.intersectsPlane(Xb,pM,o),new ge(o[0],o[1])}class Kb extends iv{}function Yb(s,{width:n,height:o},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==n*o*c)throw new RangeError("mismatched image size")}else d=new Uint8Array(n*o*c);return s.width=n,s.height=o,s.data=d,s}function Qb(s,n,o){const{width:c,height:d}=n;c===s.width&&d===s.height||(pv(s,n,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,c),height:Math.min(s.height,d)},o),s.width=c,s.height=d,s.data=n.data)}function pv(s,n,o,c,d,m){if(d.width===0||d.height===0)return n;if(d.width>s.width||d.height>s.height||o.x>s.width-d.width||o.y>s.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>n.width||d.height>n.height||c.x>n.width-d.width||c.y>n.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const _=s.data,x=n.data;for(let w=0;w<d.height;w++){const E=((o.y+w)*s.width+o.x)*m,S=((c.y+w)*n.width+c.x)*m;for(let M=0;M<d.width*m;M++)x[S+M]=_[E+M]}return n}xt(Kb,"HeatmapBucket",{omit:["layers"]});class Vo{constructor(n,o){Yb(this,n,1,o)}resize(n){Qb(this,new Vo(n),1)}clone(){return new Vo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,c,d,m){pv(n,o,c,d,m,1)}}class $r{constructor(n,o){Yb(this,n,4,o)}resize(n){Qb(this,new $r(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new $r({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,c,d,m){pv(n,o,c,d,m,4)}}xt(Vo,"AlphaImage"),xt($r,"RGBAImage");var gM={paint:new Qe({"heatmap-radius":new me(De.paint_heatmap["heatmap-radius"]),"heatmap-weight":new me(De.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new we(De.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rt(De.paint_heatmap["heatmap-color"]),"heatmap-opacity":new we(De.paint_heatmap["heatmap-opacity"])})};function mv(s){const n={},o=s.resolution||256,c=s.clips?s.clips.length:1,d=s.image||new $r({width:o,height:c}),m=(_,x,w)=>{n[s.evaluationKey]=w;const E=s.expression.evaluate(n);d.data[_+x+0]=Math.floor(255*E.r/E.a),d.data[_+x+1]=Math.floor(255*E.g/E.a),d.data[_+x+2]=Math.floor(255*E.b/E.a),d.data[_+x+3]=Math.floor(255*E.a)};if(s.clips)for(let _=0,x=0;_<c;++_,x+=4*o)for(let w=0,E=0;w<o;w++,E+=4){const S=w/(o-1),{start:M,end:D}=s.clips[_];m(x,E,M*(1-S)+D*S)}else for(let _=0,x=0;_<o;_++,x+=4)m(0,x,_/(o-1));return d}var _M={paint:new Qe({"hillshade-illumination-direction":new we(De.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new we(De.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new we(De.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new we(De.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new we(De.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new we(De.paint_hillshade["hillshade-accent-color"])})};const yM=Je([{name:"a_pos",components:2,type:"Int16"}],4),{members:vM}=yM;var Jd={exports:{}};function ug(s,n,o){o=o||2;var c,d,m,_,x,w,E,S=n&&n.length,M=S?n[0]*o:s.length,D=Jb(s,0,M,o,!0),O=[];if(!D||D.next===D.prev)return O;if(S&&(D=function(U,$,ne,ue){var te,oe,fe,ae=[];for(te=0,oe=$.length;te<oe;te++)(fe=Jb(U,$[te]*ue,te<oe-1?$[te+1]*ue:U.length,ue,!1))===fe.next&&(fe.steiner=!0),ae.push(AM(fe));for(ae.sort(EM),te=0;te<ae.length;te++)ne=IM(ae[te],ne);return ne}(s,n,D,o)),s.length>80*o){c=m=s[0],d=_=s[1];for(var B=o;B<M;B+=o)(x=s[B])<c&&(c=x),(w=s[B+1])<d&&(d=w),x>m&&(m=x),w>_&&(_=w);E=(E=Math.max(m-c,_-d))!==0?32767/E:0}return ef(D,O,o,c,d,E,0),O}function Jb(s,n,o,c,d){var m,_;if(d===yv(s,n,o,c)>0)for(m=n;m<o;m+=c)_=nw(m,s[m],s[m+1],_);else for(m=o-c;m>=n;m-=c)_=nw(m,s[m],s[m+1],_);return _&&hg(_,_.next)&&(nf(_),_=_.next),_}function ic(s,n){if(!s)return s;n||(n=s);var o,c=s;do if(o=!1,c.steiner||!hg(c,c.next)&&yi(c.prev,c,c.next)!==0)c=c.next;else{if(nf(c),(c=n=c.prev)===c.next)break;o=!0}while(o||c!==n);return n}function ef(s,n,o,c,d,m,_){if(s){!_&&m&&function(S,M,D,O){var B=S;do B.z===0&&(B.z=gv(B.x,B.y,M,D,O)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==S);B.prevZ.nextZ=null,B.prevZ=null,function(U){var $,ne,ue,te,oe,fe,ae,Se,Ee=1;do{for(ne=U,U=null,oe=null,fe=0;ne;){for(fe++,ue=ne,ae=0,$=0;$<Ee&&(ae++,ue=ue.nextZ);$++);for(Se=Ee;ae>0||Se>0&&ue;)ae!==0&&(Se===0||!ue||ne.z<=ue.z)?(te=ne,ne=ne.nextZ,ae--):(te=ue,ue=ue.nextZ,Se--),oe?oe.nextZ=te:U=te,te.prevZ=oe,oe=te;ne=ue}oe.nextZ=null,Ee*=2}while(fe>1)}(B)}(s,c,d,m);for(var x,w,E=s;s.prev!==s.next;)if(x=s.prev,w=s.next,m?bM(s,c,d,m):xM(s))n.push(x.i/o|0),n.push(s.i/o|0),n.push(w.i/o|0),nf(s),s=w.next,E=w.next;else if((s=w)===E){_?_===1?ef(s=wM(ic(s),n,o),n,o,c,d,m,2):_===2&&TM(s,n,o,c,d,m):ef(ic(s),n,o,c,d,m,1);break}}}function xM(s){var n=s.prev,o=s,c=s.next;if(yi(n,o,c)>=0)return!1;for(var d=n.x,m=o.x,_=c.x,x=n.y,w=o.y,E=c.y,S=d<m?d<_?d:_:m<_?m:_,M=x<w?x<E?x:E:w<E?w:E,D=d>m?d>_?d:_:m>_?m:_,O=x>w?x>E?x:E:w>E?w:E,B=c.next;B!==n;){if(B.x>=S&&B.x<=D&&B.y>=M&&B.y<=O&&Uu(d,x,m,w,_,E,B.x,B.y)&&yi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function bM(s,n,o,c){var d=s.prev,m=s,_=s.next;if(yi(d,m,_)>=0)return!1;for(var x=d.x,w=m.x,E=_.x,S=d.y,M=m.y,D=_.y,O=x<w?x<E?x:E:w<E?w:E,B=S<M?S<D?S:D:M<D?M:D,U=x>w?x>E?x:E:w>E?w:E,$=S>M?S>D?S:D:M>D?M:D,ne=gv(O,B,n,o,c),ue=gv(U,$,n,o,c),te=s.prevZ,oe=s.nextZ;te&&te.z>=ne&&oe&&oe.z<=ue;){if(te.x>=O&&te.x<=U&&te.y>=B&&te.y<=$&&te!==d&&te!==_&&Uu(x,S,w,M,E,D,te.x,te.y)&&yi(te.prev,te,te.next)>=0||(te=te.prevZ,oe.x>=O&&oe.x<=U&&oe.y>=B&&oe.y<=$&&oe!==d&&oe!==_&&Uu(x,S,w,M,E,D,oe.x,oe.y)&&yi(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;te&&te.z>=ne;){if(te.x>=O&&te.x<=U&&te.y>=B&&te.y<=$&&te!==d&&te!==_&&Uu(x,S,w,M,E,D,te.x,te.y)&&yi(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;oe&&oe.z<=ue;){if(oe.x>=O&&oe.x<=U&&oe.y>=B&&oe.y<=$&&oe!==d&&oe!==_&&Uu(x,S,w,M,E,D,oe.x,oe.y)&&yi(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function wM(s,n,o){var c=s;do{var d=c.prev,m=c.next.next;!hg(d,m)&&ew(d,c,c.next,m)&&tf(d,m)&&tf(m,d)&&(n.push(d.i/o|0),n.push(c.i/o|0),n.push(m.i/o|0),nf(c),nf(c.next),c=s=m),c=c.next}while(c!==s);return ic(c)}function TM(s,n,o,c,d,m){var _=s;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&CM(_,x)){var w=tw(_,x);return _=ic(_,_.next),w=ic(w,w.next),ef(_,n,o,c,d,m,0),void ef(w,n,o,c,d,m,0)}x=x.next}_=_.next}while(_!==s)}function EM(s,n){return s.x-n.x}function IM(s,n){var o=function(d,m){var _,x=m,w=d.x,E=d.y,S=-1/0;do{if(E<=x.y&&E>=x.next.y&&x.next.y!==x.y){var M=x.x+(E-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(M<=w&&M>S&&(S=M,_=x.x<x.next.x?x:x.next,M===w))return _}x=x.next}while(x!==m);if(!_)return null;var D,O=_,B=_.x,U=_.y,$=1/0;x=_;do w>=x.x&&x.x>=B&&w!==x.x&&Uu(E<U?w:S,E,B,U,E<U?S:w,E,x.x,x.y)&&(D=Math.abs(E-x.y)/(w-x.x),tf(x,d)&&(D<$||D===$&&(x.x>_.x||x.x===_.x&&SM(_,x)))&&(_=x,$=D)),x=x.next;while(x!==O);return _}(s,n);if(!o)return n;var c=tw(o,s);return ic(c,c.next),ic(o,o.next)}function SM(s,n){return yi(s.prev,s,n.prev)<0&&yi(n.next,s,s.next)<0}function gv(s,n,o,c,d){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-o)*d|0)|s<<8))|s<<4))|s<<2))|s<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-c)*d|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function AM(s){var n=s,o=s;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==s);return o}function Uu(s,n,o,c,d,m,_,x){return(d-_)*(n-x)>=(s-_)*(m-x)&&(s-_)*(c-x)>=(o-_)*(n-x)&&(o-_)*(m-x)>=(d-_)*(c-x)}function CM(s,n){return s.next.i!==n.i&&s.prev.i!==n.i&&!function(o,c){var d=o;do{if(d.i!==o.i&&d.next.i!==o.i&&d.i!==c.i&&d.next.i!==c.i&&ew(d,d.next,o,c))return!0;d=d.next}while(d!==o);return!1}(s,n)&&(tf(s,n)&&tf(n,s)&&function(o,c){var d=o,m=!1,_=(o.x+c.x)/2,x=(o.y+c.y)/2;do d.y>x!=d.next.y>x&&d.next.y!==d.y&&_<(d.next.x-d.x)*(x-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==o);return m}(s,n)&&(yi(s.prev,s,n.prev)||yi(s,n.prev,n))||hg(s,n)&&yi(s.prev,s,s.next)>0&&yi(n.prev,n,n.next)>0)}function yi(s,n,o){return(n.y-s.y)*(o.x-n.x)-(n.x-s.x)*(o.y-n.y)}function hg(s,n){return s.x===n.x&&s.y===n.y}function ew(s,n,o,c){var d=fg(yi(s,n,o)),m=fg(yi(s,n,c)),_=fg(yi(o,c,s)),x=fg(yi(o,c,n));return d!==m&&_!==x||!(d!==0||!dg(s,o,n))||!(m!==0||!dg(s,c,n))||!(_!==0||!dg(o,s,c))||!(x!==0||!dg(o,n,c))}function dg(s,n,o){return n.x<=Math.max(s.x,o.x)&&n.x>=Math.min(s.x,o.x)&&n.y<=Math.max(s.y,o.y)&&n.y>=Math.min(s.y,o.y)}function fg(s){return s>0?1:s<0?-1:0}function tf(s,n){return yi(s.prev,s,s.next)<0?yi(s,n,s.next)>=0&&yi(s,s.prev,n)>=0:yi(s,n,s.prev)<0||yi(s,s.next,n)<0}function tw(s,n){var o=new _v(s.i,s.x,s.y),c=new _v(n.i,n.x,n.y),d=s.next,m=n.prev;return s.next=n,n.prev=s,o.next=d,d.prev=o,c.next=o,o.prev=c,m.next=c,c.prev=m,c}function nw(s,n,o,c){var d=new _v(s,n,o);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function nf(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function _v(s,n,o){this.i=s,this.x=n,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yv(s,n,o,c){for(var d=0,m=n,_=o-c;m<o;m+=c)d+=(s[_]-s[m])*(s[m+1]+s[_+1]),_=m;return d}function kM(s,n,o,c,d){iw(s,n,o||0,c||s.length-1,d||MM)}function iw(s,n,o,c,d){for(;c>o;){if(c-o>600){var m=c-o+1,_=n-o+1,x=Math.log(m),w=.5*Math.exp(2*x/3),E=.5*Math.sqrt(x*w*(m-w)/m)*(_-m/2<0?-1:1);iw(s,n,Math.max(o,Math.floor(n-_*w/m+E)),Math.min(c,Math.floor(n+(m-_)*w/m+E)),d)}var S=s[n],M=o,D=c;for(rf(s,o,n),d(s[c],S)>0&&rf(s,o,c);M<D;){for(rf(s,M,D),M++,D--;d(s[M],S)<0;)M++;for(;d(s[D],S)>0;)D--}d(s[o],S)===0?rf(s,o,D):rf(s,++D,c),D<=n&&(o=D+1),n<=D&&(c=D-1)}}function rf(s,n,o){var c=s[n];s[n]=s[o],s[o]=c}function MM(s,n){return s<n?-1:s>n?1:0}function vv(s,n){const o=s.length;if(o<=1)return[s];const c=[];let d,m;for(let _=0;_<o;_++){const x=mn(s[_]);x!==0&&(s[_].area=Math.abs(x),m===void 0&&(m=x<0),m===x<0?(d&&c.push(d),d=[s[_]]):d.push(s[_]))}if(d&&c.push(d),n>1)for(let _=0;_<c.length;_++)c[_].length<=n||(kM(c[_],n,1,c[_].length-1,DM),c[_]=c[_].slice(0,n));return c}function DM(s,n){return n.area-s.area}function xv(s,n,o){const c=o.patternDependencies;let d=!1;for(const m of n){const _=m.paint.get(`${s}-pattern`);_.isConstant()||(d=!0);const x=_.constantOr(null);x&&(d=!0,c[x.to]=!0,c[x.from]=!0)}return d}function bv(s,n,o,c,d){const m=d.patternDependencies;for(const _ of n){const x=_.paint.get(`${s}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:c-1},o,{},d.availableImages),E=x.evaluate({zoom:c},o,{},d.availableImages),S=x.evaluate({zoom:c+1},o,{},d.availableImages);w=w&&w.name?w.name:w,E=E&&E.name?E.name:E,S=S&&S.name?S.name:S,m[w]=!0,m[E]=!0,m[S]=!0,o.patterns[_.id]={min:w,mid:E,max:S}}}return o}Jd.exports=ug,Jd.exports.default=ug,ug.deviation=function(s,n,o,c){var d=n&&n.length,m=Math.abs(yv(s,0,d?n[0]*o:s.length,o));if(d)for(var _=0,x=n.length;_<x;_++)m-=Math.abs(yv(s,n[_]*o,_<x-1?n[_+1]*o:s.length,o));var w=0;for(_=0;_<c.length;_+=3){var E=c[_]*o,S=c[_+1]*o,M=c[_+2]*o;w+=Math.abs((s[E]-s[M])*(s[S+1]-s[E+1])-(s[E]-s[S])*(s[M+1]-s[E+1]))}return m===0&&w===0?0:Math.abs((w-m)/m)},ug.flatten=function(s){for(var n=s[0][0].length,o={vertices:[],holes:[],dimensions:n},c=0,d=0;d<s.length;d++){for(var m=0;m<s[d].length;m++)for(var _=0;_<n;_++)o.vertices.push(s[d][m][_]);d>0&&o.holes.push(c+=s[d-1].length)}return o};class pg{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new tn,this.indexArray=new hr,this.indexArray2=new rs,this.programConfigurations=new Ql(n.layers,n.zoom),this.segments=new Ei,this.segments2=new Ei,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=n.projection}populate(n,o,c,d){this.hasPattern=xv("fill",this.layers,o);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:w,index:E,sourceLayerIndex:S}of n){const M=this.layers[0]._featureFilter.needGeometry,D=Jl(x,M);if(!this.layers[0]._featureFilter.filter(new ie(this.zoom),D,c))continue;const O=m?m.evaluate(D,{},c,o.availableImages):void 0,B={id:w,properties:x.properties,type:x.type,sourceLayerIndex:S,index:E,geometry:M?D.geometry:No(x,c,d),patterns:{},sortKey:O};_.push(B)}m&&_.sort((x,w)=>x.sortKey-w.sortKey);for(const x of _){const{geometry:w,index:E,sourceLayerIndex:S}=x;if(this.hasPattern){const M=bv("fill",this.layers,x,this.zoom,o);this.patternFeatures.push(M)}else this.addFeature(x,w,E,c,{},o.availableImages);o.featureIndex.insert(n[E].feature,w,E,S,this.index)}}update(n,o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,d)}addFeatures(n,o,c,d,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,o,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,vM),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,o,c,d,m,_=[]){for(const x of vv(o,500)){let w=0;for(const B of x)w+=B.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),S=E.vertexLength,M=[],D=[];for(const B of x){if(B.length===0)continue;B!==x[0]&&D.push(M.length/2);const U=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),$=U.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack($+B.length-1,$),M.push(B[0].x),M.push(B[0].y);for(let ne=1;ne<B.length;ne++)this.layoutVertexArray.emplaceBack(B[ne].x,B[ne].y),this.indexArray2.emplaceBack($+ne-1,$+ne),M.push(B[ne].x),M.push(B[ne].y);U.vertexLength+=B.length,U.primitiveLength+=B.length}const O=Jd.exports(M,D);for(let B=0;B<O.length;B+=3)this.indexArray.emplaceBack(S+O[B],S+O[B+1],S+O[B+2]);E.vertexLength+=w,E.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,m,_,d)}}xt(pg,"FillBucket",{omit:["layers","patternFeatures"]});const PM=new Qe({"fill-sort-key":new me(De.layout_fill["fill-sort-key"])});var RM={paint:new Qe({"fill-antialias":new we(De.paint_fill["fill-antialias"]),"fill-opacity":new me(De.paint_fill["fill-opacity"]),"fill-color":new me(De.paint_fill["fill-color"]),"fill-outline-color":new me(De.paint_fill["fill-outline-color"]),"fill-translate":new we(De.paint_fill["fill-translate"]),"fill-translate-anchor":new we(De.paint_fill["fill-translate-anchor"]),"fill-pattern":new ct(De.paint_fill["fill-pattern"])}),layout:PM};const LM=Je([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zM=Je([{name:"a_centroid_pos",components:2,type:"Uint16"}]),OM=Je([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:BM}=LM;var mg={},FM=ge,rw=Vu;function Vu(s,n,o,c,d){this.properties={},this.extent=o,this.type=0,this._pbf=s,this._geometry=-1,this._keys=c,this._values=d,s.readFields(NM,this,n)}function NM(s,n,o){s==1?n.id=o.readVarint():s==2?function(c,d){for(var m=c.readVarint()+c.pos;c.pos<m;){var _=d._keys[c.readVarint()],x=d._values[c.readVarint()];d.properties[_]=x}}(o,n):s==3?n.type=o.readVarint():s==4&&(n._geometry=o.pos)}function UM(s){for(var n,o,c=0,d=0,m=s.length,_=m-1;d<m;_=d++)c+=((o=s[_]).x-(n=s[d]).x)*(n.y+o.y);return c}Vu.types=["Unknown","Point","LineString","Polygon"],Vu.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var n,o=s.readVarint()+s.pos,c=1,d=0,m=0,_=0,x=[];s.pos<o;){if(d<=0){var w=s.readVarint();c=7&w,d=w>>3}if(d--,c===1||c===2)m+=s.readSVarint(),_+=s.readSVarint(),c===1&&(n&&x.push(n),n=[]),n.push(new FM(m,_));else{if(c!==7)throw new Error("unknown command "+c);n&&n.push(n[0].clone())}}return n&&x.push(n),x},Vu.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var n=s.readVarint()+s.pos,o=1,c=0,d=0,m=0,_=1/0,x=-1/0,w=1/0,E=-1/0;s.pos<n;){if(c<=0){var S=s.readVarint();o=7&S,c=S>>3}if(c--,o===1||o===2)(d+=s.readSVarint())<_&&(_=d),d>x&&(x=d),(m+=s.readSVarint())<w&&(w=m),m>E&&(E=m);else if(o!==7)throw new Error("unknown command "+o)}return[_,w,x,E]},Vu.prototype.toGeoJSON=function(s,n,o){var c,d,m=this.extent*Math.pow(2,o),_=this.extent*s,x=this.extent*n,w=this.loadGeometry(),E=Vu.types[this.type];function S(O){for(var B=0;B<O.length;B++){var U=O[B];O[B]=[360*(U.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(c=0;c<w.length;c++)M[c]=w[c][0];S(w=M);break;case 2:for(c=0;c<w.length;c++)S(w[c]);break;case 3:for(w=function(O){var B=O.length;if(B<=1)return[O];for(var U,$,ne=[],ue=0;ue<B;ue++){var te=UM(O[ue]);te!==0&&($===void 0&&($=te<0),$===te<0?(U&&ne.push(U),U=[O[ue]]):U.push(O[ue]))}return U&&ne.push(U),ne}(w),c=0;c<w.length;c++)for(d=0;d<w[c].length;d++)S(w[c][d])}w.length===1?w=w[0]:E="Multi"+E;var D={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(D.id=this.id),D};var VM=rw,sw=ow;function ow(s,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(jM,this,n),this.length=this._features.length}function jM(s,n,o){s===15?n.version=o.readVarint():s===1?n.name=o.readString():s===5?n.extent=o.readVarint():s===2?n._features.push(o.pos):s===3?n._keys.push(o.readString()):s===4&&n._values.push(function(c){for(var d=null,m=c.readVarint()+c.pos;c.pos<m;){var _=c.readVarint()>>3;d=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}return d}(o))}ow.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var n=this._pbf.readVarint()+this._pbf.pos;return new VM(this._pbf,n,this.extent,this._keys,this._values)};var GM=sw;function $M(s,n,o){if(s===3){var c=new GM(o,o.readVarint()+o.pos);c.length&&(n[c.name]=c)}}var wv=mg.VectorTile=function(s,n){this.layers=s.readFields($M,{},n)},gg=mg.VectorTileFeature=rw;function _g(s,n,o,c){const d=[],m=c===0?(_,x,w,E,S,M)=>{_.push(new ge(M,w+(M-x)/(E-x)*(S-w)))}:(_,x,w,E,S,M)=>{_.push(new ge(x+(M-w)/(S-w)*(E-x),M))};for(const _ of s){const x=[];for(const w of _){if(w.length<=2)continue;const E=[];for(let D=0;D<w.length-1;D++){const O=w[D].x,B=w[D].y,U=w[D+1].x,$=w[D+1].y,ne=c===0?O:B,ue=c===0?U:$;ne<n?ue>n&&m(E,O,B,U,$,n):ne>o?ue<o&&m(E,O,B,U,$,o):E.push(w[D]),ue<n&&ne>=n&&m(E,O,B,U,$,n),ue>o&&ne<=o&&m(E,O,B,U,$,o)}let S=w[w.length-1];const M=c===0?S.x:S.y;M>=n&&M<=o&&E.push(S),E.length&&(S=E[E.length-1],E[0].x===S.x&&E[0].y===S.y||E.push(E[0]),x.push(E))}x.length&&d.push(x)}return d}mg.VectorTileLayer=sw;const qM=gg.types,WM=Math.pow(2,13);function sf(s,n,o,c,d,m,_,x){s.emplaceBack((n<<1)+_,(o<<1)+m,(Math.floor(c*WM)<<1)+d,Math.round(x))}function of(s,n,o){s.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class aw{constructor(){this.acc=new ge(0,0),this.polyCount=[]}startRing(n){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ge(n.x,n.y),this.max=new ge(n.x,n.y))}append(n,o){this.currentPolyCount.edges++,this.acc._add(n);const c=this.min,d=this.max;n.x<c.x?c.x=n.x:n.x>d.x&&(d.x=n.x),n.y<c.y?c.y=n.y:n.y>d.y&&(d.y=n.y),((n.x===0||n.x===Zt)&&n.x===o.x)!=((n.y===0||n.y===Zt)&&n.y===o.y)&&this.processBorderOverlap(n,o),o.x<0!=n.x<0&&this.addBorderIntersection(0,En(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>Zt!=n.x>Zt&&this.addBorderIntersection(1,En(o.y,n.y,(Zt-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,En(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>Zt!=n.y>Zt&&this.addBorderIntersection(3,En(o.x,n.x,(Zt-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[n];o<c[0]&&(c[0]=o),o>c[1]&&(c[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const c=n.x===0?0:1;this.addBorderIntersection(c,o.y),this.addBorderIntersection(c,n.y)}else{const c=n.y===0?2:3;this.addBorderIntersection(c,o.x),this.addBorderIntersection(c,n.x)}}centroid(){const n=this.polyCount.reduce((o,c)=>o+c.edges,0);return n!==0?this.acc.div(n)._round():new ge(0,0)}span(){return new ge(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((n,o)=>n+ +(o[0]!==Number.MAX_VALUE),0)}}class af{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.layoutVertexArray=new Un,this.centroidVertexArray=new fb,this.indexArray=new hr,this.programConfigurations=new Ql(n.layers,n.zoom),this.segments=new Ei,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.enableTerrain=n.enableTerrain}populate(n,o,c,d){this.features=[],this.hasPattern=xv("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const _=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*_/(_*_+1)/Zt/(1<<m.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:m,id:_,index:x,sourceLayerIndex:w}of n){const E=this.layers[0]._featureFilter.needGeometry,S=Jl(m,E);if(!this.layers[0]._featureFilter.filter(new ie(this.zoom),S,c))continue;const M={id:_,sourceLayerIndex:w,index:x,geometry:E?S.geometry:No(m,c,d),properties:m.properties,type:m.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(bv("fill-extrusion",this.layers,M,this.zoom,o)):this.addFeature(M,M.geometry,x,c,{},o.availableImages,d),o.featureIndex.insert(m,M.geometry,x,w,this.index,D)}this.sortBorders()}addFeatures(n,o,c,d,m){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,o,c,d,m)}this.sortBorders()}update(n,o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,BM),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,OM.members,!0))),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,zM.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,c,d,m,_,x){const w=[new ge(0,0),new ge(Zt,Zt)],E=x.projection,S=E.name==="globe",M=this.enableTerrain&&!S?new aw:null,D=qM[n.type]==="Polygon";S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new nb);const O=vv(o,500);for(let ne=O.length-1;ne>=0;ne--){const ue=O[ne];(ue.length===0||(B=ue[0]).every(te=>te.x<=0)||B.every(te=>te.x>=Zt)||B.every(te=>te.y<=0)||B.every(te=>te.y>=Zt))&&O.splice(ne,1)}var B;let U;if(S)U=pw(O,w,d);else{U=[];for(const ne of O)U.push({polygon:ne,bounds:w})}const $=D?this.edgeRadius:0;for(const{polygon:ne,bounds:ue}of U){let te=0,oe=0;for(const ae of ne)D&&!ae[0].equals(ae[ae.length-1])&&ae.push(ae[0]),oe+=D?ae.length-1:ae.length;const fe=this.segments.prepareSegment((D?5:4)*oe,this.layoutVertexArray,this.indexArray);if(D){const ae=[],Se=[];te=fe.vertexLength;for(const Le of ne){let We,Ce;Le.length&&Le!==ne[0]&&Se.push(ae.length/2),We=Le[1].sub(Le[0])._perp()._unit();for(let Oe=1;Oe<Le.length;Oe++){const Ne=Le[Oe],je=Le[Oe===Le.length-1?1:Oe+1];let{x:Ze,y:ke}=Ne;if($){Ce=je.sub(Ne)._perp()._unit();const at=We.add(Ce)._unit(),Bt=$*Math.min(4,1/(We.x*at.x+We.y*at.y));Ze+=Bt*at.x,ke+=Bt*at.y,We=Ce}sf(this.layoutVertexArray,Ze,ke,0,0,1,1,0),fe.vertexLength++,ae.push(Ne.x,Ne.y),S&&of(this.layoutVertexExtArray,E.projectTilePoint(Ze,ke,d),E.upVector(d,Ze,ke))}}const Ee=Jd.exports(ae,Se);for(let Le=0;Le<Ee.length;Le+=3)this.indexArray.emplaceBack(te+Ee[Le],te+Ee[Le+2],te+Ee[Le+1]),fe.primitiveLength++}for(const ae of ne){M&&ae.length&&M.startRing(ae[0]);let Se,Ee,Le,We=ae.length>4&&hw(ae[ae.length-2],ae[0],ae[1]),Ce=$?ZM(ae[ae.length-2],ae[0],ae[1],$):0;Ee=ae[1].sub(ae[0])._perp()._unit();let Oe=!0;for(let Ne=1,je=0;Ne<ae.length;Ne++){let Ze=ae[Ne-1],ke=ae[Ne];const at=ae[Ne===ae.length-1?1:Ne+1];if(M&&D&&M.currentPolyCount.top++,uw(ke,Ze,ue)){$&&(Ee=at.sub(ke)._perp()._unit(),Oe=!Oe);continue}M&&M.append(ke,Ze);const Bt=ke.sub(Ze)._perp(),ft=Bt.x/(Math.abs(Bt.x)+Math.abs(Bt.y)),St=Bt.y>0?1:0,ut=Ze.dist(ke);if(je+ut>32768&&(je=0),$){Le=at.sub(ke)._perp()._unit();let wn=cw(Ze,ke,at,lw(Ee,Le),$);isNaN(wn)&&(wn=0);const Kt=ke.sub(Ze)._unit();Ze=Ze.add(Kt.mult(Ce))._round(),ke=ke.add(Kt.mult(-wn))._round(),Ce=wn,Ee=Le}const Vt=fe.vertexLength,Yt=ae.length>4&&hw(Ze,ke,at);let Jt=dw(je,We,Oe);if(sf(this.layoutVertexArray,Ze.x,Ze.y,ft,St,0,0,Jt),sf(this.layoutVertexArray,Ze.x,Ze.y,ft,St,0,1,Jt),je+=ut,Jt=dw(je,Yt,!Oe),We=Yt,sf(this.layoutVertexArray,ke.x,ke.y,ft,St,0,0,Jt),sf(this.layoutVertexArray,ke.x,ke.y,ft,St,0,1,Jt),fe.vertexLength+=4,this.indexArray.emplaceBack(Vt+0,Vt+1,Vt+2),this.indexArray.emplaceBack(Vt+1,Vt+3,Vt+2),fe.primitiveLength+=2,$){const wn=te+(Ne===1?ae.length-2:Ne-2),Kt=Ne===1?te:wn+1;if(this.indexArray.emplaceBack(Vt+1,wn,Vt+3),this.indexArray.emplaceBack(wn,Kt,Vt+3),fe.primitiveLength+=2,Se===void 0&&(Se=Vt),!uw(at,ae[Ne],ue)){const Jn=Ne===ae.length-1?Se:fe.vertexLength;this.indexArray.emplaceBack(Vt+2,Vt+3,Jn),this.indexArray.emplaceBack(Vt+3,Jn+1,Jn),this.indexArray.emplaceBack(Vt+3,Kt,Jn+1),fe.primitiveLength+=3}Oe=!Oe}if(S){const wn=this.layoutVertexExtArray,Kt=E.projectTilePoint(Ze.x,Ze.y,d),Jn=E.projectTilePoint(ke.x,ke.y,d),nn=E.upVector(d,Ze.x,Ze.y),fn=E.upVector(d,ke.x,ke.y);of(wn,Kt,nn),of(wn,Kt,nn),of(wn,Jn,fn),of(wn,Jn,fn)}}D&&(te+=ae.length-1)}}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;const ne=M.borders,ue=this.featuresOnBorder.push(M)-1;for(let te=0;te<4;te++)ne[te][0]!==Number.MAX_VALUE&&this.borders[te].push(ue)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,m,_,d)}sortBorders(){for(let n=0;n<4;n++)this.borders[n].sort((o,c)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[c].borders[n][0])}encodeCentroid(n,o,c=!0){let d,m;if(n)if(n.y!==0){const x=o.span()._mult(this.tileToMeter);d=(Math.max(n.x,1)<<3)+Math.min(7,Math.round(x.x/10)),m=(Math.max(n.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else d=Math.ceil(7*(n.x+450)),m=0;else d=0,m=+c;let _=c?this.centroidVertexArray.length:o.vertexArrayOffset;for(const x of o.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(_++,d,m);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(_++,0,m),this.centroidVertexArray.emplace(_++,d,m)}}}function lw(s,n){const o=s.add(n)._unit();return s.x*o.x+s.y*o.y}function ZM(s,n,o,c){const d=n.sub(s)._perp()._unit(),m=o.sub(n)._perp()._unit();return cw(s,n,o,lw(d,m),c)}function cw(s,n,o,c,d){const m=Math.sqrt(1-c*c);return Math.min(s.dist(n)/3,n.dist(o)/3,d*m/c)}function uw(s,n,o){return s.x<o[0].x&&n.x<o[0].x||s.x>o[1].x&&n.x>o[1].x||s.y<o[0].y&&n.y<o[0].y||s.y>o[1].y&&n.y>o[1].y}function hw(s,n,o){if(s.x<0||s.x>=Zt||n.x<0||n.x>=Zt||o.x<0||o.x>=Zt)return!1;const c=o.sub(n),d=c.perp(),m=s.sub(n);return(c.x*m.x+c.y*m.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(m.x*m.x+m.y*m.y))>-.866&&d.x*m.x+d.y*m.y<0}function dw(s,n,o){const c=n?2|s:-3&s;return o?1|c:-2&c}function fw(){const s=Math.PI/32,n=Math.tan(s),o=rg;return o*Math.sqrt(1+2*n*n)-o}function pw(s,n,o){const c=1<<o.z,d=ss(o.x/c),m=ss((o.x+1)/c),_=er(o.y/c),x=er((o.y+1)/c);return function(w,E,S,M,D=0,O){const B=[];if(!w.length||!S||!M)return B;const U=(ae,Se)=>{for(const Ee of ae)B.push({polygon:Ee,bounds:Se})},$=Math.ceil(Math.log2(S)),ne=Math.ceil(Math.log2(M)),ue=$-ne,te=[];for(let ae=0;ae<Math.abs(ue);ae++)te.push(ue>0?0:1);for(let ae=0;ae<Math.min($,ne);ae++)te.push(0),te.push(1);let oe=w;if(oe=_g(oe,E[0].y-D,E[1].y+D,1),oe=_g(oe,E[0].x-D,E[1].x+D,0),!oe.length)return B;const fe=[];for(te.length?fe.push({polygons:oe,bounds:E,depth:0}):U(oe,E);fe.length;){const ae=fe.pop(),Se=ae.depth,Ee=te[Se],Le=ae.bounds[0],We=ae.bounds[1],Ce=Ee===0?Le.x:Le.y,Oe=Ee===0?We.x:We.y,Ne=O?O(Ee,Ce,Oe):.5*(Ce+Oe),je=_g(ae.polygons,Ce-D,Ne+D,Ee),Ze=_g(ae.polygons,Ne-D,Oe+D,Ee);if(je.length){const ke=[Le,new ge(Ee===0?Ne:We.x,Ee===1?Ne:We.y)];te.length>Se+1?fe.push({polygons:je,bounds:ke,depth:Se+1}):U(je,ke)}if(Ze.length){const ke=[new ge(Ee===0?Ne:Le.x,Ee===1?Ne:Le.y),We];te.length>Se+1?fe.push({polygons:Ze,bounds:ke,depth:Se+1}):U(Ze,ke)}}return B}(s,n,Math.ceil((m-d)/11.25),Math.ceil((_-x)/11.25),1,(w,E,S)=>{if(w===0)return .5*(E+S);{const M=er((o.y+E/Zt)/c);return(oo(.5*(er((o.y+S/Zt)/c)+M))*c-o.y)*Zt}})}xt(af,"FillExtrusionBucket",{omit:["layers","features"]}),xt(aw,"PartMetadata");const HM=new Qe({"fill-extrusion-edge-radius":new we(De["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var XM={paint:new Qe({"fill-extrusion-opacity":new we(De["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new me(De["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new we(De["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new we(De["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ct(De["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new me(De["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new me(De["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new we(De["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new we(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new we(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:HM};function mw(s,n,o){var c=2*Math.PI*6378137/256/Math.pow(2,o);return[s*c-2*Math.PI*6378137/2,n*c-2*Math.PI*6378137/2]}class yg{constructor(n,o,c){this.z=n,this.x=o,this.y=c,this.key=lf(0,n,n,o,c)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o){const c=function(m,_,x){var w=mw(256*m,256*(_=Math.pow(2,x)-_-1),x),E=mw(256*(m+1),256*(_+1),x);return w[0]+","+w[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),d=function(m,_,x){let w,E="";for(let S=m;S>0;S--)w=1<<S-1,E+=(_&w?1:0)+(x&w?2:0);return E}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class gw{constructor(n,o){this.wrap=n,this.canonical=o,this.key=lf(n,o.z,o.z,o.x,o.y)}}class Cr{constructor(n,o,c,d,m){this.overscaledZ=n,this.wrap=o,this.canonical=new yg(c,+d,+m),this.key=o===0&&n===c?this.canonical.key:lf(o,n,c,d,m)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new Cr(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Cr(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return lf(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-n;return lf(this.wrap*+o,n,n,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new Cr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new Cr(o,this.wrap,o,c,d),new Cr(o,this.wrap,o,c+1,d),new Cr(o,this.wrap,o,c,d+1),new Cr(o,this.wrap,o,c+1,d+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Cr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Cr(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function lf(s,n,o,c,d){const m=1<<Math.min(o,22);let _=m*(d%m)+c%m;return s&&o<22&&(_+=m*m*((s<0?-2*s-1:2*s)%(1<<2*(22-o)))),16*(32*_+o)+(n-o)}xt(yg,"CanonicalTileID"),xt(Cr,"OverscaledTileID",{omit:["projMatrix"]});class ju extends ge{constructor(n,o,c){super(n,o),this.z=c}}function cf(s,n){return s.x*n.x+s.y*n.y}function _w(s,n){if(s.length===1){let o=0;const c=n[o++];let d;for(;!d||c.equals(d);)if(d=n[o++],!d)return 1/0;for(;o<n.length;o++){const m=n[o],_=s[0],x=d.sub(c),w=m.sub(c),E=_.sub(c),S=cf(x,x),M=cf(x,w),D=cf(w,w),O=cf(E,x),B=cf(E,w),U=S*D-M*M,$=(D*O-M*B)/U,ne=(S*B-M*O)/U,ue=c.z*(1-$-ne)+d.z*$+m.z*ne;if(isFinite(ue))return ue}return 1/0}{let o=1/0;for(const c of n)o=Math.min(o,c.z);return o}}function yw(s,n,o,c,d,m,_,x){const w=_*d.getElevationAt(s,n,!0,!0),E=m[0]!==0,S=E?m[1]===0?_*(m[0]/7-450):_*function(M,D,O){const B=Math.floor(D[0]/8),U=Math.floor(D[1]/8),$=10*(D[0]-8*B),ne=10*(D[1]-8*U),ue=M.getElevationAt(B,U,!0,!0),te=M.getMeterToDEM(O),oe=Math.floor(.5*($*te-1)),fe=Math.floor(.5*(ne*te-1)),ae=M.tileCoordToPixel(B,U),Se=2*oe+1,Ee=2*fe+1,Le=function(Ze,ke,at,Bt,ft){return[Ze.getElevationAtPixel(ke,at,!0),Ze.getElevationAtPixel(ke+ft,at,!0),Ze.getElevationAtPixel(ke,at+ft,!0),Ze.getElevationAtPixel(ke+Bt,at+ft,!0)]}(M,ae.x-oe,ae.y-fe,Se,Ee),We=Math.abs(Le[0]-Le[1]),Ce=Math.abs(Le[2]-Le[3]),Oe=Math.abs(Le[0]-Le[2])+Math.abs(Le[1]-Le[3]),Ne=Math.min(.25,.5*te*(We+Ce)/Se),je=Math.min(.25,.5*te*Oe/Ee);return ue+Math.max(Ne*$,je*ne)}(d,m,x):w;return{base:w+(o===0)?-1:o,top:E?Math.max(S+c,w+o+2):w+c}}const KM=Je([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:YM}=KM,QM=Je([{name:"a_packed",components:4,type:"Float32"}]),{members:JM}=QM,eD=gg.types,tD=Math.cos(Math.PI/180*37.5);class vg{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Pn,this.layoutVertexArray2=new Mi,this.indexArray=new hr,this.programConfigurations=new Ql(n.layers,n.zoom),this.segments=new Ei,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,c,d){this.hasPattern=xv("line",this.layers,o);const m=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:S,id:M,index:D,sourceLayerIndex:O}of n){const B=this.layers[0]._featureFilter.needGeometry,U=Jl(S,B);if(!this.layers[0]._featureFilter.filter(new ie(this.zoom),U,c))continue;const $=m?m.evaluate(U,{},c):void 0,ne={id:M,properties:S.properties,type:S.type,sourceLayerIndex:O,index:D,geometry:B?U.geometry:No(S,c,d),patterns:{},sortKey:$};_.push(ne)}m&&_.sort((S,M)=>S.sortKey-M.sortKey);const{lineAtlas:x,featureIndex:w}=o,E=this.addConstantDashes(x);for(const S of _){const{geometry:M,index:D,sourceLayerIndex:O}=S;if(E&&this.addFeatureDashes(S,x),this.hasPattern){const B=bv("line",this.layers,S,this.zoom,o);this.patternFeatures.push(B)}else this.addFeature(S,M,D,c,x.positions,o.availableImages);w.insert(n[D].feature,M,D,O,this.index)}}addConstantDashes(n){let o=!1;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if(d.kind!=="constant"||m.kind!=="constant")o=!0;else{const _=m.value,x=d.value;if(!x)continue;n.addDash(x.from,_),n.addDash(x.to,_),x.other&&n.addDash(x.other,_)}}return o}addFeatureDashes(n,o){const c=this.zoom;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if(m.kind==="constant"&&_.kind==="constant")continue;let x,w,E,S,M,D;if(m.kind==="constant"){const $=m.value;if(!$)continue;x=$.other||$.to,w=$.to,E=$.from}else x=m.evaluate({zoom:c-1},n),w=m.evaluate({zoom:c},n),E=m.evaluate({zoom:c+1},n);_.kind==="constant"?S=M=D=_.value:(S=_.evaluate({zoom:c-1},n),M=_.evaluate({zoom:c},n),D=_.evaluate({zoom:c+1},n)),o.addDash(x,S),o.addDash(w,M),o.addDash(E,D);const O=o.getKey(x,S),B=o.getKey(w,M),U=o.getKey(E,D);n.patterns[d.id]={min:O,mid:B,max:U}}}update(n,o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,d)}addFeatures(n,o,c,d,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,o,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,JM)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,YM),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,c,d,m,_){const x=this.layers[0].layout,w=x.get("line-join").evaluate(n,{}),E=x.get("line-cap").evaluate(n,{}),S=x.get("line-miter-limit"),M=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const D of o)this.addLine(D,n,w,E,S,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,m,_,d)}addLine(n,o,c,d,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<n.length-1;ne++)this.totalDistance+=n[ne].dist(n[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=eD[o.type]==="Polygon";let w=n.length;for(;w>=2&&n[w-1].equals(n[w-2]);)w--;let E=0;for(;E<w-1&&n[E].equals(n[E+1]);)E++;if(w<(x?3:2))return;c==="bevel"&&(m=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,M=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let D,O,B,U,$;this.e1=this.e2=-1,x&&(D=n[w-2],$=n[E].sub(D)._unit()._perp());for(let ne=E;ne<w;ne++){if(B=ne===w-1?x?n[E+1]:void 0:n[ne+1],B&&n[ne].equals(B))continue;$&&(U=$),D&&(O=D),D=n[ne],$=B?B.sub(D)._unit()._perp():U,U=U||$;let ue=U.add($);ue.x===0&&ue.y===0||ue._unit();const te=U.x*$.x+U.y*$.y,oe=ue.x*$.x+ue.y*$.y,fe=oe!==0?1/oe:1/0,ae=2*Math.sqrt(2-2*oe),Se=oe<tD&&O&&B,Ee=U.x*$.y-U.y*$.x>0;if(Se&&ne>E){const Ce=D.dist(O);if(Ce>2*S){const Oe=D.sub(D.sub(O)._mult(S/Ce)._round());this.updateDistance(O,Oe),this.addCurrentVertex(Oe,U,0,0,M),O=Oe}}const Le=O&&B;let We=Le?c:x?"butt":d;if(Le&&We==="round"&&(fe<_?We="miter":fe<=2&&(We="fakeround")),We==="miter"&&fe>m&&(We="bevel"),We==="bevel"&&(fe>2&&(We="flipbevel"),fe<m&&(We="miter")),O&&this.updateDistance(O,D),We==="miter")ue._mult(fe),this.addCurrentVertex(D,ue,0,0,M);else if(We==="flipbevel"){if(fe>100)ue=$.mult(-1);else{const Ce=fe*U.add($).mag()/U.sub($).mag();ue._perp()._mult(Ce*(Ee?-1:1))}this.addCurrentVertex(D,ue,0,0,M),this.addCurrentVertex(D,ue.mult(-1),0,0,M)}else if(We==="bevel"||We==="fakeround"){const Ce=-Math.sqrt(fe*fe-1),Oe=Ee?Ce:0,Ne=Ee?0:Ce;if(O&&this.addCurrentVertex(D,U,Oe,Ne,M),We==="fakeround"){const je=Math.round(180*ae/Math.PI/20);for(let Ze=1;Ze<je;Ze++){let ke=Ze/je;if(ke!==.5){const Bt=ke-.5;ke+=ke*Bt*(ke-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*Bt*Bt+(.848013+te*(.215638*te-1.06021)))}const at=$.sub(U)._mult(ke)._add(U)._unit()._mult(Ee?-1:1);this.addHalfVertex(D,at.x,at.y,!1,Ee,0,M)}}B&&this.addCurrentVertex(D,$,-Oe,-Ne,M)}else if(We==="butt")this.addCurrentVertex(D,ue,0,0,M);else if(We==="square"){const Ce=O?1:-1;O||this.addCurrentVertex(D,ue,Ce,Ce,M),this.addCurrentVertex(D,ue,0,0,M),O&&this.addCurrentVertex(D,ue,Ce,Ce,M)}else We==="round"&&(O&&(this.addCurrentVertex(D,U,0,0,M),this.addCurrentVertex(D,U,1,1,M,!0)),B&&(this.addCurrentVertex(D,$,-1,-1,M,!0),this.addCurrentVertex(D,$,0,0,M)));if(Se&&ne<w-1){const Ce=D.dist(B);if(Ce>2*S){const Oe=D.add(B.sub(D)._mult(S/Ce)._round());this.updateDistance(D,Oe),this.addCurrentVertex(Oe,$,0,0,M),D=Oe}}}}addCurrentVertex(n,o,c,d,m,_=!1){const x=o.y*d-o.x,w=-o.y-o.x*d;this.addHalfVertex(n,o.x+o.y*c,o.y-o.x*c,_,!1,c,m),this.addHalfVertex(n,x,w,_,!0,-d,m)}addHalfVertex({x:n,y:o},c,d,m,_,x,w){this.layoutVertexArray.emplaceBack((n<<1)+(m?1:0),(o<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),_?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,o){this.distance+=n.dist(o),this.updateScaledDistance()}}xt(vg,"LineBucket",{omit:["layers","patternFeatures"]});const nD=new Qe({"line-cap":new me(De.layout_line["line-cap"]),"line-join":new me(De.layout_line["line-join"]),"line-miter-limit":new we(De.layout_line["line-miter-limit"]),"line-round-limit":new we(De.layout_line["line-round-limit"]),"line-sort-key":new me(De.layout_line["line-sort-key"])});var vw={paint:new Qe({"line-opacity":new me(De.paint_line["line-opacity"]),"line-color":new me(De.paint_line["line-color"]),"line-translate":new we(De.paint_line["line-translate"]),"line-translate-anchor":new we(De.paint_line["line-translate-anchor"]),"line-width":new me(De.paint_line["line-width"]),"line-gap-width":new me(De.paint_line["line-gap-width"]),"line-offset":new me(De.paint_line["line-offset"]),"line-blur":new me(De.paint_line["line-blur"]),"line-dasharray":new ct(De.paint_line["line-dasharray"]),"line-pattern":new ct(De.paint_line["line-pattern"]),"line-gradient":new rt(De.paint_line["line-gradient"]),"line-trim-offset":new we(De.paint_line["line-trim-offset"])}),layout:nD};const xw=new class extends me{possiblyEvaluate(s,n){return n=new ie(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(s,n)}evaluate(s,n,o,c){return n=rn({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(s,n,o,c)}}(vw.paint.properties["line-width"].specification);function bw(s,n){return n>0?n+2*s:s}xw.useIntegerZoom=!0;const iD=Je([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rD=Je([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),sD=Je([{name:"a_projected_pos",components:4,type:"Float32"}],4);Je([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const oD=Je([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),aD=Je([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Je([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ww=Je([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lD=Je([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Je([{name:"triangle",components:3,type:"Uint16"}]),Je([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Je([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Je([{type:"Float32",name:"offsetX"}]),Je([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var tr=24;const co=128;function Tv(s,n){const{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new ie(s+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:d}=o;let m=0;for(;m<c.length&&c[m]<=s;)m++;m=Math.max(0,m-1);let _=m;for(;_<c.length&&c[_]<s+1;)_++;_=Math.min(c.length-1,_);const x=c[m],w=c[_];return o.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:d}:{kind:"camera",minZoom:x,maxZoom:w,minSize:o.evaluate(new ie(x)),maxSize:o.evaluate(new ie(w)),interpolationType:d}}}function xg(s,{uSize:n,uSizeT:o},{lowerSize:c,upperSize:d}){return s.kind==="source"?c/co:s.kind==="composite"?En(c/co,d/co,o):n}function Gu(s,n){let o=0,c=0;if(s.kind==="constant")c=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:d,minZoom:m,maxZoom:_}=s,x=d?Xe(_s.interpolationFactor(d,n,m,_),0,1):0;s.kind==="camera"?c=En(s.minSize,s.maxSize,x):o=x}return{uSizeT:o,uSize:c}}var cD=Object.freeze({__proto__:null,getSizeData:Tv,evaluateSizeForFeature:xg,evaluateSizeForZoom:Gu,SIZE_PACK_FACTOR:co});function uD(s,n,o){return s.sections.forEach(c=>{c.text=function(d,m,_){const x=m.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?d=d.toLocaleUpperCase():x==="lowercase"&&(d=d.toLocaleLowerCase()),ce.applyArabicShaping&&(d=ce.applyArabicShaping(d)),d}(c.text,n,o)}),s}const uf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function hD(s){return s==="\uFE36"||s==="\uFE48"||s==="\uFE38"||s==="\uFE44"||s==="\uFE42"||s==="\uFE3E"||s==="\uFE3C"||s==="\uFE3A"||s==="\uFE18"||s==="\uFE40"||s==="\uFE10"||s==="\uFE13"||s==="\uFE14"||s==="\uFF40"||s==="\uFFE3"||s==="\uFE11"||s==="\uFE12"}function dD(s){return s==="\uFE35"||s==="\uFE47"||s==="\uFE37"||s==="\uFE43"||s==="\uFE41"||s==="\uFE3D"||s==="\uFE3B"||s==="\uFE39"||s==="\uFE17"||s==="\uFE3F"}var hf=Wn,Tw=function(s,n,o,c,d){var m,_,x=8*d-c-1,w=(1<<x)-1,E=w>>1,S=-7,M=o?d-1:0,D=o?-1:1,O=s[n+M];for(M+=D,m=O&(1<<-S)-1,O>>=-S,S+=x;S>0;m=256*m+s[n+M],M+=D,S-=8);for(_=m&(1<<-S)-1,m>>=-S,S+=c;S>0;_=256*_+s[n+M],M+=D,S-=8);if(m===0)m=1-E;else{if(m===w)return _?NaN:1/0*(O?-1:1);_+=Math.pow(2,c),m-=E}return(O?-1:1)*_*Math.pow(2,m-c)},Ew=function(s,n,o,c,d,m){var _,x,w,E=8*m-d-1,S=(1<<E)-1,M=S>>1,D=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=c?0:m-1,B=c?1:-1,U=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(x=isNaN(n)?1:0,_=S):(_=Math.floor(Math.log(n)/Math.LN2),n*(w=Math.pow(2,-_))<1&&(_--,w*=2),(n+=_+M>=1?D/w:D*Math.pow(2,1-M))*w>=2&&(_++,w/=2),_+M>=S?(x=0,_=S):_+M>=1?(x=(n*w-1)*Math.pow(2,d),_+=M):(x=n*Math.pow(2,M-1)*Math.pow(2,d),_=0));d>=8;s[o+O]=255&x,O+=B,x/=256,d-=8);for(_=_<<d|x,E+=d;E>0;s[o+O]=255&_,O+=B,_/=256,E-=8);s[o+O-B]|=128*U};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Wn(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Wn.Varint=0,Wn.Fixed64=1,Wn.Bytes=2,Wn.Fixed32=5;var Ev=4294967296,Iw=1/Ev,Sw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function jo(s){return s.type===Wn.Bytes?s.readVarint()+s.pos:s.pos+1}function $u(s,n,o){return o?4294967296*n+(s>>>0):4294967296*(n>>>0)+(s>>>0)}function Aw(s,n,o){var c=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(c);for(var d=o.pos-1;d>=s;d--)o.buf[d+c]=o.buf[d]}function fD(s,n){for(var o=0;o<s.length;o++)n.writeVarint(s[o])}function pD(s,n){for(var o=0;o<s.length;o++)n.writeSVarint(s[o])}function mD(s,n){for(var o=0;o<s.length;o++)n.writeFloat(s[o])}function gD(s,n){for(var o=0;o<s.length;o++)n.writeDouble(s[o])}function _D(s,n){for(var o=0;o<s.length;o++)n.writeBoolean(s[o])}function yD(s,n){for(var o=0;o<s.length;o++)n.writeFixed32(s[o])}function vD(s,n){for(var o=0;o<s.length;o++)n.writeSFixed32(s[o])}function xD(s,n){for(var o=0;o<s.length;o++)n.writeFixed64(s[o])}function bD(s,n){for(var o=0;o<s.length;o++)n.writeSFixed64(s[o])}function bg(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16)+16777216*s[n+3]}function qu(s,n,o){s[o]=n,s[o+1]=n>>>8,s[o+2]=n>>>16,s[o+3]=n>>>24}function Cw(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16)+(s[n+3]<<24)}function wD(s,n,o){n.glyphs=[],s===1&&o.readMessage(TD,n)}function TD(s,n,o){if(s===3){const{id:c,bitmap:d,width:m,height:_,left:x,top:w,advance:E}=o.readMessage(ED,{});n.glyphs.push({id:c,bitmap:new Vo({width:m+6,height:_+6},d),metrics:{width:m,height:_,left:x,top:w,advance:E}})}else s===4?n.ascender=o.readSVarint():s===5&&(n.descender=o.readSVarint())}function ED(s,n,o){s===1?n.id=o.readVarint():s===2?n.bitmap=o.readBytes():s===3?n.width=o.readVarint():s===4?n.height=o.readVarint():s===5?n.left=o.readSVarint():s===6?n.top=o.readSVarint():s===7&&(n.advance=o.readVarint())}function Iv(s){let n=0,o=0;for(const _ of s)n+=_.w*_.h,o=Math.max(o,_.w);s.sort((_,x)=>x.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let d=0,m=0;for(const _ of s)for(let x=c.length-1;x>=0;x--){const w=c[x];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,m=Math.max(m,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===w.w&&_.h===w.h){const E=c.pop();x<c.length&&(c[x]=E)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(c.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:d,h:m,fill:n/(d*m)||0}}Wn.prototype={destroy:function(){this.buf=null},readFields:function(s,n,o){for(o=o||this.length;this.pos<o;){var c=this.readVarint(),d=c>>3,m=this.pos;this.type=7&c,s(d,n,this),this.pos===m&&this.skip(c)}return n},readMessage:function(s,n){return this.readFields(s,n,this.readVarint()+this.pos)},readFixed32:function(){var s=bg(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Cw(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=bg(this.buf,this.pos)+bg(this.buf,this.pos+4)*Ev;return this.pos+=8,s},readSFixed64:function(){var s=bg(this.buf,this.pos)+Cw(this.buf,this.pos+4)*Ev;return this.pos+=8,s},readFloat:function(){var s=Tw(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Tw(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var n,o,c=this.buf;return n=127&(o=c[this.pos++]),o<128?n:(n|=(127&(o=c[this.pos++]))<<7,o<128?n:(n|=(127&(o=c[this.pos++]))<<14,o<128?n:(n|=(127&(o=c[this.pos++]))<<21,o<128?n:function(d,m,_){var x,w,E=_.buf;if(x=(112&(w=E[_.pos++]))>>4,w<128||(x|=(127&(w=E[_.pos++]))<<3,w<128)||(x|=(127&(w=E[_.pos++]))<<10,w<128)||(x|=(127&(w=E[_.pos++]))<<17,w<128)||(x|=(127&(w=E[_.pos++]))<<24,w<128)||(x|=(1&(w=E[_.pos++]))<<31,w<128))return $u(d,x,m);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(o=c[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,n=this.pos;return this.pos=s,s-n>=12&&Sw?function(o,c,d){return Sw.decode(o.subarray(c,d))}(this.buf,n,s):function(o,c,d){for(var m="",_=c;_<d;){var x,w,E,S=o[_],M=null,D=S>239?4:S>223?3:S>191?2:1;if(_+D>d)break;D===1?S<128&&(M=S):D===2?(192&(x=o[_+1]))==128&&(M=(31&S)<<6|63&x)<=127&&(M=null):D===3?(w=o[_+2],(192&(x=o[_+1]))==128&&(192&w)==128&&((M=(15&S)<<12|(63&x)<<6|63&w)<=2047||M>=55296&&M<=57343)&&(M=null)):D===4&&(w=o[_+2],E=o[_+3],(192&(x=o[_+1]))==128&&(192&w)==128&&(192&E)==128&&((M=(15&S)<<18|(63&x)<<12|(63&w)<<6|63&E)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,D=1):M>65535&&(M-=65536,m+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),m+=String.fromCharCode(M),_+=D}return m}(this.buf,n,s)},readBytes:function(){var s=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,s);return this.pos=s,n},readPackedVarint:function(s,n){if(this.type!==Wn.Bytes)return s.push(this.readVarint(n));var o=jo(this);for(s=s||[];this.pos<o;)s.push(this.readVarint(n));return s},readPackedSVarint:function(s){if(this.type!==Wn.Bytes)return s.push(this.readSVarint());var n=jo(this);for(s=s||[];this.pos<n;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Wn.Bytes)return s.push(this.readBoolean());var n=jo(this);for(s=s||[];this.pos<n;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Wn.Bytes)return s.push(this.readFloat());var n=jo(this);for(s=s||[];this.pos<n;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Wn.Bytes)return s.push(this.readDouble());var n=jo(this);for(s=s||[];this.pos<n;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Wn.Bytes)return s.push(this.readFixed32());var n=jo(this);for(s=s||[];this.pos<n;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Wn.Bytes)return s.push(this.readSFixed32());var n=jo(this);for(s=s||[];this.pos<n;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Wn.Bytes)return s.push(this.readFixed64());var n=jo(this);for(s=s||[];this.pos<n;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Wn.Bytes)return s.push(this.readSFixed64());var n=jo(this);for(s=s||[];this.pos<n;)s.push(this.readSFixed64());return s},skip:function(s){var n=7&s;if(n===Wn.Varint)for(;this.buf[this.pos++]>127;);else if(n===Wn.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Wn.Fixed32)this.pos+=4;else{if(n!==Wn.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(s,n){this.writeVarint(s<<3|n)},realloc:function(s){for(var n=this.length||16;n<this.pos+s;)n*=2;if(n!==this.length){var o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),qu(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),qu(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),qu(this.buf,-1&s,this.pos),qu(this.buf,Math.floor(s*Iw),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),qu(this.buf,-1&s,this.pos),qu(this.buf,Math.floor(s*Iw),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(n,o){var c,d;if(n>=0?(c=n%4294967296|0,d=n/4294967296|0):(d=~(-n/4294967296),4294967295^(c=~(-n%4294967296))?c=c+1|0:(c=0,d=d+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(m,_,x){x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7)}(c,0,o),function(m,_){var x=(7&m)<<4;_.buf[_.pos++]|=x|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(d,o)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var n=this.pos;this.pos=function(c,d,m){for(var _,x,w=0;w<d.length;w++){if((_=d.charCodeAt(w))>55295&&_<57344){if(!x){_>56319||w+1===d.length?(c[m++]=239,c[m++]=191,c[m++]=189):x=_;continue}if(_<56320){c[m++]=239,c[m++]=191,c[m++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(c[m++]=239,c[m++]=191,c[m++]=189,x=null);_<128?c[m++]=_:(_<2048?c[m++]=_>>6|192:(_<65536?c[m++]=_>>12|224:(c[m++]=_>>18|240,c[m++]=_>>12&63|128),c[m++]=_>>6&63|128),c[m++]=63&_|128)}return m}(this.buf,s,this.pos);var o=this.pos-n;o>=128&&Aw(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeFloat:function(s){this.realloc(4),Ew(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Ew(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var n=s.length;this.writeVarint(n),this.realloc(n);for(var o=0;o<n;o++)this.buf[this.pos++]=s[o]},writeRawMessage:function(s,n){this.pos++;var o=this.pos;s(n,this);var c=this.pos-o;c>=128&&Aw(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeMessage:function(s,n,o){this.writeTag(s,Wn.Bytes),this.writeRawMessage(n,o)},writePackedVarint:function(s,n){n.length&&this.writeMessage(s,fD,n)},writePackedSVarint:function(s,n){n.length&&this.writeMessage(s,pD,n)},writePackedBoolean:function(s,n){n.length&&this.writeMessage(s,_D,n)},writePackedFloat:function(s,n){n.length&&this.writeMessage(s,mD,n)},writePackedDouble:function(s,n){n.length&&this.writeMessage(s,gD,n)},writePackedFixed32:function(s,n){n.length&&this.writeMessage(s,yD,n)},writePackedSFixed32:function(s,n){n.length&&this.writeMessage(s,vD,n)},writePackedFixed64:function(s,n){n.length&&this.writeMessage(s,xD,n)},writePackedSFixed64:function(s,n){n.length&&this.writeMessage(s,bD,n)},writeBytesField:function(s,n){this.writeTag(s,Wn.Bytes),this.writeBytes(n)},writeFixed32Field:function(s,n){this.writeTag(s,Wn.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(s,n){this.writeTag(s,Wn.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(s,n){this.writeTag(s,Wn.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(s,n){this.writeTag(s,Wn.Fixed64),this.writeSFixed64(n)},writeVarintField:function(s,n){this.writeTag(s,Wn.Varint),this.writeVarint(n)},writeSVarintField:function(s,n){this.writeTag(s,Wn.Varint),this.writeSVarint(n)},writeStringField:function(s,n){this.writeTag(s,Wn.Bytes),this.writeString(n)},writeFloatField:function(s,n){this.writeTag(s,Wn.Fixed32),this.writeFloat(n)},writeDoubleField:function(s,n){this.writeTag(s,Wn.Fixed64),this.writeDouble(n)},writeBooleanField:function(s,n){this.writeVarintField(s,Boolean(n))}};class Sv{constructor(n,{pixelRatio:o,version:c,stretchX:d,stretchY:m,content:_}){this.paddedRect=n,this.pixelRatio=o,this.stretchX=d,this.stretchY=m,this.content=_,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class kw{constructor(n,o){const c={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(n,c,m),this.addImages(o,d,m);const{w:_,h:x}=Iv(m),w=new $r({width:_||1,height:x||1});for(const E in n){const S=n[E],M=c[E].paddedRect;$r.copy(S.data,w,{x:0,y:0},{x:M.x+1,y:M.y+1},S.data)}for(const E in o){const S=o[E],M=d[E].paddedRect,D=M.x+1,O=M.y+1,B=S.data.width,U=S.data.height;$r.copy(S.data,w,{x:0,y:0},{x:D,y:O},S.data),$r.copy(S.data,w,{x:0,y:U-1},{x:D,y:O-1},{width:B,height:1}),$r.copy(S.data,w,{x:0,y:0},{x:D,y:O+U},{width:B,height:1}),$r.copy(S.data,w,{x:B-1,y:0},{x:D-1,y:O},{width:1,height:U}),$r.copy(S.data,w,{x:0,y:0},{x:D+B,y:O},{width:1,height:U})}this.image=w,this.iconPositions=c,this.patternPositions=d}addImages(n,o,c){for(const d in n){const m=n[d],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};c.push(_),o[d]=new Sv(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(n,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>n.hasImage(c)),n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in n.updatedImages)this.patchUpdatedImage(this.iconPositions[c],n.getImage(c),o),this.patchUpdatedImage(this.patternPositions[c],n.getImage(c),o)}patchUpdatedImage(n,o,c){if(!n||!o||n.version===o.version)return;n.version=o.version;const[d,m]=n.tl;c.update(o.data,void 0,{x:d,y:m})}}xt(Sv,"ImagePosition"),xt(kw,"ImageAtlas");const as={horizontal:1,vertical:2,horizontalOnly:3};class df{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,o){const c=new df;return c.scale=n||1,c.fontStack=o,c}static forImage(n){const o=new df;return o.imageName=n,o}}class Wu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o){const c=new Wu;for(let d=0;d<n.sections.length;d++){const m=n.sections[d];m.image?c.addImageSection(m):c.addTextSection(m,o)}return c}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(n){this.text=function(o,c){let d="";for(let m=0;m<o.length;m++){const _=o.charCodeAt(m+1)||null,x=o.charCodeAt(m-1)||null;d+=!c&&(_&&I(_)&&!uf[o[m+1]]||x&&I(x)&&!uf[o[m-1]])||!uf[o[m]]?o[m]:uf[o[m]]}return d}(this.text,n)}trim(){let n=0;for(let c=0;c<this.text.length&&wg[this.text.charCodeAt(c)];c++)n++;let o=this.text.length;for(let c=this.text.length-1;c>=0&&c>=n&&wg[this.text.charCodeAt(c)];c--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const c=new Wu;return c.text=this.text.substring(n,o),c.sectionIndex=this.sectionIndex.slice(n,o),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(df.forText(n.scale,n.fontStack||o));const c=this.sections.length-1;for(let d=0;d<n.text.length;++d)this.sectionIndex.push(c)}addImageSection(n){const o=n.image?n.image.name:"";if(o.length===0)return void xn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(df.forImage(o)),this.sectionIndex.push(this.sections.length-1)):xn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Av(s,n,o,c,d,m,_,x,w,E,S,M,D,O,B){const U=Wu.fromFeature(s,d);M===as.vertical&&U.verticalizePunctuation(D);let $=[];const ne=function(ae,Se,Ee,Le,We,Ce){if(!ae)return[];const Oe=[],Ne=function(at,Bt,ft,St,ut,Vt){let Yt=0;for(let Jt=0;Jt<at.length();Jt++){const wn=at.getSection(Jt);Yt+=Mw(at.getCharCode(Jt),wn,St,ut,Bt,Vt)}return Yt/Math.max(1,Math.ceil(Yt/ft))}(ae,Se,Ee,Le,We,Ce),je=ae.text.indexOf("\u200B")>=0;let Ze=0;for(let at=0;at<ae.length();at++){const Bt=ae.getSection(at),ft=ae.getCharCode(at);if(wg[ft]||(Ze+=Mw(ft,Bt,Le,We,Se,Ce)),at<ae.length()-1){const St=!((ke=ft)<11904||!(Du(ke)||Mu(ke)||Ru(ke)||Ym(ke)||Zm(ke)||Ud(ke)||qm(ke)||Xl(ke)||Hm(ke)||Gd(ke)||jd(ke)||a(ke)||ku(ke)||Vd(ke)||$m(ke)||Wm(ke)||Kl(ke)||Qm(ke)||Xm(ke)||Pu(ke)));(ID[ft]||St||Bt.imageName)&&Oe.push(Pw(at+1,Ze,Ne,Oe,SD(ft,ae.getCharCode(at+1),St&&je),!1))}}var ke;return Rw(Pw(ae.length(),Ze,Ne,Oe,0,!0))}(U,E,m,n,c,O),{processBidirectionalText:ue,processStyledBidirectionalText:te}=ce;if(ue&&U.sections.length===1){const ae=ue(U.toString(),ne);for(const Se of ae){const Ee=new Wu;Ee.text=Se,Ee.sections=U.sections;for(let Le=0;Le<Se.length;Le++)Ee.sectionIndex.push(0);$.push(Ee)}}else if(te){const ae=te(U.text,U.sectionIndex,ne);for(const Se of ae){const Ee=new Wu;Ee.text=Se[0],Ee.sectionIndex=Se[1],Ee.sections=U.sections,$.push(Ee)}}else $=function(ae,Se){const Ee=[],Le=ae.text;let We=0;for(const Ce of Se)Ee.push(ae.substring(We,Ce)),We=Ce;return We<Le.length&&Ee.push(ae.substring(We,Le.length)),Ee}(U,ne);const oe=[],fe={positionedLines:oe,text:U.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ae,Se,Ee,Le,We,Ce,Oe,Ne,je,Ze,ke,at){let Bt=0,ft=0,St=0;const ut=Ne==="right"?1:Ne==="left"?0:.5;let Vt=!1;for(const nn of We){const fn=nn.getSections();for(const Vn of fn){if(Vn.imageName)continue;const Kn=Se[Vn.fontStack];if(Kn&&(Vt=Kn.ascender!==void 0&&Kn.descender!==void 0,!Vt))break}if(!Vt)break}let Yt=0;for(const nn of We){nn.trim();const fn=nn.getMaxScale(),Vn=(fn-1)*tr,Kn={positionedGlyphs:[],lineOffset:0};ae.positionedLines[Yt]=Kn;const Zn=Kn.positionedGlyphs;let Yn=0;if(!nn.length()){ft+=Ce,++Yt;continue}let ei=0,ci=0;for(let Ln=0;Ln<nn.length();Ln++){const Si=nn.getSection(Ln),vi=nn.getSectionIndex(Ln),In=nn.getCharCode(Ln);let ai=Si.scale,Di=null,jn=null,fi=null,dr=tr,Gi=0;const $i=!(je===as.horizontal||!ke&&!b(In)||ke&&(wg[In]||(Jt=In,jm(Jt)||Hl(Jt)||Gm(Jt)||$d(Jt)||p(Jt))));if(Si.imageName){const kr=Le[Si.imageName];if(!kr)continue;fi=Si.imageName,ae.iconsInText=ae.iconsInText||!0,jn=kr.paddedRect;const qi=kr.displaySize;ai=ai*tr/at,Di={width:qi[0],height:qi[1],left:1,top:-3,advance:$i?qi[1]:qi[0],localGlyph:!1},Gi=Vt?-Di.height*ai:fn*tr-17-qi[1]*ai,dr=Di.advance;const qo=($i?qi[0]:qi[1])*ai-tr*fn;qo>0&&qo>Yn&&(Yn=qo)}else{const kr=Ee[Si.fontStack];if(!kr)continue;kr[In]&&(jn=kr[In]);const qi=Se[Si.fontStack];if(!qi)continue;const qo=qi.glyphs[In];if(!qo)continue;if(Di=qo.metrics,dr=In!==8203?tr:0,Vt){const th=qi.ascender!==void 0?Math.abs(qi.ascender):0,Ef=qi.descender!==void 0?Math.abs(qi.descender):0,If=(th+Ef)*ai;ei<If&&(ei=If,ci=(th-Ef)/2*ai),Gi=-th*ai}else Gi=(fn-ai)*tr-17}$i?(ae.verticalizable=!0,Zn.push({glyph:In,imageName:fi,x:Bt,y:ft+Gi,vertical:$i,scale:ai,localGlyph:Di.localGlyph,fontStack:Si.fontStack,sectionIndex:vi,metrics:Di,rect:jn}),Bt+=dr*ai+Ze):(Zn.push({glyph:In,imageName:fi,x:Bt,y:ft+Gi,vertical:$i,scale:ai,localGlyph:Di.localGlyph,fontStack:Si.fontStack,sectionIndex:vi,metrics:Di,rect:jn}),Bt+=Di.advance*ai+Ze)}Zn.length!==0&&(St=Math.max(Bt-Ze,St),Vt?Lw(Zn,ut,Yn,ci,Ce*fn/2):Lw(Zn,ut,Yn,0,Ce/2)),Bt=0;const ji=Ce*fn+Yn;Kn.lineOffset=Math.max(Yn,Vn),ft+=ji,++Yt}var Jt;const wn=ft,{horizontalAlign:Kt,verticalAlign:Jn}=Cv(Oe);(function(nn,fn,Vn,Kn,Zn,Yn){const ei=(fn-Vn)*Zn,ci=-Yn*Kn;for(const ji of nn)for(const Ln of ji.positionedGlyphs)Ln.x+=ei,Ln.y+=ci})(ae.positionedLines,ut,Kt,Jn,St,wn),ae.top+=-Jn*wn,ae.bottom=ae.top+wn,ae.left+=-Kt*St,ae.right=ae.left+St,ae.hasBaseline=Vt}(fe,n,o,c,$,_,x,w,M,E,D,B),!function(ae){for(const Se of ae)if(Se.positionedGlyphs.length!==0)return!1;return!0}(oe)&&fe}const wg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ID={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Mw(s,n,o,c,d,m){if(n.imageName){const _=c[n.imageName];return _?_.displaySize[0]*n.scale*tr/m+d:0}{const _=o[n.fontStack],x=_&&_.glyphs[s];return x?x.metrics.advance*n.scale+d:0}}function Dw(s,n,o,c){const d=Math.pow(s-n,2);return c?s<n?d/2:2*d:d+Math.abs(o)*o}function SD(s,n,o){let c=0;return s===10&&(c-=1e4),o&&(c+=150),s!==40&&s!==65288||(c+=50),n!==41&&n!==65289||(c+=50),c}function Pw(s,n,o,c,d,m){let _=null,x=Dw(n,o,d,m);for(const w of c){const E=Dw(n-w.x,o,d,m)+w.badness;E<=x&&(_=w,x=E)}return{index:s,x:n,priorBreak:_,badness:x}}function Rw(s){return s?Rw(s.priorBreak).concat(s.index):[]}function Cv(s){let n=.5,o=.5;switch(s){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function Lw(s,n,o,c,d){if(!(n||o||c||d))return;const m=s.length-1,_=s[m],x=(_.x+_.metrics.advance*_.scale)*n;for(let w=0;w<=m;w++)s[w].x-=x,s[w].y+=o+c+d}function AD(s,n,o){const{horizontalAlign:c,verticalAlign:d}=Cv(o),m=n[0]-s.displaySize[0]*c,_=n[1]-s.displaySize[1]*d;return{image:s,top:_,bottom:_+s.displaySize[1],left:m,right:m+s.displaySize[0]}}function zw(s,n,o,c,d,m){const _=s.image;let x;if(_.content){const $=_.content,ne=_.pixelRatio||1;x=[$[0]/ne,$[1]/ne,_.displaySize[0]-$[2]/ne,_.displaySize[1]-$[3]/ne]}const w=n.left*m,E=n.right*m;let S,M,D,O;o==="width"||o==="both"?(O=d[0]+w-c[3],M=d[0]+E+c[1]):(O=d[0]+(w+E-_.displaySize[0])/2,M=O+_.displaySize[0]);const B=n.top*m,U=n.bottom*m;return o==="height"||o==="both"?(S=d[1]+B-c[0],D=d[1]+U+c[2]):(S=d[1]+(B+U-_.displaySize[1])/2,D=S+_.displaySize[1]),{image:_,top:S,right:M,bottom:D,left:O,collisionPadding:x}}class Go extends ge{constructor(n,o,c,d,m){super(n,o),this.angle=d,this.z=c,m!==void 0&&(this.segment=m)}clone(){return new Go(this.x,this.y,this.z,this.angle,this.segment)}}function Ow(s,n,o,c,d){if(n.segment===void 0)return!0;let m=n,_=n.segment+1,x=0;for(;x>-o/2;){if(_--,_<0)return!1;x-=s[_].dist(m),m=s[_]}x+=s[_].dist(s[_+1]),_++;const w=[];let E=0;for(;x<o/2;){const S=s[_],M=s[_+1];if(!M)return!1;let D=s[_-1].angleTo(S)-S.angleTo(M);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:D}),E+=D;x-w[0].distance>c;)E-=w.shift().angleDelta;if(E>d)return!1;_++,x+=S.dist(M)}return!0}function Bw(s){let n=0;for(let o=0;o<s.length-1;o++)n+=s[o].dist(s[o+1]);return n}function Fw(s,n,o){return s?.6*n*o:0}function Nw(s,n){return Math.max(s?s.right-s.left:0,n?n.right-n.left:0)}function CD(s,n,o,c,d,m){const _=Fw(o,d,m),x=Nw(o,c)*m;let w=0;const E=Bw(s)/2;for(let S=0;S<s.length-1;S++){const M=s[S],D=s[S+1],O=M.dist(D);if(w+O>E){const B=(E-w)/O,U=En(M.x,D.x,B),$=En(M.y,D.y,B),ne=new Go(U,$,0,D.angleTo(M),S);return!_||Ow(s,ne,x,_,n)?ne:void 0}w+=O}}function kD(s,n,o,c,d,m,_,x,w){const E=Fw(c,m,_),S=Nw(c,d),M=S*_,D=s[0].x===0||s[0].x===w||s[0].y===0||s[0].y===w;return n-M<n/4&&(n=M+n/4),Uw(s,D?n/2*x%n:(S/2+2*m)*_*x%n,n,E,o,M,D,!1,w)}function Uw(s,n,o,c,d,m,_,x,w){const E=m/2,S=Bw(s);let M=0,D=n-o,O=[];for(let B=0;B<s.length-1;B++){const U=s[B],$=s[B+1],ne=U.dist($),ue=$.angleTo(U);for(;D+o<M+ne;){D+=o;const te=(D-M)/ne,oe=En(U.x,$.x,te),fe=En(U.y,$.y,te);if(oe>=0&&oe<w&&fe>=0&&fe<w&&D-E>=0&&D+E<=S){const ae=new Go(oe,fe,0,ue,B);ae._round(),c&&!Ow(s,ae,m,c,d)||O.push(ae)}}M+=ne}return x||O.length||_||(O=Uw(s,M/2,o,c,d,m,_,!0,w)),O}function Vw(s,n,o,c,d){const m=[];for(let _=0;_<s.length;_++){const x=s[_];let w;for(let E=0;E<x.length-1;E++){let S=x[E],M=x[E+1];S.x<n&&M.x<n||(S.x<n?S=new ge(n,S.y+(n-S.x)/(M.x-S.x)*(M.y-S.y))._round():M.x<n&&(M=new ge(n,S.y+(n-S.x)/(M.x-S.x)*(M.y-S.y))._round()),S.y<o&&M.y<o||(S.y<o?S=new ge(S.x+(o-S.y)/(M.y-S.y)*(M.x-S.x),o)._round():M.y<o&&(M=new ge(S.x+(o-S.y)/(M.y-S.y)*(M.x-S.x),o)._round()),S.x>=c&&M.x>=c||(S.x>=c?S=new ge(c,S.y+(c-S.x)/(M.x-S.x)*(M.y-S.y))._round():M.x>=c&&(M=new ge(c,S.y+(c-S.x)/(M.x-S.x)*(M.y-S.y))._round()),S.y>=d&&M.y>=d||(S.y>=d?S=new ge(S.x+(d-S.y)/(M.y-S.y)*(M.x-S.x),d)._round():M.y>=d&&(M=new ge(S.x+(d-S.y)/(M.y-S.y)*(M.x-S.x),d)._round()),w&&S.equals(w[w.length-1])||(w=[S],m.push(w)),w.push(M)))))}}return m}xt(Go,"Anchor");const ff=1e20;function jw(s,n,o,c,d,m,_,x,w){for(let E=n;E<n+c;E++)Gw(s,o*m+E,m,d,_,x,w);for(let E=o;E<o+d;E++)Gw(s,E*m+n,1,c,_,x,w)}function Gw(s,n,o,c,d,m,_){m[0]=0,_[0]=-ff,_[1]=ff,d[0]=s[n];for(let x=1,w=0,E=0;x<c;x++){d[x]=s[n+x*o];const S=x*x;do{const M=m[w];E=(d[x]-d[M]+S-M*M)/(x-M)/2}while(E<=_[w]&&--w>-1);w++,m[w]=x,_[w]=E,_[w+1]=ff}for(let x=0,w=0;x<c;x++){for(;_[w+1]<x;)w++;const E=m[w],S=x-E;s[n+x*o]=d[E]+S*S}}const kv={none:0,ideographs:1,all:2};class Zu{constructor(n,o,c){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,o){const c=[];for(const d in n)for(const m of n[d])c.push({stack:d,id:m});ni(c,({stack:d,id:m},_)=>{let x=this.entries[d];x||(x=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[m];if(w!==void 0)return void _(null,{stack:d,id:m,glyph:w});if(w=this._tinySDF(x,d,m),w)return x.glyphs[m]=w,void _(null,{stack:d,id:m,glyph:w});const E=Math.floor(m/256);if(256*E>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void _(null,{stack:d,id:m,glyph:w});let S=x.requests[E];S||(S=x.requests[E]=[],Zu.loadGlyphRange(d,E,this.url,this.requestManager,(M,D)=>{if(D){x.ascender=D.ascender,x.descender=D.descender;for(const O in D.glyphs)this._doesCharSupportLocalGlyph(+O)||(x.glyphs[+O]=D.glyphs[+O]);x.ranges[E]=!0}for(const O of S)O(M,D);delete x.requests[E]})),S.push((M,D)=>{M?_(M):D&&_(null,{stack:d,id:m,glyph:D.glyphs[m]||null})})},(d,m)=>{if(d)o(d);else if(m){const _={};for(const{stack:x,id:w,glyph:E}of m)_[x]===void 0&&(_[x]={}),_[x].glyphs===void 0&&(_[x].glyphs={}),_[x].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;o(null,_)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==kv.none&&(this.localGlyphMode===kv.all?!!this.localFontFamily:!!this.localFontFamily&&(Gd(n)||Km(n)||ku(n)||Kl(n)||Xl(n)))}_tinySDF(n,o,c){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let m=n.tinySDF;if(!m){let U="400";/bold/i.test(o)?U="900":/medium/i.test(o)?U="500":/light/i.test(o)&&(U="200"),m=n.tinySDF=new Zu.TinySDF({fontFamily:d,fontWeight:U,fontSize:48,buffer:6,radius:16}),m.fontWeight=U}if(this.localGlyphs[m.fontWeight][c])return this.localGlyphs[m.fontWeight][c];const _=String.fromCharCode(c),{data:x,width:w,height:E,glyphWidth:S,glyphHeight:M,glyphLeft:D,glyphTop:O,glyphAdvance:B}=m.draw(_);return this.localGlyphs[m.fontWeight][c]={id:c,bitmap:new Vo({width:w,height:E},x),metrics:{width:S/2,height:M/2,left:D/2,top:O/2-27,advance:B/2,localGlyph:!0}}}}function $w(s,n,o,c){const d=[],m=s.image,_=m.pixelRatio,x=m.paddedRect.w-2,w=m.paddedRect.h-2,E=s.right-s.left,S=s.bottom-s.top,M=m.stretchX||[[0,x]],D=m.stretchY||[[0,w]],O=(Ce,Oe)=>Ce+Oe[1]-Oe[0],B=M.reduce(O,0),U=D.reduce(O,0),$=x-B,ne=w-U;let ue=0,te=B,oe=0,fe=U,ae=0,Se=$,Ee=0,Le=ne;if(m.content&&c){const Ce=m.content;ue=Tg(M,0,Ce[0]),oe=Tg(D,0,Ce[1]),te=Tg(M,Ce[0],Ce[2]),fe=Tg(D,Ce[1],Ce[3]),ae=Ce[0]-ue,Ee=Ce[1]-oe,Se=Ce[2]-Ce[0]-te,Le=Ce[3]-Ce[1]-fe}const We=(Ce,Oe,Ne,je)=>{const Ze=Eg(Ce.stretch-ue,te,E,s.left),ke=Ig(Ce.fixed-ae,Se,Ce.stretch,B),at=Eg(Oe.stretch-oe,fe,S,s.top),Bt=Ig(Oe.fixed-Ee,Le,Oe.stretch,U),ft=Eg(Ne.stretch-ue,te,E,s.left),St=Ig(Ne.fixed-ae,Se,Ne.stretch,B),ut=Eg(je.stretch-oe,fe,S,s.top),Vt=Ig(je.fixed-Ee,Le,je.stretch,U),Yt=new ge(Ze,at),Jt=new ge(ft,at),wn=new ge(ft,ut),Kt=new ge(Ze,ut),Jn=new ge(ke/_,Bt/_),nn=new ge(St/_,Vt/_),fn=n*Math.PI/180;if(fn){const Zn=Math.sin(fn),Yn=Math.cos(fn),ei=[Yn,-Zn,Zn,Yn];Yt._matMult(ei),Jt._matMult(ei),Kt._matMult(ei),wn._matMult(ei)}const Vn=Ce.stretch+Ce.fixed,Kn=Oe.stretch+Oe.fixed;return{tl:Yt,tr:Jt,bl:Kt,br:wn,tex:{x:m.paddedRect.x+1+Vn,y:m.paddedRect.y+1+Kn,w:Ne.stretch+Ne.fixed-Vn,h:je.stretch+je.fixed-Kn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jn,pixelOffsetBR:nn,minFontScaleX:Se/_/E,minFontScaleY:Le/_/S,isSDF:o}};if(c&&(m.stretchX||m.stretchY)){const Ce=qw(M,$,B),Oe=qw(D,ne,U);for(let Ne=0;Ne<Ce.length-1;Ne++){const je=Ce[Ne],Ze=Ce[Ne+1];for(let ke=0;ke<Oe.length-1;ke++)d.push(We(je,Oe[ke],Ze,Oe[ke+1]))}}else d.push(We({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return d}function Tg(s,n,o){let c=0;for(const d of s)c+=Math.max(n,Math.min(o,d[1]))-Math.max(n,Math.min(o,d[0]));return c}function qw(s,n,o){const c=[{fixed:-1,stretch:0}];for(const[d,m]of s){const _=c[c.length-1];c.push({fixed:d-_.stretch,stretch:_.stretch}),c.push({fixed:d-_.stretch,stretch:_.stretch+(m-d)})}return c.push({fixed:n+1,stretch:o}),c}function Eg(s,n,o,c){return s/n*o+c}function Ig(s,n,o,c){return s-n*o/c}function MD(s,n,o,c){const d=n+s.positionedLines[c].lineOffset;return c===0?o+d/2:o+(d+(n+s.positionedLines[c-1].lineOffset))/2}Zu.loadGlyphRange=function(s,n,o,c,d){const m=256*n,_=m+255,x=c.transformRequest(c.normalizeGlyphsURL(o).replace("{fontstack}",s).replace("{range}",`${m}-${_}`),Rr.Glyphs);Xs(x,(w,E)=>{if(w)d(w);else if(E){const S={},M=function(D){return new hf(D).readFields(wD,{})}(E);for(const D of M.glyphs)S[D.id]=D;d(null,{glyphs:S,ascender:M.ascender,descender:M.descender})}})},Zu.TinySDF=class{constructor({fontSize:s=24,buffer:n=3,radius:o=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}={}){this.buffer=n,this.cutoff=c,this.radius=o;const x=this.size=s+4*n,w=this._createCanvas(x),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${_} ${m} ${s}px ${d}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(s){const n=document.createElement("canvas");return n.width=n.height=s,n}draw(s){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(s),_=Math.ceil(o),x=Math.min(this.size-this.buffer,Math.ceil(m-d)),w=Math.min(this.size-this.buffer,_+Math.ceil(c)),E=x+2*this.buffer,S=w+2*this.buffer,M=Math.max(E*S,0),D=new Uint8ClampedArray(M),O={data:D,width:E,height:S,glyphWidth:x,glyphHeight:w,glyphTop:_,glyphLeft:0,glyphAdvance:n};if(x===0||w===0)return O;const{ctx:B,buffer:U,gridInner:$,gridOuter:ne}=this;B.clearRect(U,U,x,w),B.fillText(s,U,U+_);const ue=B.getImageData(U,U,x,w);ne.fill(ff,0,M),$.fill(0,0,M);for(let te=0;te<w;te++)for(let oe=0;oe<x;oe++){const fe=ue.data[4*(te*x+oe)+3]/255;if(fe===0)continue;const ae=(te+U)*E+oe+U;if(fe===1)ne[ae]=0,$[ae]=ff;else{const Se=.5-fe;ne[ae]=Se>0?Se*Se:0,$[ae]=Se<0?Se*Se:0}}jw(ne,0,0,E,S,E,this.f,this.v,this.z),jw($,U,U,x,w,E,this.f,this.v,this.z);for(let te=0;te<M;te++){const oe=Math.sqrt(ne[te])-Math.sqrt($[te]);D[te]=Math.round(255-255*(oe/this.radius+this.cutoff))}return O}};class DD{constructor(n=[],o=PD){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:c}=this,d=o[n];for(;n>0;){const m=n-1>>1,_=o[m];if(c(d,_)>=0)break;o[n]=_,n=m}o[n]=d}_down(n){const{data:o,compare:c}=this,d=this.length>>1,m=o[n];for(;n<d;){let _=1+(n<<1),x=o[_];const w=_+1;if(w<this.length&&c(o[w],x)<0&&(_=w,x=o[w]),c(x,m)>=0)break;o[n]=x,n=_}o[n]=m}}function PD(s,n){return s<n?-1:s>n?1:0}function RD(s,n=1,o=!1){let c=1/0,d=1/0,m=-1/0,_=-1/0;const x=s[0];for(let O=0;O<x.length;O++){const B=x[O];(!O||B.x<c)&&(c=B.x),(!O||B.y<d)&&(d=B.y),(!O||B.x>m)&&(m=B.x),(!O||B.y>_)&&(_=B.y)}const w=Math.min(m-c,_-d);let E=w/2;const S=new DD([],LD);if(w===0)return new ge(c,d);for(let O=c;O<m;O+=w)for(let B=d;B<_;B+=w)S.push(new Hu(O+E,B+E,E,s));let M=function(O){let B=0,U=0,$=0;const ne=O[0];for(let ue=0,te=ne.length,oe=te-1;ue<te;oe=ue++){const fe=ne[ue],ae=ne[oe],Se=fe.x*ae.y-ae.x*fe.y;U+=(fe.x+ae.x)*Se,$+=(fe.y+ae.y)*Se,B+=3*Se}return new Hu(U/B,$/B,0,O)}(s),D=S.length;for(;S.length;){const O=S.pop();(O.d>M.d||!M.d)&&(M=O,o&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,D)),O.max-M.d<=n||(E=O.h/2,S.push(new Hu(O.p.x-E,O.p.y-E,E,s)),S.push(new Hu(O.p.x+E,O.p.y-E,E,s)),S.push(new Hu(O.p.x-E,O.p.y+E,E,s)),S.push(new Hu(O.p.x+E,O.p.y+E,E,s)),D+=4)}return o&&(console.log(`num probes: ${D}`),console.log(`best distance: ${M.d}`)),M.p}function LD(s,n){return n.max-s.max}function Hu(s,n,o,c){this.p=new ge(s,n),this.h=o,this.d=function(d,m){let _=!1,x=1/0;for(let w=0;w<m.length;w++){const E=m[w];for(let S=0,M=E.length,D=M-1;S<M;D=S++){const O=E[S],B=E[D];O.y>d.y!=B.y>d.y&&d.x<(B.x-O.x)*(d.y-O.y)/(B.y-O.y)+O.x&&(_=!_),x=Math.min(x,Mb(d,O,B))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const Mv=Number.POSITIVE_INFINITY,zD=Math.sqrt(2);function Ww(s,n){return n[1]!==Mv?function(o,c,d){let m=0,_=0;switch(c=Math.abs(c),d=Math.abs(d),o){case"top-right":case"top-left":case"top":_=d-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-d}switch(o){case"top-right":case"bottom-right":case"right":m=-c;break;case"top-left":case"bottom-left":case"left":m=c}return[m,_]}(s,n[0],n[1]):function(o,c){let d=0,m=0;c<0&&(c=0);const _=c/zD;switch(o){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-c;break;case"top":m=c-7}switch(o){case"top-right":case"bottom-right":d=-_;break;case"top-left":case"bottom-left":d=_;break;case"left":d=c;break;case"right":d=-c}return[d,m]}(s,n[0])}function OD(s,n,o,c,d,m,_,x,w,E){s.createArrays(),s.tilePixelRatio=Zt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const S=s.layers[0].layout,M=s.layers[0]._unevaluatedLayout._values,D={};if(s.textSizeData.kind==="composite"){const{minZoom:U,maxZoom:$}=s.textSizeData;D.compositeTextSizes=[M["text-size"].possiblyEvaluate(new ie(U),x),M["text-size"].possiblyEvaluate(new ie($),x)]}if(s.iconSizeData.kind==="composite"){const{minZoom:U,maxZoom:$}=s.iconSizeData;D.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new ie(U),x),M["icon-size"].possiblyEvaluate(new ie($),x)]}D.layoutTextSize=M["text-size"].possiblyEvaluate(new ie(w+1),x),D.layoutIconSize=M["icon-size"].possiblyEvaluate(new ie(w+1),x),D.textMaxSize=M["text-size"].possiblyEvaluate(new ie(18),x);const O=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",B=S.get("text-size");for(const U of s.features){const $=S.get("text-font").evaluate(U,{},x).join(","),ne=B.evaluate(U,{},x),ue=D.layoutTextSize.evaluate(U,{},x),te=(D.layoutIconSize.evaluate(U,{},x),{horizontal:{},vertical:void 0}),oe=U.text;let fe,ae=[0,0];if(oe){const Le=oe.toString(),We=S.get("text-letter-spacing").evaluate(U,{},x)*tr,Ce=S.get("text-line-height").evaluate(U,{},x)*tr,Oe=g(Le)?We:0,Ne=S.get("text-anchor").evaluate(U,{},x),je=S.get("text-variable-anchor");if(!je){const ft=S.get("text-radial-offset").evaluate(U,{},x);ae=ft?Ww(Ne,[ft*tr,Mv]):S.get("text-offset").evaluate(U,{},x).map(St=>St*tr)}let Ze=O?"center":S.get("text-justify").evaluate(U,{},x);const ke=S.get("symbol-placement")==="point",at=ke?S.get("text-max-width").evaluate(U,{},x)*tr:1/0,Bt=ft=>{s.allowVerticalPlacement&&h(Le)&&(te.vertical=Av(oe,n,o,d,$,at,Ce,Ne,ft,Oe,ae,as.vertical,!0,ue,ne))};if(!O&&je){const ft=Ze==="auto"?je.map(ut=>Dv(ut)):[Ze];let St=!1;for(let ut=0;ut<ft.length;ut++){const Vt=ft[ut];if(!te.horizontal[Vt])if(St)te.horizontal[Vt]=te.horizontal[0];else{const Yt=Av(oe,n,o,d,$,at,Ce,"center",Vt,Oe,ae,as.horizontal,!1,ue,ne);Yt&&(te.horizontal[Vt]=Yt,St=Yt.positionedLines.length===1)}}Bt("left")}else{if(Ze==="auto"&&(Ze=Dv(Ne)),ke||S.get("text-writing-mode").indexOf("horizontal")>=0||!h(Le)){const ft=Av(oe,n,o,d,$,at,Ce,Ne,Ze,Oe,ae,as.horizontal,!1,ue,ne);ft&&(te.horizontal[Ze]=ft)}Bt(ke?"left":Ze)}}let Se=!1;if(U.icon&&U.icon.name){const Le=c[U.icon.name];Le&&(fe=AD(d[U.icon.name],S.get("icon-offset").evaluate(U,{},x),S.get("icon-anchor").evaluate(U,{},x)),Se=Le.sdf,s.sdfIcons===void 0?s.sdfIcons=Le.sdf:s.sdfIcons!==Le.sdf&&xn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Le.pixelRatio!==s.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const Ee=Hw(te.horizontal)||te.vertical;s.iconsInText||(s.iconsInText=!!Ee&&Ee.iconsInText),(Ee||fe)&&BD(s,U,te,fe,c,D,ue,0,ae,Se,_,x,E)}m&&s.generateCollisionDebugBuffers(w,s.collisionBoxArray)}function Dv(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function BD(s,n,o,c,d,m,_,x,w,E,S,M,D){let O=m.textMaxSize.evaluate(n,{},M);O===void 0&&(O=_);const B=s.layers[0].layout,U=B.get("icon-offset").evaluate(n,{},M),$=Hw(o.horizontal)||o.vertical,ne=D.name==="globe",ue=_/24,te=s.tilePixelRatio*O/24,oe=(Oe=s.overscaling,s.zoom>18&&Oe>2&&(Oe>>=1),Math.max(Zt/(512*Oe),1)*B.get("symbol-spacing")),fe=B.get("text-padding")*s.tilePixelRatio,ae=B.get("icon-padding")*s.tilePixelRatio,Se=vt(B.get("text-max-angle")),Ee=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Le=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",We=B.get("symbol-placement"),Ce=oe/2;var Oe;const Ne=B.get("icon-text-fit");let je;c&&Ne!=="none"&&(s.allowVerticalPlacement&&o.vertical&&(je=zw(c,o.vertical,Ne,B.get("icon-text-fit-padding"),U,ue)),$&&(c=zw(c,$,Ne,B.get("icon-text-fit-padding"),U,ue)));const Ze=(ke,at,Bt)=>{if(at.x<0||at.x>=Zt||at.y<0||at.y>=Zt)return;let ft=null;if(ne){const{x:St,y:ut,z:Vt}=D.projectTilePoint(at.x,at.y,Bt);ft={anchor:new Go(St,ut,Vt,0,void 0),up:D.upVector(Bt,at.x,at.y)}}(function(St,ut,Vt,Yt,Jt,wn,Kt,Jn,nn,fn,Vn,Kn,Zn,Yn,ei,ci,ji,Ln,Si,vi,In,ai,Di,jn,fi){const dr=St.addToLineVertexArray(ut,Yt);let Gi,$i,kr,qi,qo,th,Ef,If=0,PT=0,RT=0,LT=0,Zv=-1,Hv=-1;const mo={};let zT=Lu.exports("");const ac=Vt?Vt.anchor:ut;let Xv=0,Kv=0;if(nn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Xv,Kv]=nn.layout.get("text-offset").evaluate(In,{},fi).map(qr=>qr*tr):(Xv=nn.layout.get("text-radial-offset").evaluate(In,{},fi)*tr,Kv=Mv),St.allowVerticalPlacement&&Jt.vertical){const qr=Jt.vertical;if(ei)th=Pv(qr),Jn&&(Ef=Pv(Jn));else{const Wr=nn.layout.get("text-rotate").evaluate(In,{},fi)+90;kr=Sg(fn,ac,ut,Vn,Kn,Zn,qr,Yn,Wr,ci),Jn&&(qi=Sg(fn,ac,ut,Vn,Kn,Zn,Jn,Ln,Wr))}}if(wn){const qr=nn.layout.get("icon-rotate").evaluate(In,{},fi),Wr=nn.layout.get("icon-text-fit")!=="none",Sf=$w(wn,qr,Di,Wr),Qv=Jn?$w(Jn,qr,Di,Wr):void 0;$i=Sg(fn,ac,ut,Vn,Kn,Zn,wn,Ln,qr),If=4*Sf.length;const OT=St.iconSizeData;let lc=null;OT.kind==="source"?(lc=[co*nn.layout.get("icon-size").evaluate(In,{},fi)],lc[0]>Fa&&xn(`${St.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):OT.kind==="composite"&&(lc=[co*ai.compositeIconSizes[0].evaluate(In,{},fi),co*ai.compositeIconSizes[1].evaluate(In,{},fi)],(lc[0]>Fa||lc[1]>Fa)&&xn(`${St.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),St.addSymbols(St.icon,Sf,lc,vi,Si,In,!1,Vt,ut,dr.lineStartIndex,dr.lineLength,-1,jn,fi),Zv=St.icon.placedSymbolArray.length-1,Qv&&(PT=4*Qv.length,St.addSymbols(St.icon,Qv,lc,vi,Si,In,as.vertical,Vt,ut,dr.lineStartIndex,dr.lineLength,-1,jn,fi),Hv=St.icon.placedSymbolArray.length-1)}for(const qr in Jt.horizontal){const Wr=Jt.horizontal[qr];Gi||(zT=Lu.exports(Wr.text),ei?qo=Pv(Wr):Gi=Sg(fn,ac,ut,Vn,Kn,Zn,Wr,Yn,nn.layout.get("text-rotate").evaluate(In,{},fi),ci));const Sf=Wr.positionedLines.length===1;if(RT+=Zw(St,Vt,ut,Wr,Kt,nn,ei,In,ci,dr,Jt.vertical?as.horizontal:as.horizontalOnly,Sf?Object.keys(Jt.horizontal):[qr],mo,Zv,ai,jn,fi),Sf)break}Jt.vertical&&(LT+=Zw(St,Vt,ut,Jt.vertical,Kt,nn,ei,In,ci,dr,as.vertical,["vertical"],mo,Hv,ai,jn,fi));let $a=-1;const Yv=(qr,Wr)=>qr?Math.max(qr,Wr):Wr;$a=Yv(qo,$a),$a=Yv(th,$a),$a=Yv(Ef,$a);const mP=$a>-1?1:0;St.glyphOffsetArray.length>=Ua.MAX_GLYPHS&&xn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),In.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,In.sortKey),St.symbolInstances.emplaceBack(ac.x,ac.y,ac.z,ut.x,ut.y,mo.right>=0?mo.right:-1,mo.center>=0?mo.center:-1,mo.left>=0?mo.left:-1,mo.vertical>=0?mo.vertical:-1,Zv,Hv,zT,Gi!==void 0?Gi:St.collisionBoxArray.length,Gi!==void 0?Gi+1:St.collisionBoxArray.length,kr!==void 0?kr:St.collisionBoxArray.length,kr!==void 0?kr+1:St.collisionBoxArray.length,$i!==void 0?$i:St.collisionBoxArray.length,$i!==void 0?$i+1:St.collisionBoxArray.length,qi||St.collisionBoxArray.length,qi?qi+1:St.collisionBoxArray.length,Vn,RT,LT,If,PT,mP,0,Xv,Kv,$a)})(s,at,ft,ke,o,c,d,je,s.layers[0],s.collisionBoxArray,n.index,n.sourceLayerIndex,s.index,fe,Ee,w,0,ae,Le,U,n,m,E,S,M)};if(We==="line")for(const ke of Vw(n.geometry,0,0,Zt,Zt)){const at=kD(ke,oe,Se,o.vertical||$,c,24,te,s.overscaling,Zt);for(const Bt of at){const ft=$;ft&&FD(s,ft.text,Ce,Bt)||Ze(ke,Bt,M)}}else if(We==="line-center"){for(const ke of n.geometry)if(ke.length>1){const at=CD(ke,Se,o.vertical||$,c,24,te);at&&Ze(ke,at,M)}}else if(n.type==="Polygon")for(const ke of vv(n.geometry,0)){const at=RD(ke,16);Ze(ke[0],new Go(at.x,at.y,0,0,void 0),M)}else if(n.type==="LineString")for(const ke of n.geometry)Ze(ke,new Go(ke[0].x,ke[0].y,0,0,void 0),M);else if(n.type==="Point")for(const ke of n.geometry)for(const at of ke)Ze([at],new Go(at.x,at.y,0,0,void 0),M)}const Fa=32640;function Zw(s,n,o,c,d,m,_,x,w,E,S,M,D,O,B,U,$){const ne=function(oe,fe,ae,Se,Ee,Le,We,Ce){const Oe=[];if(fe.positionedLines.length===0)return Oe;const Ne=Se.layout.get("text-rotate").evaluate(Le,{})*Math.PI/180,je=function(ft){const St=ft[0],ut=ft[1],Vt=St*ut;return Vt>0?[St,-ut]:Vt<0?[-St,ut]:St===0?[ut,St]:[ut,-St]}(ae);let Ze=Math.abs(fe.top-fe.bottom);for(const ft of fe.positionedLines)Ze-=ft.lineOffset;const ke=fe.positionedLines.length,at=Ze/ke;let Bt=fe.top-ae[1];for(let ft=0;ft<ke;++ft){const St=fe.positionedLines[ft];Bt=MD(fe,at,Bt,ft);for(const ut of St.positionedGlyphs){if(!ut.rect)continue;const Vt=ut.rect||{};let Yt=4,Jt=!0,wn=1,Kt=0;if(ut.imageName){const jn=We[ut.imageName];if(!jn)continue;if(jn.sdf){xn("SDF images are not supported in formatted text and will be ignored.");continue}Jt=!1,wn=jn.pixelRatio,Yt=1/wn}const Jn=(Ee||Ce)&&ut.vertical,nn=ut.metrics.advance*ut.scale/2,fn=ut.metrics,Vn=ut.rect;if(Vn===null)continue;Ce&&fe.verticalizable&&(Kt=ut.imageName?nn-ut.metrics.width*ut.scale/2:0);const Kn=Ee?[ut.x+nn,ut.y]:[0,0];let Zn=[0,0],Yn=[0,0],ei=!1;Ee||(Jn?(Yn=[ut.x+nn+je[0],ut.y+je[1]-Kt],ei=!0):Zn=[ut.x+nn+ae[0],ut.y+ae[1]-Kt]);const ci=Vn.w*ut.scale/(wn*(ut.localGlyph?2:1)),ji=Vn.h*ut.scale/(wn*(ut.localGlyph?2:1));let Ln,Si,vi,In;if(Jn){const jn=ut.y-Bt,fi=new ge(-nn,nn-jn),dr=-Math.PI/2,Gi=new ge(...Yn);Ln=new ge(-nn+Zn[0],Zn[1]),Ln._rotateAround(dr,fi)._add(Gi),Ln.x+=-jn+nn,Ln.y-=(fn.left-Yt)*ut.scale;const $i=ut.imageName?fn.advance*ut.scale:tr*ut.scale,kr=String.fromCharCode(ut.glyph);hD(kr)?Ln.x+=(1-Yt)*ut.scale:dD(kr)?Ln.x+=$i-fn.height*ut.scale+(-Yt-1)*ut.scale:Ln.x+=ut.imageName||fn.width+2*Yt===Vn.w&&fn.height+2*Yt===Vn.h?($i-ji)/2:($i-(fn.height+2*Yt)*ut.scale)/2,Si=new ge(Ln.x,Ln.y-ci),vi=new ge(Ln.x+ji,Ln.y),In=new ge(Ln.x+ji,Ln.y-ci)}else{const jn=(fn.left-Yt)*ut.scale-nn+Zn[0],fi=(-fn.top-Yt)*ut.scale+Zn[1],dr=jn+ci,Gi=fi+ji;Ln=new ge(jn,fi),Si=new ge(dr,fi),vi=new ge(jn,Gi),In=new ge(dr,Gi)}if(Ne){let jn;jn=Ee?new ge(0,0):ei?new ge(je[0],je[1]):new ge(ae[0],ae[1]),Ln._rotateAround(Ne,jn),Si._rotateAround(Ne,jn),vi._rotateAround(Ne,jn),In._rotateAround(Ne,jn)}const ai=new ge(0,0),Di=new ge(0,0);Oe.push({tl:Ln,tr:Si,bl:vi,br:In,tex:Vt,writingMode:fe.writingMode,glyphOffset:Kn,sectionIndex:ut.sectionIndex,isSDF:Jt,pixelOffsetTL:ai,pixelOffsetBR:Di,minFontScaleX:0,minFontScaleY:0})}}return Oe}(0,c,w,m,_,x,d,s.allowVerticalPlacement),ue=s.textSizeData;let te=null;ue.kind==="source"?(te=[co*m.layout.get("text-size").evaluate(x,{},$)],te[0]>Fa&&xn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ue.kind==="composite"&&(te=[co*B.compositeTextSizes[0].evaluate(x,{},$),co*B.compositeTextSizes[1].evaluate(x,{},$)],(te[0]>Fa||te[1]>Fa)&&xn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,ne,te,w,_,x,S,n,o,E.lineStartIndex,E.lineLength,O,U,$);for(const oe of M)D[oe]=s.text.placedSymbolArray.length-1;return 4*ne.length}function Hw(s){for(const n in s)return s[n];return null}function Sg(s,n,o,c,d,m,_,x,w,E){let S=_.top,M=_.bottom,D=_.left,O=_.right;const B=_.collisionPadding;if(B&&(D-=B[0],S-=B[1],O+=B[2],M+=B[3]),w){const U=new ge(D,S),$=new ge(O,S),ne=new ge(D,M),ue=new ge(O,M),te=vt(w);let oe=new ge(0,0);E&&(oe=new ge(E[0],E[1])),U._rotateAround(te,oe),$._rotateAround(te,oe),ne._rotateAround(te,oe),ue._rotateAround(te,oe),D=Math.min(U.x,$.x,ne.x,ue.x),O=Math.max(U.x,$.x,ne.x,ue.x),S=Math.min(U.y,$.y,ne.y,ue.y),M=Math.max(U.y,$.y,ne.y,ue.y)}return s.emplaceBack(n.x,n.y,n.z,o.x,o.y,D,S,O,M,x,c,d,m),s.length-1}function Pv(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const n=s.bottom-s.top;return n>0?Math.max(10,n):null}function FD(s,n,o,c){const d=s.compareText;if(n in d){const m=d[n];for(let _=m.length-1;_>=0;_--)if(c.dist(m[_])<o)return!0}else d[n]=[];return d[n].push(c),!1}const ND=Je([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Xw}=ND,Kw=Je([{name:"a_pos_3",components:3,type:"Int16"}]);var pf=Je([{name:"a_pos",type:"Int16",components:2}]);const $o=Zt/Math.PI/2,Rv=2*ws(1,0)*$o*Math.PI,Xu=64,Ku=[Xu,32,16],Ns=-$o,Us=$o,UD=[new Ar([Ns,Ns,Ns],[Us,Us,Us]),new Ar([Ns,Ns,Ns],[0,0,Us]),new Ar([0,Ns,Ns],[Us,0,Us]),new Ar([Ns,0,Ns],[0,Us,Us]),new Ar([0,0,Ns],[Us,Us,Us])];function Yw(s,n,o,c=!0){const d=os([],s._camera.position,s.worldSize),m=[n,o,1,1];nc(m,m,s.pixelMatrixInverse),jb(m,m,1/m[3]);const _=Sr([],Fs([],m,d)),x=s.globeMatrix,w=[x[12],x[13],x[14]],E=Fs([],w,d),S=Hd(E),M=Sr([],E),D=s.worldSize/(2*Math.PI),O=Ts(M,_),B=Math.asin(D/S);if(B<Math.acos(O)){if(!c)return null;const We=[],Ce=[];os(We,_,S/O),Sr(Ce,Fs(Ce,We,E)),Sr(_,Uo(_,E,os(_,Ce,Math.tan(B)*S)))}const U=[];new hv(d,_).closestPointOnSphere(w,D,U);const $=Sr([],Jr(x,0)),ne=Sr([],Jr(x,1)),ue=Sr([],Jr(x,2)),te=Ts($,U),oe=Ts(ne,U),fe=Ts(ue,U),ae=Ft(Math.asin(-oe/D));let Se=Ft(Math.atan2(te,fe));Se=s.center.lng+function(We,Ce){const Oe=(Ce-We+180)%360-180;return Oe<-180?Oe+360:Oe}(s.center.lng,Se);const Ee=so(Se),Le=Xe(oo(ae),0,1);return new Ou(Ee,Le)}class VD{constructor(n,o,c){this.a=Fs([],n,c),this.b=Fs([],o,c),this.center=c;const d=Sr([],this.a),m=Sr([],this.b);this.angle=Math.acos(Ts(d,m))}}function Lv(s,n){if(s.angle===0)return null;let o;return o=s.a[n]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[n]/s.a[n]/Math.sin(s.angle)-1/Math.tan(s.angle)),o<0||o>1?null:function(c,d,m,_){const x=Math.sin(m);return c*(Math.sin((1-_)*m)/x)+d*(Math.sin(_*m)/x)}(s.a[n],s.b[n],s.angle,Xe(o,0,1))+s.center[n]}function uo(s){if(s.z<=1)return UD[s.z+2*s.y+s.x];const n=zv(Ag(s));return Ar.fromPoints(n)}function rc(s,n,o){return os(s,s,1-o),Yd(s,s,n,o)}function Qw(s,n){const o=Qu(n.zoom);if(o===0)return uo(s);const c=Ag(s),d=zv(c),m=so(c.getWest())*n.worldSize,_=so(c.getEast())*n.worldSize,x=oo(c.getNorth())*n.worldSize,w=oo(c.getSouth())*n.worldSize,E=[m,x,0],S=[_,x,0],M=[m,w,0],D=[_,w,0],O=ov([],n.globeMatrix);return Ii(E,E,O),Ii(S,S,O),Ii(M,M,O),Ii(D,D,O),d[0]=rc(d[0],M,o),d[1]=rc(d[1],D,o),d[2]=rc(d[2],S,o),d[3]=rc(d[3],E,o),Ar.fromPoints(d)}function Jw(s,n,o){for(const c of s)Ii(c,c,n),os(c,c,o)}function jD(s,n,o){const c=n/s.worldSize,d=s.globeMatrix;if(o.z<=1){const Ee=uo(o).getCorners();return Jw(Ee,d,c),Ar.fromPoints(Ee)}const m=Ag(o),_=zv(m);Jw(_,d,c);const x=Number.MAX_VALUE,w=[-x,-x,-x],E=[x,x,x];if(m.contains(s.center)){for(const We of _)Xd(E,E,We),Kd(w,w,We);w[2]=0;const Ee=s.point,Le=[Ee.x*c,Ee.y*c,0];return Xd(E,E,Le),Kd(w,w,Le),new Ar(E,w)}const S=[d[12]*c,d[13]*c,d[14]*c],M=m.getCenter(),D=Xe(s.center.lat,-85.051129,ao),O=Xe(M.lat,-85.051129,ao),B=so(s.center.lng),U=oo(D);let $=B-so(M.lng);const ne=U-oo(O);$>.5?$-=1:$<-.5&&($+=1);let ue=0;Math.abs($)>Math.abs(ne)?ue=$>=0?1:3:(ue=ne>=0?0:2,Yd(S,S,[d[4]*c,d[5]*c,d[6]*c],-Math.sin(vt(ne>=0?m.getSouth():m.getNorth()))*$o));const te=_[ue],oe=_[(ue+1)%4],fe=new VD(te,oe,S),ae=[Lv(fe,0)||te[0],Lv(fe,1)||te[1],Lv(fe,2)||te[2]],Se=Qu(s.zoom);if(Se>0){const Ee=function({x:We,y:Ce,z:Oe},Ne,je,Ze,ke){const at=1/(1<<Oe);let Bt=We*at,ft=Bt+at,St=Ce*at,ut=St+at,Vt=0;const Yt=(Bt+ft)/2-Ze;return Yt>.5?Vt=-1:Yt<-.5&&(Vt=1),Bt=((Bt+Vt)*Ne-(Ze*=Ne))*je+Ze,ft=((ft+Vt)*Ne-Ze)*je+Ze,St=(St*Ne-(ke*=Ne))*je+ke,ut=(ut*Ne-ke)*je+ke,[[Bt,ut,0],[ft,ut,0],[ft,St,0],[Bt,St,0]]}(o,n,s._pixelsPerMercatorPixel,B,U);for(let We=0;We<_.length;We++)rc(_[We],Ee[We],Se);const Le=Uo([],Ee[ue],Ee[(ue+1)%4]);os(Le,Le,.5),rc(ae,Le,Se)}for(const Ee of _)Xd(E,E,Ee),Kd(w,w,Ee);return E[2]=Math.min(te[2],oe[2]),Xd(E,E,ae),Kd(w,w,ae),new Ar(E,w)}function Ag({x:s,y:n,z:o}){const c=1/(1<<o),d=new kn(ss(s*c),er((n+1)*c)),m=new kn(ss((s+1)*c),er(n*c));return new Ba(d,m)}function zv(s){const n=vt(s.getNorth()),o=vt(s.getSouth()),c=Math.cos(n),d=Math.cos(o),m=Math.sin(n),_=Math.sin(o),x=s.getWest(),w=s.getEast();return[Yu(d,_,x),Yu(d,_,w),Yu(c,m,w),Yu(c,m,x)]}function Yu(s,n,o,c=$o){return o=vt(o),[s*Math.sin(o)*c,-n*c,s*Math.cos(o)*c]}function mf(s,n,o){return Yu(Math.cos(vt(s)),Math.sin(vt(s)),n,o)}function gf(s,n,o,c){const d=1<<o.z,m=(s/Zt+o.x)/d;return mf(er((n/Zt+o.y)/d),ss(m),c)}function Cg({min:s,max:n}){return 16383/Math.max(n[0]-s[0],n[1]-s[1],n[2]-s[2])}const eT=new Float64Array(16);function _f(s){const n=Cg(s),o=Bb(eT,[n,n,n]);return Zd(o,o,((c=[])[0]=-(d=s.min)[0],c[1]=-d[1],c[2]=-d[2],c));var c,d}function Ov(s){const n=(c=s.min,(o=eT)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=c[0],o[13]=c[1],o[14]=c[2],o[15]=1,o);var o,c;const d=1/Cg(s);return tc(n,n,[d,d,d])}function tT(s,n,o,c,d){const m=function(w){const E=Zt/(2*Math.PI);return w/(2*Math.PI)/E}(o),_=[s,n,-o/(2*Math.PI)],x=lo(new Float64Array(16));return Zd(x,x,_),tc(x,x,[m,m,m]),av(x,x,vt(-d)),cg(x,x,vt(-c)),x}function Qu(s){return an(5,6,s)}function nT(s,n){const o=mf(n.lat,n.lng),c=function(B){const U=mf(B._center.lat,B._center.lng);let $=uv([],Nu(0,1,0),U);const ne=Fb([],-B.angle,U);$=Ii($,$,ne),Fb(ne,-B._pitch,$);const ue=Sr([],U);return os(ue,ue,B.cameraToCenterDistance/B.pixelsPerMeter*Rv),Ii(ue,ue,ne),Uo([],U,ue)}(s);return _=(d=cv([],c,o))[0],x=d[1],w=d[2],E=(m=o)[0],S=m[1],M=m[2],O=(D=Math.sqrt(_*_+x*x+w*w)*Math.sqrt(E*E+S*S+M*M))&&Ts(d,m)/D,Math.acos(Math.min(Math.max(O,-1),1));var d,m,_,x,w,E,S,M,D,O}const iT=vt(85),GD=Math.cos(iT),$D=Math.sin(iT);function rT(s,n){const o=s.fovAboveCenter,c=s.elevation?s.elevation.getMinElevationBelowMSL()*n:0,d=(s._camera.position[2]*s.worldSize-c)/Math.cos(s._pitch),m=Math.sin(o)*d/Math.sin(Math.max(Math.PI/2-s._pitch-o,.01)),_=Math.sin(s._pitch)*m+d;return Math.min(1.01*_,d*(1/s._horizonShift))}function sc(s,n){if(!n.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:n};const o=Math.pow(2,-s.z),c=s.x*o,d=(s.x+1)*o,m=s.y*o,_=(s.y+1)*o,x=ss(c),w=ss(d),E=er(m),S=er(_),M=n.project(x,E),D=n.project(w,E),O=n.project(w,S),B=n.project(x,S);let U=Math.min(M.x,D.x,O.x,B.x),$=Math.min(M.y,D.y,O.y,B.y),ne=Math.max(M.x,D.x,O.x,B.x),ue=Math.max(M.y,D.y,O.y,B.y);const te=o/16;function oe(ae,Se,Ee,Le,We,Ce){const Oe=(Ee+We)/2,Ne=(Le+Ce)/2,je=n.project(ss(Oe),er(Ne)),Ze=Math.max(0,U-je.x,$-je.y,je.x-ne,je.y-ue);U=Math.min(U,je.x),ne=Math.max(ne,je.x),$=Math.min($,je.y),ue=Math.max(ue,je.y),Ze>te&&(oe(ae,je,Ee,Le,Oe,Ne),oe(je,Se,Oe,Ne,We,Ce))}oe(M,D,c,m,d,m),oe(D,O,d,m,d,_),oe(O,B,d,_,c,_),oe(B,M,c,_,c,m),U-=te,$-=te,ne+=te,ue+=te;const fe=1/Math.max(ne-U,ue-$);return{scale:fe,x:U*fe,y:$*fe,x2:ne*fe,y2:ue*fe,projection:n}}const qD=lo(new Float32Array(16));class Na{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new kn(0,0)}projectTilePoint(n,o,c){return{x:n,y:o,z:0}}locationPoint(n,o,c=!0){return n._coordinatePoint(n.locationCoordinate(o),c)}pixelsPerMeter(n,o){return ws(1,n)*o}pixelSpaceConversion(n,o,c){return 1}farthestPixelDistance(n){return rT(n,n.pixelsPerMeter)}pointCoordinate(n,o,c,d){const m=n.horizonLineFromTop(!1),_=new ge(o,Math.max(m,c));return n.rayIntersectionCoordinate(n.pointRayIntersection(_,d))}pointCoordinate3D(n,o,c){const d=new ge(o,c);if(n.elevation)return n.elevation.pointCoordinate(d);{const m=this.pointCoordinate(n,d.x,d.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(n,o){if(n.elevation)return!this.pointCoordinate3D(n,o.x,o.y);const c=n.horizonLineFromTop();return o.y<c}createInversionMatrix(n,o){return qD}createTileMatrix(n,o,c){let d,m,_;const x=c.canonical,w=lo(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=sc(x,this);d=1,m=E.x+c.wrap*E.scale,_=E.y,tc(w,w,[d/E.scale,d/E.scale,n.pixelsPerMeter/o])}else d=o/n.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*c.wrap)*d,_=x.y*d;return Zd(w,w,[m,_,0]),tc(w,w,[d/Zt,d/Zt,1]),w}upVector(n,o,c){return[0,0,1]}upVectorScale(n,o,c){return{metersToTile:1}}}class WD extends Na{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,c]=this.parallels=n.parallels||[29.5,45.5],d=Math.sin(vt(o));this.n=(d+Math.sin(vt(c)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:c,c:d,r0:m}=this,_=vt(n-this.center[0]),x=vt(o),w=Math.sqrt(d-2*c*Math.sin(x))/c;return{x:w*Math.sin(_*c),y:w*Math.cos(_*c)-m,z:0}}unproject(n,o){const{n:c,c:d,r0:m}=this,_=m+o;let x=Math.atan2(n,Math.abs(_))*Math.sign(_);_*c<0&&(x-=Math.PI*Math.sign(n)*Math.sign(_));const w=vt(this.center[0])*c;x=li(x,-Math.PI-w,Math.PI-w);const E=Xe(Ft(x/c)+this.center[0],-180,180),S=Math.asin(Xe((d-(n*n+_*_)*c*c)/(2*c),-1,1)),M=Xe(Ft(S),-85.051129,ao);return new kn(E,M)}}const yf=1.340264,vf=-.081106,xf=893e-6,bf=.003796,kg=Math.sqrt(3)/2;class ZD extends Na{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const c=Math.asin(kg*Math.sin(o)),d=c*c,m=d*d*d;return{x:.5*(n*Math.cos(c)/(kg*(yf+3*vf*d+m*(7*xf+9*bf*d)))/Math.PI+.5),y:1-.5*(c*(yf+vf*d+m*(xf+bf*d))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,d=c*c,m=d*d*d;for(let S,M,D,O=0;O<12&&(M=c*(yf+vf*d+m*(xf+bf*d))-o,D=yf+3*vf*d+m*(7*xf+9*bf*d),S=M/D,c=Xe(c-S,-Math.PI/3,Math.PI/3),d=c*c,m=d*d*d,!(Math.abs(S)<1e-12));++O);const _=kg*n*(yf+3*vf*d+m*(7*xf+9*bf*d))/Math.cos(c),x=Math.asin(Math.sin(c)/kg),w=Xe(180*_/Math.PI,-180,180),E=Xe(180*x/Math.PI,-85.051129,ao);return new kn(w,E)}}class HD extends Na{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const c=360*(n-.5),d=Xe(360*(.5-o),-85.051129,ao);return new kn(c,d)}}const Ju=Math.PI/2;function Mg(s){return Math.tan((Ju+s)/2)}class XD extends Na{constructor(n){super(n),this.center=n.center||[0,30];const[o,c]=this.parallels=n.parallels||[30,30];let d=vt(o),m=vt(c);this.southernCenter=d+m<0,this.southernCenter&&(d=-d,m=-m);const _=Math.cos(d),x=Mg(d);this.n=d===m?Math.sin(d):Math.log(_/Math.cos(m))/Math.log(Mg(m)/x),this.f=_*Math.pow(Mg(d),this.n)/this.n}project(n,o){o=vt(o),this.southernCenter&&(o=-o),n=vt(n-this.center[0]);const c=1e-6,{n:d,f:m}=this;m>0?o<-Ju+c&&(o=-Ju+c):o>Ju-c&&(o=Ju-c);const _=m/Math.pow(Mg(o),d);let x=_*Math.sin(d*n),w=m-_*Math.cos(d*n);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:c,f:d}=this,m=d-o,_=Math.sign(m),x=Math.sign(c)*Math.sqrt(n*n+m*m);let w=Math.atan2(n,Math.abs(m))*_;m*c<0&&(w-=Math.PI*Math.sign(n)*_);const E=Xe(Ft(w/c)+this.center[0],-180,180),S=Xe(Ft(2*Math.atan(Math.pow(d/x,1/c))-Ju),-85.051129,ao);return new kn(E,this.southernCenter?-S:S)}}class sT extends Na{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:so(n),y:oo(o),z:0}}unproject(n,o){const c=ss(n),d=er(o);return new kn(c,d)}}const oT=vt(ao);class KD extends Na{project(n,o){const c=(o=vt(o))*o,d=c*c;return{x:.5*((n=vt(n))*(.8707-.131979*c+d*(d*(.003971*c-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+c*(.015085+d*(.028874*c-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,d=25,m=0,_=c*c;do{_=c*c;const E=_*_;m=(c*(1.007226+_*(.015085+E*(.028874*_-.044475-.005916*E)))-o)/(1.007226+_*(.045255+E*(.259866*_-.311325-.005916*11*E))),c=Xe(c-m,-oT,oT)}while(Math.abs(m)>1e-6&&--d>0);_=c*c;const x=Xe(Ft(n/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),w=Ft(c);return new kn(x,w)}}const aT=vt(ao);class YD extends Na{project(n,o){o=vt(o),n=vt(n);const c=Math.cos(o),d=2/Math.PI,m=Math.acos(c*Math.cos(n/2)),_=Math.sin(m)/m,x=.5*(n*d+2*c*Math.sin(n/2)/_)||0,w=.5*(o+Math.sin(o)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(n,o){let c=n=(2*n-.5)*Math.PI,d=o=(2*(1-o)-1)*Math.PI,m=25;const _=1e-6;let x=0,w=0;do{const E=Math.cos(d),S=Math.sin(d),M=2*S*E,D=S*S,O=E*E,B=Math.cos(c/2),U=Math.sin(c/2),$=2*B*U,ne=U*U,ue=1-O*B*B,te=ue?1/ue:0,oe=ue?Math.acos(E*B)*Math.sqrt(1/ue):0,fe=.5*(2*oe*E*U+2*c/Math.PI)-n,ae=.5*(oe*S+d)-o,Se=.5*te*(O*ne+oe*E*B*D)+1/Math.PI,Ee=te*($*M/4-oe*S*U),Le=.125*te*(M*U-oe*S*O*$),We=.5*te*(D*B+oe*ne*E)+.5,Ce=Ee*Le-We*Se;x=(ae*Ee-fe*We)/Ce,w=(fe*Le-ae*Se)/Ce,c=Xe(c-x,-Math.PI,Math.PI),d=Xe(d-w,-aT,aT)}while((Math.abs(x)>_||Math.abs(w)>_)&&--m>0);return new kn(Ft(c),Ft(d))}}class lT extends Na{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(vt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:c,cosPhi:d}=this;return{x:vt(n)*d*c+.5,y:-Math.sin(vt(o))/d*c+.5,z:0}}unproject(n,o){const{scale:c,cosPhi:d}=this,m=-(o-.5)/c,_=Xe(Ft((n-.5)/c)/d,-180,180),x=Math.asin(Xe(m*d,-1,1)),w=Xe(Ft(x),-85.051129,ao);return new kn(_,w)}}class QD extends sT{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(n,o,c){const d=gf(n,o,c);return Ii(d,d,_f(uo(c))),{x:d[0],y:d[1],z:d[2]}}locationPoint(n,o){const c=mf(o.lat,o.lng),d=Sr([],c),m=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude;Yd(c,c,d,ws(1,0)*Zt*m);const _=lo(new Float64Array(16));return Fu(_,n.pixelMatrix,n.globeMatrix),Ii(c,c,_),new ge(c[0],c[1])}pixelsPerMeter(n,o){return ws(1,0)*o}pixelSpaceConversion(n,o,c){const d=ws(1,n)*o,m=En(ws(1,45)*o,d,c);return this.pixelsPerMeter(n,o)/m}createTileMatrix(n,o,c){const d=Ov(uo(c.canonical));return Fu(new Float64Array(16),n.globeMatrix,d)}createInversionMatrix(n,o){const{center:c}=n,d=_f(uo(o));return cg(d,d,vt(c.lng)),av(d,d,vt(c.lat)),tc(d,d,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(n,o,c,d){return Yw(n,o,c,!0)||new Ou(0,0)}pointCoordinate3D(n,o,c){const d=this.pointCoordinate(n,o,c,0);return[d.x,d.y,d.z]}isPointAboveHorizon(n,o){return!Yw(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=function(d,m){const _=d.cameraToCenterDistance,x=d._centerAltitude*m,w=d._camera,E=d._camera.forward(),S=Uo([],os([],E,-_),[0,0,x]),M=d.worldSize/(2*Math.PI),D=[0,0,-M],O=d.width/d.height,B=Math.tan(d.fovAboveCenter),U=os([],w.up(),B),$=os([],w.right(),B*O),ne=Sr([],Uo([],Uo([],E,U),$)),ue=[];let te;if(new hv(S,ne).closestPointOnSphere(D,M,ue)){const oe=Uo([],ue,D),fe=Fs([],oe,S);te=Math.cos(d.fovAboveCenter)*Hd(fe)}else{const oe=Fs([],S,D),fe=Fs([],D,S);Sr(fe,fe);const ae=Hd(oe)-M;te=Math.sqrt(ae*(ae+2*M));const Se=Math.acos(te/(M+ae))-Math.acos(Ts(E,fe));te*=Math.cos(Se)}return 1.01*te}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),c=Qu(n.zoom);if(c>0){const d=rT(n,ws(1,n.center.lat)*n.worldSize),m=n.worldSize/(2*Math.PI),_=Math.max(n.width,n.height)/n.worldSize*Math.PI;return En(o,d+m*(1-Math.cos(_)),Math.pow(c,10))}return o}upVector(n,o,c){return gf(o,c,n,1)}upVectorScale(n){return{metersToTile:Rv*Cg(uo(n))}}}function cT(s){const n=s.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(s.name){case"mercator":return new sT(s);case"equirectangular":return new HD(s);case"naturalEarth":return new KD(s);case"equalEarth":return new ZD(s);case"winkelTripel":return new YD(s);case"albers":return o?new lT(s):new WD(s);case"lambertConformalConic":return o?new lT(s):new XD(s);case"globe":return new QD(s)}throw new Error(`Invalid projection name: ${s.name}`)}const JD=gg.types,eP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Dg(s,n,o,c,d,m,_,x,w,E,S,M,D){const O=x?Math.min(Fa,Math.round(x[0])):0,B=x?Math.min(Fa,Math.round(x[1])):0;s.emplaceBack(n,o,Math.round(32*c),Math.round(32*d),m,_,(O<<1)+(w?1:0),B,16*E,16*S,256*M,256*D)}function Pg(s,n,o,c,d,m,_){s.emplaceBack(n,o,c,d,m,_)}function Rg(s,n,o,c,d){s.emplaceBack(n,o,c,d),s.emplaceBack(n,o,c,d),s.emplaceBack(n,o,c,d),s.emplaceBack(n,o,c,d)}function tP(s){for(const n of s.sections)if(P(n.text))return!0;return!1}class Bv{constructor(n){this.layoutVertexArray=new oi,this.indexArray=new hr,this.programConfigurations=n,this.segments=new Ei,this.dynamicLayoutVertexArray=new Mi,this.opacityVertexArray=new _i,this.placedSymbolArray=new sb,this.globeExtVertexArray=new Mn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,o,c,d){this.isEmpty()||(c&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,iD.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,sD.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,eP,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,rD.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}xt(Bv,"SymbolBuffers");class Fv{constructor(n,o,c){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new c,this.segments=new Ei,this.collisionVertexArray=new Oo,this.collisionVertexArrayExt=new is}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,oD.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,aD.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}xt(Fv,"CollisionBuffers");class Ua{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(_=>_.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=lo([]),this.placementViewportMatrix=lo([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tv(this.zoom,o["text-size"]),this.iconSizeData=Tv(this.zoom,o["icon-size"]);const c=this.layers[0].layout,d=c.get("symbol-sort-key"),m=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>as[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=n.sourceID,this.projection=n.projection}createArrays(){this.text=new Bv(new Ql(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Bv(new Ql(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new lb,this.lineVertexArray=new cb,this.symbolInstances=new ab}calculateGlyphDependencies(n,o,c,d,m){for(let _=0;_<n.length;_++)if(o[n.charCodeAt(_)]=!0,d&&m){const x=uf[n.charAt(_)];x&&(o[x.charCodeAt(0)]=!0)}}populate(n,o,c,d){const m=this.layers[0],_=m.layout,x=this.projection.name==="globe",w=_.get("text-font"),E=_.get("text-field"),S=_.get("icon-image"),M=(E.value.kind!=="constant"||E.value.value instanceof cr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),D=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,O=_.get("symbol-sort-key");if(this.features=[],!M&&!D)return;const B=o.iconDependencies,U=o.glyphDependencies,$=o.availableImages,ne=new ie(this.zoom);for(const{feature:ue,id:te,index:oe,sourceLayerIndex:fe}of n){const ae=m._featureFilter.needGeometry,Se=Jl(ue,ae);if(!m._featureFilter.filter(ne,Se,c))continue;if(ae||(Se.geometry=No(ue,c,d)),x&&ue.type!==1&&c.z<=5){const Ce=Se.geometry,Oe=.98078528056,Ne=(je,Ze)=>Ts(gf(je.x,je.y,c,1),gf(Ze.x,Ze.y,c,1))<Oe;for(let je=0;je<Ce.length;je++)Ce[je]=tM(Ce[je],Ne)}let Ee,Le;if(M){const Ce=m.getValueAndResolveTokens("text-field",Se,c,$),Oe=cr.factory(Ce);tP(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||H()==="unavailable"||this.hasRTLText&&ce.isParsed())&&(Ee=uD(Oe,m,Se))}if(D){const Ce=m.getValueAndResolveTokens("icon-image",Se,c,$);Le=Ce instanceof Er?Ce:Er.fromString(Ce)}if(!Ee&&!Le)continue;const We=this.sortFeaturesByKey?O.evaluate(Se,{},c):void 0;if(this.features.push({id:te,text:Ee,icon:Le,index:oe,sourceLayerIndex:fe,geometry:Se.geometry,properties:ue.properties,type:JD[ue.type],sortKey:We}),Le&&(B[Le.name]=!0),Ee){const Ce=w.evaluate(Se,{},c).join(","),Oe=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(as.vertical)>=0;for(const Ne of Ee.sections)if(Ne.image)B[Ne.image.name]=!0;else{const je=h(Ee.toString()),Ze=Ne.fontStack||Ce,ke=U[Ze]=U[Ze]||{};this.calculateGlyphDependencies(Ne.text,ke,Oe,this.allowVerticalPlacement,je)}}}_.get("symbol-placement")==="line"&&(this.features=function(ue){const te={},oe={},fe=[];let ae=0;function Se(Ce){fe.push(ue[Ce]),ae++}function Ee(Ce,Oe,Ne){const je=oe[Ce];return delete oe[Ce],oe[Oe]=je,fe[je].geometry[0].pop(),fe[je].geometry[0]=fe[je].geometry[0].concat(Ne[0]),je}function Le(Ce,Oe,Ne){const je=te[Oe];return delete te[Oe],te[Ce]=je,fe[je].geometry[0].shift(),fe[je].geometry[0]=Ne[0].concat(fe[je].geometry[0]),je}function We(Ce,Oe,Ne){const je=Ne?Oe[0][Oe[0].length-1]:Oe[0][0];return`${Ce}:${je.x}:${je.y}`}for(let Ce=0;Ce<ue.length;Ce++){const Oe=ue[Ce],Ne=Oe.geometry,je=Oe.text?Oe.text.toString():null;if(!je){Se(Ce);continue}const Ze=We(je,Ne),ke=We(je,Ne,!0);if(Ze in oe&&ke in te&&oe[Ze]!==te[ke]){const at=Le(Ze,ke,Ne),Bt=Ee(Ze,ke,fe[at].geometry);delete te[Ze],delete oe[ke],oe[We(je,fe[Bt].geometry,!0)]=Bt,fe[at].geometry=null}else Ze in oe?Ee(Ze,ke,Ne):ke in te?Le(Ze,ke,Ne):(Se(Ce),te[Ze]=ae-1,oe[ke]=ae-1)}return fe.filter(Ce=>Ce.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ue,te)=>ue.sortKey-te.sortKey)}update(n,o,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,o,this.layers,c,d),this.icon.programConfigurations.updatePaintArrays(n,o,this.layers,c,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=cT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const c=this.lineVertexArray.length,d=n.segment;if(d!==void 0){let m=n.dist(o[d+1]),_=n.dist(o[d]);const x={};for(let w=d+1;w<o.length;w++)x[w]={x:o[w].x,y:o[w].y,tileUnitDistanceFromAnchor:m},w<o.length-1&&(m+=o[w+1].dist(o[w]));for(let w=d||0;w>=0;w--)x[w]={x:o[w].x,y:o[w].y,tileUnitDistanceFromAnchor:_},w>0&&(_+=o[w-1].dist(o[w]));for(let w=0;w<o.length;w++){const E=x[w];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(n,o,c,d,m,_,x,w,E,S,M,D,O,B){const U=n.indexArray,$=n.layoutVertexArray,ne=n.globeExtVertexArray,ue=n.segments.prepareSegment(4*o.length,$,U,this.canOverlap?_.sortKey:void 0),te=this.glyphOffsetArray.length,oe=ue.vertexLength,fe=this.allowVerticalPlacement&&x===as.vertical?Math.PI/2:0,ae=_.text&&_.text.sections;for(let Ee=0;Ee<o.length;Ee++){const{tl:Le,tr:We,bl:Ce,br:Oe,tex:Ne,pixelOffsetTL:je,pixelOffsetBR:Ze,minFontScaleX:ke,minFontScaleY:at,glyphOffset:Bt,isSDF:ft,sectionIndex:St}=o[Ee],ut=ue.vertexLength,Vt=Bt[1];if(Dg($,E.x,E.y,Le.x,Vt+Le.y,Ne.x,Ne.y,c,ft,je.x,je.y,ke,at),Dg($,E.x,E.y,We.x,Vt+We.y,Ne.x+Ne.w,Ne.y,c,ft,Ze.x,je.y,ke,at),Dg($,E.x,E.y,Ce.x,Vt+Ce.y,Ne.x,Ne.y+Ne.h,c,ft,je.x,Ze.y,ke,at),Dg($,E.x,E.y,Oe.x,Vt+Oe.y,Ne.x+Ne.w,Ne.y+Ne.h,c,ft,Ze.x,Ze.y,ke,at),w){const Yt=w.anchor,Jt=w.up;Pg(ne,Yt.x,Yt.y,Yt.z,Jt[0],Jt[1],Jt[2]),Pg(ne,Yt.x,Yt.y,Yt.z,Jt[0],Jt[1],Jt[2]),Pg(ne,Yt.x,Yt.y,Yt.z,Jt[0],Jt[1],Jt[2]),Pg(ne,Yt.x,Yt.y,Yt.z,Jt[0],Jt[1],Jt[2]),Rg(n.dynamicLayoutVertexArray,Yt.x,Yt.y,Yt.z,fe)}else Rg(n.dynamicLayoutVertexArray,E.x,E.y,E.z,fe);U.emplaceBack(ut,ut+1,ut+2),U.emplaceBack(ut+1,ut+2,ut+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Bt[0]),Ee!==o.length-1&&St===o[Ee+1].sectionIndex||n.programConfigurations.populatePaintArrays($.length,_,_.index,{},O,B,ae&&ae[St])}const Se=w?w.anchor:E;n.placedSymbolArray.emplaceBack(Se.x,Se.y,Se.z,E.x,E.y,te,this.glyphOffsetArray.length-te,oe,S,M,E.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],x,0,!1,0,D,0)}_commitLayoutVertex(n,o,c,d,m,_,x){n.emplaceBack(o,c,d,m,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(n,o,c,d,m,_,x){const w=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),E=w.vertexLength,S=x.tileAnchorX,M=x.tileAnchorY;for(let O=0;O<4;O++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(o,-n.padding,-n.padding),c.collisionVertexArrayExt.emplaceBack(o,n.padding,-n.padding),c.collisionVertexArrayExt.emplaceBack(o,n.padding,n.padding),c.collisionVertexArrayExt.emplaceBack(o,-n.padding,n.padding),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,S,M,new ge(n.x1,n.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,S,M,new ge(n.x2,n.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,S,M,new ge(n.x2,n.y2)),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,S,M,new ge(n.x1,n.y2)),w.vertexLength+=4;const D=c.indexArray;D.emplaceBack(E,E+1),D.emplaceBack(E+1,E+2),D.emplaceBack(E+2,E+3),D.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,c,d,m,_){for(let x=d;x<m;x++){const w=c.get(x),E=this.getSymbolInstanceTextSize(n,_,o,x);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(n,o,c,d,m,_){for(let x=d;x<m;x++){const w=c.get(x),E=this.getSymbolInstanceIconSize(n,o,_.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}generateCollisionDebugBuffers(n,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fv(qn,ww.members,rs),this.iconCollisionBox=new Fv(qn,ww.members,rs);const c=Gu(this.iconSizeData,n),d=Gu(this.textSizeData,n);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(d,n,o,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(d,n,o,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,n,o,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,n,o,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(n,o,c,d){const m=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:d),_=xg(this.textSizeData,n,m)/tr;return this.tilePixelRatio*_}getSymbolInstanceIconSize(n,o,c){const d=this.icon.placedSymbolArray.get(c),m=xg(this.iconSizeData,n,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(n,o,c){n.emplaceBack(o,-c,-c),n.emplaceBack(o,c,-c),n.emplaceBack(o,c,c),n.emplaceBack(o,-c,c)}_updateTextDebugCollisionBoxes(n,o,c,d,m,_){for(let x=d;x<m;x++){const w=c.get(x),E=this.getSymbolInstanceTextSize(n,_,o,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(n,o,c,d,m,_){for(let x=d;x<m;x++){const w=c.get(x),E=this.getSymbolInstanceIconSize(n,o,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(n,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Gu(this.iconSizeData,n),d=Gu(this.textSizeData,n);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(d,n,o,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(d,n,o,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(c,n,o,_.iconBoxStartIndex,_.iconBoxEndIndex,_.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,n,o,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,c,d,m,_,x,w,E){const S={};for(let M=o;M<c;M++){const D=n.get(M);S.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},S.textFeatureIndex=D.featureIndex;break}for(let M=d;M<m;M++){const D=n.get(M);S.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},S.verticalTextFeatureIndex=D.featureIndex;break}for(let M=_;M<x;M++){const D=n.get(M);S.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},S.iconFeatureIndex=D.featureIndex;break}for(let M=w;M<E;M++){const D=n.get(M);S.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},S.verticalIconFeatureIndex=D.featureIndex;break}return S}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,o){const c=n.placedSymbolArray.get(o),d=c.vertexStartIndex+4*c.numGlyphs;for(let m=c.vertexStartIndex;m<d;m+=4)n.indexArray.emplaceBack(m,m+1,m+2),n.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),c=Math.cos(n),d=[],m=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const w=this.symbolInstances.get(x);d.push(0|Math.round(o*w.tileAnchorX+c*w.tileAnchorY)),m.push(w.featureIndex)}return _.sort((x,w)=>d[x]-d[w]||m[w]-m[x]),_}addToSortKeyRanges(n,o){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===o?c.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const c=this.symbolInstances.get(o);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((d,m,_)=>{d>=0&&_.indexOf(d)===m&&this.addIndicesForPlacedSymbol(this.text,d)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}xt(Ua,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ua.MAX_GLYPHS=65535,Ua.addDynamicAttributes=Rg;const nP=new Qe({"symbol-placement":new we(De.layout_symbol["symbol-placement"]),"symbol-spacing":new we(De.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new we(De.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new me(De.layout_symbol["symbol-sort-key"]),"symbol-z-order":new we(De.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new we(De.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new we(De.layout_symbol["icon-ignore-placement"]),"icon-optional":new we(De.layout_symbol["icon-optional"]),"icon-rotation-alignment":new we(De.layout_symbol["icon-rotation-alignment"]),"icon-size":new me(De.layout_symbol["icon-size"]),"icon-text-fit":new we(De.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new we(De.layout_symbol["icon-text-fit-padding"]),"icon-image":new me(De.layout_symbol["icon-image"]),"icon-rotate":new me(De.layout_symbol["icon-rotate"]),"icon-padding":new we(De.layout_symbol["icon-padding"]),"icon-keep-upright":new we(De.layout_symbol["icon-keep-upright"]),"icon-offset":new me(De.layout_symbol["icon-offset"]),"icon-anchor":new me(De.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new we(De.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new we(De.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new we(De.layout_symbol["text-rotation-alignment"]),"text-field":new me(De.layout_symbol["text-field"]),"text-font":new me(De.layout_symbol["text-font"]),"text-size":new me(De.layout_symbol["text-size"]),"text-max-width":new me(De.layout_symbol["text-max-width"]),"text-line-height":new me(De.layout_symbol["text-line-height"]),"text-letter-spacing":new me(De.layout_symbol["text-letter-spacing"]),"text-justify":new me(De.layout_symbol["text-justify"]),"text-radial-offset":new me(De.layout_symbol["text-radial-offset"]),"text-variable-anchor":new we(De.layout_symbol["text-variable-anchor"]),"text-anchor":new me(De.layout_symbol["text-anchor"]),"text-max-angle":new we(De.layout_symbol["text-max-angle"]),"text-writing-mode":new we(De.layout_symbol["text-writing-mode"]),"text-rotate":new me(De.layout_symbol["text-rotate"]),"text-padding":new we(De.layout_symbol["text-padding"]),"text-keep-upright":new we(De.layout_symbol["text-keep-upright"]),"text-transform":new me(De.layout_symbol["text-transform"]),"text-offset":new me(De.layout_symbol["text-offset"]),"text-allow-overlap":new we(De.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new we(De.layout_symbol["text-ignore-placement"]),"text-optional":new we(De.layout_symbol["text-optional"])});var Nv={paint:new Qe({"icon-opacity":new me(De.paint_symbol["icon-opacity"]),"icon-color":new me(De.paint_symbol["icon-color"]),"icon-halo-color":new me(De.paint_symbol["icon-halo-color"]),"icon-halo-width":new me(De.paint_symbol["icon-halo-width"]),"icon-halo-blur":new me(De.paint_symbol["icon-halo-blur"]),"icon-translate":new we(De.paint_symbol["icon-translate"]),"icon-translate-anchor":new we(De.paint_symbol["icon-translate-anchor"]),"text-opacity":new me(De.paint_symbol["text-opacity"]),"text-color":new me(De.paint_symbol["text-color"],{runtimeType:fs,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new me(De.paint_symbol["text-halo-color"]),"text-halo-width":new me(De.paint_symbol["text-halo-width"]),"text-halo-blur":new me(De.paint_symbol["text-halo-blur"]),"text-translate":new we(De.paint_symbol["text-translate"]),"text-translate-anchor":new we(De.paint_symbol["text-translate-anchor"])}),layout:nP};class uT{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:wa,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xt(uT,"FormatSectionOverride",{omit:["defaultValue"]});class Lg extends Bs{constructor(n){super(n,Nv)}recalculate(n,o){super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const d=[];for(const m of c)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(n,o,c,d){const m=this.layout.get(n).evaluate(o,{},c,d),_=this._unevaluatedLayout._values[n];return _.isDataDriven()||Vl(_.value)||!m?m:function(x,w){return w.replace(/{([^{}]+)}/g,(E,S)=>S in x?String(x[S]):"")}(o.properties,m)}createBucket(n){return new Ua(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of Nv.paint.overridableProperties){if(!Lg.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),c=new uT(o),d=new Ul(c,o.property.specification);let m=null;m=o.value.kind==="constant"||o.value.kind==="source"?new yu("source",d):new vu("composite",d,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new Fe(o.property,m,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,c){return!(!this.layout||o.isDataDriven()||c.isDataDriven())&&Lg.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const c=n.get("text-field"),d=Nv.paint.properties[o];let m=!1;const _=x=>{for(const w of x)if(d.overrides&&d.overrides.hasOverride(w))return void(m=!0)};if(c.value.kind==="constant"&&c.value.value instanceof cr)_(c.value.value.sections);else if(c.value.kind==="source"){const x=E=>{m||(E instanceof Ll&&Ti(E.value)===Ea?_(E.value.sections):E instanceof Js?_(E.sections):E.eachChild(x))},w=c.value;w._styleExpression&&x(w._styleExpression.expression)}return m}getProgramConfiguration(n){return new Oa(this,n)}}var iP={paint:new Qe({"background-color":new we(De.paint_background["background-color"]),"background-pattern":new Ye(De.paint_background["background-pattern"]),"background-opacity":new we(De.paint_background["background-opacity"])})},rP={paint:new Qe({"raster-opacity":new we(De.paint_raster["raster-opacity"]),"raster-hue-rotate":new we(De.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new we(De.paint_raster["raster-brightness-min"]),"raster-brightness-max":new we(De.paint_raster["raster-brightness-max"]),"raster-saturation":new we(De.paint_raster["raster-saturation"]),"raster-contrast":new we(De.paint_raster["raster-contrast"]),"raster-resampling":new we(De.paint_raster["raster-resampling"]),"raster-fade-duration":new we(De.paint_raster["raster-fade-duration"])})};class sP extends Bs{constructor(n){super(n,{}),this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}var oP={paint:new Qe({"sky-type":new we(De.paint_sky["sky-type"]),"sky-atmosphere-sun":new we(De.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new we(De.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new we(De.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new we(De.paint_sky["sky-gradient-radius"]),"sky-gradient":new rt(De.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new we(De.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new we(De.paint_sky["sky-atmosphere-color"]),"sky-opacity":new we(De.paint_sky["sky-opacity"])})};function Uv(s,n,o){const c=[0,0,1],d=qb([]);return Zb(d,d,o?-vt(s)+Math.PI:vt(s)),Wb(d,d,-vt(n)),Vb(c,c,d),Sr(c,c)}const aP={circle:class extends Bs{constructor(s){super(s,lM)}createBucket(s){return new iv(s)}queryRadius(s){const n=s;return Bu("circle-radius",this,n)+Bu("circle-stroke-width",this,n)+ag(this.paint.get("circle-translate"))}queryIntersectsFeature(s,n,o,c,d,m,_,x){const w=Lb(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return Hb(s,c,m,_,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Oa(this,s)}},heatmap:class extends Bs{createBucket(s){return new Kb(s)}constructor(s){super(s,gM),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Bu("heatmap-radius",this,s)}queryIntersectsFeature(s,n,o,c,d,m,_,x){const w=this.paint.get("heatmap-radius").evaluate(n,o);return Hb(s,c,m,_,x,!0,!0,new ge(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Oa(this,s)}},hillshade:class extends Bs{constructor(s){super(s,_M)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Bs{constructor(s){super(s,RM)}getProgramIds(){const s=this.paint.get("fill-pattern"),n=s&&s.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getProgramConfiguration(s){return new Oa(this,s)}recalculate(s,n){super.recalculate(s,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new pg(s)}queryRadius(){return ag(this.paint.get("fill-translate"))}queryIntersectsFeature(s,n,o,c,d,m){return!s.queryGeometry.isAboveHorizon&&kb(Rb(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Bs{constructor(s){super(s,XM)}createBucket(s){return new af(s)}queryRadius(){return ag(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Oa(this,s)}queryIntersectsFeature(s,n,o,c,d,m,_,x,w){const E=Lb(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(n,o),M=this.paint.get("fill-extrusion-base").evaluate(n,o),D=[0,0],O=x&&m.elevation,B=m.elevation?m.elevation.exaggeration():1,U=s.tile.getBucket(this);if(O&&U instanceof af){const oe=U.centroidVertexArray,fe=w+1;if(fe<oe.length){const ae=oe.get(fe);D[0]=ae.a_centroid_pos0,D[1]=ae.a_centroid_pos1}}if(D[0]===0&&D[1]===1)return!1;m.projection.name==="globe"&&(c=pw([c],[new ge(0,0),new ge(Zt,Zt)],s.tileID.canonical).map(oe=>oe.polygon).flat());const $=O?x:null,[ne,ue]=function(oe,fe,ae,Se,Ee,Le,We,Ce,Oe,Ne,je){return oe.projection.name==="globe"?function(Ze,ke,at,Bt,ft,St,ut,Vt,Yt,Jt,wn){const Kt=[],Jn=[],nn=Ze.projection.upVectorScale(wn,Ze.center.lat,Ze.worldSize).metersToTile,fn=[0,0,0,1],Vn=[0,0,0,1],Kn=(Yn,ei,ci,ji)=>{Yn[0]=ei,Yn[1]=ci,Yn[2]=ji,Yn[3]=1},Zn=fw();at>0&&(at+=Zn),Bt+=Zn;for(const Yn of ke){const ei=[],ci=[];for(const ji of Yn){const Ln=ji.x+ft.x,Si=ji.y+ft.y,vi=Ze.projection.projectTilePoint(Ln,Si,wn),In=Ze.projection.upVector(wn,ji.x,ji.y);let ai=at,Di=Bt;if(ut){const jn=yw(Ln,Si,at,Bt,ut,Vt,Yt,Jt);ai+=jn.base,Di+=jn.top}at!==0?Kn(fn,vi.x+In[0]*nn*ai,vi.y+In[1]*nn*ai,vi.z+In[2]*nn*ai):Kn(fn,vi.x,vi.y,vi.z),Kn(Vn,vi.x+In[0]*nn*Di,vi.y+In[1]*nn*Di,vi.z+In[2]*nn*Di),Ii(fn,fn,St),Ii(Vn,Vn,St),ei.push(new ju(fn[0],fn[1],fn[2])),ci.push(new ju(Vn[0],Vn[1],Vn[2]))}Kt.push(ei),Jn.push(ci)}return[Kt,Jn]}(oe,fe,ae,Se,Ee,Le,We,Ce,Oe,Ne,je):We?function(Ze,ke,at,Bt,ft,St,ut,Vt,Yt){const Jt=[],wn=[],Kt=[0,0,0,1];for(const Jn of Ze){const nn=[],fn=[];for(const Vn of Jn){const Kn=Vn.x+Bt.x,Zn=Vn.y+Bt.y,Yn=yw(Kn,Zn,ke,at,St,ut,Vt,Yt);Kt[0]=Kn,Kt[1]=Zn,Kt[2]=Yn.base,Kt[3]=1,nc(Kt,Kt,ft),Kt[3]=Math.max(Kt[3],1e-5);const ei=new ju(Kt[0]/Kt[3],Kt[1]/Kt[3],Kt[2]/Kt[3]);Kt[0]=Kn,Kt[1]=Zn,Kt[2]=Yn.top,Kt[3]=1,nc(Kt,Kt,ft),Kt[3]=Math.max(Kt[3],1e-5);const ci=new ju(Kt[0]/Kt[3],Kt[1]/Kt[3],Kt[2]/Kt[3]);nn.push(ei),fn.push(ci)}Jt.push(nn),wn.push(fn)}return[Jt,wn]}(fe,ae,Se,Ee,Le,We,Ce,Oe,Ne):function(Ze,ke,at,Bt,ft){const St=[],ut=[],Vt=ft[8]*ke,Yt=ft[9]*ke,Jt=ft[10]*ke,wn=ft[11]*ke,Kt=ft[8]*at,Jn=ft[9]*at,nn=ft[10]*at,fn=ft[11]*at;for(const Vn of Ze){const Kn=[],Zn=[];for(const Yn of Vn){const ei=Yn.x+Bt.x,ci=Yn.y+Bt.y,ji=ft[0]*ei+ft[4]*ci+ft[12],Ln=ft[1]*ei+ft[5]*ci+ft[13],Si=ft[2]*ei+ft[6]*ci+ft[14],vi=ft[3]*ei+ft[7]*ci+ft[15],In=ji+Vt,ai=Ln+Yt,Di=Si+Jt,jn=Math.max(vi+wn,1e-5),fi=ji+Kt,dr=Ln+Jn,Gi=Si+nn,$i=Math.max(vi+fn,1e-5);Kn.push(new ju(In/jn,ai/jn,Di/jn)),Zn.push(new ju(fi/$i,dr/$i,Gi/$i))}St.push(Kn),ut.push(Zn)}return[St,ut]}(fe,ae,Se,Ee,Le)}(m,c,M,S,E,_,$,D,B,m.center.lat,s.tileID.canonical),te=s.queryGeometry;return function(oe,fe,ae){let Se=1/0;kb(ae,fe)&&(Se=_w(ae,fe[0]));for(let Ee=0;Ee<fe.length;Ee++){const Le=fe[Ee],We=oe[Ee];for(let Ce=0;Ce<Le.length-1;Ce++){const Oe=Le[Ce],Ne=[Oe,Le[Ce+1],We[Ce+1],We[Ce],Oe];Cb(ae,Ne)&&(Se=Math.min(Se,_w(ae,Ne)))}}return Se!==1/0&&Se}(ne,ue,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends Bs{constructor(s){super(s,vw),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Aa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,n){super.recalculate(s,n),this.paint._values["line-floorwidth"]=xw.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new vg(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Oa(this,s)}queryRadius(s){const n=s,o=bw(Bu("line-width",this,n),Bu("line-gap-width",this,n)),c=Bu("line-offset",this,n);return o/2+Math.abs(c)+ag(this.paint.get("line-translate"))}queryIntersectsFeature(s,n,o,c,d,m){if(s.queryGeometry.isAboveHorizon)return!1;const _=Rb(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),x=s.pixelToTileUnitsFactor/2*bw(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),w=this.paint.get("line-offset").evaluate(n,o);return w&&(c=function(E,S){const M=[],D=new ge(0,0);for(let O=0;O<E.length;O++){const B=E[O],U=[];for(let $=0;$<B.length;$++){const ne=B[$-1],ue=B[$],te=B[$+1],oe=$===0?D:ue.sub(ne)._unit()._perp(),fe=$===B.length-1?D:te.sub(ue)._unit()._perp(),ae=oe._add(fe)._unit();ae._mult(1/(ae.x*fe.x+ae.y*fe.y)),U.push(ae._mult(S)._add(ue))}M.push(U)}return M}(c,w*s.pixelToTileUnitsFactor)),function(E,S,M){for(let D=0;D<S.length;D++){const O=S[D];if(E.length>=3){for(let B=0;B<O.length;B++)if(ec(E,O[B]))return!0}if(rM(E,O,M))return!0}return!1}(_,c,x)}isTileClipped(){return!0}},symbol:Lg,background:class extends Bs{constructor(s){super(s,iP)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Bs{constructor(s){super(s,rP)}getProgramIds(){return["raster"]}},sky:class extends Bs{constructor(s){super(s,oP),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=mv({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(s,n){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),d=!c,m=s.style.light,_=m.properties.get("position");return d&&m.properties.get("anchor")==="viewport"&&xn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?Uv(_.azimuthal,90-_.polar,n):Uv(c[0],90-c[1],n)}const o=this.paint.get("sky-gradient-center");return Uv(o[0],90-o[1],n)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class wf{constructor(n,o,c,d){this.context=n,this.format=c,this.texture=n.gl.createTexture(),this.update(o,d)}update(n,o,c){const{width:d,height:m}=n,{context:_}=this,{gl:x}=_,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:S,ImageData:M,ImageBitmap:D}=T;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!o||o.premultiply!==!1)),c||this.size&&this.size[0]===d&&this.size[1]===m){const{x:O,y:B}=c||{x:0,y:0};n instanceof w||n instanceof E||n instanceof S||n instanceof M||D&&n instanceof D?x.texSubImage2D(x.TEXTURE_2D,0,O,B,x.RGBA,x.UNSIGNED_BYTE,n):x.texSubImage2D(x.TEXTURE_2D,0,O,B,d,m,x.RGBA,x.UNSIGNED_BYTE,n.data)}else this.size=[d,m],n instanceof w||n instanceof E||n instanceof S||n instanceof M||D&&n instanceof D?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,n):x.texImage2D(x.TEXTURE_2D,0,this.format,d,m,0,this.format,x.UNSIGNED_BYTE,n.data);this.useMipmap=Boolean(o&&o.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(n,o){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),n!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?n===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:n),this.filter=n),o!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,o),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class lP{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class cP{constructor(){this.tasks={},this.taskQueue=[],Nt(["process"],this),this.invoker=new lP(this.process),this.nextId=0}add(n,o){const c=this.nextId++,d=function({type:m,isSymbolTile:_,zoom:x}){return x=x||0,m==="message"?0:m!=="maybePrepare"||_?m!=="parseTile"||_?m==="parseTile"&&_?300-x:m==="maybePrepare"&&_?400-x:500:200-x:100-x}(o);if(d===0){br();try{n()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:n,metadata:o,priority:d,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){br();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let n=null,o=1/0;for(let d=0;d<this.taskQueue.length;d++){const m=this.tasks[this.taskQueue[d]];m.priority<o&&(o=m.priority,n=d)}if(n===null)return null;const c=this.taskQueue[n];return this.taskQueue.splice(n,1),c}remove(){this.invoker.remove()}}class hT{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const c=n[o];this._stringToNumber[c]=o,this._numberToString[o]=c}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const uP=["tile","layer","source","sourceLayer","state"];class dT{constructor(n,o,c,d,m){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=c,this._y=d,this.properties=n.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(n.id=this.id);for(const o of uP)this[o]!==void 0&&(n[o]=this[o]);return n}}const Es=32,ho=33,Va=new Uint16Array(8184);for(let s=0;s<2046;s++){let n=s+2,o=0,c=0,d=0,m=0,_=0,x=0;for(1&n?d=m=_=Es:o=c=x=Es;(n>>=1)>1;){const E=o+d>>1,S=c+m>>1;1&n?(d=o,m=c,o=_,c=x):(o=d,c=m,d=_,m=x),_=E,x=S}const w=4*s;Va[w+0]=o,Va[w+1]=c,Va[w+2]=d,Va[w+3]=m}const fo=new Uint16Array(2178),ja=new Uint8Array(1089),zg=new Uint16Array(1089);function fT(s){return s===0?-.03125:s===32?.03125:0}var pT=Je([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const mT={type:2,extent:Zt,loadGeometry:()=>[[new ge(0,0),new ge(8193,0),new ge(8193,8193),new ge(0,8193),new ge(0,0)]]};class Vv{constructor(n,o,c,d,m){this.tileID=n,this.uid=ri(),this.uses=0,this.tileSize=o,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(n){const o=n+this.timeAdded;o<Sn.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=sc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,o,c){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(d,m){const _={};if(!m)return _;for(const x of d){const w=x.layerIds.map(E=>m.getLayer(E)).filter(Boolean);if(w.length!==0){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>w.filter(S=>S.id===E)[0]));for(const E of w)_[E.id]=x}}return _}(n.buckets,o.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const m=this.buckets[d];if(m instanceof Ua){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const m=this.buckets[d];if(m instanceof Ua&&m.hasRTLText){this.hasRTLText=!0,ce.isLoading()||ce.isLoaded()||H()!=="deferred"||le();break}}this.queryPadding=0;for(const d in this.buckets){const m=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(d).queryRadius(m))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas)}else this.collisionBoxArray=new Ky}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.id]}upload(n){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(n)}const o=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wf(n,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wf(n,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new wf(n,this.lineAtlas.image,o.ALPHA),this.lineAtlas.uploaded=!0)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,o,c,d,m,_,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:x,transform:_,params:m,tileTransform:this.tileTransform},n,o,c):{}}querySourceFeatures(n,o){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),m=o?o.sourceLayer:"",_=d._geojsonTileLayer||d[m];if(!_)return;const x=bu(o&&o.filter),{z:w,x:E,y:S}=this.tileID.canonical,M={z:w,x:E,y:S};for(let D=0;D<_.length;D++){const O=_.feature(D);if(x.needGeometry){const $=Jl(O,!0);if(!x.filter(new ie(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!x.filter(new ie(this.tileID.overscaledZ),O))continue;const B=c.getId(O,m),U=new dT(O,w,E,S,B);U.tile=M,n.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const o=this.expirationTime;if(n.cacheControl){const c=$s(n.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(o)if(this.expirationTime<o)d=!0;else{const m=this.expirationTime-o;m?this.expirationTime=c+Math.max(m,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0||!o)return;const c=this.latestFeatureIndex.loadVTLayers(),d=o.style.listImages();for(const m in this.buckets){if(!o.style.hasLayer(m))continue;const _=this.buckets[m],x=_.layers[0].sourceLayer||"_geojsonTileLayer",w=c[x],E=n[x];if(!w||!E||Object.keys(E).length===0)continue;if(_.update(E,w,d,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof vg||_ instanceof pg){const M=o.style._getSourceCache(_.layers[0].source);o._terrain&&o._terrain.enabled&&M&&_.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(M.id,this.tileID)}const S=o&&o.style&&o.style.getLayer(m);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Sn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=Sn.now()+n}setTexture(n,o){const c=o.context,d=c.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture?this.texture.update(n,{useMipmap:!0}):(this.texture=new wf(c,n,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),c.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax))}setDependencies(n,o){const c={};for(const d of o)c[d]=!0;this.dependencies[n]=c}hasDependency(n,o){for(const c of n){const d=this.dependencies[c];if(d){for(const m of o)if(d[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const c=No(mT,this.tileID.canonical,this.tileTransform)[0],d=new tn,m=new qd;for(let _=0;_<c.length;_++){const{x,y:w}=c[_];d.emplaceBack(x,w),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(m),this._tileDebugBuffer=n.createVertexBuffer(d,pf.members),this._tileDebugSegments=Ei.simpleSegment(0,0,d.length,m.length)}_makeTileBoundsBuffers(n,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const c=No(mT,this.tileID.canonical,this.tileTransform)[0];let d,m;if(this.isRaster){const _=function(x,w){const E=sc(x,w),S=Math.pow(2,x.z);for(let $=0;$<ho;$++)for(let ne=0;ne<ho;ne++){const ue=ss((x.x+(ne+fT(ne))/Es)/S),te=er((x.y+($+fT($))/Es)/S),oe=w.project(ue,te),fe=$*ho+ne;fo[2*fe+0]=Math.round((oe.x*E.scale-E.x)*Zt),fo[2*fe+1]=Math.round((oe.y*E.scale-E.y)*Zt)}ja.fill(0),zg.fill(0);for(let $=2045;$>=0;$--){const ne=4*$,ue=Va[ne+0],te=Va[ne+1],oe=Va[ne+2],fe=Va[ne+3],ae=ue+oe>>1,Se=te+fe>>1,Ee=ae+Se-te,Le=Se+ue-ae,We=te*ho+ue,Ce=fe*ho+oe,Oe=Se*ho+ae,Ne=Math.hypot((fo[2*We+0]+fo[2*Ce+0])/2-fo[2*Oe+0],(fo[2*We+1]+fo[2*Ce+1])/2-fo[2*Oe+1])>=16;if(ja[Oe]=ja[Oe]||(Ne?1:0),$<1022){const je=(te+Le>>1)*ho+(ue+Ee>>1),Ze=(fe+Le>>1)*ho+(oe+Ee>>1);ja[Oe]=ja[Oe]||ja[je]||ja[Ze]}}const M=new Un,D=new hr;let O=0;function B($,ne){const ue=ne*ho+$;return zg[ue]===0&&(M.emplaceBack(fo[2*ue+0],fo[2*ue+1],$*Zt/Es,ne*Zt/Es),zg[ue]=++O),zg[ue]-1}function U($,ne,ue,te,oe,fe){const ae=$+ue>>1,Se=ne+te>>1;if(Math.abs($-oe)+Math.abs(ne-fe)>1&&ja[Se*ho+ae])U(oe,fe,$,ne,ae,Se),U(ue,te,oe,fe,ae,Se);else{const Ee=B($,ne),Le=B(ue,te),We=B(oe,fe);D.emplaceBack(Ee,Le,We)}}return U(0,0,Es,Es,Es,0),U(Es,Es,0,0,0,Es),{vertices:M,indices:D}}(this.tileID.canonical,o);d=_.vertices,m=_.indices}else{d=new Un,m=new hr;for(const{x,y:w}of c)d.emplaceBack(x,w,0,0);const _=Jd.exports(d.int16,void 0,4);for(let x=0;x<_.length;x+=3)m.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=n.createVertexBuffer(d,pT.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(m),this._tileBoundsSegments=Ei.simpleSegment(0,0,d.length,m.length)}_makeGlobeTileDebugBuffers(n,o){const c=o.projection;if(!c||c.name!=="globe"||o.freezeTileCoverage)return;const d=this.tileID.canonical,m=_f(Qw(d,o)),_=Qu(o.zoom);let x;_>0&&(x=ov(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,d,o,m,x,_),this._makeGlobeTileDebugTextBuffer(n,d,o,m,x,_)}_globePoint(n,o,c,d,m,_,x){let w=gf(n,o,c);if(_){const E=1<<c.z,S=so(d.center.lng),M=oo(d.center.lat),D=(c.x+.5)/E-S;let O=0;D>.5?O=-1:D<-.5&&(O=1);let B=(n/Zt+c.x)/E+O,U=(o/Zt+c.y)/E;B=(B-S)*d._pixelsPerMercatorPixel+S,U=(U-M)*d._pixelsPerMercatorPixel+M;const $=[B*d.worldSize,U*d.worldSize,0];Ii($,$,_),w=rc(w,$,x)}return Ii(w,w,m)}_makeGlobeTileDebugBorderBuffer(n,o,c,d,m,_){const x=new tn,w=new qd,E=new Nn,S=(D,O,B,U,$)=>{const ne=(B-D)/($-1),ue=(U-O)/($-1),te=x.length;for(let oe=0;oe<$;oe++){const fe=D+oe*ne,ae=O+oe*ue;x.emplaceBack(fe,ae);const Se=this._globePoint(fe,ae,o,c,d,m,_);E.emplaceBack(Se[0],Se[1],Se[2]),w.emplaceBack(te+oe)}},M=Zt;S(0,0,M,0,16),S(M,0,M,M,16),S(M,M,0,M,16),S(0,M,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(w),this._tileDebugBuffer=n.createVertexBuffer(x,pf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(E,Kw.members),this._tileDebugSegments=Ei.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugTextBuffer(n,o,c,d,m,_){const x=new tn,w=new hr,E=new Nn,S=25;w.reserve(32),x.reserve(S),E.reserve(S);const M=(D,O)=>S*D+O;for(let D=0;D<S;D++){const O=2048*D;for(let B=0;B<S;B++){const U=2048*B;x.emplaceBack(U,O);const $=this._globePoint(U,O,o,c,d,m,_);E.emplaceBack($[0],$[1],$[2])}}for(let D=0;D<4;D++)for(let O=0;O<4;O++){const B=M(D,O),U=M(D,O+1),$=M(D+1,O),ne=M(D+1,O+1);w.emplaceBack(B,U,$),w.emplaceBack($,U,ne)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(w),this._tileDebugTextBuffer=n.createVertexBuffer(x,pf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(E,Kw.members),this._tileDebugTextSegments=Ei.simpleSegment(0,0,S,32)}}class hP{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,o,c){const d=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][d]=this.stateChanges[n][d]||{},rn(this.stateChanges[n][d],c),this.deletedStates[n]===null){this.deletedStates[n]={};for(const m in this.state[n])m!==d&&(this.deletedStates[n][m]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][d]===null){this.deletedStates[n][d]={};for(const m in this.state[n][d])c[m]||(this.deletedStates[n][d][m]=null)}else for(const m in c)this.deletedStates[n]&&this.deletedStates[n][d]&&this.deletedStates[n][d][m]===null&&delete this.deletedStates[n][d][m]}removeFeatureState(n,o,c){if(this.deletedStates[n]===null)return;const d=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},c&&o!==void 0)this.deletedStates[n][d]!==null&&(this.deletedStates[n][d]=this.deletedStates[n][d]||{},this.deletedStates[n][d][c]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][d])for(c in this.deletedStates[n][d]={},this.stateChanges[n][d])this.deletedStates[n][d][c]=null;else this.deletedStates[n][d]=null;else this.deletedStates[n]=null}getState(n,o){const c=String(o),d=rn({},(this.state[n]||{})[c],(this.stateChanges[n]||{})[c]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const m=this.deletedStates[n][o];if(m===null)return{};for(const _ in m)delete d[_]}return d}initializeTileState(n,o){n.setFeatureState(this.state,o)}coalesceChanges(n,o){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const m={};for(const _ in this.stateChanges[d])this.state[d][_]||(this.state[d][_]={}),rn(this.state[d][_],this.stateChanges[d][_]),m[_]=this.state[d][_];c[d]=m}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const m={};if(this.deletedStates[d]===null)for(const _ in this.state[d])m[_]={},this.state[d][_]={};else for(const _ in this.deletedStates[d]){if(this.deletedStates[d][_]===null)this.state[d][_]={};else for(const x of Object.keys(this.deletedStates[d][_]))delete this.state[d][_][x];m[_]=this.state[d][_]}c[d]=c[d]||{},rn(c[d],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const d in n)n[d].setFeatureState(c,o)}}class gT{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const c=this.toIdx(n,o);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function _T(s,n,o,c){let d=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(o[_]<s[_]||o[_]>n[_])return null}else{const x=1/c[_];let w=(s[_]-o[_])*x,E=(n[_]-o[_])*x;if(w>E){const S=w;w=E,E=S}if(w>d&&(d=w),E<m&&(m=E),d>m)return null}return d}function yT(s,n,o,c,d,m,_,x,w,E,S){const M=c-s,D=d-n,O=m-o,B=_-s,U=x-n,$=w-o,ne=S[1]*$-S[2]*U,ue=S[2]*B-S[0]*$,te=S[0]*U-S[1]*B,oe=M*ne+D*ue+O*te;if(Math.abs(oe)<1e-15)return null;const fe=1/oe,ae=E[0]-s,Se=E[1]-n,Ee=E[2]-o,Le=(ae*ne+Se*ue+Ee*te)*fe;if(Le<0||Le>1)return null;const We=Se*O-Ee*D,Ce=Ee*M-ae*O,Oe=ae*D-Se*M,Ne=(S[0]*We+S[1]*Ce+S[2]*Oe)*fe;return Ne<0||Le+Ne>1?null:(B*We+U*Ce+$*Oe)*fe}function vT(s,n,o){return(s-n)/(o-n)}function xT(s,n,o,c,d,m,_,x,w){const E=1<<o,S=m-c,M=_-d,D=(s+1)/E*S+c,O=(n+0)/E*M+d,B=(n+1)/E*M+d;x[0]=(s+0)/E*S+c,x[1]=O,w[0]=D,w[1]=B}class bT{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(m){const _=Math.ceil(Math.log2(m.dim/8)),x=[];let w=Math.ceil(Math.pow(2,_));const E=1/w,S=(O,B,U,$,ne)=>{const ue=$?1:0,te=(O+1)*U-ue,oe=B*U,fe=(B+1)*U-ue;ne[0]=O*U,ne[1]=oe,ne[2]=te,ne[3]=fe};let M=new gT(w);const D=[];for(let O=0;O<w*w;O++){S(O%w,Math.floor(O/w),E,!1,D);const B=Ga(D[0],D[1],m),U=Ga(D[2],D[1],m),$=Ga(D[2],D[3],m),ne=Ga(D[0],D[3],m);M.minimums.push(Math.min(B,U,$,ne)),M.maximums.push(Math.max(B,U,$,ne)),M.leaves.push(1)}for(x.push(M),w/=2;w>=1;w/=2){const O=x[x.length-1];M=new gT(w);for(let B=0;B<w*w;B++){S(B%w,Math.floor(B/w),2,!0,D);const U=O.getElevation(D[0],D[1]),$=O.getElevation(D[2],D[1]),ne=O.getElevation(D[2],D[3]),ue=O.getElevation(D[0],D[3]),te=O.isLeaf(D[0],D[1]),oe=O.isLeaf(D[2],D[1]),fe=O.isLeaf(D[2],D[3]),ae=O.isLeaf(D[0],D[3]),Se=Math.min(U.min,$.min,ne.min,ue.min),Ee=Math.max(U.max,$.max,ne.max,ue.max),Le=te&&oe&&fe&&ae;M.maximums.push(Ee),M.minimums.push(Se),M.leaves.push(Ee-Se<=5&&Le?1:0)}x.push(M)}return x}(this.dem),c=o.length-1,d=o[c];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(o,0,0,c,0)}raycastRoot(n,o,c,d,m,_,x=1){return _T([n,o,-100],[c,d,this.maximums[0]*x],m,_)}raycast(n,o,c,d,m,_,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(n,o,c,d,m,_,x);if(w==null)return null;const E=[],S=[],M=[],D=[],O=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:B,t:U,nodex:$,nodey:ne,depth:ue}=O.pop();if(this.leaves[B]){xT($,ne,ue,n,o,c,d,M,D);const oe=1<<ue,fe=($+0)/oe,ae=($+1)/oe,Se=(ne+0)/oe,Ee=(ne+1)/oe,Le=Ga(fe,Se,this.dem)*x,We=Ga(ae,Se,this.dem)*x,Ce=Ga(ae,Ee,this.dem)*x,Oe=Ga(fe,Ee,this.dem)*x,Ne=yT(M[0],M[1],Le,D[0],M[1],We,D[0],D[1],Ce,m,_),je=yT(D[0],D[1],Ce,M[0],D[1],Oe,M[0],M[1],Le,m,_),Ze=Math.min(Ne!==null?Ne:Number.MAX_VALUE,je!==null?je:Number.MAX_VALUE);if(Ze!==Number.MAX_VALUE)return Ze;{const ke=Yd([],m,_,U);if(wT(Le,We,Oe,Ce,vT(ke[0],M[0],D[0]),vT(ke[1],M[1],D[1]))>=ke[2])return U}continue}let te=0;for(let oe=0;oe<this._siblingOffset.length;oe++){xT(($<<1)+this._siblingOffset[oe][0],(ne<<1)+this._siblingOffset[oe][1],ue+1,n,o,c,d,M,D),M[2]=-100,D[2]=this.maximums[this.childOffsets[B]+oe]*x;const fe=_T(M,D,m,_);if(fe!=null){const ae=fe;E[oe]=ae;let Se=!1;for(let Ee=0;Ee<te&&!Se;Ee++)ae>=E[S[Ee]]&&(S.splice(Ee,0,oe),Se=!0);Se||(S[te]=oe),te++}}for(let oe=0;oe<te;oe++){const fe=S[oe];O.push({idx:this.childOffsets[B]+fe,t:E[fe],nodex:($<<1)+this._siblingOffset[fe][0],nodey:(ne<<1)+this._siblingOffset[fe][1],depth:ue+1})}}return null}_addNode(n,o,c){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,c,d,m){if(n[d].isLeaf(o,c)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=d-1,x=n[_];let w=0,E=0;for(let S=0;S<this._siblingOffset.length;S++){const M=2*o+this._siblingOffset[S][0],D=2*c+this._siblingOffset[S][1],O=x.getElevation(M,D),B=x.isLeaf(M,D),U=this._addNode(O.min,O.max,B);B&&(w|=1<<S),E||(E=U)}for(let S=0;S<this._siblingOffset.length;S++)w&1<<S||this._construct(n,2*o+this._siblingOffset[S][0],2*c+this._siblingOffset[S][1],_,E+S)}}function wT(s,n,o,c,d,m){return En(En(s,o,m),En(n,c,m),d)}function Ga(s,n,o){const c=o.dim,d=Xe(s*c-.5,0,c-1),m=Xe(n*c-.5,0,c-1),_=Math.floor(d),x=Math.floor(m),w=Math.min(_+1,c-1),E=Math.min(x+1,c-1);return wT(o.get(_,x),o.get(w,x),o.get(_,E),o.get(w,E),d-_,m-x)}const TT={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Og{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,c,d=!1,m=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return xn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const _=this.dim=o.height-2,x=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.encoding=c||"mapbox",this.borderReady=d,!d){for(let w=0;w<_;w++)x[this._idx(-1,w)]=x[this._idx(0,w)],x[this._idx(_,w)]=x[this._idx(_-1,w)],x[this._idx(w,-1)]=x[this._idx(w,0)],x[this._idx(w,_)]=x[this._idx(w,_-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(_,-1)]=x[this._idx(_-1,0)],x[this._idx(-1,_)]=x[this._idx(0,_-1)],x[this._idx(_,_)]=x[this._idx(_-1,_-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new bT(this)}get(n,o,c=!1){c&&(n=Xe(n,-1,this.dim),o=Xe(o,-1,this.dim));const d=4*this._idx(n,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[d],this.pixels[d+1],this.pixels[d+2])}static getUnpackVector(n){return TT[n]}get unpackVector(){return TT[this.encoding]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}_unpackMapbox(n,o,c){return(256*n*256+256*o+c)/10-1e4}_unpackTerrarium(n,o,c){return 256*n+o+c/256-32768}static pack(n,o){const c=[0,0,0,0],d=Og.getUnpackVector(o);let m=Math.floor((n+d[3])/d[2]);return c[2]=m%256,m=Math.floor(m/256),c[1]=m%256,m=Math.floor(m/256),c[0]=m,c}getPixels(){return new $r({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,c){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let d=o*this.dim,m=o*this.dim+this.dim,_=c*this.dim,x=c*this.dim+this.dim;switch(o){case-1:d=m-1;break;case 1:m=d+1}switch(c){case-1:_=x-1;break;case 1:x=_+1}const w=-o*this.dim,E=-c*this.dim;for(let S=_;S<x;S++)for(let M=d;M<m;M++){const D=4*this._idx(M,S),O=4*this._idx(M+w,S+E);this.pixels[D+0]=n.pixels[O+0],this.pixels[D+1]=n.pixels[O+1],this.pixels[D+2]=n.pixels[O+2],this.pixels[D+3]=n.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}xt(Og,"DEMData"),xt(bT,"DemMinMaxQuadTree",{omit:["dem"]});class dP{constructor(n,o){this.max=n,this.onRemove=o,this.reset()}reset(){for(const n in this.data)for(const o of this.data[n])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(n,o,c){const d=n.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const m={value:o,timeout:void 0};if(c!==void 0&&(m.timeout=setTimeout(()=>{this.remove(n,m)},c)),this.data[d].push(m),this.order.push(d),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value}getByKey(n){const o=this.data[n];return o?o[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,o){if(!this.has(n))return this;const c=n.wrapped().key,d=o===void 0?0:this.data[c].indexOf(o),m=this.data[c][d];return this.data[c].splice(d,1),m.timeout&&clearTimeout(m.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(n){const o=[];for(const c in this.data)for(const d of this.data[c])n(d.value)||o.push(d);for(const c of o)this.remove(c.value.tileID,c)}}class eh{constructor(n,o,c){this.func=n,this.mask=o,this.range=c}}eh.ReadOnly=!1,eh.ReadWrite=!0,eh.disabled=new eh(519,eh.ReadOnly,[0,1]);const jv=7680;class Gv{constructor(n,o,c,d,m,_){this.test=n,this.ref=o,this.mask=c,this.fail=d,this.depthFail=m,this.pass=_}}Gv.disabled=new Gv({func:519,mask:0},0,0,jv,jv,jv);class po{constructor(n,o,c){this.blendFunction=n,this.blendColor=o,this.mask=c}}po.Replace=[1,0],po.disabled=new po(po.Replace,di.transparent,[!1,!1,!1,!1]),po.unblended=new po(po.Replace,di.transparent,[!0,!0,!0,!0]),po.alphaBlended=new po([1,771],di.transparent,[!0,!0,!0,!0]);const $v=1029,qv=2305;class Vs{constructor(n,o,c){this.enable=n,this.mode=o,this.frontFace=c}}Vs.disabled=new Vs(!1,$v,qv),Vs.backCCW=new Vs(!0,$v,qv),Vs.backCW=new Vs(!0,$v,2304),Vs.frontCW=new Vs(!0,1028,2304),Vs.frontCCW=new Vs(!0,1028,qv);class oc extends Cs{constructor(n,o,c){super(),this.id=n,this._onlySymbols=c,o.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new dP(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new hP,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const o=this._tiles[n];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,o){return n.isSymbolTile=this._onlySymbols,this._source.loadTile(n,o)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const c=this._tiles[o];c.upload(n),c.prepare(this.map.style.imageManager)}}getIds(){return ii(this._tiles).map(n=>n.tileID).sort(ET).map(n=>n.key)}getRenderableIds(n){const o=[];for(const c in this._tiles)this._isIdRenderable(+c,n)&&o.push(this._tiles[c]);return n?o.sort((c,d)=>{const m=c.tileID,_=d.tileID,x=new ge(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),w=new ge(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||w.y-x.y||w.x-x.x}).map(c=>c.tileID.key):o.map(c=>c.tileID).sort(ET).map(c=>c.key)}hasRenderableParent(n){const o=this.findLoadedParent(n,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(n,o){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(o||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,o){const c=this._tiles[n];c&&(c.state!=="loading"&&(c.state=o),this._loadTile(c,this._tileLoaded.bind(this,c,n,o)))}_tileLoaded(n,o,c,d){if(d)if(n.state="errored",d.status!==404)this._source.fire(new Ys(d,{tile:n}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else n.timeAdded=Sn.now(),c==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(o,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new Fn("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const o=this.getRenderableIds();for(let d=0;d<o.length;d++){const m=o[d];if(n.neighboringTiles&&n.neighboringTiles[m]){const _=this.getTileByID(m);c(n,_),c(_,n)}}function c(d,m){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-d.tileID.canonical.x;const x=m.tileID.canonical.y-d.tileID.canonical.y,w=Math.pow(2,d.tileID.canonical.z),E=m.tileID.key;_===0&&x===0||Math.abs(x)>1||(Math.abs(_)>1&&(Math.abs(_+w)===1?_+=w:Math.abs(_-w)===1&&(_-=w)),m.dem&&d.dem&&(d.dem.backfillBorder(m.dem,_,x),d.neighboringTiles&&d.neighboringTiles[E]&&(d.neighboringTiles[E].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,o,c,d){for(const m in this._tiles){let _=this._tiles[m];if(d[m]||!_.hasData()||_.tileID.overscaledZ<=o||_.tileID.overscaledZ>c)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>o+1;){const E=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[E.key],_&&_.hasData()&&(x=E)}let w=x;for(;w.overscaledZ>o;)if(w=w.scaledTo(w.overscaledZ-1),n[w.key]){d[x.key]=x;break}}}findLoadedParent(n,o){if(n.key in this._loadedParentTiles){const c=this._loadedParentTiles[n.key];return c&&c.tileID.overscaledZ>=o?c:null}for(let c=n.overscaledZ-1;c>=o;c--){const d=n.scaledTo(c),m=this._getLoadedTile(d);if(m)return m}}_getLoadedTile(n){const o=this._tiles[n.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,o){o=o||this._source.tileSize;const c=Math.ceil(n.width/o)+1,d=Math.ceil(n.height/o)+1,m=Math.floor(c*d*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(n){const o=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,o){const c={};for(const d in this._tiles){const m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+o),c[m.tileID.key]=m}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(n,o,c){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let d;this.updateCacheSize(n,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Cr(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(d=n.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(x=>this._source.hasTile(x)))):d=[];const m=this._updateRetainedTiles(d);if(IT(this._source.type)&&d.length!==0){const x={},w={},E=Object.keys(m);for(const M of E){const D=m[M],O=this._tiles[M];if(!O||O.fadeEndTime&&O.fadeEndTime<=Sn.now())continue;const B=this.findLoadedParent(D,Math.max(D.overscaledZ-oc.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),x[B.tileID.key]=B.tileID),w[M]=D}const S=d[d.length-1].overscaledZ;for(const M in this._tiles){const D=this._tiles[M];if(m[M]||!D.hasData())continue;let O=D.tileID;for(;O.overscaledZ>S;){O=O.scaledTo(O.overscaledZ-1);const B=this._tiles[O.key];if(B&&B.hasData()&&w[O.key]){m[M]=D.tileID;break}}}for(const M in x)m[M]||(this._coveredTiles[M]=!0,m[M]=x[M])}for(const x in m)this._tiles[x].clearFadeHold();const _=function(x,w){const E=[];for(const S in x)S in w||E.push(S);return E}(this._tiles,m);for(const x of _){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const o={};if(n.length===0)return o;const c={},d=n.reduce((E,S)=>Math.min(E,S.overscaledZ),1/0),m=n[0].overscaledZ,_=Math.max(m-oc.maxOverzooming,this._source.minzoom),x=Math.max(m+oc.maxUnderzooming,this._source.minzoom),w={};for(const E of n){const S=this._addTile(E);o[E.key]=E,S.hasData()||d<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,d,x,o);for(const E of n){let S=this._tiles[E.key];if(S.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const D=E.children(this._source.maxzoom)[0],O=this.getTile(D);if(O&&O.hasData()){o[D.key]=D;continue}}else{const D=E.children(this._source.maxzoom);if(o[D[0].key]&&o[D[1].key]&&o[D[2].key]&&o[D[3].key])continue}let M=S.wasRequested();for(let D=E.overscaledZ-1;D>=_;--D){const O=E.scaledTo(D);if(c[O.key]||(c[O.key]=!0,S=this.getTile(O),!S&&M&&(S=this._addTile(O)),S&&(o[O.key]=O,M=S.wasRequested(),S.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const o=[];let c,d=this._tiles[n].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}o.push(d.key);const m=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;d=m}for(const m of o)this._loadedParentTiles[m]=c}}_addTile(n){let o=this._tiles[n.key];if(o)return o;o=this._cache.getAndRemove(n),o&&(this._setTileReloadTimer(n.key,o),o.tileID=n,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,o)));const c=Boolean(o);if(!c){const d=this.map?this.map.painter:null;o=new Vv(n,this._source.tileSize*n.overscaleFactor(),this.transform.tileZoom,d,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,n.key,o.state))}return o?(o.uses++,this._tiles[n.key]=o,c||this._source.fire(new Fn("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(n,o){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const c=o.getExpiryTimeout();c&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},c))}_removeTile(n){const o=this._tiles[n];o&&(o.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,o,c){const d=[],m=this.transform;if(!m)return d;const _=m.projection.name==="globe",x=so(m.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(c&&E.clearQueryDebugViz(),E.holdingForFade())continue;let S;if(_){const M=E.tileID.canonical;if(M.z===0){const D=[Math.abs(Xe(x,...Tf(M,-1))-x),Math.abs(Xe(x,...Tf(M,1))-x)];S=[0,2*D.indexOf(Math.min(...D))-1]}else{const D=[Math.abs(Xe(x,...Tf(M,-1))-x),Math.abs(Xe(x,...Tf(M,0))-x),Math.abs(Xe(x,...Tf(M,1))-x)];S=[D.indexOf(Math.min(...D))-1]}}else S=[0];for(const M of S){const D=n.containsTile(E,m,o,M);D&&d.push(D)}}return d}getVisibleCoordinates(n){const o=this.getRenderableIds(n).map(c=>this._tiles[c].tileID);for(const c of o)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(IT(this._source.type))for(const n in this._tiles){const o=this._tiles[n];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=Sn.now())return!0}return!1}setFeatureState(n,o,c){this._state.updateState(n=n||"_geojsonTileLayer",o,c)}removeFeatureState(n,o,c){this._state.removeFeatureState(n=n||"_geojsonTileLayer",o,c)}getFeatureState(n,o){return this._state.getState(n=n||"_geojsonTileLayer",o)}setDependencies(n,o,c){const d=this._tiles[n];d&&d.setDependencies(o,c)}reloadTilesForDependencies(n,o){for(const c in this._tiles)this._tiles[c].hasDependency(n,o)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(n,o))}_preloadTiles(n,o){const c=new Map,d=Array.isArray(n)?n:[n],m=this.map.painter.terrain,_=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const x of d){const w=x.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)c.set(E.key,E);this.usedForTerrain&&x.updateElevation(!1)}ni(Array.from(c.values()),(x,w)=>{const E=new Vv(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,S=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(S,E)})},o)}}function ET(s,n){const o=Math.abs(2*s.wrap)-+(s.wrap<0),c=Math.abs(2*n.wrap)-+(n.wrap<0);return s.overscaledZ-n.overscaledZ||c-o||n.canonical.y-s.canonical.y||n.canonical.x-s.canonical.x}function IT(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function Tf(s,n){const o=1<<s.z;return[s.x/o+n,(s.x+1)/o+n]}oc.maxOverzooming=10,oc.maxUnderzooming=3;class Bg{constructor(n,o,c){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=c}static create(n,o,c){const d=c||n.findDEMTileFor(o);if(!d||!d.dem)return;const m=d.dem,_=d.tileID,x=1<<o.canonical.z-_.canonical.z;return new Bg(d,d.tileSize/Zt/x,[(o.canonical.x/x-_.canonical.x)*m.dim,(o.canonical.y/x-_.canonical.y)*m.dim])}tileCoordToPixel(n,o){const c=o*this._scale+this._offset[1],d=Math.floor(n*this._scale+this._offset[0]),m=Math.floor(c);return new ge(d,m)}getElevationAt(n,o,c,d){const m=n*this._scale+this._offset[0],_=o*this._scale+this._offset[1],x=Math.floor(m),w=Math.floor(_),E=this._dem;return d=!!d,c?En(En(E.get(x,w,d),E.get(x,w+1,d),_-w),En(E.get(x+1,w,d),E.get(x+1,w+1,d),_-w),m-x):E.get(x,w,d)}getElevationAtPixel(n,o,c){return this._dem.get(n,o,!!c)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*ws(1,n)*this._dem.stride}}class ST{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Ra(Zt,16,0),this.featureIndexArray=new hb,this.promoteId=o}insert(n,o,c,d,m,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,m,_);const w=this.grid;for(let E=0;E<o.length;E++){const S=o[E],M=[1/0,1/0,-1/0,-1/0];for(let D=0;D<S.length;D++){const O=S[D];M[0]=Math.min(M[0],O.x),M[1]=Math.min(M[1],O.y),M[2]=Math.max(M[2],O.x),M[3]=Math.max(M[3],O.y)}M[0]<Zt&&M[1]<Zt&&M[2]>=0&&M[3]>=0&&w.insert(x,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wv(new hf(this.rawTileData)).layers,this.sourceLayerCoder=new hT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o,c,d){this.loadVTLayers();const m=n.params||{},_=bu(m.filter),x=n.tileResult,w=n.transform,E=x.bufferedTilespaceBounds,S=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(B,U,$,ne)=>Pb(x.bufferedTilespaceGeometry,B,U,$,ne));S.sort(fP);let M=null;w.elevation&&S.length>0&&(M=Bg.create(w.elevation,this.tileID));const D={};let O;for(let B=0;B<S.length;B++){const U=S[B];if(U===O)continue;O=U;const $=this.featureIndexArray.get(U);let ne=null;this.loadMatchingFeature(D,$,_,m.layers,m.availableImages,o,c,d,(ue,te,oe,fe=0)=>(ne||(ne=No(ue,this.tileID.canonical,n.tileTransform)),te.queryIntersectsFeature(x,ue,oe,ne,this.z,n.transform,n.pixelPosMatrix,M,fe)))}return D}loadMatchingFeature(n,o,c,d,m,_,x,w,E){const{featureIndex:S,bucketIndex:M,sourceLayerIndex:D,layoutVertexArrayOffset:O}=o,B=this.bucketLayerIDs[M];if(d&&!function(ue,te){for(let oe=0;oe<ue.length;oe++)if(te.indexOf(ue[oe])>=0)return!0;return!1}(d,B))return;const U=this.sourceLayerCoder.decode(D),$=this.vtLayers[U].feature(S);if(c.needGeometry){const ue=Jl($,!0);if(!c.filter(new ie(this.tileID.overscaledZ),ue,this.tileID.canonical))return}else if(!c.filter(new ie(this.tileID.overscaledZ),$))return;const ne=this.getId($,U);for(let ue=0;ue<B.length;ue++){const te=B[ue];if(d&&d.indexOf(te)<0)continue;const oe=_[te];if(!oe)continue;let fe={};ne!==void 0&&w&&(fe=w.getState(oe.sourceLayer||"_geojsonTileLayer",ne));const ae=rn({},x[te]);ae.paint=AT(ae.paint,oe.paint,$,fe,m),ae.layout=AT(ae.layout,oe.layout,$,fe,m);const Se=!E||E($,oe,fe,O);if(!Se)continue;const Ee=new dT($,this.z,this.x,this.y,ne);Ee.layer=ae;let Le=n[te];Le===void 0&&(Le=n[te]=[]),Le.push({featureIndex:S,feature:Ee,intersectionZ:Se})}}lookupSymbolFeatures(n,o,c,d,m,_,x,w){const E={};this.loadVTLayers();const S=bu(m);for(const M of n)this.loadMatchingFeature(E,{bucketIndex:c,sourceLayerIndex:d,featureIndex:M,layoutVertexArrayOffset:0},S,_,x,w,o);return E}loadFeature(n){const{featureIndex:o,sourceLayerIndex:c}=n;this.loadVTLayers();const d=this.sourceLayerCoder.decode(c),m=this.vtFeatures[d];if(m[o])return m[o];const _=this.vtLayers[d].feature(o);return m[o]=_,_}hasLayer(n){for(const o of this.bucketLayerIDs)for(const c of o)if(n===c)return!0;return!1}getId(n,o){let c=n.id;if(this.promoteId){const d=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];d!=null&&(c=n.properties[d]),typeof c=="boolean"&&(c=Number(c))}return c}}function AT(s,n,o,c,d){return Hn(s,(m,_)=>{const x=n instanceof Be?n.get(_):null;return x&&x.evaluate?x.evaluate(o,c,d):x})}function fP(s,n){return n-s}xt(ST,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class CT{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new Vo({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const c=this.getKey(n,o);return this.positions[c]}trim(){const n=this.width,o=this.height=bi(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,c){const d=[];let m=n.length%2==1?-n[n.length-1]*c:0,_=n[0]*c,x=!0;d.push({left:m,right:_,isDash:x,zeroLength:n[0]===0});let w=n[0];for(let E=1;E<n.length;E++){x=!x;const S=n[E];m=w*c,w+=S,_=w*c,d.push({left:m,right:_,isDash:x,zeroLength:S===0})}return d}addRoundDash(n,o,c){const d=o/2;for(let m=-c;m<=c;m++){const _=this.width*(this.nextRow+c+m);let x=0,w=n[x];for(let E=0;E<this.width;E++){E/w.right>1&&(w=n[++x]);const S=Math.abs(E-w.left),M=Math.abs(E-w.right),D=Math.min(S,M);let O;const B=m/c*(d+1);if(w.isDash){const U=d-Math.abs(B);O=Math.sqrt(D*D+U*U)}else O=d-Math.sqrt(D*D+B*B);this.image.data[_+E]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(n,o){for(let w=n.length-1;w>=0;--w){const E=n[w],S=n[w+1];E.zeroLength?n.splice(w,1):S&&S.isDash===E.isDash&&(S.left=E.left,n.splice(w,1))}const c=n[0],d=n[n.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const m=this.width*this.nextRow;let _=0,x=n[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=n[++_]);const E=Math.abs(w-x.left),S=Math.abs(w-x.right),M=Math.min(E,S);this.image.data[m+w]=Math.max(0,Math.min(255,(x.isDash?M:-M)+o+128))}}addDash(n,o){const c=this.getKey(n,o);if(this.positions[c])return this.positions[c];const d=o==="round",m=d?7:0,_=2*m+1;if(this.nextRow+_>this.height)return xn("LineAtlas out of space"),null;n.length===0&&n.push(1);let x=0;for(let S=0;S<n.length;S++)n[S]<0&&(xn("Negative value is found in line dasharray, replacing values with 0"),n[S]=0),x+=n[S];if(x!==0){const S=this.width/x,M=this.getDashRanges(n,this.width,S);d?this.addRoundDash(M,S,m):this.addRegularDash(M,o==="square"?.5*S:0)}const w=this.nextRow+m;this.nextRow+=_;const E={tl:[w,m],br:[x,0]};return this.positions[c]=E,E}}xt(CT,"LineAtlas");class kT{constructor(n){const o={},c=[];for(const x in n){const w=n[x],E=o[x]={};for(const S in w.glyphs){const M=w.glyphs[+S];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const D=M.metrics.localGlyph?2:1,O={x:0,y:0,w:M.bitmap.width+2*D,h:M.bitmap.height+2*D};c.push(O),E[S]=O}}const{w:d,h:m}=Iv(c),_=new Vo({width:d||1,height:m||1});for(const x in n){const w=n[x];for(const E in w.glyphs){const S=w.glyphs[+E];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const M=o[x][E],D=S.metrics.localGlyph?2:1;Vo.copy(S.bitmap,_,{x:0,y:0},{x:M.x+D,y:M.y+D},S.bitmap)}}this.image=_,this.positions=o}}xt(kT,"GlyphAtlas");class pP{constructor(n){this.tileID=new Cr(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),this.tileZoom=n.tileZoom,this.uid=n.uid,this.zoom=n.zoom,this.canonical=n.tileID.canonical,this.pixelRatio=n.pixelRatio,this.tileSize=n.tileSize,this.source=n.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=n.showCollisionBoxes,this.collectResourceTiming=!!n.collectResourceTiming,this.returnDependencies=!!n.returnDependencies,this.promoteId=n.promoteId,this.enableTerrain=!!n.enableTerrain,this.isSymbolTile=n.isSymbolTile,this.tileTransform=sc(n.tileID.canonical,n.projection),this.projection=n.projection}parse(n,o,c,d,m){this.status="parsing",this.data=n,this.collisionBoxArray=new Ky;const _=new hT(Object.keys(n.layers).sort()),x=new ST(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},E=new CT(256,256),S={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:c},M=o.familiesBySource[this.source];for(const fe in M){const ae=n.layers[fe];if(!ae)continue;let Se=!1,Ee=!1;for(const Ce of M[fe])Ce[0].type==="symbol"?Se=!0:Ee=!0;if(this.isSymbolTile===!0&&!Se||this.isSymbolTile===!1&&!Ee)continue;ae.version===1&&xn(`Vector tile source "${this.source}" layer "${fe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Le=_.encode(fe),We=[];for(let Ce=0;Ce<ae.length;Ce++){const Oe=ae.feature(Ce),Ne=x.getId(Oe,fe);We.push({feature:Oe,id:Ne,index:Ce,sourceLayerIndex:Le})}for(const Ce of M[fe]){const Oe=Ce[0];this.isSymbolTile!==void 0&&Oe.type==="symbol"!==this.isSymbolTile||Oe.minzoom&&this.zoom<Math.floor(Oe.minzoom)||Oe.maxzoom&&this.zoom>=Oe.maxzoom||Oe.visibility!=="none"&&(Wv(Ce,this.zoom,c),(w[Oe.id]=Oe.createBucket({index:x.bucketLayerIDs.length,layers:Ce,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Le,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(We,S,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Ce.map(Ne=>Ne.id)))}}let D,O,B,U;E.trim();const $={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ne=Hn(S.glyphDependencies,fe=>Object.keys(fe).map(Number));Object.keys(ne).length?d.send("getGlyphs",{uid:this.uid,stacks:ne},(fe,ae)=>{D||(D=fe,O=ae,oe.call(this))},void 0,!1,$):O={};const ue=Object.keys(S.iconDependencies);ue.length?d.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"icons"},(fe,ae)=>{D||(D=fe,B=ae,oe.call(this))},void 0,!1,$):B={};const te=Object.keys(S.patternDependencies);function oe(){if(D)return m(D);if(O&&B&&U){const fe=new kT(O),ae=new kw(B,U);for(const Se in w){const Ee=w[Se];Ee instanceof Ua?(Wv(Ee.layers,this.zoom,c),OD(Ee,O,fe.positions,B,ae.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):Ee.hasPattern&&(Ee instanceof vg||Ee instanceof pg||Ee instanceof af)&&(Wv(Ee.layers,this.zoom,c),Ee.addFeatures(S,this.tileID.canonical,ae.patternPositions,c,this.tileTransform))}this.status="done",m(null,{buckets:ii(w).filter(Se=>!Se.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:fe.image,lineAtlas:E,imageAtlas:ae,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?fe.positions:null})}}te.length?d.send("getImages",{icons:te,source:this.source,tileID:this.tileID,type:"patterns"},(fe,ae)=>{D||(D=fe,U=ae,oe.call(this))},void 0,!1,$):U={},oe.call(this)}}function Wv(s,n,o){const c=new ie(n);for(const d of s)d.recalculate(c,o)}class MT{constructor(n){this.entries={},this.scheduler=n}request(n,o,c,d){const m=this.entries[n]=this.entries[n]||{callbacks:[]};if(m.result){const[_,x]=m.result;return this.scheduler?this.scheduler.add(()=>{d(_,x)},o):d(_,x),()=>{}}return m.callbacks.push(d),m.cancel||(m.cancel=c((_,x)=>{m.result=[_,x];for(const w of m.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,x)},o):w(_,x);setTimeout(()=>delete this.entries[n],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(_=>_!==d),m.callbacks.length||(m.cancel(),delete this.entries[n]))}}}function DT(s,n,o){const c=JSON.stringify(s.request);return s.data&&(this.deduped.entries[c]={result:[null,s.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},d=>{const m=Xs(s.request,(_,x,w,E)=>{_?d(_):x&&d(null,{vectorTile:o?void 0:new wv(new hf(x)),rawData:x,cacheControl:w,expires:E})});return()=>{m.cancel(),d()}},n)}l.ARRAY_TYPE=Gr,l.AUTH_ERR_MSG=_a,l.Aabb=Ar,l.Actor=class{constructor(s,n,o){this.target=s,this.parent=n,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Nt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=br()?s:T,this.scheduler=new cP}send(s,n,o,c,d=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=m,this.callbacks[_]=o);const x=As(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:s,hasCallback:!!o,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:Zl(n,x)},x),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(s){const n=s.data,o=n.id;if(o&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const c=this.cancelCallbacks[o];delete this.cancelCallbacks[o],c&&c.cancel()}else if(n.mustQueue||br()){const c=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,n),c&&c.metadata||{type:"message"})}else this.processTask(o,n)}processTask(s,n){if(n.type==="<response>"){const o=this.callbacks[s];delete this.callbacks[s],o&&(n.error?o(no(n.error)):o(null,no(n.data)))}else{const o=As(this.globalScope)?void 0:[],c=n.hasCallback?(m,_)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:m?Zl(m):null,data:Zl(_,o)},o)}:m=>{},d=no(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,d,c);else if(this.parent.getWorkerSource){const m=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,m[0],d.source)[m[1]](d,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=yg,l.Color=di,l.ColorMode=po,l.CullFaceMode=Vs,l.DEMData=Og,l.DataConstantProperty=we,l.DedupedRequest=MT,l.DepthMode=eh,l.EXTENT=Zt,l.Elevation=class{isDataAvailableAtPoint(s){const n=this._source();if(this.isUsingMockSource()||!n||s.y<0||s.y>1)return!1;const o=n.getSource().maxzoom,c=1<<o,d=Math.floor(s.x),m=Math.floor((s.x-d)*c),_=Math.floor(s.y*c),x=this.findDEMTileFor(new Cr(o,d,o,m,_));return!(!x||!x.dem)}getAtPointOrZero(s,n=0){return this.getAtPoint(s,n)||0}getAtPoint(s,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const c=this._source();if(!c||s.y<0||s.y>1)return n;const d=c.getSource().maxzoom,m=1<<d,_=Math.floor(s.x),x=s.x-_,w=new Cr(d,_,d,Math.floor(x*m),Math.floor(s.y*m)),E=this.findDEMTileFor(w);if(!E||!E.dem)return n;const S=E.dem,M=1<<E.tileID.canonical.z,D=(x*M-E.tileID.canonical.x)*S.dim,O=(s.y*M-E.tileID.canonical.y)*S.dim,B=Math.floor(D),U=Math.floor(O);return(o?this.exaggeration():1)*En(En(S.get(B,U),S.get(B,U+1),O-U),En(S.get(B+1,U),S.get(B+1,U+1),O-U),D-B)}getAtTileOffset(s,n,o){const c=1<<s.canonical.z;return this.getAtPointOrZero(new Ou(s.wrap+(s.canonical.x+n/Zt)/c,(s.canonical.y+o/Zt)/c))}getAtTileOffsetFunc(s,n,o,c){return d=>{const m=this.getAtTileOffset(s,d.x,d.y),_=c.upVector(s.canonical,d.x,d.y);return os(_,_,m*c.upVectorScale(s.canonical,n,o).metersToTile),_}}getForTilePoints(s,n,o,c){if(this.isUsingMockSource())return!1;const d=Bg.create(this,s,c);return!!d&&(n.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],o)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(s);if(!n||!n.dem)return null;const o=n.dem.tree,c=n.tileID,d=1<<s.canonical.z-c.canonical.z;let m=s.canonical.x/d-c.canonical.x,_=s.canonical.y/d-c.canonical.y,x=0;for(let w=0;w<s.canonical.z-c.canonical.z&&!o.leaves[x];w++){m*=2,_*=2;const E=2*Math.floor(_)+Math.floor(m);x=o.childOffsets[x]+E,m%=1,_%=1}return{min:this.exaggeration()*o.minimums[x],max:this.exaggeration()*o.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=Ys,l.EvaluationParameters=ie,l.Event=Fn,l.Evented=Cs,l.FillExtrusionBucket=af,l.Frustum=fv,l.FrustumCorners=dv,l.GLOBE_METERS_TO_ECEF=Rv,l.GLOBE_RADIUS=$o,l.GLOBE_SCALE_MATCH_LATITUDE=45,l.GLOBE_ZOOM_THRESHOLD_MAX=6,l.GLOBE_ZOOM_THRESHOLD_MIN=5,l.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_createGrid(s){const n=new tn,o=new hr,c=65;for(let d=0;d<c;d++)for(let m=0;m<c;m++)n.emplaceBack(m,d);this._gridSegments=[];for(let d=0,m=0;d<Ku.length;d++){const _=Ku[d];for(let w=0;w<_;w++)for(let E=0;E<64;E++){const S=w*c+E;o.emplaceBack(S+1,S,S+c),o.emplaceBack(S+c,S+c+1,S+1)}const x=64*_*2;this._gridSegments.push(Ei.simpleSegment(0,m,(_+1)*c,x)),m+=x}this._gridBuffer=s.createVertexBuffer(n,pf.members),this._gridIndexBuffer=s.createIndexBuffer(o,!0)}_createPoles(s){const n=new hr;for(let d=0;d<=Xu;d++)n.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=s.createIndexBuffer(n,!0);const o=new bs,c=new bs;this._poleSegments=[];for(let d=0,m=0;d<5;d++){const _=360/(1<<d);o.emplaceBack(0,-$o,0,.5,0),c.emplaceBack(0,-$o,0,.5,1);for(let x=0;x<=Xu;x++){const w=x/Xu,E=En(0,_,w),[S,M,D]=Yu(GD,$D,E,$o);o.emplaceBack(S,M,D,w,0),c.emplaceBack(S,M,D,w,1)}this._poleSegments.push(Ei.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(o,Xw,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(c,Xw,!1)}getGridBuffers(s){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[s]]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,n){if(!this._wireframeSegments){const o=new rs,c=Xu,d=c+1;this._wireframeSegments=[];for(let m=0,_=0;m<Ku.length;m++){const x=Ku[m];for(let E=0;E<x;E++)for(let S=0;S<c;S++){const M=E*d+S;o.emplaceBack(M,M+1),o.emplaceBack(M,M+d),o.emplaceBack(M,M+d+1)}const w=x*c*3;this._wireframeSegments.push(Ei.simpleSegment(0,_,(x+1)*d,w)),_+=w}this._wireframeIndexBuffer=s.createIndexBuffer(o)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[n]]}},l.GlyphManager=Zu,l.ImagePosition=Sv,l.LivePerformanceUtils=Ve,l.LngLat=kn,l.LngLatBounds=Ba,l.LocalGlyphMode=kv,l.MAX_MERCATOR_LATITUDE=ao,l.MercatorCoordinate=Ou,l.ONE_EM=tr,l.OverscaledTileID=Cr,l.PerformanceMarkers=Te,l.Properties=Qe,l.RGBAImage=$r,l.Ray=hv,l.RequestManager=class{constructor(s,n,o){this._transformRequestFn=s,this._customAccessToken=n,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const s=function(){let n="";for(let o=0;o<10;o++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",it,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,n){return this._transformRequestFn&&this._transformRequestFn(s,n)||{url:s}}normalizeStyleURL(s,n){if(!es(s))return s;const o=wr(s);return o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeGlyphsURL(s,n){if(!es(s))return s;const o=wr(s);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeSourceURL(s,n,o,c){if(!es(s))return s;const d=wr(s);return d.path=`/v4/${d.authority}.json`,d.params.push("secure"),o&&d.params.push(`language=${o}`),c&&d.params.push(`worldview=${c}`),this._makeAPIURL(d,this._customAccessToken||n)}normalizeSpriteURL(s,n,o,c){const d=wr(s);return es(s)?(d.path=`/styles/v1${d.path}/sprite${n}${o}`,this._makeAPIURL(d,this._customAccessToken||c)):(d.path+=`${n}${o}`,Ao(d))}normalizeTileURL(s,n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!es(s))return s;const c=wr(s);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||o&&c.authority!=="raster"&&o===512?"@2x":""}${j.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${z.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${z.TILE_URL_VERSION}${c.path}`);const d=this._customAccessToken||function(m){for(const _ of m){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||z.ACCESS_TOKEN;return z.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,d)}canonicalizeTileURL(s,n){const o=wr(s);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return s;let c="mapbox://";o.path.match(/^\/raster\/v1\//)?c+=`raster/${o.path.replace(`/${z.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${o.path.replace(`/${z.TILE_URL_VERSION}/`,"")}`;let d=o.params;return n&&(d=d.filter(m=>!m.match(/^access_token=/))),d.length&&(c+=`?${d.join("&")}`),c}canonicalizeTileset(s,n){const o=!!n&&es(n),c=[];for(const d of s.tiles||[])ya(d)?c.push(this.canonicalizeTileURL(d,o)):c.push(d);return c}_makeAPIURL(s,n){const o="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=wr(z.API_URL);if(s.protocol=c.protocol,s.authority=c.authority,s.protocol==="http"){const d=s.params.indexOf("secure");d>=0&&s.params.splice(d,1)}if(c.path!=="/"&&(s.path=`${c.path}${s.path}`),!z.REQUIRE_ACCESS_TOKEN)return Ao(s);if(n=n||z.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return s.params=s.params.filter(d=>d.indexOf("access_token")===-1),s.params.push(`access_token=${n||""}`),Ao(s)}},l.ResourceType=Rr,l.SegmentVector=Ei,l.SourceCache=oc,l.StencilMode=Gv,l.StructArrayLayout1ui2=qd,l.StructArrayLayout2f1f2i16=Ir,l.StructArrayLayout2i4=tn,l.StructArrayLayout2ui4=rs,l.StructArrayLayout3f12=is,l.StructArrayLayout3ui6=hr,l.StructArrayLayout4i8=Un,l.StructArrayLayout5f20=bs,l.Texture=wf,l.Tile=Vv,l.Transitionable=Ae,l.Uniform1f=ng,l.Uniform1i=class extends Bo{constructor(s){super(s),this.current=0}set(s,n,o){this.fetchUniformLocation(s,n)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},l.Uniform2f=class extends Bo{constructor(s){super(s),this.current=[0,0]}set(s,n,o){this.fetchUniformLocation(s,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}},l.Uniform3f=class extends Bo{constructor(s){super(s),this.current=[0,0,0]}set(s,n,o){this.fetchUniformLocation(s,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}},l.Uniform4f=xb,l.UniformColor=bb,l.UniformMatrix2f=class extends Bo{constructor(s){super(s),this.current=Hk}set(s,n,o){if(this.fetchUniformLocation(s,n)){for(let c=0;c<4;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}},l.UniformMatrix3f=class extends Bo{constructor(s){super(s),this.current=Zk}set(s,n,o){if(this.fetchUniformLocation(s,n)){for(let c=0;c<9;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},l.UniformMatrix4f=class extends Bo{constructor(s){super(s),this.current=Wk}set(s,n,o){if(this.fetchUniformLocation(s,n)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let c=1;c<16;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}},l.UnwrappedTileID=gw,l.ValidationError=gt,l.VectorTileFeature=gg,l.VectorTileWorkerSource=class extends Cs{constructor(s,n,o,c,d){super(),this.actor=s,this.layerIndex=n,this.availableImages=o,this.loadVectorData=d||DT,this.loading={},this.loaded={},this.deduped=new MT(s.scheduler),this.isSpriteLoaded=c,this.scheduler=s.scheduler}loadTile(s,n){const o=s.uid,c=s&&s.request,d=c&&c.collectResourceTiming,m=this.loading[o]=new pP(s);m.abort=this.loadVectorData(s,(_,x)=>{const w=!this.loading[o];if(delete this.loading[o],w||_||!x)return m.status="done",w||(this.loaded[o]=m),n(_);const E=x.rawData,S={};x.expires&&(S.expires=x.expires),x.cacheControl&&(S.cacheControl=x.cacheControl),m.vectorTile=x.vectorTile||new wv(new hf(E));const M=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(D,O)=>{if(D||!O)return n(D);const B={};if(d){const U=zt(c);U.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify(U)))}n(null,rn({rawTileData:E.slice(0)},O,S,B))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[o]=m})}reloadTile(s,n){const o=this.loaded,c=s.uid,d=this;if(o&&o[c]){const m=o[c];m.showCollisionBoxes=s.showCollisionBoxes,m.enableTerrain=!!s.enableTerrain,m.projection=s.projection,m.tileTransform=sc(s.tileID.canonical,s.projection);const _=(x,w)=>{const E=m.reloadCallback;E&&(delete m.reloadCallback,m.parse(m.vectorTile,d.layerIndex,this.availableImages,d.actor,E)),n(x,w)};m.status==="parsing"?m.reloadCallback=_:m.status==="done"&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(s,n){const o=s.uid,c=this.loading[o];c&&(c.abort&&c.abort(),delete this.loading[o]),n()}removeTile(s,n){const o=this.loaded,c=s.uid;o&&o[c]&&delete o[c],n()}},l.WritingMode=as,l.ZoomHistory=Vm,l.add=Uo,l.addDynamicAttributes=Rg,l.adjoint=function(s,n){var o=n[0],c=n[1],d=n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],S=n[8];return s[0]=_*S-x*E,s[1]=d*E-c*S,s[2]=c*x-d*_,s[3]=x*w-m*S,s[4]=o*S-d*w,s[5]=d*m-o*x,s[6]=m*E-_*w,s[7]=c*w-o*E,s[8]=o*_-c*m,s},l.asyncAll=ni,l.bezier=Qt,l.bindAll=Nt,l.boundsAttributes=pT,l.bufferConvexPolygon=function(s,n){const o=[];for(let c=0;c<s.length;c++){const d=li(c-1,-1,s.length-1),m=li(c+1,-1,s.length-1),_=s[c],x=s[m],w=s[d].sub(_).unit(),E=x.sub(_).unit(),S=E.angleWithSep(w.x,w.y),M=w.add(E).unit().mult(-1*n/Math.sin(S/2));o.push(_.add(M))}return o},l.cacheEntryPossiblyAdded=function(s){fa++,fa>Il&&(s.getActor().send("enforceCacheSizeLimit",ha),fa=0)},l.calculateGlobeLabelMatrix=function(s,n){const{x:o,y:c}=s.point,d=tT(o,c,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Fu(d,d,Ov(uo(n)))},l.calculateGlobeMatrix=function(s){const{x:n,y:o}=s.point,{lng:c,lat:d}=s._center;return tT(n,o,s.worldSize,c,d)},l.calculateGlobeMercatorMatrix=function(s){const n=s.pixelsPerMeter,o=n/ws(1,s.center.lat),c=lo(new Float64Array(16));return Zd(c,c,[s.point.x,s.point.y,0]),tc(c,c,[o,o,n]),Float32Array.from(c)},l.circumferenceAtLatitude=Jy,l.clamp=Xe,l.clearTileCache=function(s){if(!da())return;const n=T.caches.delete(So);s&&n.catch(s).then(()=>s())},l.clipLine=Vw,l.clone=function(s){var n=new Gr(16);return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n[9]=s[9],n[10]=s[10],n[11]=s[11],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],n},l.clone$1=wi,l.collisionCircleLayout=lD,l.config=z,l.conjugate=function(s,n){return s[0]=-n[0],s[1]=-n[1],s[2]=-n[2],s[3]=n[3],s},l.create=function(){var s=new Gr(16);return Gr!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},l.create$1=zb,l.createExpression=Lo,l.createLayout=Je,l.createStyleLayer=function(s){return s.type==="custom"?new sP(s):new aP[s.type](s)},l.cross=uv,l.degToRad=vt,l.distance=function(s,n){return Math.hypot(n[0]-s[0],n[1]-s[1],n[2]-s[2])},l.div=function(s,n,o){return s[0]=n[0]/o[0],s[1]=n[1]/o[1],s[2]=n[2]/o[2],s},l.dot=Ts,l.earthRadius=rg,l.ease=lt,l.easeCubicInOut=kt,l.ecefToLatLng=function([s,n,o]){const c=Math.hypot(s,n,o),d=Math.atan2(s,o),m=.5*Math.PI-Math.acos(-n/c);return new kn(Ft(d),Ft(m))},l.emitValidationErrors=Nd,l.endsWith=vn,l.enforceCacheSizeLimit=function(s){Zs(),lr&&lr.then(n=>{n.keys().then(o=>{for(let c=0;c<o.length-s;c++)n.delete(o[c])})})},l.evaluateSizeForFeature=xg,l.evaluateSizeForZoom=Gu,l.evaluateVariableOffset=Ww,l.evented=Q,l.exactEquals=function(s,n){return s[0]===n[0]&&s[1]===n[1]&&s[2]===n[2]&&s[3]===n[3]},l.exactEquals$1=function(s,n){return s[0]===n[0]&&s[1]===n[1]&&s[2]===n[2]},l.exported=Sn,l.exported$1=j,l.extend=rn,l.extend$1=ks,l.fillExtrusionHeightLift=fw,l.filterObject=Vr,l.fromMat4=function(s,n){return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[4],s[4]=n[5],s[5]=n[6],s[6]=n[8],s[7]=n[9],s[8]=n[10],s},l.fromQuat=function(s,n){var o=n[0],c=n[1],d=n[2],m=n[3],_=o+o,x=c+c,w=d+d,E=o*_,S=c*_,M=c*x,D=d*_,O=d*x,B=d*w,U=m*_,$=m*x,ne=m*w;return s[0]=1-M-B,s[1]=S+ne,s[2]=D-$,s[3]=0,s[4]=S-ne,s[5]=1-E-B,s[6]=O+U,s[7]=0,s[8]=D+$,s[9]=O-U,s[10]=1-E-M,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},l.fromRotation=function(s,n){var o=Math.sin(n),c=Math.cos(n);return s[0]=c,s[1]=o,s[2]=0,s[3]=-o,s[4]=c,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},l.fromScaling=Bb,l.furthestTileCorner=function(s){const n=Math.round((s+45+360)%360/90)%4;return Lt[n]},l.getAABBPointSquareDist=function(s,n,o){let c=0;for(let d=0;d<2;++d){const m=o?o[d]:0;s[d]>m&&(c+=(s[d]-m)*(s[d]-m)),n[d]<m&&(c+=(m-n[d])*(m-n[d]))}return c},l.getAnchorAlignment=Cv,l.getAnchorJustification=Dv,l.getBounds=function(s){let n=1/0,o=1/0,c=-1/0,d=-1/0;for(const m of s)n=Math.min(n,m.x),o=Math.min(o,m.y),c=Math.max(c,m.x),d=Math.max(d,m.y);return{min:new ge(n,o),max:new ge(c,d)}},l.getColumn=Jr,l.getGridMatrix=function(s,n,o,c){const d=n.getNorth(),m=n.getSouth(),_=n.getWest(),x=n.getEast(),w=1<<s.z,E=x-_,S=d-m,M=E/Xu,D=-S/Ku[o],O=[0,M,0,D,0,0,d,_,0];if(s.z>0){const B=180/c;Ob(O,O,[B/E+1,0,0,0,B/S+1,0,-.5*B/M,.5*B/D,1])}return O[2]=w,O[5]=s.x,O[8]=s.y,O},l.getImage=ga,l.getJSON=function(s,n){return Hs(rn(s,{type:"json"}),n)},l.getLatitudinalLod=function(s){const n=80.051129;s=Xe(s,-80.051129,n)/n*90;const o=Math.pow(Math.abs(Math.sin(vt(s))),3);return Math.round(o*(Ku.length-1))},l.getMapSessionAPI=ye,l.getPerformanceMeasurement=zt,l.getProjection=cT,l.getRTLTextPluginStatus=H,l.getReferrer=pa,l.getTilePoint=function(s,{x:n,y:o},c=0){return new ge(((n-c)*s.scale-s.x)*Zt,(o*s.scale-s.y)*Zt)},l.getTileVec3=function(s,n,o=0){return Nu(((n.x-o)*s.scale-s.x)*Zt,(n.y*s.scale-s.y)*Zt,Eb(n.z,n.y))},l.getVideo=function(s,n){const o=T.document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let c=0;c<s.length;c++){const d=T.document.createElement("source");Cl(s[c])||(o.crossOrigin="Anonymous"),d.src=s[c],o.appendChild(d)}return{cancel:()=>{}}},l.globeCenterToScreenPoint=function(s){const n=[0,0,0],o=lo(new Float64Array(16));return Fu(o,s.pixelMatrix,s.globeMatrix),Ii(n,n,o),new ge(n[0],n[1])},l.globeDenormalizeECEF=Ov,l.globeECEFOrigin=function(s,n){const o=[0,0,0];return Ii(o,o,_f(uo(n.canonical))),Ii(o,o,s),o},l.globeNormalizeECEF=_f,l.globePixelsToTileUnits=function(s,n){return Zt/(512*Math.pow(2,s))*Cg(uo(n))},l.globePoleMatrixForTile=function(s,n,o){const c=lo(new Float64Array(16)),d=(n/(1<<s)-.5)*Math.PI*2;return cg(c,o.globeMatrix,d),Float32Array.from(c)},l.globeTileBounds=uo,l.globeTiltAtLngLat=nT,l.globeToMercatorTransition=Qu,l.globeUseCustomAntiAliasing=function(s,n,o){const c=Qu(o.zoom),d=s.style.map._antialias,m=!!n.extStandardDerivatives,_=n.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return c===0&&!d&&!_&&m},l.identity=lo,l.identity$1=qb,l.invert=ov,l.isFullscreen=function(){return!!T.document.fullscreenElement||!!T.document.webkitFullscreenElement},l.isLngLatBehindGlobe=function(s,n){return nT(s,n)>Math.PI/2*1.01},l.isMapAuthenticated=function(s){return pe.has(s)},l.isMapboxURL=es,l.isSafariWithAntialiasingBug=function(s){const n=s.navigator?s.navigator.userAgent:null;return!!As(s)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},l.latFromMercatorY=er,l.latLngToECEF=mf,l.len=hM,l.length=Hd,l.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},l.lngFromMercatorX=ss,l.loadVectorTile=DT,l.makeRequest=Hs,l.mapValue=function(s,n,o,c,d){return Xe((s-n)/(o-n)*(d-c)+c,c,d)},l.mercatorScale=Ib,l.mercatorXfromLng=so,l.mercatorYfromLat=oo,l.mercatorZfromAltitude=ws,l.mul=cM,l.mul$1=uM,l.multiply=Fu,l.multiply$1=Ob,l.multiply$2=Ub,l.nextPowerOfTwo=bi,l.normalize=Sr,l.normalize$1=dM,l.normalize$2=Gb,l.number=En,l.ortho=function(s,n,o,c,d,m,_){var x=1/(n-o),w=1/(c-d),E=1/(m-_);return s[0]=-2*x,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*w,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*E,s[11]=0,s[12]=(n+o)*x,s[13]=(d+c)*w,s[14]=(_+m)*E,s[15]=1,s},l.pbf=hf,l.perspective=function(s,n,o,c,d){var m,_=1/Math.tan(n/2);return s[0]=_/o,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=_,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,d!=null&&d!==1/0?(s[10]=(d+c)*(m=1/(c-d)),s[14]=2*d*c*m):(s[10]=-1,s[14]=-2*c),s},l.pick=function(s,n){const o={};for(let c=0;c<n.length;c++){const d=n[c];d in s&&(o[d]=s[d])}return o},l.plugin=ce,l.pointGeometry=ge,l.polygonContainsPoint=ec,l.polygonIntersectsBox=Pb,l.polygonIntersectsPolygon=Cb,l.polygonizeBounds=function(s,n,o=0,c=!0){const d=new ge(o,o),m=s.sub(d),_=n.add(d),x=[m,new ge(_.x,m.y),_,new ge(m.x,_.y)];return c&&x.push(m.clone()),x},l.posAttributes=pf,l.postMapLoadEvent=Y,l.postPerformanceEvent=de,l.postTurnstileEvent=F,l.potpack=Iv,l.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},l.radToDeg=Ft,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(s){return s({pluginStatus:W,pluginURL:K}),Q.on("pluginStateChange",s),s},l.removeAuthState=function(s){pe.delete(s)},l.renderColorRamp=mv,l.resample=Sb,l.rotateX=av,l.rotateX$1=Wb,l.rotateY=cg,l.rotateY$1=Zb,l.rotateZ=function(s,n,o){var c=Math.sin(o),d=Math.cos(o),m=n[0],_=n[1],x=n[2],w=n[3],E=n[4],S=n[5],M=n[6],D=n[7];return n!==s&&(s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[0]=m*d+E*c,s[1]=_*d+S*c,s[2]=x*d+M*c,s[3]=w*d+D*c,s[4]=E*d-m*c,s[5]=S*d-_*c,s[6]=M*d-x*c,s[7]=D*d-w*c,s},l.rotateZ$1=function(s,n,o){o*=.5;var c=n[0],d=n[1],m=n[2],_=n[3],x=Math.sin(o),w=Math.cos(o);return s[0]=c*w+d*x,s[1]=d*w-c*x,s[2]=m*w+_*x,s[3]=_*w-m*x,s},l.scale=tc,l.scale$1=jb,l.scale$2=os,l.scaleAndAdd=Yd,l.set=function(s,n,o,c){return s[0]=n,s[1]=o,s[2]=c,s},l.setCacheLimits=function(s,n){ha=s,Il=n},l.setColumn=function(s,n,o){s[4*n+0]=o[0],s[4*n+1]=o[1],s[4*n+2]=o[2],s[4*n+3]=o[3]},l.setRTLTextPlugin=function(s,n,o=!1){if(W===L||W===N||W===G)throw new Error("setRTLTextPlugin cannot be called multiple times.");K=Sn.resolveURL(s),W=L,X=n,q(),o||le()},l.smoothstep=an,l.spec=De,l.squaredLength=function(s){var n=s[0],o=s[1],c=s[2];return n*n+o*o+c*c},l.storeAuthState=function(s,n){n?pe.add(s):pe.delete(s)},l.sub=Fs,l.subtract=cv,l.symbolSize=cD,l.tileAABB=function(s,n,o,c,d,m,_,x,w){if(w.name==="globe")return jD(s,n,new yg(o,c,d));const E=sc({z:o,x:c,y:d},w);return new Ar([(m+E.x/E.scale)*n,n*(E.y/E.scale),_],[(m+E.x2/E.scale)*n,n*(E.y2/E.scale),x])},l.tileCornersToBounds=Ag,l.tileTransform=sc,l.transformMat3=function(s,n,o){var c=n[0],d=n[1],m=n[2];return s[0]=c*o[0]+d*o[3]+m*o[6],s[1]=c*o[1]+d*o[4]+m*o[7],s[2]=c*o[2]+d*o[5]+m*o[8],s},l.transformMat4=Ii,l.transformMat4$1=nc,l.transformQuat=Vb,l.transitionTileAABBinECEF=Qw,l.translate=Zd,l.transpose=function(s,n){if(s===n){var o=n[1],c=n[2],d=n[5];s[1]=n[3],s[2]=n[6],s[3]=o,s[5]=n[7],s[6]=c,s[7]=d}else s[0]=n[0],s[1]=n[3],s[2]=n[6],s[3]=n[1],s[4]=n[4],s[5]=n[7],s[6]=n[2],s[7]=n[5],s[8]=n[8];return s},l.triggerPluginCompletionEvent=Z,l.uniqueId=ri,l.updateGlobeVertexNormal=function(s,n,o,c,d){const m=5*n+2;s.float32[m+0]=o,s.float32[m+1]=c,s.float32[m+2]=d},l.validateCustomStyleLayer=function(s){const n=[],o=s.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),s.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},l.validateFilter=s=>zs(ql(s)),l.validateFog=s=>zs(Bm(s)),l.validateLayer=s=>zs(zd(s)),l.validateLight=s=>zs(Wl(s)),l.validateSource=s=>zs(Au(s)),l.validateStyle=Fm,l.validateTerrain=s=>zs(Od(s)),l.values=ii,l.vectorTile=mg,l.version=A,l.warnOnce=xn,l.window=T,l.wrap=li}),f(["./shared"],function(l){function T(J){if(typeof J=="number"||typeof J=="boolean"||typeof J=="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){let V="[";for(const Y of J)V+=`${T(Y)},`;return`${V}]`}let F="{";for(const V of Object.keys(J).sort())F+=`${V}:${T(J[V])},`;return`${F}}`}function A(J){let F="";for(const V of l.refProperties)F+=`/${T(J[V])}`;return F}class R{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,V){for(const re of F)this._layerConfigs[re.id]=re,(this._layers[re.id]=l.createStyleLayer(re)).compileFilter(),this.keyCache[re.id]&&delete this.keyCache[re.id];for(const re of V)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const Y=function(re,de){const ve={};for(let pe=0;pe<re.length;pe++){const Te=de&&de[re[pe].id]||A(re[pe]);de&&(de[re[pe].id]=Te);let Ve=ve[Te];Ve||(Ve=ve[Te]=[]),Ve.push(re[pe])}const ye=[];for(const pe in ve)ye.push(ve[pe]);return ye}(l.values(this._layerConfigs),this.keyCache);for(const re of Y){const de=re.map(pt=>this._layers[pt.id]),ve=de[0];if(ve.visibility==="none")continue;const ye=ve.source||"";let pe=this.familiesBySource[ye];pe||(pe=this.familiesBySource[ye]={});const Te=ve.sourceLayer||"_geojsonTileLayer";let Ve=pe[Te];Ve||(Ve=pe[Te]=[]),Ve.push(de)}}}class z{loadTile(F,V){const{uid:Y,encoding:re,rawImageData:de,padding:ve,buildQuadTree:ye}=F,pe=l.window.ImageBitmap&&de instanceof l.window.ImageBitmap?this.getImageData(de,ve):de;V(null,new l.DEMData(Y,pe,re,ve<1,ye))}getImageData(F,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(F.width,F.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=F.width,this.offscreenCanvas.height=F.height,this.offscreenCanvasContext.drawImage(F,0,0,F.width,F.height);const Y=this.offscreenCanvasContext.getImageData(-V,-V,F.width+2*V,F.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Y}}var j=function J(F,V){var Y,re=F&&F.type;if(re==="FeatureCollection")for(Y=0;Y<F.features.length;Y++)J(F.features[Y],V);else if(re==="GeometryCollection")for(Y=0;Y<F.geometries.length;Y++)J(F.geometries[Y],V);else if(re==="Feature")J(F.geometry,V);else if(re==="Polygon")ee(F.coordinates,V);else if(re==="MultiPolygon")for(Y=0;Y<F.coordinates.length;Y++)ee(F.coordinates[Y],V);return F};function ee(J,F){if(J.length!==0){se(J[0],F);for(var V=1;V<J.length;V++)se(J[V],!F)}}function se(J,F){for(var V=0,Y=0,re=0,de=J.length,ve=de-1;re<de;ve=re++){var ye=(J[re][0]-J[ve][0])*(J[ve][1]+J[re][1]),pe=V+ye;Y+=Math.abs(V)>=Math.abs(ye)?V-pe+ye:ye-pe+V,V=pe}V+Y>=0!=!!F&&J.reverse()}const be=l.VectorTileFeature.prototype.toGeoJSON;class Re{constructor(F){this._feature=F,this.extent=l.EXTENT,this.type=F.type,this.properties=F.tags,"id"in F&&!isNaN(F.id)&&(this.id=parseInt(F.id,10))}loadGeometry(){if(this._feature.type===1){const F=[];for(const V of this._feature.geometry)F.push([new l.pointGeometry(V[0],V[1])]);return F}{const F=[];for(const V of this._feature.geometry){const Y=[];for(const re of V)Y.push(new l.pointGeometry(re[0],re[1]));F.push(Y)}return F}}toGeoJSON(F,V,Y){return be.call(this,F,V,Y)}}class Ge{constructor(F){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=F.length,this._features=F}feature(F){return new Re(this._features[F])}}var it={exports:{}},dt=l.pointGeometry,Ue=l.vectorTile.VectorTileFeature,ge=Ke;function Ke(J,F){this.options=F||{},this.features=J,this.length=J.length}function He(J,F){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=F||4096}Ke.prototype.feature=function(J){return new He(this.features[J],this.options.extent)},He.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var F=0;F<J.length;F++){for(var V=J[F],Y=[],re=0;re<V.length;re++)Y.push(new dt(V[re][0],V[re][1]));this.geometry.push(Y)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,F=1/0,V=-1/0,Y=1/0,re=-1/0,de=0;de<J.length;de++)for(var ve=J[de],ye=0;ye<ve.length;ye++){var pe=ve[ye];F=Math.min(F,pe.x),V=Math.max(V,pe.x),Y=Math.min(Y,pe.y),re=Math.max(re,pe.y)}return[F,Y,V,re]},He.prototype.toGeoJSON=Ue.prototype.toGeoJSON;var en=l.pbf,vt=ge;function Ft(J){var F=new en;return function(V,Y){for(var re in V.layers)Y.writeMessage(3,Lt,V.layers[re])}(J,F),F.finish()}function Lt(J,F){var V;F.writeVarintField(15,J.version||1),F.writeStringField(1,J.name||""),F.writeVarintField(5,J.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<J.length;V++)Y.feature=J.feature(V),F.writeMessage(2,kt,Y);var re=Y.keys;for(V=0;V<re.length;V++)F.writeStringField(3,re[V]);var de=Y.values;for(V=0;V<de.length;V++)F.writeMessage(4,li,de[V])}function kt(J,F){var V=J.feature;V.id!==void 0&&F.writeVarintField(1,V.id),F.writeMessage(2,Qt,J),F.writeVarintField(3,V.type),F.writeMessage(4,an,V)}function Qt(J,F){var V=J.feature,Y=J.keys,re=J.values,de=J.keycache,ve=J.valuecache;for(var ye in V.properties){var pe=V.properties[ye],Te=de[ye];if(pe!==null){Te===void 0&&(Y.push(ye),de[ye]=Te=Y.length-1),F.writeVarint(Te);var Ve=typeof pe;Ve!=="string"&&Ve!=="boolean"&&Ve!=="number"&&(pe=JSON.stringify(pe));var pt=Ve+":"+pe,$e=ve[pt];$e===void 0&&(re.push(pe),ve[pt]=$e=re.length-1),F.writeVarint($e)}}}function lt(J,F){return(F<<3)+(7&J)}function Xe(J){return J<<1^J>>31}function an(J,F){for(var V=J.loadGeometry(),Y=J.type,re=0,de=0,ve=V.length,ye=0;ye<ve;ye++){var pe=V[ye],Te=1;Y===1&&(Te=pe.length),F.writeVarint(lt(1,Te));for(var Ve=Y===3?pe.length-1:pe.length,pt=0;pt<Ve;pt++){pt===1&&Y!==1&&F.writeVarint(lt(2,Ve-1));var $e=pe[pt].x-re,zt=pe[pt].y-de;F.writeVarint(Xe($e)),F.writeVarint(Xe(zt)),re+=$e,de+=zt}Y===3&&F.writeVarint(lt(7,1))}}function li(J,F){var V=typeof J;V==="string"?F.writeStringField(1,J):V==="boolean"?F.writeBooleanField(7,J):V==="number"&&(J%1!=0?F.writeDoubleField(3,J):J<0?F.writeSVarintField(6,J):F.writeVarintField(5,J))}function ni(J,F,V,Y,re,de){if(re-Y<=V)return;const ve=Y+re>>1;ii(J,F,ve,Y,re,de%2),ni(J,F,V,Y,ve-1,de+1),ni(J,F,V,ve+1,re,de+1)}function ii(J,F,V,Y,re,de){for(;re>Y;){if(re-Y>600){const Te=re-Y+1,Ve=V-Y+1,pt=Math.log(Te),$e=.5*Math.exp(2*pt/3),zt=.5*Math.sqrt(pt*$e*(Te-$e)/Te)*(Ve-Te/2<0?-1:1);ii(J,F,V,Math.max(Y,Math.floor(V-Ve*$e/Te+zt)),Math.min(re,Math.floor(V+(Te-Ve)*$e/Te+zt)),de)}const ve=F[2*V+de];let ye=Y,pe=re;for(rn(J,F,Y,V),F[2*re+de]>ve&&rn(J,F,Y,re);ye<pe;){for(rn(J,F,ye,pe),ye++,pe--;F[2*ye+de]<ve;)ye++;for(;F[2*pe+de]>ve;)pe--}F[2*Y+de]===ve?rn(J,F,Y,pe):(pe++,rn(J,F,pe,re)),pe<=V&&(Y=pe+1),V<=pe&&(re=pe-1)}}function rn(J,F,V,Y){It(J,V,Y),It(F,2*V,2*Y),It(F,2*V+1,2*Y+1)}function It(J,F,V){const Y=J[F];J[F]=J[V],J[V]=Y}function ri(J,F,V,Y){const re=J-V,de=F-Y;return re*re+de*de}it.exports=Ft,it.exports.fromVectorTileJs=Ft,it.exports.fromGeojsonVt=function(J,F){F=F||{};var V={};for(var Y in J)V[Y]=new vt(J[Y].features,F),V[Y].name=Y,V[Y].version=F.version,V[Y].extent=F.extent;return Ft({layers:V})},it.exports.GeoJSONWrapper=vt;const Tn=J=>J[0],bi=J=>J[1];class et{constructor(F,V=Tn,Y=bi,re=64,de=Float64Array){this.nodeSize=re,this.points=F;const ve=F.length<65536?Uint16Array:Uint32Array,ye=this.ids=new ve(F.length),pe=this.coords=new de(2*F.length);for(let Te=0;Te<F.length;Te++)ye[Te]=Te,pe[2*Te]=V(F[Te]),pe[2*Te+1]=Y(F[Te]);ni(ye,pe,re,0,ye.length-1,0)}range(F,V,Y,re){return function(de,ve,ye,pe,Te,Ve,pt){const $e=[0,de.length-1,0],zt=[];let Rt,Mt;for(;$e.length;){const Wt=$e.pop(),sn=$e.pop(),Sn=$e.pop();if(sn-Sn<=pt){for(let Fn=Sn;Fn<=sn;Fn++)Rt=ve[2*Fn],Mt=ve[2*Fn+1],Rt>=ye&&Rt<=Te&&Mt>=pe&&Mt<=Ve&&zt.push(de[Fn]);continue}const Ut=Math.floor((Sn+sn)/2);Rt=ve[2*Ut],Mt=ve[2*Ut+1],Rt>=ye&&Rt<=Te&&Mt>=pe&&Mt<=Ve&&zt.push(de[Ut]);const Bn=(Wt+1)%2;(Wt===0?ye<=Rt:pe<=Mt)&&($e.push(Sn),$e.push(Ut-1),$e.push(Bn)),(Wt===0?Te>=Rt:Ve>=Mt)&&($e.push(Ut+1),$e.push(sn),$e.push(Bn))}return zt}(this.ids,this.coords,F,V,Y,re,this.nodeSize)}within(F,V,Y){return function(re,de,ve,ye,pe,Te){const Ve=[0,re.length-1,0],pt=[],$e=pe*pe;for(;Ve.length;){const zt=Ve.pop(),Rt=Ve.pop(),Mt=Ve.pop();if(Rt-Mt<=Te){for(let Bn=Mt;Bn<=Rt;Bn++)ri(de[2*Bn],de[2*Bn+1],ve,ye)<=$e&&pt.push(re[Bn]);continue}const Wt=Math.floor((Mt+Rt)/2),sn=de[2*Wt],Sn=de[2*Wt+1];ri(sn,Sn,ve,ye)<=$e&&pt.push(re[Wt]);const Ut=(zt+1)%2;(zt===0?ve-pe<=sn:ye-pe<=Sn)&&(Ve.push(Mt),Ve.push(Wt-1),Ve.push(Ut)),(zt===0?ve+pe>=sn:ye+pe>=Sn)&&(Ve.push(Wt+1),Ve.push(Rt),Ve.push(Ut))}return pt}(this.ids,this.coords,F,V,Y,this.nodeSize)}}const Nt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},vn=Math.fround||(Hn=new Float32Array(1),J=>(Hn[0]=+J,Hn[0]));var Hn;class Vr{constructor(F){this.options=jr(Object.create(Nt),F),this.trees=new Array(this.options.maxZoom+1)}load(F){const{log:V,minZoom:Y,maxZoom:re,nodeSize:de}=this.options;V&&console.time("total time");const ve=`prepare ${F.length} points`;V&&console.time(ve),this.points=F;let ye=[];for(let pe=0;pe<F.length;pe++)F[pe].geometry&&ye.push(ar(F[pe],pe));this.trees[re+1]=new et(ye,As,qs,de,Float32Array),V&&console.timeEnd(ve);for(let pe=re;pe>=Y;pe--){const Te=+Date.now();ye=this._cluster(ye,pe),this.trees[pe]=new et(ye,As,qs,de,Float32Array),V&&console.log("z%d: %d clusters in %dms",pe,ye.length,+Date.now()-Te)}return V&&console.timeEnd("total time"),this}getClusters(F,V){let Y=((F[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,F[1]));let de=F[2]===180?180:((F[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)Y=-180,de=180;else if(Y>de){const Ve=this.getClusters([Y,re,180,ve],V),pt=this.getClusters([-180,re,de,ve],V);return Ve.concat(pt)}const ye=this.trees[this._limitZoom(V)],pe=ye.range(mn(Y),br(ve),mn(de),br(re)),Te=[];for(const Ve of pe){const pt=ye.points[Ve];Te.push(pt.numPoints?xn(pt):this.points[pt.index])}return Te}getChildren(F){const V=this._getOriginId(F),Y=this._getOriginZoom(F),re="No cluster with the specified id.",de=this.trees[Y];if(!de)throw new Error(re);const ve=de.points[V];if(!ve)throw new Error(re);const ye=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),pe=de.within(ve.x,ve.y,ye),Te=[];for(const Ve of pe){const pt=de.points[Ve];pt.parentId===F&&Te.push(pt.numPoints?xn(pt):this.points[pt.index])}if(Te.length===0)throw new Error(re);return Te}getLeaves(F,V,Y){const re=[];return this._appendLeaves(re,F,V=V||10,Y=Y||0,0),re}getTile(F,V,Y){const re=this.trees[this._limitZoom(F)],de=Math.pow(2,F),{extent:ve,radius:ye}=this.options,pe=ye/ve,Te=(Y-pe)/de,Ve=(Y+1+pe)/de,pt={features:[]};return this._addTileFeatures(re.range((V-pe)/de,Te,(V+1+pe)/de,Ve),re.points,V,Y,de,pt),V===0&&this._addTileFeatures(re.range(1-pe/de,Te,1,Ve),re.points,de,Y,de,pt),V===de-1&&this._addTileFeatures(re.range(0,Te,pe/de,Ve),re.points,-1,Y,de,pt),pt.features.length?pt:null}getClusterExpansionZoom(F){let V=this._getOriginZoom(F)-1;for(;V<=this.options.maxZoom;){const Y=this.getChildren(F);if(V++,Y.length!==1)break;F=Y[0].properties.cluster_id}return V}_appendLeaves(F,V,Y,re,de){const ve=this.getChildren(V);for(const ye of ve){const pe=ye.properties;if(pe&&pe.cluster?de+pe.point_count<=re?de+=pe.point_count:de=this._appendLeaves(F,pe.cluster_id,Y,re,de):de<re?de++:F.push(ye),F.length===Y)break}return de}_addTileFeatures(F,V,Y,re,de,ve){for(const ye of F){const pe=V[ye],Te=pe.numPoints;let Ve,pt,$e;if(Te)Ve=xr(pe),pt=pe.x,$e=pe.y;else{const Mt=this.points[pe.index];Ve=Mt.properties,pt=mn(Mt.geometry.coordinates[0]),$e=br(Mt.geometry.coordinates[1])}const zt={type:1,geometry:[[Math.round(this.options.extent*(pt*de-Y)),Math.round(this.options.extent*($e*de-re))]],tags:Ve};let Rt;Te?Rt=pe.id:this.options.generateId?Rt=pe.index:this.points[pe.index].id&&(Rt=this.points[pe.index].id),Rt!==void 0&&(zt.id=Rt),ve.features.push(zt)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,V){const Y=[],{radius:re,extent:de,reduce:ve,minPoints:ye}=this.options,pe=re/(de*Math.pow(2,V));for(let Te=0;Te<F.length;Te++){const Ve=F[Te];if(Ve.zoom<=V)continue;Ve.zoom=V;const pt=this.trees[V+1],$e=pt.within(Ve.x,Ve.y,pe),zt=Ve.numPoints||1;let Rt=zt;for(const Mt of $e){const Wt=pt.points[Mt];Wt.zoom>V&&(Rt+=Wt.numPoints||1)}if(Rt>zt&&Rt>=ye){let Mt=Ve.x*zt,Wt=Ve.y*zt,sn=ve&&zt>1?this._map(Ve,!0):null;const Sn=(Te<<5)+(V+1)+this.points.length;for(const Ut of $e){const Bn=pt.points[Ut];if(Bn.zoom<=V)continue;Bn.zoom=V;const Fn=Bn.numPoints||1;Mt+=Bn.x*Fn,Wt+=Bn.y*Fn,Bn.parentId=Sn,ve&&(sn||(sn=this._map(Ve,!0)),ve(sn,this._map(Bn)))}Ve.parentId=Sn,Y.push(wi(Mt/Rt,Wt/Rt,Sn,Rt,sn))}else if(Y.push(Ve),Rt>1)for(const Mt of $e){const Wt=pt.points[Mt];Wt.zoom<=V||(Wt.zoom=V,Y.push(Wt))}}return Y}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,V){if(F.numPoints)return V?jr({},F.properties):F.properties;const Y=this.points[F.index].properties,re=this.options.map(Y);return V&&re===Y?jr({},re):re}}function wi(J,F,V,Y,re){return{x:vn(J),y:vn(F),zoom:1/0,id:V,parentId:-1,numPoints:Y,properties:re}}function ar(J,F){const[V,Y]=J.geometry.coordinates;return{x:vn(mn(V)),y:vn(br(Y)),zoom:1/0,index:F,parentId:-1}}function xn(J){return{type:"Feature",id:J.id,properties:xr(J),geometry:{type:"Point",coordinates:[(F=J.x,360*(F-.5)),$s(J.y)]}};var F}function xr(J){const F=J.numPoints,V=F>=1e4?`${Math.round(F/1e3)}k`:F>=1e3?Math.round(F/100)/10+"k":F;return jr(jr({},J.properties),{cluster:!0,cluster_id:J.id,point_count:F,point_count_abbreviated:V})}function mn(J){return J/360+.5}function br(J){const F=Math.sin(J*Math.PI/180),V=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return V<0?0:V>1?1:V}function $s(J){const F=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function jr(J,F){for(const V in F)J[V]=F[V];return J}function As(J){return J.x}function qs(J){return J.y}function Jr(J,F,V,Y){for(var re,de=Y,ve=V-F>>1,ye=V-F,pe=J[F],Te=J[F+1],Ve=J[V],pt=J[V+1],$e=F+3;$e<V;$e+=3){var zt=So(J[$e],J[$e+1],pe,Te,Ve,pt);if(zt>de)re=$e,de=zt;else if(zt===de){var Rt=Math.abs($e-ve);Rt<ye&&(re=$e,ye=Rt)}}de>Y&&(re-F>3&&Jr(J,F,re,Y),J[re+2]=de,V-re>3&&Jr(J,re,V,Y))}function So(J,F,V,Y,re,de){var ve=re-V,ye=de-Y;if(ve!==0||ye!==0){var pe=((J-V)*ve+(F-Y)*ye)/(ve*ve+ye*ye);pe>1?(V=re,Y=de):pe>0&&(V+=ve*pe,Y+=ye*pe)}return(ve=J-V)*ve+(ye=F-Y)*ye}function lr(J,F,V,Y){var re={id:J===void 0?null:J,type:F,geometry:V,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var ve=de.geometry,ye=de.type;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ws(de,ve);else if(ye==="Polygon"||ye==="MultiLineString")for(var pe=0;pe<ve.length;pe++)Ws(de,ve[pe]);else if(ye==="MultiPolygon")for(pe=0;pe<ve.length;pe++)for(var Te=0;Te<ve[pe].length;Te++)Ws(de,ve[pe][Te])}(re),re}function Ws(J,F){for(var V=0;V<F.length;V+=3)J.minX=Math.min(J.minX,F[V]),J.minY=Math.min(J.minY,F[V+1]),J.maxX=Math.max(J.maxX,F[V]),J.maxY=Math.max(J.maxY,F[V+1])}function ha(J,F,V,Y){if(F.geometry){var re=F.geometry.coordinates,de=F.geometry.type,ve=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),ye=[],pe=F.id;if(V.promoteId?pe=F.properties[V.promoteId]:V.generateId&&(pe=Y||0),de==="Point")Il(re,ye);else if(de==="MultiPoint")for(var Te=0;Te<re.length;Te++)Il(re[Te],ye);else if(de==="LineString")da(re,ye,ve,!1);else if(de==="MultiLineString"){if(V.lineMetrics){for(Te=0;Te<re.length;Te++)da(re[Te],ye=[],ve,!1),J.push(lr(pe,"LineString",ye,F.properties));return}Zs(re,ye,ve,!1)}else if(de==="Polygon")Zs(re,ye,ve,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(Te=0;Te<F.geometry.geometries.length;Te++)ha(J,{id:pe,geometry:F.geometry.geometries[Te],properties:F.properties},V,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Te=0;Te<re.length;Te++){var Ve=[];Zs(re[Te],Ve,ve,!0),ye.push(Ve)}}J.push(lr(pe,de,ye,F.properties))}}function Il(J,F){F.push(Sl(J[0])),F.push(fa(J[1])),F.push(0)}function da(J,F,V,Y){for(var re,de,ve=0,ye=0;ye<J.length;ye++){var pe=Sl(J[ye][0]),Te=fa(J[ye][1]);F.push(pe),F.push(Te),F.push(0),ye>0&&(ve+=Y?(re*Te-pe*de)/2:Math.sqrt(Math.pow(pe-re,2)+Math.pow(Te-de,2))),re=pe,de=Te}var Ve=F.length-3;F[2]=1,Jr(F,0,Ve,V),F[Ve+2]=1,F.size=Math.abs(ve),F.start=0,F.end=F.size}function Zs(J,F,V,Y){for(var re=0;re<J.length;re++){var de=[];da(J[re],de,V,Y),F.push(de)}}function Sl(J){return J/360+.5}function fa(J){var F=Math.sin(J*Math.PI/180),V=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return V<0?0:V>1?1:V}function Rr(J,F,V,Y,re,de,ve,ye){if(Y/=F,de>=(V/=F)&&ve<Y)return J;if(ve<V||de>=Y)return null;for(var pe=[],Te=0;Te<J.length;Te++){var Ve=J[Te],pt=Ve.geometry,$e=Ve.type,zt=re===0?Ve.minX:Ve.minY,Rt=re===0?Ve.maxX:Ve.maxY;if(zt>=V&&Rt<Y)pe.push(Ve);else if(!(Rt<V||zt>=Y)){var Mt=[];if($e==="Point"||$e==="MultiPoint")Al(pt,Mt,V,Y,re);else if($e==="LineString")pa(pt,Mt,V,Y,re,!1,ye.lineMetrics);else if($e==="MultiLineString")Xs(pt,Mt,V,Y,re,!1);else if($e==="Polygon")Xs(pt,Mt,V,Y,re,!0);else if($e==="MultiPolygon")for(var Wt=0;Wt<pt.length;Wt++){var sn=[];Xs(pt[Wt],sn,V,Y,re,!0),sn.length&&Mt.push(sn)}if(Mt.length){if(ye.lineMetrics&&$e==="LineString"){for(Wt=0;Wt<Mt.length;Wt++)pe.push(lr(Ve.id,$e,Mt[Wt],Ve.tags));continue}$e!=="LineString"&&$e!=="MultiLineString"||(Mt.length===1?($e="LineString",Mt=Mt[0]):$e="MultiLineString"),$e!=="Point"&&$e!=="MultiPoint"||($e=Mt.length===3?"Point":"MultiPoint"),pe.push(lr(Ve.id,$e,Mt,Ve.tags))}}}return pe.length?pe:null}function Al(J,F,V,Y,re){for(var de=0;de<J.length;de+=3){var ve=J[de+re];ve>=V&&ve<=Y&&(F.push(J[de]),F.push(J[de+1]),F.push(J[de+2]))}}function pa(J,F,V,Y,re,de,ve){for(var ye,pe,Te=Hs(J),Ve=re===0?Hc:ma,pt=J.start,$e=0;$e<J.length-3;$e+=3){var zt=J[$e],Rt=J[$e+1],Mt=J[$e+2],Wt=J[$e+3],sn=J[$e+4],Sn=re===0?zt:Rt,Ut=re===0?Wt:sn,Bn=!1;ve&&(ye=Math.sqrt(Math.pow(zt-Wt,2)+Math.pow(Rt-sn,2))),Sn<V?Ut>V&&(pe=Ve(Te,zt,Rt,Wt,sn,V),ve&&(Te.start=pt+ye*pe)):Sn>Y?Ut<Y&&(pe=Ve(Te,zt,Rt,Wt,sn,Y),ve&&(Te.start=pt+ye*pe)):Cl(Te,zt,Rt,Mt),Ut<V&&Sn>=V&&(pe=Ve(Te,zt,Rt,Wt,sn,V),Bn=!0),Ut>Y&&Sn<=Y&&(pe=Ve(Te,zt,Rt,Wt,sn,Y),Bn=!0),!de&&Bn&&(ve&&(Te.end=pt+ye*pe),F.push(Te),Te=Hs(J)),ve&&(pt+=ye)}var Fn=J.length-3;zt=J[Fn],Rt=J[Fn+1],Mt=J[Fn+2],(Sn=re===0?zt:Rt)>=V&&Sn<=Y&&Cl(Te,zt,Rt,Mt),Fn=Te.length-3,de&&Fn>=3&&(Te[Fn]!==Te[0]||Te[Fn+1]!==Te[1])&&Cl(Te,Te[0],Te[1],Te[2]),Te.length&&F.push(Te)}function Hs(J){var F=[];return F.size=J.size,F.start=J.start,F.end=J.end,F}function Xs(J,F,V,Y,re,de){for(var ve=0;ve<J.length;ve++)pa(J[ve],F,V,Y,re,de,!1)}function Cl(J,F,V,Y){J.push(F),J.push(V),J.push(Y)}function Hc(J,F,V,Y,re,de){var ve=(de-F)/(Y-F);return J.push(de),J.push(V+(re-V)*ve),J.push(1),ve}function ma(J,F,V,Y,re,de){var ve=(de-V)/(re-V);return J.push(F+(Y-F)*ve),J.push(de),J.push(1),ve}function Ks(J,F){for(var V=[],Y=0;Y<J.length;Y++){var re,de=J[Y],ve=de.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")re=ga(de.geometry,F);else if(ve==="MultiLineString"||ve==="Polygon"){re=[];for(var ye=0;ye<de.geometry.length;ye++)re.push(ga(de.geometry[ye],F))}else if(ve==="MultiPolygon")for(re=[],ye=0;ye<de.geometry.length;ye++){for(var pe=[],Te=0;Te<de.geometry[ye].length;Te++)pe.push(ga(de.geometry[ye][Te],F));re.push(pe)}V.push(lr(de.id,ve,re,de.tags))}return V}function ga(J,F){var V=[];V.size=J.size,J.start!==void 0&&(V.start=J.start,V.end=J.end);for(var Y=0;Y<J.length;Y+=3)V.push(J[Y]+F,J[Y+1],J[Y+2]);return V}function _a(J,F){if(J.transformed)return J;var V,Y,re,de=1<<J.z,ve=J.x,ye=J.y;for(V=0;V<J.features.length;V++){var pe=J.features[V],Te=pe.geometry,Ve=pe.type;if(pe.geometry=[],Ve===1)for(Y=0;Y<Te.length;Y+=2)pe.geometry.push(es(Te[Y],Te[Y+1],F,de,ve,ye));else for(Y=0;Y<Te.length;Y++){var pt=[];for(re=0;re<Te[Y].length;re+=2)pt.push(es(Te[Y][re],Te[Y][re+1],F,de,ve,ye));pe.geometry.push(pt)}}return J.transformed=!0,J}function es(J,F,V,Y,re,de){return[Math.round(V*(J*Y-re)),Math.round(V*(F*Y-de))]}function ya(J,F,V,Y,re){for(var de=F===re.maxZoom?0:re.tolerance/((1<<F)*re.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:Y,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ye=0;ye<J.length;ye++){ve.numFeatures++,Xc(ve,J[ye],de,re);var pe=J[ye].minX,Te=J[ye].minY,Ve=J[ye].maxX,pt=J[ye].maxY;pe<ve.minX&&(ve.minX=pe),Te<ve.minY&&(ve.minY=Te),Ve>ve.maxX&&(ve.maxX=Ve),pt>ve.maxY&&(ve.maxY=pt)}return ve}function Xc(J,F,V,Y){var re=F.geometry,de=F.type,ve=[];if(de==="Point"||de==="MultiPoint")for(var ye=0;ye<re.length;ye+=3)ve.push(re[ye]),ve.push(re[ye+1]),J.numPoints++,J.numSimplified++;else if(de==="LineString")va(ve,re,J,V,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(ye=0;ye<re.length;ye++)va(ve,re[ye],J,V,de==="Polygon",ye===0);else if(de==="MultiPolygon")for(var pe=0;pe<re.length;pe++){var Te=re[pe];for(ye=0;ye<Te.length;ye++)va(ve,Te[ye],J,V,!0,ye===0)}if(ve.length){var Ve=F.tags||null;if(de==="LineString"&&Y.lineMetrics){for(var pt in Ve={},F.tags)Ve[pt]=F.tags[pt];Ve.mapbox_clip_start=re.start/re.size,Ve.mapbox_clip_end=re.end/re.size}var $e={geometry:ve,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Ve};F.id!==null&&($e.id=F.id),J.features.push($e)}}function va(J,F,V,Y,re,de){var ve=Y*Y;if(Y>0&&F.size<(re?ve:Y))V.numPoints+=F.length/3;else{for(var ye=[],pe=0;pe<F.length;pe+=3)(Y===0||F[pe+2]>ve)&&(V.numSimplified++,ye.push(F[pe]),ye.push(F[pe+1])),V.numPoints++;re&&function(Te,Ve){for(var pt=0,$e=0,zt=Te.length,Rt=zt-2;$e<zt;Rt=$e,$e+=2)pt+=(Te[$e]-Te[Rt])*(Te[$e+1]+Te[Rt+1]);if(pt>0===Ve)for($e=0,zt=Te.length;$e<zt/2;$e+=2){var Mt=Te[$e],Wt=Te[$e+1];Te[$e]=Te[zt-2-$e],Te[$e+1]=Te[zt-1-$e],Te[zt-2-$e]=Mt,Te[zt-1-$e]=Wt}}(ye,de),J.push(ye)}}function xa(J,F){var V=(F=this.options=function(re,de){for(var ve in de)re[ve]=de[ve];return re}(Object.create(this.options),F)).debug;if(V&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(re,de){var ve=[];if(re.type==="FeatureCollection")for(var ye=0;ye<re.features.length;ye++)ha(ve,re.features[ye],de,ye);else ha(ve,re.type==="Feature"?re:{geometry:re},de);return ve}(J,F);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(re,de){var ve=de.buffer/de.extent,ye=re,pe=Rr(re,1,-1-ve,ve,0,-1,2,de),Te=Rr(re,1,1-ve,2+ve,0,-1,2,de);return(pe||Te)&&(ye=Rr(re,1,-ve,1+ve,0,-1,2,de)||[],pe&&(ye=Ks(pe,1).concat(ye)),Te&&(ye=ye.concat(Ks(Te,-1)))),ye}(Y,F),Y.length&&this.splitTile(Y,0,0,0),V&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function wr(J,F,V){return 32*((1<<J)*V+F)+J}function Ao(J,F){const V=J.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);const Y=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!Y)return F(null,null);const re=new Ge(Y.features);let de=it.exports(re);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),F(null,{vectorTile:re,rawData:de.buffer})}xa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},xa.prototype.splitTile=function(J,F,V,Y,re,de,ve){for(var ye=[J,F,V,Y],pe=this.options,Te=pe.debug;ye.length;){Y=ye.pop(),V=ye.pop(),F=ye.pop(),J=ye.pop();var Ve=1<<F,pt=wr(F,V,Y),$e=this.tiles[pt];if(!$e&&(Te>1&&console.time("creation"),$e=this.tiles[pt]=ya(J,F,V,Y,pe),this.tileCoords.push({z:F,x:V,y:Y}),Te)){Te>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,V,Y,$e.numFeatures,$e.numPoints,$e.numSimplified),console.timeEnd("creation"));var zt="z"+F;this.stats[zt]=(this.stats[zt]||0)+1,this.total++}if($e.source=J,re){if(F===pe.maxZoom||F===re)continue;var Rt=1<<re-F;if(V!==Math.floor(de/Rt)||Y!==Math.floor(ve/Rt))continue}else if(F===pe.indexMaxZoom||$e.numPoints<=pe.indexMaxPoints)continue;if($e.source=null,J.length!==0){Te>1&&console.time("clipping");var Mt,Wt,sn,Sn,Ut,Bn,Fn=.5*pe.buffer/pe.extent,Ys=.5-Fn,Cs=.5+Fn,De=1+Fn;Mt=Wt=sn=Sn=null,Ut=Rr(J,Ve,V-Fn,V+Cs,0,$e.minX,$e.maxX,pe),Bn=Rr(J,Ve,V+Ys,V+De,0,$e.minX,$e.maxX,pe),J=null,Ut&&(Mt=Rr(Ut,Ve,Y-Fn,Y+Cs,1,$e.minY,$e.maxY,pe),Wt=Rr(Ut,Ve,Y+Ys,Y+De,1,$e.minY,$e.maxY,pe),Ut=null),Bn&&(sn=Rr(Bn,Ve,Y-Fn,Y+Cs,1,$e.minY,$e.maxY,pe),Sn=Rr(Bn,Ve,Y+Ys,Y+De,1,$e.minY,$e.maxY,pe),Bn=null),Te>1&&console.timeEnd("clipping"),ye.push(Mt||[],F+1,2*V,2*Y),ye.push(Wt||[],F+1,2*V,2*Y+1),ye.push(sn||[],F+1,2*V+1,2*Y),ye.push(Sn||[],F+1,2*V+1,2*Y+1)}}},xa.prototype.getTile=function(J,F,V){var Y=this.options,re=Y.extent,de=Y.debug;if(J<0||J>24)return null;var ve=1<<J,ye=wr(J,F=(F%ve+ve)%ve,V);if(this.tiles[ye])return _a(this.tiles[ye],re);de>1&&console.log("drilling down to z%d-%d-%d",J,F,V);for(var pe,Te=J,Ve=F,pt=V;!pe&&Te>0;)Te--,Ve=Math.floor(Ve/2),pt=Math.floor(pt/2),pe=this.tiles[wr(Te,Ve,pt)];return pe&&pe.source?(de>1&&console.log("found parent tile z%d-%d-%d",Te,Ve,pt),de>1&&console.time("drilling down"),this.splitTile(pe.source,Te,Ve,pt,J,F,V),de>1&&console.timeEnd("drilling down"),this.tiles[ye]?_a(this.tiles[ye],re):null):null};class kl extends l.VectorTileWorkerSource{constructor(F,V,Y,re,de){super(F,V,Y,re,Ao),de&&(this.loadGeoJSON=de)}loadData(F,V){const Y=F&&F.request,re=Y&&Y.collectResourceTiming;this.loadGeoJSON(F,(de,ve)=>{if(de||!ve)return V(de);if(typeof ve!="object")return V(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));{j(ve,!0);try{if(F.filter){const pe=l.createExpression(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));ve={type:"FeatureCollection",features:ve.features.filter(Ve=>pe.value.evaluate({zoom:0},Ve))}}this._geoJSONIndex=F.cluster?new Vr(function({superclusterOptions:pe,clusterProperties:Te}){if(!Te||!pe)return pe;const Ve={},pt={},$e={accumulated:null,zoom:0},zt={properties:null},Rt=Object.keys(Te);for(const Mt of Rt){const[Wt,sn]=Te[Mt],Sn=l.createExpression(sn),Ut=l.createExpression(typeof Wt=="string"?[Wt,["accumulated"],["get",Mt]]:Wt);Ve[Mt]=Sn.value,pt[Mt]=Ut.value}return pe.map=Mt=>{zt.properties=Mt;const Wt={};for(const sn of Rt)Wt[sn]=Ve[sn].evaluate($e,zt);return Wt},pe.reduce=(Mt,Wt)=>{zt.properties=Wt;for(const sn of Rt)$e.accumulated=Mt[sn],Mt[sn]=pt[sn].evaluate($e,zt)},pe}(F)).load(ve.features):function(pe,Te){return new xa(pe,Te)}(ve,F.geojsonVtOptions)}catch(pe){return V(pe)}this.loaded={};const ye={};if(re){const pe=l.getPerformanceMeasurement(Y);pe&&(ye.resourceTiming={},ye.resourceTiming[F.source]=JSON.parse(JSON.stringify(pe)))}V(null,ye)}})}reloadTile(F,V){const Y=this.loaded;return Y&&Y[F.uid]?super.reloadTile(F,V):this.loadTile(F,V)}loadGeoJSON(F,V){if(F.request)l.getJSON(F.request,V);else{if(typeof F.data!="string")return V(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(F.data))}catch{return V(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(F,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(Y){V(Y)}}getClusterChildren(F,V){try{V(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(Y){V(Y)}}getClusterLeaves(F,V){try{V(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(Y){V(Y)}}}class Co{constructor(F){this.self=F,this.actor=new l.Actor(F,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:kl},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,Y)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=Y},this.self.registerRTLTextPlugin=V=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=V.applyArabicShaping,l.plugin.processBidirectionalText=V.processBidirectionalText,l.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(F,V,Y){delete this.layerIndexes[F],delete this.availableImages[F],delete this.workerSources[F],delete this.demWorkerSources[F],Y()}checkIfReady(F,V,Y){Y()}setReferrer(F,V){this.referrer=V}spriteLoaded(F,V){this.isSpriteLoaded[F]=V;for(const Y in this.workerSources[F]){const re=this.workerSources[F][Y];for(const de in re)re[de]instanceof l.VectorTileWorkerSource&&(re[de].isSpriteLoaded=V,re[de].fire(new l.Event("isSpriteLoaded")))}}setImages(F,V,Y){this.availableImages[F]=V;for(const re in this.workerSources[F]){const de=this.workerSources[F][re];for(const ve in de)de[ve].availableImages=V}Y()}enableTerrain(F,V,Y){this.terrain=V,Y()}setProjection(F,V){this.projections[F]=l.getProjection(V)}setLayers(F,V,Y){this.getLayerIndex(F).replace(V),Y()}updateLayers(F,V,Y){this.getLayerIndex(F).update(V.layers,V.removedIds),Y()}loadTile(F,V,Y){const re=this.enableTerrain?l.extend({enableTerrain:this.terrain},V):V;re.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,V.type,V.source).loadTile(re,Y)}loadDEMTile(F,V,Y){const re=this.enableTerrain?l.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(F,V.source).loadTile(re,Y)}reloadTile(F,V,Y){const re=this.enableTerrain?l.extend({enableTerrain:this.terrain},V):V;re.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,V.type,V.source).reloadTile(re,Y)}abortTile(F,V,Y){this.getWorkerSource(F,V.type,V.source).abortTile(V,Y)}removeTile(F,V,Y){this.getWorkerSource(F,V.type,V.source).removeTile(V,Y)}removeSource(F,V,Y){if(!this.workerSources[F]||!this.workerSources[F][V.type]||!this.workerSources[F][V.type][V.source])return;const re=this.workerSources[F][V.type][V.source];delete this.workerSources[F][V.type][V.source],re.removeSource!==void 0?re.removeSource(V,Y):Y()}loadWorkerSource(F,V,Y){try{this.self.importScripts(V.url),Y()}catch(re){Y(re.toString())}}syncRTLPluginState(F,V,Y){try{l.plugin.setState(V);const re=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&re!=null){this.self.importScripts(re);const de=l.plugin.isParsed();Y(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),de)}}catch(re){Y(re.toString())}}getAvailableImages(F){let V=this.availableImages[F];return V||(V=[]),V}getLayerIndex(F){let V=this.layerIndexes[F];return V||(V=this.layerIndexes[F]=new R),V}getWorkerSource(F,V,Y){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][V]||(this.workerSources[F][V]={}),!this.workerSources[F][V][Y]){const re={send:(de,ve,ye,pe,Te,Ve)=>{this.actor.send(de,ve,ye,F,Te,Ve)},scheduler:this.actor.scheduler};this.workerSources[F][V][Y]=new this.workerSourceTypes[V](re,this.getLayerIndex(F),this.getAvailableImages(F),this.isSpriteLoaded[F])}return this.workerSources[F][V][Y]}getDEMWorkerSource(F,V){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][V]||(this.demWorkerSources[F][V]=new z),this.demWorkerSources[F][V]}enforceCacheSizeLimit(F,V){l.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(F,V,Y){Y(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Co(self)),Co}),f(["./shared"],function(l){function T(p,a){if(Array.isArray(p)){if(!Array.isArray(a)||p.length!==a.length)return!1;for(let h=0;h<p.length;h++)if(!T(p[h],a[h]))return!1;return!0}if(typeof p=="object"&&p!==null&&a!==null){if(typeof a!="object"||Object.keys(p).length!==Object.keys(a).length)return!1;for(const h in p)if(!T(p[h],a[h]))return!1;return!0}return p===a}var A=R;function R(p){return!function(a){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(b);try{v=new Worker(I),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(I),g}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()?(z[h=a&&a.failIfMajorPerformanceCaveat]===void 0&&(z[h]=function(g){var v,b=function(I){var C=document.createElement("canvas"),k=Object.create(R.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=I,C.getContext("webgl",k)||C.getContext("experimental-webgl",k)}(g);if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),b.getShaderParameter(v,b.COMPILE_STATUS)===!0)}(h)),z[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(p)}var z={};function j(p,a,h){const g=l.window.document.createElement(p);return a!==void 0&&(g.className=a),h&&h.appendChild(g),g}function ee(p,a,h){const g=l.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const v of Object.keys(a))g.setAttributeNS(null,v,a[v]);return h&&h.appendChild(g),g}R.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const se=l.window.document&&l.window.document.documentElement.style,be=se&&se.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Re;function Ge(){se&&be&&(Re=se[be],se[be]="none")}function it(){se&&be&&(se[be]=Re)}function dt(p){p.preventDefault(),p.stopPropagation(),l.window.removeEventListener("click",dt,!0)}function Ue(){l.window.addEventListener("click",dt,!0),l.window.setTimeout(()=>{l.window.removeEventListener("click",dt,!0)},0)}function ge(p,a){const h=p.getBoundingClientRect();return en(p,h,a)}function Ke(p,a){const h=p.getBoundingClientRect(),g=[];for(let v=0;v<a.length;v++)g.push(en(p,h,a[v]));return g}function He(p){return l.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function en(p,a,h){const g=p.offsetWidth===a.width?1:p.offsetWidth/a.width;return new l.pointGeometry((h.clientX-a.left)*g,(h.clientY-a.top)*g)}function vt(p,a){var h=a[0],g=a[1],v=a[2],b=a[3],I=h*b-v*g;return I?(p[0]=b*(I=1/I),p[1]=-g*I,p[2]=-v*I,p[3]=h*I,p):null}function Ft(p){const{userImage:a}=p;return!!(a&&a.render&&a.render())&&(p.data.replace(new Uint8Array(a.data.buffer)),!0)}class Lt extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:h,callback:g}of this.requestors)this._notify(h,g);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,h){this._validate(a,h)&&(this.images[a]=h)}_validate(a,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new l.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),g=!1),g}_validateStretch(a,h){if(!a)return!0;let g=0;for(const v of a){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0}removeImage(a){const h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,h){let g=!0;if(!this.isLoaded())for(const v of a)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(a,h):this.requestors.push({ids:a,callback:h})}_notify(a,h){const g={};for(const v of a){this.images[v]||this.fire(new l.Event("styleimagemissing",{id:v}));const b=this.images[v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:l.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,g)}getPixelSize(){const{width:a,height:h}=this.atlasImage;return{width:a,height:h}}getPattern(a){const h=this.patterns[a],g=this.getImage(a);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new l.ImagePosition(v,g);this.patterns[a]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const b in this.patterns)a.push(this.patterns[b].bin);const{w:h,h:g}=l.potpack(a),v=this.atlasImage;v.resize({width:h||1,height:g||1});for(const b in this.patterns){const{bin:I}=this.patterns[b],C=I.x+1,k=I.y+1,P=this.images[b].data,L=P.width,N=P.height;l.RGBAImage.copy(P,v,{x:0,y:0},{x:C,y:k},{width:L,height:N}),l.RGBAImage.copy(P,v,{x:0,y:N-1},{x:C,y:k-1},{width:L,height:1}),l.RGBAImage.copy(P,v,{x:0,y:0},{x:C,y:k+N},{width:L,height:1}),l.RGBAImage.copy(P,v,{x:L-1,y:0},{x:C-1,y:k},{width:1,height:N}),l.RGBAImage.copy(P,v,{x:0,y:0},{x:C+L,y:k},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const h of a){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const g=this.images[h];Ft(g)&&this.updateImage(h,g)}}}const kt=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(p,a){return function([h,g,v]){const b=l.degToRad(g+90),I=l.degToRad(v);return{x:h*Math.cos(b)*Math.sin(I),y:h*Math.sin(b)*Math.sin(I),z:h*Math.cos(I),azimuthal:g,polar:v}}(p.expression.evaluate(a))}interpolate(p,a,h){return{x:l.number(p.x,a.x,h),y:l.number(p.y,a.y,h),z:l.number(p.z,a.z,h),azimuthal:l.number(p.azimuthal,a.azimuthal,h),polar:l.number(p.polar,a.polar,h)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Qt="-transition";class lt extends l.Evented{constructor(a){super(),this._transitionable=new l.Transitionable(kt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h={}){if(!this._validate(l.validateLight,a,h))for(const g in a){const v=a[g];l.endsWith(g,Qt)?this._transitionable.setTransition(g.slice(0,-Qt.length),v):this._transitionable.setValue(g,v)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,g){return(!g||g.validate!==!1)&&l.emitValidationErrors(this,a.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}const Xe=new l.Properties({source:new l.DataConstantProperty(l.spec.terrain.source),exaggeration:new l.DataConstantProperty(l.spec.terrain.exaggeration)}),an="-transition";class li extends l.Evented{constructor(a,h){super(),this._transitionable=new l.Transitionable(Xe),this.set(a),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(a){for(const h in a){const g=a[h];l.endsWith(h,an)?this._transitionable.setTransition(h.slice(0,-an.length),g):this._transitionable.setValue(h,g)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}}function ni(p,a,h,g){const v=l.smoothstep(45,65,h),[b,I]=ii(p,g),C=l.length(a);let k=1-Math.min(1,Math.exp((C-b)/(I-b)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*v*p.alpha}function ii(p,a){const h=.5/Math.tan(.5*a);return[p.range[0]+h,p.range[1]+h]}const rn=new l.Properties({range:new l.DataConstantProperty(l.spec.fog.range),color:new l.DataConstantProperty(l.spec.fog.color),"high-color":new l.DataConstantProperty(l.spec.fog["high-color"]),"space-color":new l.DataConstantProperty(l.spec.fog["space-color"]),"horizon-blend":new l.DataConstantProperty(l.spec.fog["horizon-blend"]),"star-intensity":new l.DataConstantProperty(l.spec.fog["star-intensity"])}),It="-transition";class ri extends l.Evented{constructor(a,h){super(),this._transitionable=new l.Transitionable(rn),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const a=this._transform,h=a.projection.name==="globe",g=l.globeToMercatorTransition(a.zoom),v=this.properties.get("range"),b=[.5,3];return{range:h?[l.number(b[0],v[0],g),l.number(b[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,h={}){if(!this._validate(l.validateFog,a,h)){for(const g of Object.keys(l.spec.fog))a&&a[g]===void 0&&(a[g]=l.spec.fog[g].default);for(const g in a){const v=a[g];l.endsWith(g,It)?this._transitionable.setTransition(g.slice(0,-It.length),v):this._transitionable.setValue(g,v)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:l.smoothstep(45,65,a))*h.a}getOpacityAtLatLng(a,h){return this._transform.projection.supportsFog?function(g,v,b){const I=l.MercatorCoordinate.fromLngLat(v),C=b.elevation?b.elevation.getAtPointOrZero(I):0,k=[I.x,I.y,C];return l.transformMat4(k,k,b.mercatorFogMatrix),ni(g,k,b.pitch,b._fov)}(this.state,a,h):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?ii(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,g){return(!g||g.validate!==!1)&&l.emitValidationErrors(this,a.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Tn{constructor(a,h){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const b=new Tn.Actor(g[v],h,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,h,g){l.asyncAll(this.actors,(v,b)=>{v.send(a,h,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function bi(p,a,h){return a*(l.EXTENT/(p.tileSize*Math.pow(2,h-p.tileID.overscaledZ)))}Tn.Actor=l.Actor;class et{constructor(a,h,g,v){this.screenBounds=a,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(a,h){let g,v;if(a instanceof l.pointGeometry||typeof a[0]=="number"){const b=l.pointGeometry.convert(a);g=[b],v=h.isPointAboveHorizon(b)}else{const b=l.pointGeometry.convert(a[0]),I=l.pointGeometry.convert(a[1]);g=[b,I],v=l.polygonizeBounds(b,I).every(C=>h.isPointAboveHorizon(C))}return new et(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return l.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new l.pointGeometry(1,1)):this.screenBounds[1],v=l.polygonizeBounds(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),l.bufferConvexPolygon(v,a)}bufferedCameraGeometryGlobe(a){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new l.pointGeometry(1,1)):this.screenBounds[1],v=l.polygonizeBounds(h,g,a),b=this.cameraPoint.clone();switch(3*((b.y>h.y)+(b.y>g.y))+((b.x>h.x)+(b.x>g.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(a,h,g,v=0){const b=a.queryPadding/h._pixelsPerMercatorPixel+1,I=g?this._bufferedCameraMercator(b,h):this._bufferedScreenMercator(b,h);let C=a.tileID.wrap+(I.unwrapped?v:0);const k=I.polygon.map(Z=>l.getTilePoint(a.tileTransform,Z,C));if(!l.polygonIntersectsBox(k,0,0,l.EXTENT,l.EXTENT))return;C=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const P=this.screenGeometryMercator.polygon.map(Z=>l.getTileVec3(a.tileTransform,Z,C)),L=P.map(Z=>new l.pointGeometry(Z[0],Z[1])),N=h.getFreeCameraOptions().position||new l.MercatorCoordinate(0,0,0),G=l.getTileVec3(a.tileTransform,N,C),X=P.map(Z=>{const q=l.sub(Z,Z,G);return l.normalize(q,q),new l.Ray(G,q)}),W=bi(a,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:X,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(K=l.getBounds(k),K.min.x=l.clamp(K.min.x,0,l.EXTENT),K.min.y=l.clamp(K.min.y,0,l.EXTENT),K.max.x=l.clamp(K.max.x,0,l.EXTENT),K.max.y=l.clamp(K.max.y,0,l.EXTENT),K),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:W};var K}_bufferedScreenMercator(a,h){const g=Hn(a);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),h):{polygon:this.bufferedScreenGeometry(a).map(b=>h.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(a,h){const g=Hn(a);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),h):{polygon:this.bufferedCameraGeometry(a).map(b=>h.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(a,h){const g=function(b,I){const C=l.multiply([],I.pixelMatrix,I.globeMatrix),k=[0,-l.GLOBE_RADIUS,0,1],P=[0,l.GLOBE_RADIUS,0,1],L=[0,0,0,1];l.transformMat4$1(k,k,C),l.transformMat4$1(P,P,C),l.transformMat4$1(L,L,C);const N=new l.pointGeometry(k[0]/k[3],k[1]/k[3]),G=new l.pointGeometry(P[0]/P[3],P[1]/P[3]),X=l.polygonContainsPoint(b,N)&&k[3]<L[3],W=l.polygonContainsPoint(b,G)&&P[3]<L[3];if(!X&&!W)return null;const K=function(he,xe,Ae){for(let Ie=1;Ie<he.length;Ie++){const qe=vn(xe.pointCoordinate3D(he[Ie-1]).x),_e=vn(xe.pointCoordinate3D(he[Ie]).x);if(Ae<0){if(qe<_e)return{idx:Ie,t:-qe/(_e-1-qe)}}else if(_e<qe)return{idx:Ie,t:(1-qe)/(_e+1-qe)}}return null}(b,I,X?-1:1);if(!K)return null;const{idx:Z,t:q}=K;let Q=Z>1?Nt(b.slice(0,Z),I):[],H=Z<b.length?Nt(b.slice(Z),I):[];Q=Q.map(he=>new l.pointGeometry(vn(he.x),he.y)),H=H.map(he=>new l.pointGeometry(vn(he.x),he.y));const le=[...Q];le.length===0&&le.push(H[H.length-1]);const ce=l.number(le[le.length-1].y,(H.length===0?Q[0]:H[0]).y,q);let ie;return ie=X?[new l.pointGeometry(0,ce),new l.pointGeometry(0,0),new l.pointGeometry(1,0),new l.pointGeometry(1,ce)]:[new l.pointGeometry(1,ce),new l.pointGeometry(1,1),new l.pointGeometry(0,1),new l.pointGeometry(0,ce)],le.push(...ie),H.length===0?le.push(Q[0]):le.push(...H),{polygon:le.map(he=>new l.MercatorCoordinate(he.x,he.y)),unwrapped:!1}}(a,h);if(g)return g;const v=function(b,I){let C=!1,k=-1/0,P=0;for(let N=0;N<b.length-1;N++)b[N].x>k&&(k=b[N].x,P=N);for(let N=0;N<b.length-1;N++){const G=(P+N)%(b.length-1),X=b[G],W=b[G+1];Math.abs(X.x-W.x)>.5&&(X.x<W.x?(X.x+=1,G===0&&(b[b.length-1].x+=1)):(W.x+=1,G+1===b.length-1&&(b[0].x+=1)),C=!0)}const L=l.mercatorXfromLng(I.center.lng);return C&&L<Math.abs(L-1)&&b.forEach(N=>{N.x-=1}),{polygon:b,unwrapped:C}}(Nt(a,h).map(b=>new l.pointGeometry(vn(b.x),b.y)),h);return{polygon:v.polygon.map(b=>new l.MercatorCoordinate(b.x,b.y)),unwrapped:v.unwrapped}}}function Nt(p,a){return l.resample(p,h=>{const g=a.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function vn(p){return p<0?1+p%1:p%1}function Hn(p){return 100*p|0}function Vr(p,a,h,g,v){const b=function(I,C){if(I)return v(I);if(C){p.url&&C.tiles&&p.tiles&&delete p.tiles;const k=l.pick(l.extend(C,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(k.vectorLayers=C.vector_layers,k.vectorLayerIds=k.vectorLayers.map(P=>P.id)),k.tiles=a.canonicalizeTileset(k,p.url),v(null,k)}};return p.url?l.getJSON(a.transformRequest(a.normalizeSourceURL(p.url,null,h,g),l.ResourceType.Source),b):l.exported.frame(()=>b(null,p))}class wi{constructor(a,h,g){this.bounds=l.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const h=Math.pow(2,a.z),g=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*h),v=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*h),b=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*h),I=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*h);return a.x>=g&&a.x<b&&a.y>=v&&a.y<I}}class ar{constructor(a,h,g){this.context=a;const v=a.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class xr{constructor(a,h,g,v){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=a;const b=a.gl;this.buffer=b.createBuffer(),a.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let g=0;g<this.attributes.length;g++){const v=h.attributes[this.attributes[g].name];v!==void 0&&a.enableVertexAttribArray(v)}}setVertexAttribPointers(a,h,g){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],I=h.attributes[b.name];I!==void 0&&a.vertexAttribPointer(I,b.components,a[xn[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class mn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class br extends mn{getDefault(){return l.Color.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class $s extends mn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class jr extends mn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class As extends mn{getDefault(){return[!0,!0,!0,!0]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class qs extends mn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Jr extends mn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class So extends mn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class lr extends mn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Ws extends mn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class ha extends mn{getDefault(){return[0,1]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Il extends mn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class da extends mn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Zs extends mn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class Sl extends mn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class fa extends mn{getDefault(){return l.Color.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Rr extends mn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Al extends mn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class pa extends mn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Hs extends mn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Xs extends mn{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class Cl extends mn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Hc extends mn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ma extends mn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Ks extends mn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class ga extends mn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class _a extends mn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class es extends mn{getDefault(){return null}set(a){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ya extends mn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class Xc extends mn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class va extends mn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class xa extends mn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class wr extends mn{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class Ao extends wr{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class kl extends wr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Co extends kl{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class J{constructor(a,h,g,v){this.context=a,this.width=h,this.height=g;const b=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Ao(a,b),v&&(this.depthAttachment=new kl(a,b))}destroy(){const a=this.context.gl,h=this.colorAttachment.get();if(h&&a.deleteTexture(h),this.depthAttachment){const g=this.depthAttachment.get();g&&a.deleteRenderbuffer(g)}a.deleteFramebuffer(this.framebuffer)}}class F{constructor(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new br(this),this.clearDepth=new $s(this),this.clearStencil=new jr(this),this.colorMask=new As(this),this.depthMask=new qs(this),this.stencilMask=new Jr(this),this.stencilFunc=new So(this),this.stencilOp=new lr(this),this.stencilTest=new Ws(this),this.depthRange=new ha(this),this.depthTest=new Il(this),this.depthFunc=new da(this),this.blend=new Zs(this),this.blendFunc=new Sl(this),this.blendColor=new fa(this),this.blendEquation=new Rr(this),this.cullFace=new Al(this),this.cullFaceSide=new pa(this),this.frontFace=new Hs(this),this.program=new Xs(this),this.activeTexture=new Cl(this),this.viewport=new Hc(this),this.bindFramebuffer=new ma(this),this.bindRenderbuffer=new Ks(this),this.bindTexture=new ga(this),this.bindVertexBuffer=new _a(this),this.bindElementBuffer=new es(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ya(this),this.pixelStoreUnpack=new Xc(this),this.pixelStoreUnpackPremultiplyAlpha=new va(this),this.pixelStoreUnpackFlipY=new xa(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h){return new ar(this,a,h)}createVertexBuffer(a,h,g){return new xr(this,a,h,g)}createRenderbuffer(a,h,g){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,a,h,g),this.bindRenderbuffer.set(null),b}createFramebuffer(a,h,g){return new J(this,a,h,g)}clear({color:a,depth:h,stencil:g}){const v=this.gl;let b=0;a&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(b)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){T(a.blendFunction,l.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class V extends l.Evented{constructor(a,h,g,v){super(),this.id=a,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},h),l.extend(this,l.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Vr(this._options,this.map._requestManager,null,null,(a,h)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new l.ErrorEvent(a)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new wi(h.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(h.tiles),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,h){const g=l.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);a.request=l.getImage(this.map._requestManager.transformRequest(v,l.ResourceType.Tile),(b,I,C,k)=>(delete a.request,a.aborted?(a.state="unloaded",h(null)):b?(a.state="errored",h(b)):I?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:C,expires:k}),a.setTexture(I,this.map.painter),a.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(a,h,g){a.setTexture(h,g)}static unloadTileData(a,h){a.texture&&h.saveTileTexture(a.texture)}abortTile(a,h){a.request&&(a.request.cancel(),delete a.request),h()}unloadTile(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()}hasTransition(){return!1}}let Y;function re(p,a,h,g,v,b,I,C){const k=[p,h,v,a,g,b,1,1,1],P=[I,C,1],L=l.adjoint([],k),[N,G,X]=l.transformMat3(P,P,l.transpose(L,L));return l.multiply$1(k,[N,0,0,0,G,0,0,0,X],k)}class de extends l.Evented{constructor(a,h,g,v){super(),this.id=a,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=h,this._dirty=!1}load(a,h){this._loaded=h||!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(g,v)=>{if(this._imageRequest=null,this._loaded=!0,g)this.fire(new l.ErrorEvent(g));else if(v){const{HTMLImageElement:b}=l.window;this.image=v instanceof b?l.exported.getImageData(v):v,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const h=a.map(l.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,b=1/0,I=-1/0,C=-1/0;for(const N of g)v=Math.min(v,N.x),b=Math.min(b,N.y),I=Math.max(I,N.x),C=Math.max(C,N.y);const k=Math.max(I-v,C-b),P=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),L=Math.pow(2,P);return new l.CanonicalTileID(P,Math.floor((v+I)/2*L),Math.floor((b+C)/2*L))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const k in this.tiles){const P=this.tiles[k];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}if(this._boundsArray)return;const h=l.tileTransform(this.tileID,this.map.transform.projection),[g,v,b,I]=this.coordinates.map(k=>{const P=h.projection.project(k[0],k[1]);return l.getTilePoint(h,P)._round()});this.perspectiveTransform=function(k,P,L,N,G,X,W,K,Z,q){const Q=re(0,0,k,0,0,P,k,P),H=re(L,N,G,X,W,K,Z,q);return l.multiply$1(H,l.adjoint(Q,Q),H),[H[6]/H[8]*k/l.EXTENT,H[7]/H[8]*P/l.EXTENT]}(this.width,this.height,g.x,g.y,v.x,v.y,I.x,I.y,b.x,b.y);const C=this._boundsArray=new l.StructArrayLayout4i8;C.emplaceBack(g.x,g.y,0,0),C.emplaceBack(v.x,v.y,l.EXTENT,0),C.emplaceBack(I.x,I.y,0,l.EXTENT),C.emplaceBack(b.x,b.y,l.EXTENT,l.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(C,l.boundsAttributes.members),this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,h=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new l.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ve={vector:class extends l.Evented{constructor(p,a,h,g){if(super(),this.id=p,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(a,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new l.DedupedRequest}load(p){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=Vr(this._options,this.map._requestManager,a,h,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new l.ErrorEvent(g))):v&&(l.extend(this,v),v.bounds&&(this.tileBounds=new wi(v.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))),p&&p(g)})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const p=this.map.style._getSourceCaches(this.id);for(const a of p)a.clearTiles()})}setSourceProperty(p){p(),this.reload()}setTiles(p){return this._options.tiles=p,this.reload(),this}setUrl(p){return this.url=p,this._options.url=p,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return l.extend({},this._options)}loadTile(p,a){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,l.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired")p.state==="loading"?p.reloadCallback=a:p.request=p.actor.send("reloadTile",g,v.bind(this));else if(p.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",g,v.bind(this),void 0,!0);else{const b=l.loadVectorTile.call({deduped:this._deduped},g,(I,C)=>{I||!C?v.call(this,I):(g.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},p.actor&&p.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);p.request={cancel:b}}function v(b,I){return delete p.request,p.aborted?a(null):b&&b.status!==404?a(b):(I&&I.resourceTiming&&(p.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&p.setExpiryData(I),p.loadVectorData(I,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:V,"raster-dem":class extends V{constructor(p,a,h,g){super(p,a,h,g),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(p,a){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,b){v&&(p.state="errored",a(v)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",a(null))}p.request=l.getImage(this.map._requestManager.transformRequest(h,l.ResourceType.Tile),function(v,b,I,C){if(delete p.request,p.aborted)p.state="unloaded",a(null);else if(v)p.state="errored",a(v);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:I,expires:C});const k=l.window.ImageBitmap&&b instanceof l.window.ImageBitmap&&(Y==null&&(Y=l.window.OffscreenCanvas&&new l.window.OffscreenCanvas(1,1).getContext("2d")&&typeof l.window.createImageBitmap=="function"),Y),P=1-(b.width-l.prevPowerOfTwo(b.width))/2;P<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const L=k?b:l.exported.getImageData(b,P),N={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:P};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",N,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const a=p.canonical,h=Math.pow(2,a.z),g=(a.x-1+h)%h,v=a.x===0?p.wrap-1:p.wrap,b=(a.x+1+h)%h,I=a.x+1===h?p.wrap+1:p.wrap,C={};return C[new l.OverscaledTileID(p.overscaledZ,v,a.z,g,a.y).key]={backfilled:!1},C[new l.OverscaledTileID(p.overscaledZ,I,a.z,b,a.y).key]={backfilled:!1},a.y>0&&(C[new l.OverscaledTileID(p.overscaledZ,v,a.z,g,a.y-1).key]={backfilled:!1},C[new l.OverscaledTileID(p.overscaledZ,p.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},C[new l.OverscaledTileID(p.overscaledZ,I,a.z,b,a.y-1).key]={backfilled:!1}),a.y+1<h&&(C[new l.OverscaledTileID(p.overscaledZ,v,a.z,g,a.y+1).key]={backfilled:!1},C[new l.OverscaledTileID(p.overscaledZ,p.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},C[new l.OverscaledTileID(p.overscaledZ,I,a.z,b,a.y+1).key]={backfilled:!1}),C}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends l.Evented{constructor(p,a,h,g){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=a.data,this._options=l.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const v=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*v,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*v,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:l.EXTENT,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*v,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},a),this}getClusterChildren(p,a){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},a),this}getClusterLeaves(p,a,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:a,offset:h},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=l.extend({},this.workerOptions),a=this._data;typeof a=="string"?(p.request=this.map._requestManager.transformRequest(l.exported.resolveURL(a),l.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new l.ErrorEvent(h));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new l.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,a){const h=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(h,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete p.request,p.unloadVectorData(),p.aborted?a(null):g?a(g):(p.loadVectorData(v,this.map.painter,h==="reloadTile"),a(null))),void 0,h==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends de{constructor(p,a,h,g){super(p,a,h,g),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const a of p.urls)this.urls.push(this.map._requestManager.transformRequest(a,l.ResourceType.Source).url);l.getVideo(this.urls,(a,h)=>{this._loaded=!0,a?this.fire(new l.ErrorEvent(a)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const a=this.video.seekable;p<a.start(0)||p>a.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,a=p.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(p,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:de,canvas:class extends de{constructor(p,a,h,g){super(p,a,h,g),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(b=>typeof b!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends l.Evented{constructor(p,a,h,g){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=a,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new l.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new l.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new wi(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),l.extend(this,l.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return l.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:a,y:h,z:g}=p.canonical;return this._implementation.hasTile({x:a,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,a){const{x:h,y:g,z:v}=p.tileID.canonical,b=new l.window.AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:b.signal})).then(function(I){return delete p.request,p.aborted?(p.state="unloaded",a(null)):I===void 0?(p.state="errored",a(null)):I===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",a(null)):function(C){return C instanceof l.window.ImageData||C instanceof l.window.HTMLCanvasElement||C instanceof l.window.ImageBitmap||C instanceof l.window.HTMLImageElement}(I)?(this.loadTileData(p,I),p.state="loaded",void a(null)):(p.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(I=>{I.code!==20&&(p.state="errored",a(I))}),p.request.cancel=()=>b.abort()}loadTileData(p,a){V.loadTileData(p,a,this._map.painter)}unloadTileData(p){V.unloadTileData(p,this._map.painter)}unloadTile(p,a){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:h,y:g,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}a()}abortTile(p,a){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ye=function(p,a,h,g){const v=new ve[a.type](p,a,h,g);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],v),v};function pe(p,a){const h=l.identity([]);return l.scale(h,h,[.5*p.width,.5*-p.height,1]),l.translate(h,h,[1,-1,0]),l.multiply(h,h,p.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(h)}function Te(p,a,h,g,v,b,I,C=!1){const k=p.tilesIn(g,I,C);k.sort(pt);const P=[];for(const N of k)P.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(a,h,p._state,N,v,b,pe(p.transform,N.tile.tileID),C)});const L=function(N){const G={},X={};for(const W of N){const K=W.queryResults,Z=W.wrappedTileID,q=X[Z]=X[Z]||{};for(const Q in K){const H=K[Q],le=q[Q]=q[Q]||{},ce=G[Q]=G[Q]||[];for(const ie of H)le[ie.featureIndex]||(le[ie.featureIndex]=!0,ce.push(ie))}}return G}(P);for(const N in L)L[N].forEach(G=>{const X=G.feature,W=X.layer;W&&W.type!=="background"&&W.type!=="sky"&&(X.source=W.source,W["source-layer"]&&(X.sourceLayer=W["source-layer"]),X.state=X.id!==void 0?p.getFeatureState(W["source-layer"],X.id):{})});return L}function Ve(p,a){const h=p.getRenderableIds().map(b=>p.getTileByID(b)),g=[],v={};for(let b=0;b<h.length;b++){const I=h[b],C=I.tileID.canonical.key;v[C]||(v[C]=!0,I.querySourceFeatures(g,a))}return g}function pt(p,a){const h=p.tileID,g=a.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}function $e(){return Yl.workerClass!=null?new Yl.workerClass:new l.window.Worker(Yl.workerUrl)}const zt="mapboxgl_preloaded_worker_pool";class Rt{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Rt.workerCount;)this.workers.push(new $e);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zt]}numActive(){return Object.keys(this.active).length}}let Mt;function Wt(){return Mt||(Mt=new Rt),Mt}function sn(p,a){const h={};for(const g in p)g!=="ref"&&(h[g]=p[g]);return l.refProperties.forEach(g=>{g in a&&(h[g]=a[g])}),h}function Sn(p){p=p.slice();const a=Object.create(null);for(let h=0;h<p.length;h++)a[p[h].id]=p[h];for(let h=0;h<p.length;h++)"ref"in p[h]&&(p[h]=sn(p[h],a[p[h].ref]));return p}Rt.workerCount=2;const Ut={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Bn(p,a,h){h.push({command:Ut.addSource,args:[p,a[p]]})}function Fn(p,a,h){a.push({command:Ut.removeSource,args:[p]}),h[p]=!0}function Ys(p,a,h,g){Fn(p,h,g),Bn(p,a,h)}function Cs(p,a,h){let g;for(g in p[h])if(p[h].hasOwnProperty(g)&&g!=="data"&&!T(p[h][g],a[h][g]))return!1;for(g in a[h])if(a[h].hasOwnProperty(g)&&g!=="data"&&!T(p[h][g],a[h][g]))return!1;return!0}function De(p,a,h,g,v,b){let I;for(I in a=a||{},p=p||{})p.hasOwnProperty(I)&&(T(p[I],a[I])||h.push({command:b,args:[g,I,a[I],v]}));for(I in a)a.hasOwnProperty(I)&&!p.hasOwnProperty(I)&&(T(p[I],a[I])||h.push({command:b,args:[g,I,a[I],v]}))}function ks(p){return p.id}function gi(p,a){return p[a.id]=a,p}class Qs{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=l.clamp(a,0,1);let h=1,g=this._distances[h];const v=a*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];const b=h-1,I=this._distances[b],C=g-I,k=C>0?(v-I)/C:0;return this.points[b].mult(1-k).add(this.points[h].mult(k))}}class nm{constructor(a,h,g){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(a/g),this.yCellCount=Math.ceil(h/g);for(let I=0;I<this.xCellCount*this.yCellCount;I++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,g,v,b){this._forEachCell(h,g,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(a,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(a,h,g,v,b,I){this.boxCells[b].push(I)}_insertCircleCell(a,h,g,v,b,I){this.circleCells[b].push(I)}_query(a,h,g,v,b,I){if(g<0||a>this.width||v<0||h>this.height)return!b&&[];const C=[];if(a<=0&&h<=0&&this.width<=g&&this.height<=v){if(b)return!0;for(let k=0;k<this.boxKeys.length;k++)C.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const P=this.circles[3*k],L=this.circles[3*k+1],N=this.circles[3*k+2];C.push({key:this.circleKeys[k],x1:P-N,y1:L-N,x2:P+N,y2:L+N})}return I?C.filter(I):C}return this._forEachCell(a,h,g,v,this._queryCell,C,{hitTest:b,seenUids:{box:{},circle:{}}},I),b?C.length>0:C}_queryCircle(a,h,g,v,b){const I=a-g,C=a+g,k=h-g,P=h+g;if(C<0||I>this.width||P<0||k>this.height)return!v&&[];const L=[];return this._forEachCell(I,k,C,P,this._queryCellCircle,L,{hitTest:v,circle:{x:a,y:h,radius:g},seenUids:{box:{},circle:{}}},b),v?L.length>0:L}query(a,h,g,v,b){return this._query(a,h,g,v,!1,b)}hitTest(a,h,g,v,b){return this._query(a,h,g,v,!0,b)}hitTestCircle(a,h,g,v){return this._queryCircle(a,h,g,!0,v)}_queryCell(a,h,g,v,b,I,C,k){const P=C.seenUids,L=this.boxCells[b];if(L!==null){const G=this.bboxes;for(const X of L)if(!P.box[X]){P.box[X]=!0;const W=4*X;if(a<=G[W+2]&&h<=G[W+3]&&g>=G[W+0]&&v>=G[W+1]&&(!k||k(this.boxKeys[X]))){if(C.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[X],x1:G[W],y1:G[W+1],x2:G[W+2],y2:G[W+3]})}}}const N=this.circleCells[b];if(N!==null){const G=this.circles;for(const X of N)if(!P.circle[X]){P.circle[X]=!0;const W=3*X;if(this._circleAndRectCollide(G[W],G[W+1],G[W+2],a,h,g,v)&&(!k||k(this.circleKeys[X]))){if(C.hitTest)return I.push(!0),!0;{const K=G[W],Z=G[W+1],q=G[W+2];I.push({key:this.circleKeys[X],x1:K-q,y1:Z-q,x2:K+q,y2:Z+q})}}}}}_queryCellCircle(a,h,g,v,b,I,C,k){const P=C.circle,L=C.seenUids,N=this.boxCells[b];if(N!==null){const X=this.bboxes;for(const W of N)if(!L.box[W]){L.box[W]=!0;const K=4*W;if(this._circleAndRectCollide(P.x,P.y,P.radius,X[K+0],X[K+1],X[K+2],X[K+3])&&(!k||k(this.boxKeys[W])))return I.push(!0),!0}}const G=this.circleCells[b];if(G!==null){const X=this.circles;for(const W of G)if(!L.circle[W]){L.circle[W]=!0;const K=3*W;if(this._circlesCollide(X[K],X[K+1],X[K+2],P.x,P.y,P.radius)&&(!k||k(this.circleKeys[W])))return I.push(!0),!0}}}_forEachCell(a,h,g,v,b,I,C,k){const P=this._convertToXCellCoord(a),L=this._convertToYCellCoord(h),N=this._convertToXCellCoord(g),G=this._convertToYCellCoord(v);for(let X=P;X<=N;X++)for(let W=L;W<=G;W++)if(b.call(this,a,h,g,v,this.xCellCount*W+X,I,C,k))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,g,v,b,I){const C=v-a,k=b-h,P=g+I;return P*P>C*C+k*k}_circleAndRectCollide(a,h,g,v,b,I,C){const k=(I-v)/2,P=Math.abs(a-(v+k));if(P>k+g)return!1;const L=(C-b)/2,N=Math.abs(h-(b+L));if(N>L+g)return!1;if(P<=k||N<=L)return!0;const G=P-k,X=N-L;return G*G+X*X<=g*g}}const ds=Math.tan(85*Math.PI/180);function ba(p,a,h,g,v,b,I){const C=l.create();if(h)if(b.name==="globe"){const k=l.calculateGlobeLabelMatrix(v,a);l.multiply(C,C,k)}else{const k=vt([],I);C[0]=k[0],C[1]=k[1],C[4]=k[2],C[5]=k[3],g||l.rotateZ(C,C,v.angle)}else l.multiply(C,v.labelPlaneMatrix,p);return C}function im(p,a,h,g,v,b,I){const C=ba(p,a,h,g,v,b,I);return b.name==="globe"&&h||(C[2]=C[6]=C[10]=C[14]=0),C}function wa(p,a,h,g,v,b,I){if(h){if(b.name==="globe"){const C=ba(p,a,h,g,v,b,I);return l.invert(C,C),l.multiply(C,p,C),C}{const C=l.clone(p),k=l.identity([]);return k[0]=I[0],k[1]=I[1],k[4]=I[2],k[5]=I[3],l.multiply(C,C,k),g||l.rotateZ(C,C,-v.angle),C}}return v.glCoordMatrix}function ht(p,a,h=0){const g=[p.x,p.y,h,1];h?l.transformMat4$1(g,g,a):Kc(g,g,a);const v=g[3];return{point:[g[0]/v,g[1]/v,g[2]/v],signedDistanceFromCamera:v}}function on(p,a){const h=[p[0],p[1],p[2],1];l.transformMat4$1(h,h,a);const g=h[3];return{point:[h[0]/g,h[1]/g,h[2]/g],signedDistanceFromCamera:g}}function ln(p,a){return Math.min(.5+p/a*.5,1.5)}function fs(p,a){const h=p[0]/p[3],g=p[1]/p[3];return h>=-a[0]&&h<=a[0]&&g>=-a[1]&&g<=a[1]}function Ta(p,a,h,g,v,b,I,C,k,P){const L=h.transform,N=g?p.textSizeData:p.iconSizeData,G=l.evaluateSizeForZoom(N,h.transform.zoom),X=L.projection.name==="globe",W=[256/h.width*2+1,256/h.height*2+1],K=g?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;K.clear();let Z=null;X&&(Z=g?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const q=p.lineVertexArray,Q=g?p.text.placedSymbolArray:p.icon.placedSymbolArray,H=h.transform.width/h.transform.height;let le=!1;for(let ce=0;ce<Q.length;ce++){const ie=Q.get(ce);if(ie.writingMode!==l.WritingMode.vertical||le||ce!==0&&Q.get(ce-1).writingMode===l.WritingMode.horizontal||(le=!0),(ie.hidden||ie.writingMode===l.WritingMode.vertical)&&!le){ts(ie.numGlyphs,K);continue}le=!1;const he=new l.pointGeometry(ie.tileAnchorX,ie.tileAnchorY),xe=k?k(he):[0,0,0],Ae=L.projection.projectTilePoint(he.x,he.y,P.canonical),Ie=[Ae.x+xe[0],Ae.y+xe[1],Ae.z+xe[2]],qe=[...Ie,1];if(l.transformMat4$1(qe,qe,a),!fs(qe,W)){ts(ie.numGlyphs,K);continue}const _e=ln(h.transform.cameraToCenterDistance,qe[3]),Fe=l.evaluateSizeForFeature(N,G,ie),Be=I?Fe/_e:Fe*_e,we=ht(new l.pointGeometry(Ie[0],Ie[1]),v,Ie[2]);if(we.signedDistanceFromCamera<=0){ts(ie.numGlyphs,K);continue}let me={};const ct=I?null:k,Ye=Ea(ie,Be,!1,C,a,v,b,p.glyphOffsetArray,q,K,Z,we.point,he,me,H,ct,L.projection,P,I);le=Ye.useVertical,ct&&Ye.needsFlipping&&(me={}),(Ye.notEnoughRoom||le||Ye.needsFlipping&&Ea(ie,Be,!0,C,a,v,b,p.glyphOffsetArray,q,K,Z,we.point,he,me,H,ct,L.projection,P,I).notEnoughRoom)&&ts(ie.numGlyphs,K)}g?(p.text.dynamicLayoutVertexBuffer.updateData(K),Z&&p.text.globeExtVertexBuffer.updateData(Z)):(p.icon.dynamicLayoutVertexBuffer.updateData(K),Z&&p.icon.globeExtVertexBuffer.updateData(Z))}function cn(p,a,h,g,v,b,I,C,k,P,L,N,G,X,W,K){const Z=C.glyphStartIndex+C.numGlyphs,q=C.lineStartIndex,Q=C.lineStartIndex+C.lineLength,H=a.getoffsetX(C.glyphStartIndex),le=a.getoffsetX(Z-1),ce=Qn(p*H,h,g,v,b,I,C.segment,q,Q,k,P,L,N,G,!0,X,W,K);if(!ce)return null;const ie=Qn(p*le,h,g,v,b,I,C.segment,q,Q,k,P,L,N,G,!0,X,W,K);return ie?{first:ce,last:ie}:null}function Ml(p,a,h,g){return p.writingMode===l.WritingMode.horizontal&&Math.abs(h.y-a.y)>Math.abs(h.x-a.x)*g?{useVertical:!0}:p.writingMode===l.WritingMode.vertical?a.y<h.y?{needsFlipping:!0}:null:p.flipState!==0&&function(v,b,I){const C=(b.x-v.x)*I;return C===0||Math.abs((b.y-v.y)/C)>ds}(a,h,g)?p.flipState===1?{needsFlipping:!0}:null:a.x>h.x?{needsFlipping:!0}:null}function Ea(p,a,h,g,v,b,I,C,k,P,L,N,G,X,W,K,Z,q,Q){const H=a/24,le=p.lineOffsetX*H,ce=p.lineOffsetY*H;let ie=[];if(p.numGlyphs>1){const he=p.glyphStartIndex+p.numGlyphs,xe=p.lineStartIndex,Ae=p.lineStartIndex+p.lineLength,Ie=cn(H,C,le,ce,h,N,G,p,k,b,X,K,!1,Z,q,Q);if(!Ie)return{notEnoughRoom:!0};const qe=on(Ie.first.point,I).point,_e=on(Ie.last.point,I).point,Fe=new l.pointGeometry(qe[0],qe[1]),Be=new l.pointGeometry(_e[0],_e[1]);if(g&&!h){const we=Ml(p,Fe,Be,W);if(p.flipState=we&&we.needsFlipping?1:2,we)return we}ie=[Ie.first];for(let we=p.glyphStartIndex+1;we<he-1;we++){const me=Qn(H*C.getoffsetX(we),le,ce,h,N,G,p.segment,xe,Ae,k,b,X,K,!1,!1,Z,q,Q);if(!me)return{notEnoughRoom:!0};ie.push(me)}ie.push(Ie.last)}else{if(g&&!h){const xe=ht(G,v).point,Ae=p.lineStartIndex+p.segment+1,Ie=new l.pointGeometry(k.getx(Ae),k.gety(Ae)),qe=ht(Ie,v),_e=qe.signedDistanceFromCamera>0?qe.point:Lr(G,Ie,xe,1,v,void 0,Z,q.canonical),Fe=Ml(p,new l.pointGeometry(xe[0],xe[1]),new l.pointGeometry(_e[0],_e[1]),W);if(p.flipState=Fe&&Fe.needsFlipping?1:2,Fe)return Fe}const he=Qn(H*C.getoffsetX(p.glyphStartIndex),le,ce,h,N,G,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,k,b,X,K,!1,!1,Z,q,Q);if(!he)return{notEnoughRoom:!0};ie=[he]}if(L)for(const he of ie)l.updateGlobeVertexNormal(L,P.length+0,he.up[0],he.up[1],he.up[2]),l.updateGlobeVertexNormal(L,P.length+1,he.up[0],he.up[1],he.up[2]),l.updateGlobeVertexNormal(L,P.length+2,he.up[0],he.up[1],he.up[2]),l.updateGlobeVertexNormal(L,P.length+3,he.up[0],he.up[1],he.up[2]),l.addDynamicAttributes(P,he.point[0],he.point[1],he.point[2],he.angle);else for(const he of ie)l.addDynamicAttributes(P,he.point[0],he.point[1],he.point[2],he.angle);return{}}function Ia(p,a,h,g,v){const b=g.projectTilePoint(p.x,p.y,a);if(!v)return ht(b,h,b.z);const I=v(p);return ht(new l.pointGeometry(b.x+I[0],b.y+I[1]),h,b.z+I[2])}function Lr(p,a,h,g,v,b,I,C){const k=Ia(p.add(p.sub(a)._unit()),C,v,I,b).point,P=l.sub([],h,k);return l.scaleAndAdd([],h,P,g/l.length(P))}function Qn(p,a,h,g,v,b,I,C,k,P,L,N,G,X,W,K,Z,q){const Q=g?p-a:p+a;let H=Q>0?1:-1,le=0;g&&(H*=-1,le=Math.PI),H<0&&(le+=Math.PI);let ce=H>0?C+I:C+I+1,ie=v,he=v,xe=0,Ae=0;const Ie=Math.abs(Q),qe=[],_e=[];let Fe=b;const Be=()=>{const Je=ce-H;return xe===0?b:new l.pointGeometry(P.getx(Je),P.gety(Je))},we=()=>{const Je=Be();return Lr(Je,Fe||Je,he,Ie-xe+1,L,G,K,Z.canonical)};for(;xe+Ae<=Ie;){if(ce+=H,ce<C||ce>=k)return null;if(he=ie,qe.push(ie),X&&_e.push(Fe||Be()),ie=N[ce],ie===void 0){Fe=new l.pointGeometry(P.getx(ce),P.gety(ce));const Je=Ia(Fe,Z.canonical,L,K,G);ie=Je.signedDistanceFromCamera>0?N[ce]=Je.point:we()}else Fe=null;xe+=Ae,Ae=l.distance(he,ie)}Fe=Fe||new l.pointGeometry(P.getx(ce),P.gety(ce));const me=Be();W&&G&&(N[ce]=ie=N[ce]===void 0?ie:we(),Ae=l.distance(he,ie));const ct=(Ie-xe)/Ae,Ye=Fe.sub(me).mult(ct)._add(me),rt=l.sub([],ie,he),Qe=l.scaleAndAdd([],he,rt,ct);let At=[0,0,1],$t=rt[0],Ot=rt[1];if(q&&(At=K.upVector(Z.canonical,Ye.x,Ye.y),At[0]!==0||At[1]!==0||At[2]!==1)){const Je=[1,0,0],Xt=[0,1,0];Je[0]=At[2],Je[1]=0,Je[2]=-At[0],l.cross(Xt,At,Je),l.normalize(Je,Je),l.normalize(Xt,Xt),$t=l.dot(rt,Je),Ot=l.dot(rt,Xt)}if(h){const Je=l.cross([],At,rt);l.normalize(Je,Je),l.scaleAndAdd(Qe,Qe,Je,h*H)}const Ct=le+Math.atan2(Ot,$t);return qe.push(Qe),X&&_e.push(Ye),{point:Qe,angle:Ct,path:qe,tilePath:_e,up:At}}const By=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ts(p,a){for(let h=0;h<p;h++){const g=a.length;a.resize(g+4),a.float32.set(By,4*g)}}function Kc(p,a,h){const g=a[0],v=a[1];return p[0]=h[0]*g+h[4]*v+h[12],p[1]=h[1]*g+h[5]*v+h[13],p[3]=h[3]*g+h[7]*v+h[15],p}const Tr=100;class Yh{constructor(a,h,g=new nm(a.width+200,a.height+200,25),v=new nm(a.width+200,a.height+200,25)){this.transform=a,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Tr,this.screenBottomBoundary=a.height+Tr,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=h}placeCollisionBox(a,h,g,v,b,I,C,k){let P=g.projectedAnchorX,L=g.projectedAnchorY,N=g.projectedAnchorZ;const G=g.elevation,X=g.tileID;if(G&&X){const ce=a.getProjection().upVector(X.canonical,g.tileAnchorX,g.tileAnchorY),ie=a.getProjection().upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ce[0]*G*ie,L+=ce[1]*G*ie,N+=ce[2]*G*ie}const W=this.projectAndGetPerspectiveRatio(C,[P,L,N],g.tileID,a.projection.name==="globe"||!!G||this.transform.pitch>0,a.getProjection()),K=I*W.perspectiveRatio,Z=(g.x1*h+v.x-g.padding)*K+W.point.x,q=(g.y1*h+v.y-g.padding)*K+W.point.y,Q=(g.x2*h+v.x+g.padding)*K+W.point.x,H=(g.y2*h+v.y+g.padding)*K+W.point.y,le=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(Z,q,Q,H)||!b&&this.grid.hitTest(Z,q,Q,H,k)||le?{box:[],offscreen:!1,occluded:W.occluded}:{box:[Z,q,Q,H],offscreen:this.isOffscreen(Z,q,Q,H),occluded:!1}}placeCollisionCircles(a,h,g,v,b,I,C,k,P,L,N,G,X,W,K){const Z=[],q=this.transform.elevation,Q=q?q.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,a.getProjection()):me=>[0,0,0],H=new l.pointGeometry(g.tileAnchorX,g.tileAnchorY),le=a.getProjection().projectTilePoint(g.tileAnchorX,g.tileAnchorY,K.canonical),ce=Q(H),ie=[le.x+ce[0],le.y+ce[1],le.z+ce[2]],he=a.projection.name==="globe",xe=this.projectAndGetPerspectiveRatio(C,[ie[0],ie[1],ie[2]],K,he||!!q||this.transform.pitch>0,a.getProjection()),{perspectiveRatio:Ae}=xe,Ie=(N?I/Ae:I*Ae)/l.ONE_EM,qe=ht(new l.pointGeometry(ie[0],ie[1]),k,ie[2]).point,_e=xe.signedDistanceFromCamera>0?cn(Ie,b,g.lineOffsetX*Ie,g.lineOffsetY*Ie,!1,qe,H,g,v,k,{},q&&!N?Q:null,N&&!!q,a.getProjection(),K,N):null;let Fe=!1,Be=!1,we=!0;if(_e&&!xe.occluded){const me=.5*X*Ae+W,ct=new l.pointGeometry(-100,-100),Ye=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),rt=new Qs,Qe=_e.first,At=_e.last;let $t=[];for(let Je=Qe.path.length-1;Je>=1;Je--)$t.push(Qe.path[Je]);for(let Je=1;Je<At.path.length;Je++)$t.push(At.path[Je]);const Ot=2.5*me;if(P){const Je=$t.map(q&&!he?(Xt,tn)=>{const Nn=Q(tn<Qe.path.length-1?Qe.tilePath[Qe.path.length-1-tn]:At.tilePath[tn-Qe.path.length+2]);return Xt[2]=Nn[2],on(Xt,P)}:Xt=>on(Xt,P));$t=Je.some(Xt=>Xt.signedDistanceFromCamera<=0)?[]:Je.map(Xt=>Xt.point)}let Ct=[];if($t.length>0){const Je=$t.map(Pn=>new l.pointGeometry(Pn[0],Pn[1]));let Xt=1/0,tn=-1/0,Nn=1/0,Un=-1/0;for(let Pn=0;Pn<Je.length;Pn++)Xt=Math.min(Xt,Je[Pn].x),Nn=Math.min(Nn,Je[Pn].y),tn=Math.max(tn,Je[Pn].x),Un=Math.max(Un,Je[Pn].y);Ct=Xt>=ct.x&&tn<=Ye.x&&Nn>=ct.y&&Un<=Ye.y?[Je]:tn<ct.x||Xt>Ye.x||Un<ct.y||Nn>Ye.y?[]:l.clipLine([Je],ct.x,ct.y,Ye.x,Ye.y)}for(const Je of Ct){rt.reset(Je,.25*me);let Xt=0;Xt=rt.length<=.5*me?1:Math.ceil(rt.paddedLength/Ot)+1;for(let tn=0;tn<Xt;tn++){const Nn=tn/Math.max(Xt-1,1),Un=rt.lerp(Nn),Pn=Un.x+Tr,Mi=Un.y+Tr;Z.push(Pn,Mi,me,0);const ur=Pn-me,xs=Mi-me,Xn=Pn+me,oi=Mi+me;if(we=we&&this.isOffscreen(ur,xs,Xn,oi),Be=Be||this.isInsideGrid(ur,xs,Xn,oi),!h&&this.grid.hitTestCircle(Pn,Mi,me,G)&&(Fe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Fe,occluded:!1}}}}return{circles:!L&&Fe||!Be?[]:Z,offscreen:we,collisionDetected:Fe,occluded:xe.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let g=1/0,v=1/0,b=-1/0,I=-1/0;for(const L of a){const N=new l.pointGeometry(L.x+Tr,L.y+Tr);g=Math.min(g,N.x),v=Math.min(v,N.y),b=Math.max(b,N.x),I=Math.max(I,N.y),h.push(N)}const C=this.grid.query(g,v,b,I).concat(this.ignoredGrid.query(g,v,b,I)),k={},P={};for(const L of C){const N=L.key;if(k[N.bucketInstanceId]===void 0&&(k[N.bucketInstanceId]={}),k[N.bucketInstanceId][N.featureIndex])continue;const G=[new l.pointGeometry(L.x1,L.y1),new l.pointGeometry(L.x2,L.y1),new l.pointGeometry(L.x2,L.y2),new l.pointGeometry(L.x1,L.y2)];l.polygonIntersectsPolygon(h,G)&&(k[N.bucketInstanceId][N.featureIndex]=!0,P[N.bucketInstanceId]===void 0&&(P[N.bucketInstanceId]=[]),P[N.bucketInstanceId].push(N.featureIndex))}return P}insertCollisionBox(a,h,g,v,b){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:b},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,g,v,b){const I=h?this.ignoredGrid:this.grid,C={bucketInstanceId:g,featureIndex:v,collisionGroupID:b};for(let k=0;k<a.length;k+=4)I.insertCircle(C,a[k],a[k+1],a[k+2])}projectAndGetPerspectiveRatio(a,h,g,v,b){const I=[h[0],h[1],h[2],1];let C=!1;if(h[2]||this.transform.pitch>0){l.transformMat4$1(I,I,a);const k=b.name==="globe";this.fogState&&g&&!k&&(C=function(P,L,N,G,X,W){const K=W.calculateFogTileMatrix(X),Z=[L,N,G];return l.transformMat4(Z,Z,K),ni(P,Z,W.pitch,W._fov)}(this.fogState,h[0],h[1],h[2],g.toUnwrapped(),this.transform)>.9)}else Kc(I,I,a);return{point:new l.pointGeometry((I[0]/I[3]+1)/2*this.transform.width+Tr,(-I[1]/I[3]+1)/2*this.transform.height+Tr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/I[3]*.5,1.5),signedDistanceFromCamera:I[3],occluded:v&&I[2]>I[3]||C}}isOffscreen(a,h,g,v){return g<Tr||a>=this.screenRightBoundary||v<Tr||h>this.screenBottomBoundary}isInsideGrid(a,h,g,v){return g>=0&&a<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const a=l.identity([]);return l.translate(a,a,[-100,-100,0]),a}}function Yc(p,a,h){const g=a.createTileMatrix(p,p.worldSize,h.toUnwrapped());return l.multiply(new Float32Array(16),p.projMatrix,g)}function Qc(p,a,h){if(a.projection.name===h.projection.name)return p.projMatrix;const g=h.clone();return g.setProjection(a.projection),Yc(g,a.getProjection(),p)}function Dl(p,a,h){return a.name===h.projection.name?p.projMatrix:Yc(h,a,p)}class Pl{constructor(a,h,g,v){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class ko{constructor(a,h,g,v,b,I=!1){this.text=new Pl(a?a.text:null,h,g,b),this.icon=new Pl(a?a.icon:null,h,v,b),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yi{constructor(a,h,g,v=!1){this.text=a,this.icon=h,this.skipFade=g,this.clipped=v}}class di{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class Qh{constructor(a,h,g,v,b){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=b}}class Jh{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[a]}}function cr(p,a,h,g,v){const{horizontalAlign:b,verticalAlign:I}=l.getAnchorAlignment(p),C=-(b-.5)*a,k=-(I-.5)*h,P=l.evaluateVariableOffset(p,g);return new l.pointGeometry(C+P[0]*v,k+P[1]*v)}function Er(p,a,h,g,v){const b=new l.pointGeometry(p,a);return h&&b._rotate(g?v:-v),b}class rm{constructor(a,h,g,v,b){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new Yh(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Jh(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,h,g,v){const b=g.getBucket(h),I=g.latestFeatureIndex;if(!b||!I||h.id!==b.layerIds[0])return;const C=b.layers[0].layout,k=g.collisionBoxArray,P=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/l.EXTENT,N=g.tileID.toUnwrapped();this.transform.setProjection(b.projection);const G=(X=g.tileID,W=b.getProjection(),K=this.transform,W.name===this.projection?K.calculateProjMatrix(X.toUnwrapped()):Yc(K,W,X));var X,W,K;const Z=C.get("text-pitch-alignment")==="map",q=C.get("text-rotation-alignment")==="map";h.compileFilter();const Q=h.dynamicFilter(),H=h.dynamicFilterNeedsFeature(),le=this.transform.calculatePixelsToTileUnitsMatrix(g),ce=im(G,g.tileID.canonical,Z,q,this.transform,b.getProjection(),le);let ie=null;if(Z){const Ae=wa(G,g.tileID.canonical,Z,q,this.transform,b.getProjection(),le);ie=l.multiply([],this.transform.labelPlaneMatrix,Ae)}let he=null;Q&&g.latestFeatureIndex&&(he={unwrappedTileID:N,dynamicFilter:Q,dynamicFilterNeedsFeature:H,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Qh(b.bucketInstanceId,I,b.sourceLayerIndex,b.index,g.tileID);const xe={bucket:b,layout:C,posMatrix:G,textLabelPlaneMatrix:ce,labelToScreenMatrix:ie,clippingData:he,scale:P,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const Ae of b.sortKeyRanges){const{sortKey:Ie,symbolInstanceStart:qe,symbolInstanceEnd:_e}=Ae;a.push({sortKey:Ie,symbolInstanceStart:qe,symbolInstanceEnd:_e,parameters:xe})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:xe})}attemptAnchorPlacement(a,h,g,v,b,I,C,k,P,L,N,G,X,W,K,Z,q,Q){const H=[G.textOffset0,G.textOffset1],le=cr(a,g,v,H,b),ce=this.collisionIndex.placeCollisionBox(W,b,h,Er(le.x,le.y,I,C,this.transform.angle),N,k,P,L.predicate);if(Z){const ie=W.getSymbolInstanceIconSize(Q,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(W,ie,Z,Er(le.x,le.y,I,C,this.transform.angle),N,k,P,L.predicate).box.length===0)return}if(ce.box.length>0){let ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(ie=this.prevPlacement.variableOffsets[G.crossTileID].anchor),this.variableOffsets[G.crossTileID]={textOffset:H,width:g,height:v,anchor:a,textScale:b,prevAnchor:ie},this.markUsedJustification(W,a,G,K),W.allowVerticalPlacement&&(this.markUsedOrientation(W,K,G),this.placedOrientations[G.crossTileID]=K),{shift:le,placedGlyphBoxes:ce}}}placeLayerBucketPart(a,h,g,v){const{bucket:b,layout:I,posMatrix:C,textLabelPlaneMatrix:k,labelToScreenMatrix:P,clippingData:L,textPixelRatio:N,holdingForFade:G,collisionBoxArray:X,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:K,collisionGroup:Z}=a.parameters,q=I.get("text-optional"),Q=I.get("icon-optional"),H=I.get("text-allow-overlap"),le=I.get("icon-allow-overlap"),ce=I.get("text-rotation-alignment")==="map",ie=I.get("text-pitch-alignment")==="map",he=I.get("icon-text-fit")!=="none",xe=I.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let Ae=H&&(le||!b.hasIconData()||Q),Ie=le&&(H||!b.hasTextData()||q);!b.collisionArrays&&X&&b.deserializeCollisionBoxes(X),g&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,X);const qe=(_e,Fe,Be)=>{if(L){const Xn={zoom:this.transform.zoom,pitch:this.transform.pitch};let oi=null;if(L.dynamicFilterNeedsFeature){const Mn=this.retainedQueryData[b.bucketInstanceId];oi=L.featureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:Mn.bucketIndex,sourceLayerIndex:Mn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Xn,oi,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new l.pointGeometry(_e.tileAnchorX,_e.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[_e.crossTileID]=new Yi(!1,!1,!1,!0),void(h[_e.crossTileID]=!0)}if(h[_e.crossTileID])return;if(G)return void(this.placements[_e.crossTileID]=new Yi(!1,!1,!1));let we=!1,me=!1,ct=!0,Ye=!1,rt=!1,Qe=null,At={box:null,offscreen:null,occluded:null},$t={box:null,offscreen:null,occluded:null},Ot=null,Ct=null,Je=null,Xt=0,tn=0,Nn=0;Be.textFeatureIndex?Xt=Be.textFeatureIndex:_e.useRuntimeCollisionCircles&&(Xt=_e.featureIndex),Be.verticalTextFeatureIndex&&(tn=Be.verticalTextFeatureIndex);const Un=Xn=>{Xn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||Xn.elevation)&&(Xn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,Xn.tileAnchorX,Xn.tileAnchorY):0)},Pn=Be.textBox;if(Pn){Un(Pn);const Xn=Mn=>{let _i=l.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Mn&&this.prevPlacement){const Ji=this.prevPlacement.placedOrientations[_e.crossTileID];Ji&&(this.placedOrientations[_e.crossTileID]=Ji,_i=Ji,this.markUsedOrientation(b,_i,_e))}return _i},oi=(Mn,_i)=>{if(b.allowVerticalPlacement&&_e.numVerticalGlyphVertices>0&&Be.verticalTextBox){for(const Ji of b.writingModes)if(Ji===l.WritingMode.vertical?(At=_i(),$t=At):At=Mn(),At&&At.box&&At.box.length)break}else At=Mn()};if(I.get("text-variable-anchor")){let Mn=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]){const qn=this.prevPlacement.variableOffsets[_e.crossTileID];Mn.indexOf(qn.anchor)>0&&(Mn=Mn.filter(Ir=>Ir!==qn.anchor),Mn.unshift(qn.anchor))}const _i=(qn,Ir,Oo)=>{const is=b.getSymbolInstanceTextSize(W,_e,this.transform.zoom,Fe),hr=(qn.x2-qn.x1)*is+2*qn.padding,La=(qn.y2-qn.y1)*is+2*qn.padding,io=he&&!le?Ir:null;io&&Un(io);let Vi={box:[],offscreen:!1,occluded:!1};const bs=H?2*Mn.length:Mn.length;for(let ro=0;ro<bs;++ro){const rs=this.attemptAnchorPlacement(Mn[ro%Mn.length],qn,hr,La,is,ce,ie,N,C,Z,ro>=Mn.length,_e,Fe,b,Oo,io,W,K);if(rs&&(Vi=rs.placedGlyphBoxes,Vi&&Vi.box&&Vi.box.length)){we=!0,Qe=rs.shift;break}}return Vi};oi(()=>_i(Pn,Be.iconBox,l.WritingMode.horizontal),()=>{const qn=Be.verticalTextBox;return qn&&Un(qn),b.allowVerticalPlacement&&!(At&&At.box&&At.box.length)&&_e.numVerticalGlyphVertices>0&&qn?_i(qn,Be.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),At&&(we=At.box,ct=At.offscreen,Ye=At.occluded);const Ji=Xn(At&&At.box);if(!we&&this.prevPlacement){const qn=this.prevPlacement.variableOffsets[_e.crossTileID];qn&&(this.variableOffsets[_e.crossTileID]=qn,this.markUsedJustification(b,qn.anchor,_e,Ji))}}else{const Mn=(_i,Ji)=>{const qn=b.getSymbolInstanceTextSize(W,_e,this.transform.zoom,Fe),Ir=this.collisionIndex.placeCollisionBox(b,qn,_i,new l.pointGeometry(0,0),H,N,C,Z.predicate);return Ir&&Ir.box&&Ir.box.length&&(this.markUsedOrientation(b,Ji,_e),this.placedOrientations[_e.crossTileID]=Ji),Ir};oi(()=>Mn(Pn,l.WritingMode.horizontal),()=>{const _i=Be.verticalTextBox;return b.allowVerticalPlacement&&_e.numVerticalGlyphVertices>0&&_i?(Un(_i),Mn(_i,l.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Xn(At&&At.box&&At.box.length)}}if(Ot=At,we=Ot&&Ot.box&&Ot.box.length>0,ct=Ot&&Ot.offscreen,Ye=Ot&&Ot.occluded,_e.useRuntimeCollisionCircles){const Xn=b.text.placedSymbolArray.get(_e.centerJustifiedTextSymbolIndex>=0?_e.centerJustifiedTextSymbolIndex:_e.verticalPlacedTextSymbolIndex),oi=l.evaluateSizeForFeature(b.textSizeData,W,Xn),Mn=I.get("text-padding");Ct=this.collisionIndex.placeCollisionCircles(b,H,Xn,b.lineVertexArray,b.glyphOffsetArray,oi,C,k,P,g,ie,Z.predicate,_e.collisionCircleDiameter*oi/l.ONE_EM,Mn,this.retainedQueryData[b.bucketInstanceId].tileID),we=H||Ct.circles.length>0&&!Ct.collisionDetected,ct=ct&&Ct.offscreen,Ye=Ct.occluded}if(Be.iconFeatureIndex&&(Nn=Be.iconFeatureIndex),Be.iconBox){const Xn=oi=>{Un(oi);const Mn=he&&Qe?Er(Qe.x,Qe.y,ce,ie,this.transform.angle):new l.pointGeometry(0,0),_i=b.getSymbolInstanceIconSize(K,this.transform.zoom,_e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,_i,oi,Mn,le,N,C,Z.predicate)};$t&&$t.box&&$t.box.length&&Be.verticalIconBox?(Je=Xn(Be.verticalIconBox),me=Je.box.length>0):(Je=Xn(Be.iconBox),me=Je.box.length>0),ct=ct&&Je.offscreen,rt=Je.occluded}const Mi=q||_e.numHorizontalGlyphVertices===0&&_e.numVerticalGlyphVertices===0,ur=Q||_e.numIconVertices===0;if(Mi||ur?ur?Mi||(me=me&&we):we=me&&we:me=we=me&&we,we&&Ot&&Ot.box&&this.collisionIndex.insertCollisionBox(Ot.box,I.get("text-ignore-placement"),b.bucketInstanceId,$t&&$t.box&&tn?tn:Xt,Z.ID),me&&Je&&this.collisionIndex.insertCollisionBox(Je.box,I.get("icon-ignore-placement"),b.bucketInstanceId,Nn,Z.ID),Ct&&(we&&this.collisionIndex.insertCollisionCircles(Ct.circles,I.get("text-ignore-placement"),b.bucketInstanceId,Xt,Z.ID),g)){const Xn=b.bucketInstanceId;let oi=this.collisionCircleArrays[Xn];oi===void 0&&(oi=this.collisionCircleArrays[Xn]=new di);for(let Mn=0;Mn<Ct.circles.length;Mn+=4)oi.circles.push(Ct.circles[Mn+0]),oi.circles.push(Ct.circles[Mn+1]),oi.circles.push(Ct.circles[Mn+2]),oi.circles.push(Ct.collisionDetected?1:0)}const xs=b.projection.name!=="globe";Ae=Ae&&(xs||!Ye),Ie=Ie&&(xs||!rt),this.placements[_e.crossTileID]=new Yi(we||Ae,me||Ie,ct||b.justReloaded),h[_e.crossTileID]=!0};if(xe){const _e=b.getSortedSymbolIndexes(this.transform.angle);for(let Fe=_e.length-1;Fe>=0;--Fe){const Be=_e[Fe];qe(b.symbolInstances.get(Be),Be,b.collisionArrays[Be])}}else for(let _e=a.symbolInstanceStart;_e<a.symbolInstanceEnd;_e++)qe(b.symbolInstances.get(_e),_e,b.collisionArrays[_e]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[b.bucketInstanceId];l.invert(_e.invProjMatrix,C),_e.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(a,h,g,v){let b;b=v===l.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(h)];const I=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const C of I)C>=0&&(a.text.placedSymbolArray.get(C).crossTileID=b>=0&&C!==b?0:g.crossTileID)}markUsedOrientation(a,h,g){const v=h===l.WritingMode.horizontal||h===l.WritingMode.horizontalOnly?h:0,b=h===l.WritingMode.vertical?h:0,I=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex].filter(C=>C!==-1);for(const C of I)a.text.placedSymbolArray.get(C).placedOrientation=v;g.verticalPlacedTextSymbolIndex!==-1&&(a.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(a):1,b=h?h.opacities:{},I=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(const k in this.placements){const P=this.placements[k],L=b[k];L?(this.opacities[k]=new ko(L,v,P.text,P.icon,null,P.clipped),g=g||P.text!==L.text.placed||P.icon!==L.icon.placed):(this.opacities[k]=new ko(null,v,P.text,P.icon,P.skipFade,P.clipped),g=g||P.text||P.icon)}for(const k in b){const P=b[k];if(!this.opacities[k]){const L=new ko(P,v,!1,!1);L.isHidden()||(this.opacities[k]=L,g=g||P.text.placed||P.icon.placed)}}for(const k in I)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=I[k]);for(const k in C)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=C[k]);g?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h){const g={};for(const v of h){const b=v.getBucket(a);b&&v.latestFeatureIndex&&a.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,v.collisionBoxArray)}}updateBucketOpacities(a,h,g){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const v=a.layers[0].layout,b=!!a.layers[0].dynamicFilter(),I=new ko(null,0,!1,!1,!0),C=v.get("text-allow-overlap"),k=v.get("icon-allow-overlap"),P=v.get("text-variable-anchor"),L=v.get("text-rotation-alignment")==="map",N=v.get("text-pitch-alignment")==="map",G=v.get("icon-text-fit")!=="none",X=new ko(null,0,C&&(k||!a.hasIconData()||v.get("icon-optional")),k&&(C||!a.hasTextData()||v.get("text-optional")),!0);!a.collisionArrays&&g&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(g);const W=(Z,q,Q)=>{for(let H=0;H<q/4;H++)Z.opacityVertexArray.emplaceBack(Q)};let K=0;for(let Z=0;Z<a.symbolInstances.length;Z++){const q=a.symbolInstances.get(Z),{numHorizontalGlyphVertices:Q,numVerticalGlyphVertices:H,crossTileID:le}=q;let ce=this.opacities[le];h[le]?ce=I:ce||(ce=X,this.opacities[le]=ce),h[le]=!0;const ie=Q>0||H>0,he=q.numIconVertices>0,xe=this.placedOrientations[q.crossTileID],Ae=xe===l.WritingMode.vertical,Ie=xe===l.WritingMode.horizontal||xe===l.WritingMode.horizontalOnly;if(!ie&&!he||ce.isHidden()||K++,ie){const qe=ps(ce.text);W(a.text,Q,Ae?Js:qe),W(a.text,H,Ie?Js:qe);const _e=ce.text.isHidden();[q.rightJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.leftJustifiedTextSymbolIndex].forEach(we=>{we>=0&&(a.text.placedSymbolArray.get(we).hidden=_e||Ae?1:0)}),q.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).hidden=_e||Ie?1:0);const Fe=this.variableOffsets[q.crossTileID];Fe&&this.markUsedJustification(a,Fe.anchor,q,xe);const Be=this.placedOrientations[q.crossTileID];Be&&(this.markUsedJustification(a,"left",q,Be),this.markUsedOrientation(a,Be,q))}if(he){const qe=ps(ce.icon);q.placedIconSymbolIndex>=0&&(W(a.icon,q.numIconVertices,Ae?Js:qe),a.icon.placedSymbolArray.get(q.placedIconSymbolIndex).hidden=ce.icon.isHidden()),q.verticalPlacedIconSymbolIndex>=0&&(W(a.icon,q.numVerticalIconVertices,Ie?Js:qe),a.icon.placedSymbolArray.get(q.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const qe=a.collisionArrays[Z];if(qe){let _e=new l.pointGeometry(0,0),Fe=!0;if(qe.textBox||qe.verticalTextBox){if(P){const we=this.variableOffsets[le];we?(_e=cr(we.anchor,we.width,we.height,we.textOffset,we.textScale),L&&_e._rotate(N?this.transform.angle:-this.transform.angle)):Fe=!1}b&&(Fe=!ce.clipped),qe.textBox&&Mo(a.textCollisionBox.collisionVertexArray,ce.text.placed,!Fe||Ae,_e.x,_e.y),qe.verticalTextBox&&Mo(a.textCollisionBox.collisionVertexArray,ce.text.placed,!Fe||Ie,_e.x,_e.y)}const Be=Fe&&Boolean(!Ie&&qe.verticalIconBox);qe.iconBox&&Mo(a.iconCollisionBox.collisionVertexArray,ce.icon.placed,Be,G?_e.x:0,G?_e.y:0),qe.verticalIconBox&&Mo(a.iconCollisionBox.collisionVertexArray,ce.icon.placed,!Be,G?_e.x:0,G?_e.y:0)}}}if(a.fullyClipped=K===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Z.invProjMatrix,a.placementViewportMatrix=Z.viewportMatrix,a.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){const g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>a}setStale(){this.stale=!0}}function Mo(p,a,h,g,v){p.emplaceBack(a?1:0,h?1:0,g||0,v||0),p.emplaceBack(a?1:0,h?1:0,g||0,v||0),p.emplaceBack(a?1:0,h?1:0,g||0,v||0),p.emplaceBack(a?1:0,h?1:0,g||0,v||0)}const Ti=Math.pow(2,25),Rl=Math.pow(2,24),ed=Math.pow(2,17),Ll=Math.pow(2,16),Ui=Math.pow(2,9),td=Math.pow(2,8),nd=Math.pow(2,1);function ps(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const a=p.placed?1:0,h=Math.floor(127*p.opacity);return h*Ti+a*Rl+h*ed+a*Ll+h*Ui+a*td+h*nd+a}const Js=0;class Jc{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,h,g,v,b){const I=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(I,v,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((C,k)=>C.sortKey-k.sortKey));this._currentPartIndex<I.length;){const C=I[this._currentPartIndex];if(h.placeLayerBucketPart(C,this._seenCrossTileIDs,g,C.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class Fy{constructor(a,h,g,v,b,I,C,k){this.placement=new rm(a,b,I,C,k),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(a,h,g){const v=l.exported.now(),b=()=>{const I=l.exported.now()-v;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=h[a[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=C)&&(!I.maxzoom||I.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Jc(I)),this._inProgressLayer.continuePlacement(g[I.source],this.placement,this._showCollisionBoxes,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const id=512/l.EXTENT/2;class Sa{constructor(a,h,g){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let v=0;v<h.length;v++){const b=h.get(v),I=b.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,a)})}}getScaledCoordinates(a,h){const g=id/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*l.EXTENT+a.tileAnchorX)*g),y:Math.floor((h.canonical.y*l.EXTENT+a.tileAnchorY)*g)}}findMatches(a,h,g){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<a.length;b++){const I=a.get(b);if(I.crossTileID)continue;const C=this.indexedSymbolInstances[I.key];if(!C)continue;const k=this.getScaledCoordinates(I,h);for(const P of C)if(Math.abs(P.coord.x-k.x)<=v&&Math.abs(P.coord.y-k.y)<=v&&!g[P.crossTileID]){g[P.crossTileID]=!0,I.crossTileID=P.crossTileID;break}}}}class Ny{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class sm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const h=Math.round((a-this.lng)/360);if(h!==0)for(const g in this.indexes){const v=this.indexes[g],b={};for(const I in v){const C=v[I];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),b[C.tileID.key]=C}this.indexes[g]=b}this.lng=a}addBucket(a,h,g){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const v=this.usedCrossTileIDs[a.overscaledZ];for(const b in this.indexes){const I=this.indexes[b];if(Number(b)>a.overscaledZ)for(const C in I){const k=I[C];k.tileID.isChildOf(a)&&k.findMatches(h.symbolInstances,a,v)}else{const C=I[a.scaledTo(Number(b)).key];C&&C.findMatches(h.symbolInstances,a,v)}}for(let b=0;b<h.symbolInstances.length;b++){const I=h.symbolInstances.get(b);I.crossTileID||(I.crossTileID=g.generate(),v[I.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Sa(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(const g in h.indexedSymbolInstances)for(const v of h.indexedSymbolInstances[g])delete this.usedCrossTileIDs[a][v.crossTileID]}removeStaleBuckets(a){let h=!1;for(const g in this.indexes){const v=this.indexes[g];for(const b in v)a[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[b]),delete v[b],h=!0)}return h}}class Do{constructor(){this.layerIndexes={},this.crossTileIDs=new Ny,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,g,v){let b=this.layerIndexes[a.id];b===void 0&&(b=this.layerIndexes[a.id]=new sm);let I=!1;const C={};v.name!=="globe"&&b.handleWrapJump(g);for(const k of h){const P=k.getBucket(a);P&&a.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(k.tileID,P,this.crossTileIDs)&&(I=!0),C[P.bucketInstanceId]=!0)}return b.removeStaleBuckets(C)&&(I=!0),I}pruneUnusedLayers(a){const h={};a.forEach(g=>{h[g]=!0});for(const g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}const ns=(p,a)=>l.emitValidationErrors(p,a&&a.filter(h=>h.identifier!=="source.canvas")),eu=l.pick(Ut,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),eo=l.pick(Ut,["setCenter","setZoom","setBearing","setPitch"]),rd={version:8,layers:[],sources:{}},tu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ms extends l.Evented{constructor(a,h={}){super(),this.map=a,this.dispatcher=new Tn(Wt(),this),this.imageManager=new Lt,this.imageManager.setEventedParent(this),this.glyphManager=new l.GlyphManager(a._requestManager,h.localFontFamily?l.LocalGlyphMode.all:h.localIdeographFontFamily?l.LocalGlyphMode.ideographs:l.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new Do,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const g=this;this._rtlTextPluginCallback=ms.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,I)=>{if(l.triggerPluginCompletionEvent(b),I&&I.every(C=>C))for(const C in g._sourceCaches){const k=g._sourceCaches[C],P=k.getSource().type;P!=="vector"&&P!=="geojson"||k.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const I in this._layers){const C=this._layers[I];C.source===b.id&&this._validateLayer(C)}})}loadURL(a,h={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const g=typeof h.validate=="boolean"?h.validate:!l.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);const v=this.map._requestManager.transformRequest(a,l.ResourceType.Style);this._request=l.getJSON(v,(b,I)=>{this._request=null,b?this.fire(new l.ErrorEvent(b)):I&&this._load(I,g)})}loadJSON(a,h={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(a,h.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(rd,!1)}_updateLayerCount(a,h){const g=h?1:-1;a.is3D()&&(this._num3DLayers+=g),a.type==="circle"&&(this._numCircleLayers+=g),a.type==="symbol"&&(this._numSymbolLayers+=g)}_load(a,h){if(h&&ns(this,l.validateStyle(a)))return;this._loaded=!0,this.stylesheet=l.clone$1(a),this._updateMapProjection();for(const v in a.sources)this.addSource(v,a.sources[v],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const g=Sn(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of g)v=l.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new lt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=function(h,g,v){let b,I,C;const k=l.exported.devicePixelRatio>1?"@2x":"";let P=l.getJSON(g.transformRequest(g.normalizeSpriteURL(h,k,".json"),l.ResourceType.SpriteJSON),(G,X)=>{P=null,C||(C=G,b=X,N())}),L=l.getImage(g.transformRequest(g.normalizeSpriteURL(h,k,".png"),l.ResourceType.SpriteImage),(G,X)=>{L=null,C||(C=G,I=X,N())});function N(){if(C)v(C);else if(b&&I){const G=l.exported.getImageData(I),X={};for(const W in b){const{width:K,height:Z,x:q,y:Q,sdf:H,pixelRatio:le,stretchX:ce,stretchY:ie,content:he}=b[W],xe=new l.RGBAImage({width:K,height:Z});l.RGBAImage.copy(G,xe,{x:q,y:Q},{x:0,y:0},{width:K,height:Z}),X[W]={data:xe,pixelRatio:le,sdf:H,stretchX:ce,stretchY:ie,content:he}}v(null,X)}}return{cancel(){P&&(P.cancel(),P=null),L&&(L.cancel(),L=null)}}}(a,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new l.ErrorEvent(h));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(a){const h=this.getSource(a.source);if(!h)return;const g=a.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const h=[];for(const g of a){const v=this._layers[g];v.type!=="custom"&&h.push(v.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&tu[a.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const h=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const I in this._updatedSources){const C=this._updatedSources[I];C==="reload"?this._reloadSource(I):C==="clear"&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];g[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(a,this._availableImages),!b.isHidden(a.zoom)){const C=this._getLayerSourceCache(b);C&&(C.used=!0)}const I=this.map.painter;if(I){const C=b.getProgramIds();if(!C)continue;const k=b.getProgramConfiguration(a.zoom);for(const P of C)I.useProgram(P,k)}}for(const v in g){const b=this._sourceCaches[v];g[v]!==b.used&&b.getSource().fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),ns(this,l.validateStyle(a)))return!1;(a=l.clone$1(a)).layers=Sn(a.layers);const h=function(v,b){if(!v)return[{command:Ut.setStyle,args:[b]}];let I=[];try{if(!T(v.version,b.version))return[{command:Ut.setStyle,args:[b]}];T(v.center,b.center)||I.push({command:Ut.setCenter,args:[b.center]}),T(v.zoom,b.zoom)||I.push({command:Ut.setZoom,args:[b.zoom]}),T(v.bearing,b.bearing)||I.push({command:Ut.setBearing,args:[b.bearing]}),T(v.pitch,b.pitch)||I.push({command:Ut.setPitch,args:[b.pitch]}),T(v.sprite,b.sprite)||I.push({command:Ut.setSprite,args:[b.sprite]}),T(v.glyphs,b.glyphs)||I.push({command:Ut.setGlyphs,args:[b.glyphs]}),T(v.transition,b.transition)||I.push({command:Ut.setTransition,args:[b.transition]}),T(v.light,b.light)||I.push({command:Ut.setLight,args:[b.light]}),T(v.fog,b.fog)||I.push({command:Ut.setFog,args:[b.fog]}),T(v.projection,b.projection)||I.push({command:Ut.setProjection,args:[b.projection]});const C={},k=[];(function(N,G,X,W){let K;for(K in G=G||{},N=N||{})N.hasOwnProperty(K)&&(G.hasOwnProperty(K)||Fn(K,X,W));for(K in G)G.hasOwnProperty(K)&&(N.hasOwnProperty(K)?T(N[K],G[K])||(N[K].type==="geojson"&&G[K].type==="geojson"&&Cs(N,G,K)?X.push({command:Ut.setGeoJSONSourceData,args:[K,G[K].data]}):Ys(K,G,X,W)):Bn(K,G,X))})(v.sources,b.sources,k,C);const P=[];v.layers&&v.layers.forEach(N=>{N.source&&C[N.source]?I.push({command:Ut.removeLayer,args:[N.id]}):P.push(N)});let L=v.terrain;L&&C[L.source]&&(I.push({command:Ut.setTerrain,args:[void 0]}),L=void 0),I=I.concat(k),T(L,b.terrain)||I.push({command:Ut.setTerrain,args:[b.terrain]}),function(N,G,X){G=G||[];const W=(N=N||[]).map(ks),K=G.map(ks),Z=N.reduce(gi,{}),q=G.reduce(gi,{}),Q=W.slice(),H=Object.create(null);let le,ce,ie,he,xe,Ae,Ie;for(le=0,ce=0;le<W.length;le++)ie=W[le],q.hasOwnProperty(ie)?ce++:(X.push({command:Ut.removeLayer,args:[ie]}),Q.splice(Q.indexOf(ie,ce),1));for(le=0,ce=0;le<K.length;le++)ie=K[K.length-1-le],Q[Q.length-1-le]!==ie&&(Z.hasOwnProperty(ie)?(X.push({command:Ut.removeLayer,args:[ie]}),Q.splice(Q.lastIndexOf(ie,Q.length-ce),1)):ce++,Ae=Q[Q.length-le],X.push({command:Ut.addLayer,args:[q[ie],Ae]}),Q.splice(Q.length-le,0,ie),H[ie]=!0);for(le=0;le<K.length;le++)if(ie=K[le],he=Z[ie],xe=q[ie],!H[ie]&&!T(he,xe))if(T(he.source,xe.source)&&T(he["source-layer"],xe["source-layer"])&&T(he.type,xe.type)){for(Ie in De(he.layout,xe.layout,X,ie,null,Ut.setLayoutProperty),De(he.paint,xe.paint,X,ie,null,Ut.setPaintProperty),T(he.filter,xe.filter)||X.push({command:Ut.setFilter,args:[ie,xe.filter]}),T(he.minzoom,xe.minzoom)&&T(he.maxzoom,xe.maxzoom)||X.push({command:Ut.setLayerZoomRange,args:[ie,xe.minzoom,xe.maxzoom]}),he)he.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?De(he[Ie],xe[Ie],X,ie,Ie.slice(6),Ut.setPaintProperty):T(he[Ie],xe[Ie])||X.push({command:Ut.setLayerProperty,args:[ie,Ie,xe[Ie]]}));for(Ie in xe)xe.hasOwnProperty(Ie)&&!he.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?De(he[Ie],xe[Ie],X,ie,Ie.slice(6),Ut.setPaintProperty):T(he[Ie],xe[Ie])||X.push({command:Ut.setLayerProperty,args:[ie,Ie,xe[Ie]]}))}else X.push({command:Ut.removeLayer,args:[ie]}),Ae=Q[Q.lastIndexOf(ie)+1],X.push({command:Ut.addLayer,args:[xe,Ae]})}(P,b.layers,I)}catch(C){console.warn("Unable to compute style diff:",C),I=[{command:Ut.setStyle,args:[b]}]}return I}(this.serialize(),a).filter(v=>!(v.command in eo));if(h.length===0)return!1;const g=h.filter(v=>!(v.command in eu));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return h.forEach(v=>{v.command!=="setTransition"&&v.command!=="setProjection"&&this[v.command].apply(this,v.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,h){return this.getImage(a)?this.fire(new l.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,h),this._afterImageUpdated(a),this)}updateImage(a,h){this.imageManager.updateImage(a,h)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new l.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,h,g={}){if(this._checkLoaded(),this.getSource(a)!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.validateSource,`sources.${a}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=ye(a,h,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:v.serialize(),sourceId:a}));const b=I=>{const C=(I?"symbol:":"other:")+a,k=this._sourceCaches[C]=new l.SourceCache(C,v,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[a]=k,k.style=this,k.onAdd(this.map)};b(!1),h.type!=="vector"&&h.type!=="geojson"||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const h=this.getSource(a);if(!h)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===a)return this.fire(new l.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new l.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(a);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,h){this._checkLoaded(),this.getSource(a).setData(h),this._changed=!0}getSource(a){const h=this._getSourceCache(a);return h&&h.getSource()}_getSources(){const a=[];for(const h in this._otherSourceCaches){const g=this._getSourceCache(h);g&&a.push(g.getSource())}return a}addLayer(a,h,g={}){this._checkLoaded();const v=a.id;if(this.getLayer(v))return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if(a.type==="custom"){if(ns(this,l.validateCustomStyleLayer(a)))return;b=l.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(v,a.source),a=l.clone$1(a),a=l.extend(a,{source:v})),this._validate(l.validateLayer,`layers.${v}`,a,{arrayIndex:-1},g))return;b=l.createStyleLayer(a),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const I=h?this._order.indexOf(h):this._order.length;if(h&&I===-1)return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(I,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const C=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&C&&b.type!=="custom"){const k=this._removedLayers[v];delete this._removedLayers[v],k.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",C.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,h){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new l.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===h)return;const g=this._order.indexOf(a);this._order.splice(g,1);const v=h?this._order.indexOf(h):this._order.length;h&&v===-1?this.fire(new l.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(v,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const h=this._layers[a];if(!h)return void this.fire(new l.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const g=this._order.indexOf(a);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const h in this._layers)if(this._layers[h].type===a)return!0;return!1}setLayerZoomRange(a,h,g){this._checkLoaded();const v=this.getLayer(a);v?v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new l.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,h,g={}){this._checkLoaded();const v=this.getLayer(a);if(v){if(!T(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(l.validateFilter,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=l.clone$1(h),this._updateLayer(v)))}else this.fire(new l.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const h=this.getLayer(a);return h&&l.clone$1(h.filter)}setLayoutProperty(a,h,g,v={}){this._checkLoaded();const b=this.getLayer(a);b?T(b.getLayoutProperty(h),g)||(b.setLayoutProperty(h,g,v),this._updateLayer(b)):this.fire(new l.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,h){const g=this.getLayer(a);if(g)return g.getLayoutProperty(h);this.fire(new l.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,h,g,v={}){this._checkLoaded();const b=this.getLayer(a);b?T(b.getPaintProperty(h),g)||(b.setPaintProperty(h,g,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new l.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,h){const g=this.getLayer(a);return g&&g.getPaintProperty(h)}setFeatureState(a,h){this._checkLoaded();const g=a.source,v=a.sourceLayer,b=this.getSource(g);if(!b)return void this.fire(new l.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const I=b.type;if(I==="geojson"&&v)return void this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(I==="vector"&&!v)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(g);for(const k of C)k.setFeatureState(v,a.id,h)}removeFeatureState(a,h){this._checkLoaded();const g=a.source,v=this.getSource(g);if(!v)return void this.fire(new l.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=v.type,I=b==="vector"?a.sourceLayer:void 0;if(b==="vector"&&!I)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(g);for(const k of C)k.removeFeatureState(I,a.id,h)}getFeatureState(a){this._checkLoaded();const h=a.source,g=a.sourceLayer,v=this.getSource(h);if(v){if(v.type!=="vector"||g)return a.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(g,a.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const h in this._sourceCaches){const g=this._sourceCaches[h].getSource();a[g.id]||(a[g.id]=g.serialize())}return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0;const h=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&h&&h.getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",h.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const h=I=>this._layers[I].type==="fill-extrusion",g={},v=[];for(let I=this._order.length-1;I>=0;I--){const C=this._order[I];if(h(C)){g[C]=I;for(const k of a){const P=k[C];if(P)for(const L of P)v.push(L)}}}v.sort((I,C)=>C.intersectionZ-I.intersectionZ);const b=[];for(let I=this._order.length-1;I>=0;I--){const C=this._order[I];if(h(C))for(let k=v.length-1;k>=0;k--){const P=v[k].feature;if(g[P.layer.id]<I)break;b.push(P),v.pop()}else for(const k of a){const P=k[C];if(P)for(const L of P)b.push(L.feature)}}return b}queryRenderedFeatures(a,h,g){h&&h.filter&&this._validate(l.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of h.layers){const P=this._layers[k];if(!P)return this.fire(new l.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];v[P.source]=!0}}const b=[];h.availableImages=this._availableImages;const I=h&&h.layers?h.layers.some(k=>{const P=this.getLayer(k);return P&&P.is3D()}):this.has3DLayers(),C=et.createFromScreenPoints(a,g);for(const k in this._sourceCaches){const P=this._sourceCaches[k].getSource().id;h.layers&&!v[P]||b.push(Te(this._sourceCaches[k],this._layers,this._serializedLayers,C,h,g,I,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(k,P,L,N,G,X,W){const K={},Z=X.queryRenderedSymbols(N),q=[];for(const Q of Object.keys(Z).map(Number))q.push(W[Q]);q.sort(pt);for(const Q of q){const H=Q.featureIndex.lookupSymbolFeatures(Z[Q.bucketInstanceId],P,Q.bucketIndex,Q.sourceLayerIndex,G.filter,G.layers,G.availableImages,k);for(const le in H){const ce=K[le]=K[le]||[],ie=H[le];ie.sort((he,xe)=>{const Ae=Q.featureSortOrder;if(Ae){const Ie=Ae.indexOf(he.featureIndex);return Ae.indexOf(xe.featureIndex)-Ie}return xe.featureIndex-he.featureIndex});for(const he of ie)ce.push(he)}}for(const Q in K)K[Q].forEach(H=>{const le=H.feature,ce=L(k[Q]).getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=ce});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(a,h){h&&h.filter&&this._validate(l.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const g=this._getSourceCaches(a);let v=[];for(const b of g)v=v.concat(Ve(b,h));return v}addSourceType(a,h,g){return ms.getSourceType(a)?g(new Error(`A source type called "${a}" already exists.`)):(ms.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(a,h={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const I in a)if(!T(a[I],g[I])){v=!0;break}if(!v)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,h),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,h=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(h===1){if(typeof a.source=="object"){const g="terrain-dem-src";this.addSource(g,a.source),a=l.clone$1(a),a=l.extend(a,{source:g})}if(this._validate(l.validateTerrain,"terrain",a))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(a,h);else{const g=this.terrain,v=g.get();for(const b of Object.keys(l.spec.terrain))!a.hasOwnProperty(b)&&l.spec.terrain[b].default&&(a[b]=l.spec.terrain[b].default);for(const b in a)if(!T(a[b],v[b])){g.set(a),this.stylesheet.terrain=a;const I=this._setTransitionParameters({duration:0});g.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const h=this.fog=new ri(a,this.map.transform);this.stylesheet.fog=a;const g=this._setTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,g=h.get();Object.keys(a).length===0&&h.set(a);for(const v in a)if(!T(a[v],g[v])){h.set(a),this.stylesheet.fog=a;const b=this._setTransitionParameters({duration:0});h.updateTransitions(b);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:l.exported.now(),transition:l.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(g=>this.isLayerDraped(this._layers[g])),h=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...h)}_createTerrain(a,h){const g=this.terrain=new li(a,h);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const a in this._layers){const h=this._layers[a];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const h=this._layers[a];h.type==="symbol"&&this._updateLayer(h)}}_validate(a,h,g,v,b={}){return(!b||b.validate!==!1)&&ns(this,a.call(l.validateStyle,l.extend({key:h,style:this.serialize(),value:g,styleSpec:l.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const h=this._getSourceCaches(a);for(const g of h)g.clearTiles()}_reloadSource(a){const h=this._getSourceCaches(a);for(const g of h)g.resume(),g.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const h in this._sourceCaches)this._sourceCaches[h].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const h=this._sourceCaches[a];h.resume(),h.reload()}}_updatePlacement(a,h,g,v,b=!1){let I=!1,C=!1;const k={};for(const P of this._order){const L=this._layers[P];if(L.type!=="symbol")continue;if(!k[L.source]){const G=this._getLayerSourceCache(L);if(!G)continue;k[L.source]=G.getRenderableIds(!0).map(X=>G.getTileByID(X)).sort((X,W)=>W.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(W.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(L,k[L.source],a.center.lng,a.projection);I=I||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new l.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),a.zoom))&&(this.pauseablePlacement=new Fy(a,this._order,b,h,g,v,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),C=!0),I&&this.pauseablePlacement.placement.setStale()),C||I)for(const P of this._order){const L=this._layers[P];L.type==="symbol"&&this.placement.updateLayerOpacities(L,k[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(a,h,g){this.glyphManager.getGlyphs(h.stacks,g)}getResource(a,h,g){return l.makeRequest(h,g)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const h=[];return this._otherSourceCaches[a]&&h.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&h.push(this._symbolSourceCaches[a]),h}_isSourceCacheLoaded(a){const h=this._getSourceCaches(a);return h.length===0?(this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ms.getSourceType=function(p){return ve[p]},ms.setSourceType=function(p,a){ve[p]=a},ms.registerForPluginStateChange=l.registerForPluginStateChange;var om=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,nu="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",am=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,sd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,lm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let od={},ad={};const Po=[];gs(om,Po),gs(am,Po),gs(sd,Po),gs(lm,Po),od=An("",am),ad=An(lm,sd);const ld=An(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),cd=om,iu=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var ud={background:An(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:An(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:An(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:An("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:An(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:An(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:An("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:An("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:An("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:An(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:An(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:An(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:An(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:An(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:An(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:An(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:An(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:An(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:An(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:An(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:An(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:An(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:An(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:An(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:An(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:An(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,nu),skyboxGradient:An(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,nu),skyboxCapture:An(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:An(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:An(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function gs(p,a){const h=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const b of v)a.includes(b)||a.push(b)}}function An(p,a){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},b=[...Po];return gs(p,b),gs(a,b),{fragmentSource:p=p.replace(h,(I,C,k,P,L)=>(v[L]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${k} ${P} ${L};
#else
uniform ${k} ${P} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${k} ${P} ${L} = u_${L};
#endif
`)),vertexSource:a=a.replace(h,(I,C,k,P,L)=>{const N=P==="float"?"vec2":"vec4",G=L.match(/color/)?"color":N;return v[L]?C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${k} ${N} a_${L};
varying ${k} ${P} ${L};
#else
uniform ${k} ${P} u_${L};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${k} ${P} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${G}(a_${L}, u_${L}_t);
#else
    ${k} ${P} ${L} = u_${L};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${k} ${N} a_${L};
#else
uniform ${k} ${P} u_${L};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${k} ${P} ${L} = a_${L};
#else
    ${k} ${P} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${k} ${P} ${L} = unpack_mix_${G}(a_${L}, u_${L}_t);
#else
    ${k} ${P} ${L} = u_${L};
#endif
`}),staticAttributes:g,usedDefines:b}}class zl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,h,g,v,b,I,C){this.context=a;let k=this.boundPaintVertexBuffers.length!==v.length;for(let L=0;!k&&L<v.length;L++)this.boundPaintVertexBuffers[L]!==v[L]&&(k=!0);let P=this.boundDynamicVertexBuffers.length!==C.length;for(let L=0;!P&&L<C.length;L++)this.boundDynamicVertexBuffers[L]!==C[L]&&(P=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||k||P||this.boundIndexBuffer!==b||this.boundVertexOffset!==I)this.freshBind(h,g,v,b,I,C);else{a.bindVertexArrayOES.set(this.vao);for(const L of C)L&&L.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(a,h,g,v,b,I){let C;const k=a.numAttributes,P=this.context,L=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=I;else{C=P.currentNumAttributes||0;for(let N=k;N<C;N++)L.disableVertexAttribArray(N)}h.enableAttributes(L,a),h.bind(),h.setVertexAttribPointers(L,a,b);for(const N of g)N.enableAttributes(L,a),N.bind(),N.setVertexAttribPointers(L,a,b);for(const N of I)N&&(N.enableAttributes(L,a),N.bind(),N.setVertexAttribPointers(L,a,b));v&&v.bind(),P.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ru(p,a){const h=Math.pow(2,a.canonical.z),g=a.canonical.y;return[new l.MercatorCoordinate(0,g/h).toLngLat().lat,new l.MercatorCoordinate(0,(g+1)/h).toLngLat().lat]}function su(p,a,h,g,v,b,I){const C=p.context,k=C.gl,P=h.fbo;if(!P)return;p.prepareDrawTile();const L=p.useProgram("hillshade");C.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,P.colorAttachment.get());const N=((K,Z,q,Q)=>{const H=q.paint.get("hillshade-shadow-color"),le=q.paint.get("hillshade-highlight-color"),ce=q.paint.get("hillshade-accent-color");let ie=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);q.paint.get("hillshade-illumination-anchor")==="viewport"&&(ie-=K.transform.angle);const he=!K.options.moving;return{u_matrix:Q||K.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),he),u_image:0,u_latrange:ru(0,Z.tileID),u_light:[q.paint.get("hillshade-exaggeration"),ie],u_shadow:H,u_highlight:le,u_accent:ce}})(p,h,g,p.terrain?a.projMatrix:null);p.prepareDrawProgram(C,L,a.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:X,tileBoundsSegments:W}=p.getTileBoundsBuffers(h);L.draw(C,k.TRIANGLES,v,b,I,l.CullFaceMode.disabled,N,g.id,G,X,W)}function ou(p,a,h){if(!a.needsDEMTextureUpload)return;const g=p.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||p.getTileTexture(h.stride);const b=h.getPixels();a.demTexture?a.demTexture.update(b,{premultiply:!1}):a.demTexture=new l.Texture(g,b,v.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function cm(p,a,h,g,v,b){const I=p.context,C=I.gl;if(!a.dem)return;const k=a.dem;if(I.activeTexture.set(C.TEXTURE1),ou(p,a,k),!a.demTexture)return;a.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const P=k.dim;I.activeTexture.set(C.TEXTURE0);let L=a.fbo;if(!L){const W=new l.Texture(I,{width:P,height:P,data:null},C.RGBA);W.bind(C.LINEAR,C.CLAMP_TO_EDGE),L=a.fbo=I.createFramebuffer(P,P,!0),L.colorAttachment.set(W.texture)}I.bindFramebuffer.set(L.framebuffer),I.viewport.set([0,0,P,P]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:G,tileBoundsSegments:X}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(I,C.TRIANGLES,g,v,b,l.CullFaceMode.disabled,((W,K)=>{const Z=K.stride,q=l.create();return l.ortho(q,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(q,q,[0,-l.EXTENT,0]),{u_matrix:q,u_image:1,u_dimension:[Z,Z],u_zoom:W.overscaledZ,u_unpack:K.unpackVector}})(a.tileID,k),h.id,N,G,X),a.needsHillshadePrepare=!1}const au=p=>({u_matrix:new l.UniformMatrix4f(p),u_image0:new l.Uniform1i(p),u_skirt_height:new l.Uniform1f(p)}),hd=(p,a)=>({u_matrix:p,u_image0:0,u_skirt_height:a}),lu=(p,a,h,g,v,b,I,C,k,P,L,N,G,X)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:I,u_frustum_tr:C,u_frustum_br:k,u_frustum_bl:P,u_globe_pos:L,u_globe_radius:N,u_viewport:G,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9)});function Ol(p,a){return p!=null&&a!=null&&!(!p.hasData()||!a.hasData())&&p.demTexture!=null&&a.demTexture!=null&&p.tileID.key!==a.tileID.key}const to=new class{constructor(){this.operations={}}newMorphing(p,a,h,g,v){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==h.tileID.key&&(b.queued=h)}else this.operations[p]={startTime:g,phase:0,duration:v,from:a,to:h,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const a=this.operations[p];return{from:a.from,to:a.to,phase:a.phase}}update(p){for(const a in this.operations){const h=this.operations[a];for(h.phase=(p-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,p)){delete this.operations[a];break}}}_nextOp(p,a){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=a,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Aa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function En(p,a){const h=1<<p.z;return!a&&(p.x===0||p.x===h-1)||p.y===0||p.y===h-1}const Ca=p=>({u_matrix:p});function dd(p,a,h,g,v){if(v>0){const b=l.exported.now(),I=(b-p.timeAdded)/v,C=a?(b-a.timeAdded)/v:-1,k=h.getSource(),P=g.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),L=!a||Math.abs(a.tileID.overscaledZ-P)>Math.abs(p.tileID.overscaledZ-P),N=L&&p.refreshedUponExpiration?1:l.clamp(L?I:1-C,0,1);return p.refreshedUponExpiration&&I>=1&&(p.refreshedUponExpiration=!1),a?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class um extends l.SourceCache{constructor(a){const h={type:"raster-dem",maxzoom:a.transform.maxZoom},g=new Tn(Wt(),null),v=ye("mock-dem",h,g,a.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,h){a.state="loaded",h(null)}}class hm extends l.SourceCache{constructor(a){const h=ye("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new Tn(Wt(),null),a.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,h,g){if(a.freezeTileCoverage)return;this.transform=a;const v=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,I)=>{if(b[I.key]="",!this._tiles[I.key]){const C=new l.Tile(I,this._source.tileSize*I.overscaleFactor(),a.tileZoom);C.state="loaded",this._tiles[I.key]=C}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(a){const h=this.proxyCachedFBO[a];if(h!==void 0){const g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class cu extends l.OverscaledTileID{constructor(a,h,g){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class dm extends l.Elevation{constructor(a,h){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,b]=function(k){const P=new l.StructArrayLayout4i8,L=new l.StructArrayLayout3ui6,N=131;P.reserve(17161),L.reserve(33800);const G=l.EXTENT/128,X=l.EXTENT+G/2,W=X+G;for(let Z=-G;Z<W;Z+=G)for(let q=-G;q<W;q+=G){const Q=q<0||q>X||Z<0||Z>X?24575:0,H=l.clamp(Math.round(q),0,l.EXTENT),le=l.clamp(Math.round(Z),0,l.EXTENT);P.emplaceBack(H+Q,le,H,le)}const K=(Z,q)=>{const Q=q*N+Z;L.emplaceBack(Q+1,Q,Q+N),L.emplaceBack(Q+N,Q+N+1,Q+1)};for(let Z=1;Z<129;Z++)for(let q=1;q<129;q++)K(q,Z);return[0,129].forEach(Z=>{for(let q=0;q<130;q++)K(q,Z),K(Z,q)}),[P,L,32768]}(),I=a.context;this.gridBuffer=I.createVertexBuffer(g,l.boundsAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(v),this.gridSegments=l.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=l.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new hm(h.map),this.orthoMatrix=l.create(),l.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,l.EXTENT,0,l.EXTENT,0,1);const C=I.gl;this._overlapStencilMode=new l.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new um(h.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency()}update(a,h,g){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const v=a.terrain.properties;this.sourceCache=a.terrain.drapeRenderMode===0?this._mockSourceCache:a._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&l.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(h,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),h.updateElevation(!g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||a.efficiency!==100&&l.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=h.getIds().map(k=>{const P=h.getTileByID(k).tileID;return P.projMatrix=g.calculateProjMatrix(P.toUnwrapped()),P});(function(k,P){const L=P.transform.pointCoordinate(P.transform.getCameraPoint()),N=new l.pointGeometry(L.x,L.y);k.sort((G,X)=>{if(X.overscaledZ-G.overscaledZ)return X.overscaledZ-G.overscaledZ;const W=new l.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),K=new l.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),Z=N.mult(1<<G.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(W)-Z.distSqr(K)})})(v,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const k in I){const P=I[k];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,a[k],b),P.usedForTerrain))continue;const L=a[k];P.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[h.id]=v.map(k=>new cu(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=l.exported.now();const C={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const P=this.terrainTileForTile[k.key];if(!P)continue;const L=P.tileID.key;L in C||(this._visibleDemTiles.push(P),C[L]=L)}}_assignTerrainTiles(a){this._initializing||a.forEach(h=>{if(this.terrainTileForTile[h.key])return;const g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){const a=this.painter.context,h=a.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(a.activeTexture.set(h.TEXTURE1),ou(this.painter,v,b))}}_prepareDemTileUniforms(a,h,g,v){if(!h||h.demTexture==null)return!1;const b=a.tileID.canonical,I=Math.pow(2,h.tileID.canonical.z-b.z),C=v||"";return g[`u_dem_tl${C}`]=[b.x*I%1,b.y*I%1],g[`u_dem_scale${C}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,h=a.gl;if(!this._emptyDepthBufferTexture){const g=new l.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new l.Texture(a,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const b=v.dem.tree.minimums[0];return b>0&&a++,g+b},0);return a?h/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,h=a.gl;a.activeTexture.set(h.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new l.RGBAImage({width:1,height:1},new Uint8Array(l.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new l.Texture(a,v,h.RGBA,{premultiply:!1}),b}setupElevationDraw(a,h,g){const v=this.painter.context,b=v.gl,I=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:l.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var C;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let k=null,P=null,L=1;if(g&&g.morphing&&this._useVertexMorphing){const N=g.morphing.srcDemTile,G=g.morphing.dstDemTile;L=g.morphing.phase,N&&G&&(this._prepareDemTileUniforms(a,N,I,"_prev")&&(P=N),this._prepareDemTileUniforms(a,G,I)&&(k=G))}if(P&&k?(v.activeTexture.set(b.TEXTURE2),k.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),P.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),I.u_dem_lerp=L):(k=this.terrainTileForTile[a.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(a,k,I)?k.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&k){const N=(1<<k.tileID.canonical.z)*l.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=N}if(g&&g.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,I),this.painter.transform.projection.name==="globe"){const N=this.globeUniformValues(this.painter.transform,a.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,N)}}globeUniformValues(a,h,g){const v=a.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,l.EXTENT,0),u_tile_br_up:v.upVector(h,l.EXTENT,l.EXTENT),u_tile_bl_up:v.upVector(h,0,l.EXTENT),u_tile_up_scale:g?l.GLOBE_METERS_TO_ECEF:v.upVectorScale(h,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const h=this.painter,g=this.painter.context;a.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,I,C,k){if(v.transform.projection.name==="globe")(function(P,L,N,G,X){const W=P.context,K=W.gl;let Z,q;const Q=P.options.showTerrainWireframe?2:0,H=P.transform,le=l.globeUseCustomAntiAliasing(P,W,H),ce=(we,me)=>{if(q===we)return;const ct=[Aa[we],"PROJECTION_GLOBE_VIEW"];le&&ct.push("CUSTOM_ANTIALIASING"),me&&ct.push(Aa[Q]),Z=P.useProgram("globeRaster",null,ct),q=we},ie=P.colorModeForRenderPass(),he=new l.DepthMode(K.LEQUAL,l.DepthMode.ReadWrite,P.depthRangeFor3D);to.update(X);const xe=l.calculateGlobeMercatorMatrix(H),Ae=[l.mercatorXfromLng(H.center.lng),l.mercatorYfromLat(H.center.lat)],Ie=Q?[!1,!0]:[!1],qe=P.globeSharedBuffers,_e=[H.width*l.exported.devicePixelRatio,H.height*l.exported.devicePixelRatio],Fe=Float32Array.from(H.globeMatrix),Be={useDenormalizedUpVectorScale:!0};if(Ie.forEach(we=>{q=-1;const me=we?K.LINES:K.TRIANGLES;for(const ct of G){const Ye=N.getTile(ct),rt=l.StencilMode.disabled,Qe=L.prevTerrainTileForTile[ct.key],At=L.terrainTileForTile[ct.key];Ol(Qe,At)&&to.newMorphing(ct.key,Qe,At,X,250),W.activeTexture.set(K.TEXTURE0),Ye.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const $t=to.getMorphValuesForProxy(ct.key),Ot=$t?1:0;$t&&l.extend$1(Be,{morphing:{srcDemTile:$t.from,dstDemTile:$t.to,phase:l.easeCubicInOut($t.phase)}});const Ct=l.tileCornersToBounds(ct.canonical),Je=l.getLatitudinalLod(Ct.getCenter().lat),Xt=l.getGridMatrix(ct.canonical,Ct,Je,H.worldSize/H._pixelsPerMercatorPixel),tn=l.globeNormalizeECEF(l.globeTileBounds(ct.canonical)),Nn=lu(H.projMatrix,Fe,xe,tn,l.globeToMercatorTransition(H.zoom),Ae,H.frustumCorners.TL,H.frustumCorners.TR,H.frustumCorners.BR,H.frustumCorners.BL,H.globeCenterInViewSpace,H.globeRadius,_e,Xt);if(ce(Ot,we),L.setupElevationDraw(Ye,Z,Be),P.prepareDrawProgram(W,Z,ct.toUnwrapped()),qe){const[Un,Pn,Mi]=we?qe.getWirefameBuffers(P.context,Je):qe.getGridBuffers(Je);Z.draw(W,me,he,rt,ie,l.CullFaceMode.backCCW,Nn,"globe_raster",Un,Pn,Mi)}}}),qe){const we=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];le&&we.push("CUSTOM_ANTIALIASING"),Z=P.useProgram("globeRaster",null,we);for(const me of G){const{x:ct,y:Ye,z:rt}=me.canonical,Qe=Ye===0,At=Ye===(1<<rt)-1,[$t,Ot,Ct,Je]=qe.getPoleBuffers(rt);if(Je&&(Qe||At)){const Xt=N.getTile(me);W.activeTexture.set(K.TEXTURE0),Xt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let tn=l.globePoleMatrixForTile(rt,ct,H);const Nn=l.globeNormalizeECEF(l.globeTileBounds(me.canonical)),Un=(Pn,Mi)=>Pn.draw(W,K.TRIANGLES,he,l.StencilMode.disabled,ie,l.CullFaceMode.disabled,lu(H.projMatrix,tn,tn,Nn,0,Ae,H.frustumCorners.TL,H.frustumCorners.TR,H.frustumCorners.BR,H.frustumCorners.BL,H.globeCenterInViewSpace,H.globeRadius,_e),"globe_pole_raster",Mi,Ct,Je);L.setupElevationDraw(Xt,Z,Be),P.prepareDrawProgram(W,Z,me.toUnwrapped()),Qe&&Un(Z,$t),At&&(tn=l.scale(l.create(),tn,[1,-1,1]),Un(Z,Ot))}}}})(v,b,I,C,k);else{const P=v.context,L=P.gl;let N,G;const X=v.options.showTerrainWireframe?2:0,W=(H,le)=>{if(G===H)return;const ce=[Aa[H]];le&&ce.push(Aa[X]),N=v.useProgram("terrainRaster",null,ce),G=H},K=v.colorModeForRenderPass(),Z=new l.DepthMode(L.LEQUAL,l.DepthMode.ReadWrite,v.depthRangeFor3D);to.update(k);const q=v.transform,Q=6*Math.pow(1.5,22-q.zoom)*b.exaggeration();(X?[!1,!0]:[!1]).forEach(H=>{G=-1;const le=H?L.LINES:L.TRIANGLES,[ce,ie]=H?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const he of C){const xe=I.getTile(he),Ae=l.StencilMode.disabled,Ie=b.prevTerrainTileForTile[he.key],qe=b.terrainTileForTile[he.key];Ol(Ie,qe)&&to.newMorphing(he.key,Ie,qe,k,250),P.activeTexture.set(L.TEXTURE0),xe.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const _e=to.getMorphValuesForProxy(he.key),Fe=_e?1:0;let Be;_e&&(Be={morphing:{srcDemTile:_e.from,dstDemTile:_e.to,phase:l.easeCubicInOut(_e.phase)}});const we=hd(he.projMatrix,En(he.canonical,q.renderWorldCopies)?Q/10:Q);W(Fe,H),b.setupElevationDraw(xe,N,Be),v.prepareDrawProgram(P,N,he.toUnwrapped()),N.draw(P,le,Z,Ae,K,l.CullFaceMode.backCCW,we,"terrain_raster",b.gridBuffer,ce,ie)}})}}(h,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const h=this.painter,g=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],I=this._drapedRenderBatches.shift(),C=[],k=h.style.order;let P=0;for(const L of b){const N=v.getTileByID(L.proxyTileKey),G=v.proxyCachedFBO[L.key]?v.proxyCachedFBO[L.key][a]:void 0,X=G!==void 0?v.renderCache[G]:this.pool[P++],W=G!==void 0;if(N.texture=X.tex,W&&!X.dirty){C.push(N.tileID);continue}let K;g.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(g.clear({color:l.Color.transparent,stencil:0}),X.dirty=!1);for(let Z=I.start;Z<=I.end;++Z){const q=h.style._layers[k[Z]];if(q.isHidden(h.transform.zoom))continue;const Q=h.style._getLayerSourceCache(q),H=Q?this.proxyToSource[L.key][Q.id]:[L];if(!H)continue;const le=H;g.viewport.set([0,0,X.fb.width,X.fb.height]),K!==(Q?Q.id:null)&&(this._setupStencil(X,H,q,Q),K=Q?Q.id:null),h.renderLayer(h,Q,q,le)}this.renderedToTile?(X.dirty=!0,C.push(N.tileID)):W||--P,P===5&&(P=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),I.end+1}postRender(){}renderCacheEfficiency(a){const h=a.order.length;if(h===0)return{efficiency:100};let g,v=0,b=0,I=!1;for(let C=0;C<h;++C){const k=a._layers[a.order[C]];this._style.isLayerDraped(k)?(I&&++v,++b):I||(I=!0,g=k.id)}return b===0?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{a=Math.min(a,h.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,h,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const I=b.tileID,C=1<<I.overscaledZ,{x:k,y:P}=I.canonical,L=k/C,N=(k+1)/C,G=P/C,X=(P+1)/C;return{minx:L,miny:G,maxx:N,maxy:X,t:b.dem.tree.raycastRoot(L,G,N,X,a,h,g),tile:b}});v.sort((b,I)=>(b.t!==null?b.t:Number.MAX_VALUE)-(I.t!==null?I.t:Number.MAX_VALUE));for(const b of v){if(b.t==null)return null;const I=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,a,h,g);if(I!=null)return I}return null}_createFBO(){const a=this.painter.context,h=a.gl,g=this.drapeBufferSize;a.activeTexture.set(h.TEXTURE0);const v=new l.Texture(a,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);const b=a.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new Co(a,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const h=this._style._layers[a],g=h.isHidden(this.painter.transform.zoom),v=h.getCrossfadeParameters(),b=!!v&&v.t!==1,I=h.hasTransition();return h.type!=="custom"&&!g&&(b||I)})}_clearRasterFadeFromRenderCache(){let a=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof V){a=!0;break}if(a)for(let h=0;h<this._style.order.length;++h){const g=this._style._layers[this._style.order[h]],v=g.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(g);if(g.type!=="raster"||v||!b)continue;const I=g.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const k=this.proxyToSource[C.key][b.id];if(k)for(const P of k){const L=dd(b.getTile(P),b.findLoadedParent(P,0),b,this.painter.transform,I);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(b.id,P)}}}}_setupDrapedRenderBatches(){const a=this._style.order,h=a.length;if(h===0)return;const g=[];let v,b=0,I=this._style._layers[a[b]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++b<h;)I=this._style._layers[a[b]];for(;b<h;++b){const C=this._style._layers[a[b]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?v===void 0&&(v=b):v!==void 0&&(g.push({start:v,end:b-1}),v=void 0))}v!==void 0&&g.push({start:v,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(a){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const I=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let C=0;C<I.length;++C){const k=Object.values(I[C]);h.renderCachePool.push(...k)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let I=g.length-1;I>=0;I--){const C=g[I];if(h.getTileByID(C.key),h.proxyCachedFBO[C.key]!==void 0){const k=a[C.key],P=this.proxyToSource[C.key];let L=0;for(const N in P){const G=P[N],X=k[N];if(!X||X.length!==G.length||G.some((W,K)=>W!==X[K]||v[N]&&v[N].hasOwnProperty(W.key))){L=-1;break}++L}for(const N in h.proxyCachedFBO[C.key])h.renderCache[h.proxyCachedFBO[C.key][N]].dirty=L<0||L!==Object.values(k).length}}const b=[...this._drapedRenderBatches];b.sort((I,C)=>C.end-C.start-(I.end-I.start));for(const I of b)for(const C of g){if(h.proxyCachedFBO[C.key])continue;let k=h.renderCachePool.pop();k===void 0&&h.renderCache.length<50&&(k=h.renderCache.length,h.renderCache.push(this._createFBO())),k!==void 0&&(h.proxyCachedFBO[C.key]={},h.proxyCachedFBO[C.key][I.start]=k,h.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(a,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,I=b.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let C;if(g.isTileClipped())C=h.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):l.StencilMode.disabled}_renderTileClippingMasks(a,h){const g=this.painter,v=this.painter.context,b=v.gl;g._tileClippingMaskIDs={},v.setColorMode(l.ColorMode.disabled),v.setDepthMode(l.DepthMode.disabled);const I=g.useProgram("clippingMask");for(const C of a){const k=g._tileClippingMaskIDs[C.key]=--h;I.draw(v,b.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:b.ALWAYS,mask:0},k,255,b.KEEP,b.KEEP,b.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,Ca(C.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(a){const h=this.painter.transform;if(a.x<0||a.x>h.width||a.y<0||a.y>h.height)return null;const g=[a.x,a.y,1,1];l.transformMat4$1(g,g,h.pixelMatrixInverse),l.scale$1(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;const v=h._camera.position,b=l.mercatorZfromAltitude(1,h.center.lat),I=[v[0],v[1],v[2]/b,0],C=l.subtract([],g.slice(0,3),I);l.normalize(C,C);const k=this.raycast(I,C,this._exaggeration);return k!==null&&k?(l.scaleAndAdd(I,I,C,k),I[3]=I[2],I[2]*=b,I):null}drawDepth(){const a=this.painter,h=a.context,g=this.proxySourceCache,v=Math.ceil(a.width),b=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=h.gl,C=h.createFramebuffer(v,b,!0);h.activeTexture.set(I.TEXTURE0);const k=new l.Texture(h,{width:v,height:b,data:null},I.RGBA);k.bind(I.NEAREST,I.CLAMP_TO_EDGE),C.colorAttachment.set(k.texture);const P=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,b);C.depthAttachment.set(P),this._depthFBO=C,this._depthTexture=k}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,b]),function(I,C,k,P){if(I.transform.projection.name==="globe")return;const L=I.context,N=L.gl;L.clear({depth:1});const G=I.useProgram("terrainDepth"),X=new l.DepthMode(N.LESS,l.DepthMode.ReadWrite,I.depthRangeFor3D);for(const W of P){const K=k.getTile(W),Z=hd(W.projMatrix,0);C.setupElevationDraw(K,G),G.draw(L,N.TRIANGLES,X,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.backCCW,Z,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(a,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,h,g){if(a.getSource()instanceof de)return this._setupProxiedCoordsForImageSource(a,h,g);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const v=this.proxiedCoords[a.id]=[],b=this.proxyCoords;for(let C=0;C<b.length;C++){const k=b[C],P=this._findTileCoveringTileID(k,a);if(P){const L=this._createProxiedId(k,P,g[k.key]&&g[k.key][a.id]);v.push(L),this.proxyToSource[k.key][a.id]=[L]}}let I=!1;for(let C=0;C<h.length;C++){const k=a.getTile(h[C]);if(!k||!k.hasData())continue;const P=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==k.tileID.canonical.z){const L=this.proxyToSource[P.tileID.key][a.id],N=this._createProxiedId(P.tileID,k,g[P.tileID.key]&&g[P.tileID.key][a.id]);L?L.splice(L.length-1,0,N):this.proxyToSource[P.tileID.key][a.id]=[N],v.push(N),I=!0}}this._sourceTilesOverlap[a.id]=I}_setupProxiedCoordsForImageSource(a,h,g){if(!a.getSource().loaded())return;const v=this.proxiedCoords[a.id]=[],b=this.proxyCoords,I=a.getSource(),C=new l.pointGeometry(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),k=I.coordinates.map(l.MercatorCoordinate.fromLngLat).reduce((L,N)=>(L.min.x=Math.min(L.min.x,N.x-C.x),L.min.y=Math.min(L.min.y,N.y-C.y),L.max.x=Math.max(L.max.x,N.x-C.x),L.max.y=Math.max(L.max.y,N.y-C.y),L),{min:new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(L,N)=>{const G=L.wrap+L.canonical.x/(1<<L.canonical.z),X=L.canonical.y/(1<<L.canonical.z),W=l.EXTENT/(1<<L.canonical.z),K=N.wrap+N.canonical.x/(1<<N.canonical.z),Z=N.canonical.y/(1<<N.canonical.z);return G+W<K+k.min.x||G>K+k.max.x||X+W<Z+k.min.y||X>Z+k.max.y};for(let L=0;L<b.length;L++){const N=b[L];for(let G=0;G<h.length;G++){const X=a.getTile(h[G]);if(!X||!X.hasData()||P(N,X.tileID))continue;const W=this._createProxiedId(N,X,g[N.key]&&g[N.key][a.id]),K=this.proxyToSource[N.key][a.id];K?K.push(W):this.proxyToSource[N.key][a.id]=[W],v.push(W)}}}_createProxiedId(a,h,g){let v=this.orthoMatrix;if(g){const b=g.find(I=>I.key===h.tileID.key);if(b)return b}if(h.tileID.key!==a.key){const b=a.canonical.z-h.tileID.canonical.z;let I,C,k;v=l.create();const P=h.tileID.wrap-a.wrap<<a.overscaledZ;b>0?(I=l.EXTENT>>b,C=I*((h.tileID.canonical.x<<b)-a.canonical.x+P),k=I*((h.tileID.canonical.y<<b)-a.canonical.y)):(I=l.EXTENT<<-b,C=l.EXTENT*(h.tileID.canonical.x-(a.canonical.x+P<<-b)),k=l.EXTENT*(h.tileID.canonical.y-(a.canonical.y<<-b))),l.ortho(v,0,I,0,I,0,1),l.translate(v,v,[C,k,0])}return new cu(h.tileID,a.key,v)}_findTileCoveringTileID(a,h){let g=h.getTile(a);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[h.id],b=v[a.key];if(g=b?h.getTileByID(b):null,g&&g.hasData()||b===null)return g;let I=g?g.tileID:a,C=I.overscaledZ;const k=h.getSource().minzoom,P=[];if(!b){const N=h.getSource().maxzoom;if(a.canonical.z>=N){const G=a.canonical.z-N;h.getSource().reparseOverscaled?(C=Math.max(a.canonical.z+2,h.transform.tileZoom),I=new l.OverscaledTileID(C,a.wrap,N,a.canonical.x>>G,a.canonical.y>>G)):G!==0&&(C=N,I=new l.OverscaledTileID(C,a.wrap,N,a.canonical.x>>G,a.canonical.y>>G))}I.key!==a.key&&(P.push(I.key),g=h.getTile(I))}const L=N=>{P.forEach(G=>{v[G]=N}),P.length=0};for(C-=1;C>=k&&(!g||!g.hasData());C--){g&&L(g.tileID.key);const N=I.calculateScaledKey(C);if(g=h.getTileByID(N),g&&g.hasData())break;const G=v[N];if(G===null)break;G===void 0?P.push(N):g=h.getTileByID(G)}return L(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,h){let g=this._tilesDirty[a];g||(g=this._tilesDirty[a]={}),g[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(h){let g=0;const v=new l.StructArrayLayout2ui4,b=131;for(let I=1;I<129;I++){for(let C=1;C<129;C++)g=I*b+C,v.emplaceBack(g,g+1),v.emplaceBack(g,g+b),v.emplaceBack(g+1,g+b),I===128&&v.emplaceBack(g+b,g+b+1);v.emplaceBack(g+1,g+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=l.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class fm{static cacheKey(a,h,g,v){let b=`${h}${v?v.cacheKey:""}`;for(const I of g)a.usedDefines.includes(I)&&(b+=`/${I}`);return b}constructor(a,h,g,v,b,I){const C=a.gl;this.program=C.createProgram();const k=function(Z){const q=[];for(let Q=0;Q<Z.length;Q++){if(Z[Q]===null)continue;const H=Z[Q].split(" ");q.push(H.pop())}return q}(g.staticAttributes),P=v?v.getBinderAttributes():[],L=k.concat(P);let N=v?v.defines():[];N=N.concat(I.map(Z=>`#define ${Z}`));const G=N.concat(a.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(iu):iu,iu,cd,ld.fragmentSource,ad.fragmentSource,g.fragmentSource).join(`
`),X=N.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,cd,ld.vertexSource,ad.vertexSource,od.vertexSource,g.vertexSource).join(`
`),W=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(W,G),C.compileShader(W),C.attachShader(this.program,W);const K=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(K,X),C.compileShader(K),C.attachShader(this.program,K),this.attributes={},this.numAttributes=L.length;for(let Z=0;Z<this.numAttributes;Z++)L[Z]&&(C.bindAttribLocation(this.program,Z,L[Z]),this.attributes[L[Z]]=Z);C.linkProgram(this.program),C.deleteShader(K),C.deleteShader(W),this.fixedUniforms=b(a),this.binderUniforms=v?v.getUniforms(a):[],I.includes("TERRAIN")&&(this.terrainUniforms=(Z=>({u_dem:new l.Uniform1i(Z),u_dem_prev:new l.Uniform1i(Z),u_dem_unpack:new l.Uniform4f(Z),u_dem_tl:new l.Uniform2f(Z),u_dem_scale:new l.Uniform1f(Z),u_dem_tl_prev:new l.Uniform2f(Z),u_dem_scale_prev:new l.Uniform1f(Z),u_dem_size:new l.Uniform1f(Z),u_dem_lerp:new l.Uniform1f(Z),u_exaggeration:new l.Uniform1f(Z),u_depth:new l.Uniform1i(Z),u_depth_size_inv:new l.Uniform2f(Z),u_meter_to_dem:new l.Uniform1f(Z),u_label_plane_matrix_inv:new l.UniformMatrix4f(Z)}))(a)),I.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new l.Uniform3f(Z),u_tile_tr_up:new l.Uniform3f(Z),u_tile_br_up:new l.Uniform3f(Z),u_tile_bl_up:new l.Uniform3f(Z),u_tile_up_scale:new l.Uniform1f(Z)}))(a)),I.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new l.UniformMatrix4f(Z),u_fog_range:new l.Uniform2f(Z),u_fog_color:new l.Uniform4f(Z),u_fog_horizon_blend:new l.Uniform1f(Z),u_fog_temporal_offset:new l.Uniform1f(Z),u_frustum_tl:new l.Uniform3f(Z),u_frustum_tr:new l.Uniform3f(Z),u_frustum_br:new l.Uniform3f(Z),u_frustum_bl:new l.Uniform3f(Z),u_globe_pos:new l.Uniform3f(Z),u_globe_radius:new l.Uniform1f(Z),u_globe_transition:new l.Uniform1f(Z),u_is_globe:new l.Uniform1i(Z),u_viewport:new l.Uniform2f(Z)}))(a))}}setTerrainUniformValues(a,h){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(a,h){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(a,h){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in h)g[v].set(this.program,v,h[v])}}draw(a,h,g,v,b,I,C,k,P,L,N,G,X,W,K){const Z=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(g),a.setStencilMode(v),a.setColorMode(b),a.setCullFace(I);for(const Q of Object.keys(this.fixedUniforms))this.fixedUniforms[Q].set(this.program,Q,C[Q]);W&&W.setUniforms(this.program,a,this.binderUniforms,G,{zoom:X});const q={[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[h];for(const Q of N.get()){const H=Q.vaos||(Q.vaos={});(H[k]||(H[k]=new zl)).bind(a,this,P,W?W.getPaintVertexBuffers():[],L,Q.vertexOffset,K||[]),Z.drawElements(h,Q.primitiveLength*q,Z.UNSIGNED_SHORT,Q.primitiveOffset*q*2)}}}function pm(p,a,h){const g=1/bi(h,1,a.transform.tileZoom),v=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,a.transform.tileZoom)/v,I=b*(h.tileID.canonical.x+h.tileID.wrap*v),C=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[I>>16,C>>16],u_pixel_coord_lower:[65535&I,65535&C]}}const fd=l.create(),uu=(p,a,h,g,v,b,I,C,k,P,L)=>{const N=a.style.light,G=N.properties.get("position"),X=[G.x,G.y,G.z],W=l.create$1();N.properties.get("anchor")==="viewport"&&(l.fromRotation(W,-a.transform.angle),l.transformMat3(X,X,W));const K=N.properties.get("color"),Z=a.transform,q={u_matrix:p,u_lightpos:X,u_lightintensity:N.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:b};return Z.projection.name==="globe"&&(q.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],q.u_zoom_transition=k,q.u_inv_rot_matrix=L,q.u_merc_center=P,q.u_up_dir=Z.projection.upVector(new l.CanonicalTileID(0,0,0),P[0]*l.EXTENT,P[1]*l.EXTENT),q.u_height_lift=C),q},pd=(p,a,h,g,v,b,I,C,k,P,L,N,G)=>{const X=uu(p,a,h,g,v,b,I,P,L,N,G),W={u_height_factor:-Math.pow(2,I.overscaledZ)/k.tileSize/8};return l.extend(X,pm(C,a,k),W)},hu=p=>({u_matrix:p}),md=(p,a,h,g)=>l.extend(hu(p),pm(h,a,g)),mm=(p,a)=>({u_matrix:p,u_world:a}),Uy=(p,a,h,g,v)=>l.extend(md(p,a,h,g),{u_world:v}),Bl=l.create(),Fl=(p,a,h,g,v,b)=>{const I=p.transform,C=I.projection.name==="globe";let k;if(b.paint.get("circle-pitch-alignment")==="map")if(C){const L=l.globePixelsToTileUnits(I.zoom,a.canonical)*I._pixelsPerMercatorPixel;k=Float32Array.from([L,0,0,L])}else k=I.calculatePixelsToTileUnitsMatrix(h);else k=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:p.translatePosMatrix(a.projMatrix,h,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:l.exported.devicePixelRatio,u_extrude_scale:k,u_inv_rot_matrix:Bl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){P.u_inv_rot_matrix=g,P.u_merc_center=v,P.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],P.u_zoom_transition=l.globeToMercatorTransition(I.zoom);const L=v[0]*l.EXTENT,N=v[1]*l.EXTENT;P.u_up_dir=I.projection.upVector(new l.CanonicalTileID(0,0,0),L,N)}return P},gm=p=>{const a=[];return p.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),p.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a},du=(p,a,h,g)=>{const v=l.EXTENT/h.tileSize;return{u_matrix:p,u_camera_to_center_distance:a.getCameraToCenterDistance(g),u_extrude_scale:[a.pixelsToGLUnits[0]/v,a.pixelsToGLUnits[1]/v]}},fu=(p,a,h=1)=>({u_matrix:p,u_color:a,u_overlay:0,u_overlay_scale:h}),_s=l.create(),gd=(p,a,h,g,v,b,I)=>{const C=p.transform,k=C.projection.name==="globe",P=k?l.globePixelsToTileUnits(C.zoom,a.canonical)*C._pixelsPerMercatorPixel:bi(h,1,b),L={u_matrix:a.projMatrix,u_extrude_scale:P,u_intensity:I,u_inv_rot_matrix:_s,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){L.u_inv_rot_matrix=g,L.u_merc_center=v,L.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],L.u_zoom_transition=l.globeToMercatorTransition(C.zoom);const N=v[0]*l.EXTENT,G=v[1]*l.EXTENT;L.u_up_dir=C.projection.upVector(new l.CanonicalTileID(0,0,0),N,G)}return L},_m=(p,a,h,g,v,b,I,C)=>{const k=p.transform,P=k.calculatePixelsToTileUnitsMatrix(a),L={u_matrix:pu(p,a,h,v),u_pixels_to_tile_units:P,u_device_pixel_ratio:I,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:C};if(ym(h)){const N=yd(a,p.transform);L.u_texsize=a.lineAtlasTexture.size,L.u_scale=[N,g.fromScale,g.toScale],L.u_mix=g.t}return L},_d=(p,a,h,g,v,b)=>{const I=p.transform,C=yd(a,I);return{u_matrix:pu(p,a,h,v),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:b,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function yd(p,a){return 1/bi(p,1,a.tileZoom)}function pu(p,a,h,g){return p.translatePosMatrix(g||a.tileID.projMatrix,a,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function ym(p){const a=p.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}const vd=(p,a,h,g,v,b)=>{return{u_matrix:p,u_tl_parent:a,u_scale_parent:h,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(C=v.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(I=v.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Vy(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var I,C};function Vy(p){p*=Math.PI/180;const a=Math.sin(p),h=Math.cos(p);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}const Nl=l.create(),vm=(p,a,h,g,v,b,I,C,k,P,L,N,G,X,W,K)=>{const Z=v.transform,q={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:Z.width/Z.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:I,u_coord_matrix:C,u_is_text:+k,u_pitch_with_map:+g,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Nl,u_up_vector:[0,-1,0]};return K.name==="globe"&&(q.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],q.u_zoom_transition=N,q.u_inv_rot_matrix=X,q.u_merc_center=G,q.u_camera_forward=Z._camera.forward(),q.u_ecef_origin=l.globeECEFOrigin(Z.globeMatrix,L.toUnwrapped()),q.u_tile_matrix=Float32Array.from(Z.globeMatrix),q.u_up_vector=W),q},mu=(p,a,h,g,v,b,I,C,k,P,L,N,G,X,W,K,Z)=>l.extend(vm(p,a,h,g,v,b,I,C,k,P,N,G,X,W,K,Z),{u_gamma_scale:g?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:l.exported.devicePixelRatio,u_is_halo:+L}),jy=(p,a,h,g,v,b,I,C,k,P,L,N,G,X,W,K)=>l.extend(mu(p,a,h,g,v,b,I,C,!0,k,!0,L,N,G,X,W,K),{u_texsize_icon:P,u_texture_icon:1}),xd=(p,a,h)=>({u_matrix:p,u_opacity:a,u_color:h}),Gy=(p,a,h,g,v,b)=>l.extend(function(I,C,k,P){const L=k.imageManager.getPattern(I.from.toString()),N=k.imageManager.getPattern(I.to.toString()),{width:G,height:X}=k.imageManager.getPixelSize(),W=Math.pow(2,P.tileID.overscaledZ),K=P.tileSize*Math.pow(2,k.transform.tileZoom)/W,Z=K*(P.tileID.canonical.x+P.tileID.wrap*W),q=K*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[G,X],u_mix:C.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/bi(P,1,k.transform.tileZoom),u_pixel_coord_upper:[Z>>16,q>>16],u_pixel_coord_lower:[65535&Z,65535&q]}}(g,b,h,v),{u_matrix:p,u_opacity:a}),gu={fillExtrusion:p=>({u_matrix:new l.UniformMatrix4f(p),u_lightpos:new l.Uniform3f(p),u_lightintensity:new l.Uniform1f(p),u_lightcolor:new l.Uniform3f(p),u_vertical_gradient:new l.Uniform1f(p),u_opacity:new l.Uniform1f(p),u_edge_radius:new l.Uniform1f(p),u_ao:new l.Uniform2f(p),u_tile_id:new l.Uniform3f(p),u_zoom_transition:new l.Uniform1f(p),u_inv_rot_matrix:new l.UniformMatrix4f(p),u_merc_center:new l.Uniform2f(p),u_up_dir:new l.Uniform3f(p),u_height_lift:new l.Uniform1f(p)}),fillExtrusionPattern:p=>({u_matrix:new l.UniformMatrix4f(p),u_lightpos:new l.Uniform3f(p),u_lightintensity:new l.Uniform1f(p),u_lightcolor:new l.Uniform3f(p),u_vertical_gradient:new l.Uniform1f(p),u_height_factor:new l.Uniform1f(p),u_edge_radius:new l.Uniform1f(p),u_ao:new l.Uniform2f(p),u_tile_id:new l.Uniform3f(p),u_zoom_transition:new l.Uniform1f(p),u_inv_rot_matrix:new l.UniformMatrix4f(p),u_merc_center:new l.Uniform2f(p),u_up_dir:new l.Uniform3f(p),u_height_lift:new l.Uniform1f(p),u_image:new l.Uniform1i(p),u_texsize:new l.Uniform2f(p),u_pixel_coord_upper:new l.Uniform2f(p),u_pixel_coord_lower:new l.Uniform2f(p),u_scale:new l.Uniform3f(p),u_fade:new l.Uniform1f(p),u_opacity:new l.Uniform1f(p)}),fill:p=>({u_matrix:new l.UniformMatrix4f(p)}),fillPattern:p=>({u_matrix:new l.UniformMatrix4f(p),u_image:new l.Uniform1i(p),u_texsize:new l.Uniform2f(p),u_pixel_coord_upper:new l.Uniform2f(p),u_pixel_coord_lower:new l.Uniform2f(p),u_scale:new l.Uniform3f(p),u_fade:new l.Uniform1f(p)}),fillOutline:p=>({u_matrix:new l.UniformMatrix4f(p),u_world:new l.Uniform2f(p)}),fillOutlinePattern:p=>({u_matrix:new l.UniformMatrix4f(p),u_world:new l.Uniform2f(p),u_image:new l.Uniform1i(p),u_texsize:new l.Uniform2f(p),u_pixel_coord_upper:new l.Uniform2f(p),u_pixel_coord_lower:new l.Uniform2f(p),u_scale:new l.Uniform3f(p),u_fade:new l.Uniform1f(p)}),circle:p=>({u_camera_to_center_distance:new l.Uniform1f(p),u_extrude_scale:new l.UniformMatrix2f(p),u_device_pixel_ratio:new l.Uniform1f(p),u_matrix:new l.UniformMatrix4f(p),u_inv_rot_matrix:new l.UniformMatrix4f(p),u_merc_center:new l.Uniform2f(p),u_tile_id:new l.Uniform3f(p),u_zoom_transition:new l.Uniform1f(p),u_up_dir:new l.Uniform3f(p)}),collisionBox:p=>({u_matrix:new l.UniformMatrix4f(p),u_camera_to_center_distance:new l.Uniform1f(p),u_extrude_scale:new l.Uniform2f(p)}),collisionCircle:p=>({u_matrix:new l.UniformMatrix4f(p),u_inv_matrix:new l.UniformMatrix4f(p),u_camera_to_center_distance:new l.Uniform1f(p),u_viewport_size:new l.Uniform2f(p)}),debug:p=>({u_color:new l.UniformColor(p),u_matrix:new l.UniformMatrix4f(p),u_overlay:new l.Uniform1i(p),u_overlay_scale:new l.Uniform1f(p)}),clippingMask:p=>({u_matrix:new l.UniformMatrix4f(p)}),heatmap:p=>({u_extrude_scale:new l.Uniform1f(p),u_intensity:new l.Uniform1f(p),u_matrix:new l.UniformMatrix4f(p),u_inv_rot_matrix:new l.UniformMatrix4f(p),u_merc_center:new l.Uniform2f(p),u_tile_id:new l.Uniform3f(p),u_zoom_transition:new l.Uniform1f(p),u_up_dir:new l.Uniform3f(p)}),heatmapTexture:p=>({u_image:new l.Uniform1i(p),u_color_ramp:new l.Uniform1i(p),u_opacity:new l.Uniform1f(p)}),hillshade:p=>({u_matrix:new l.UniformMatrix4f(p),u_image:new l.Uniform1i(p),u_latrange:new l.Uniform2f(p),u_light:new l.Uniform2f(p),u_shadow:new l.UniformColor(p),u_highlight:new l.UniformColor(p),u_accent:new l.UniformColor(p)}),hillshadePrepare:p=>({u_matrix:new l.UniformMatrix4f(p),u_image:new l.Uniform1i(p),u_dimension:new l.Uniform2f(p),u_zoom:new l.Uniform1f(p),u_unpack:new l.Uniform4f(p)}),line:p=>({u_matrix:new l.UniformMatrix4f(p),u_pixels_to_tile_units:new l.UniformMatrix2f(p),u_device_pixel_ratio:new l.Uniform1f(p),u_units_to_pixels:new l.Uniform2f(p),u_dash_image:new l.Uniform1i(p),u_gradient_image:new l.Uniform1i(p),u_image_height:new l.Uniform1f(p),u_texsize:new l.Uniform2f(p),u_scale:new l.Uniform3f(p),u_mix:new l.Uniform1f(p),u_alpha_discard_threshold:new l.Uniform1f(p),u_trim_offset:new l.Uniform2f(p)}),linePattern:p=>({u_matrix:new l.UniformMatrix4f(p),u_texsize:new l.Uniform2f(p),u_pixels_to_tile_units:new l.UniformMatrix2f(p),u_device_pixel_ratio:new l.Uniform1f(p),u_image:new l.Uniform1i(p),u_units_to_pixels:new l.Uniform2f(p),u_scale:new l.Uniform3f(p),u_fade:new l.Uniform1f(p),u_alpha_discard_threshold:new l.Uniform1f(p)}),raster:p=>({u_matrix:new l.UniformMatrix4f(p),u_tl_parent:new l.Uniform2f(p),u_scale_parent:new l.Uniform1f(p),u_fade_t:new l.Uniform1f(p),u_opacity:new l.Uniform1f(p),u_image0:new l.Uniform1i(p),u_image1:new l.Uniform1i(p),u_brightness_low:new l.Uniform1f(p),u_brightness_high:new l.Uniform1f(p),u_saturation_factor:new l.Uniform1f(p),u_contrast_factor:new l.Uniform1f(p),u_spin_weights:new l.Uniform3f(p),u_perspective_transform:new l.Uniform2f(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new l.Uniform1i(p),u_is_size_feature_constant:new l.Uniform1i(p),u_size_t:new l.Uniform1f(p),u_size:new l.Uniform1f(p),u_camera_to_center_distance:new l.Uniform1f(p),u_rotate_symbol:new l.Uniform1i(p),u_aspect_ratio:new l.Uniform1f(p),u_fade_change:new l.Uniform1f(p),u_matrix:new l.UniformMatrix4f(p),u_label_plane_matrix:new l.UniformMatrix4f(p),u_coord_matrix:new l.UniformMatrix4f(p),u_is_text:new l.Uniform1i(p),u_pitch_with_map:new l.Uniform1i(p),u_texsize:new l.Uniform2f(p),u_tile_id:new l.Uniform3f(p),u_zoom_transition:new l.Uniform1f(p),u_inv_rot_matrix:new l.UniformMatrix4f(p),u_merc_center:new l.Uniform2f(p),u_camera_forward:new l.Uniform3f(p),u_tile_matrix:new l.UniformMatrix4f(p),u_up_vector:new l.Uniform3f(p),u_ecef_origin:new l.Uniform3f(p),u_texture:new l.Uniform1i(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new l.Uniform1i(p),u_is_size_feature_constant:new l.Uniform1i(p),u_size_t:new l.Uniform1f(p),u_size:new l.Uniform1f(p),u_camera_to_center_distance:new l.Uniform1f(p),u_rotate_symbol:new l.Uniform1i(p),u_aspect_ratio:new l.Uniform1f(p),u_fade_change:new l.Uniform1f(p),u_matrix:new l.UniformMatrix4f(p),u_label_plane_matrix:new l.UniformMatrix4f(p),u_coord_matrix:new l.UniformMatrix4f(p),u_is_text:new l.Uniform1i(p),u_pitch_with_map:new l.Uniform1i(p),u_texsize:new l.Uniform2f(p),u_texture:new l.Uniform1i(p),u_gamma_scale:new l.Uniform1f(p),u_device_pixel_ratio:new l.Uniform1f(p),u_tile_id:new l.Uniform3f(p),u_zoom_transition:new l.Uniform1f(p),u_inv_rot_matrix:new l.UniformMatrix4f(p),u_merc_center:new l.Uniform2f(p),u_camera_forward:new l.Uniform3f(p),u_tile_matrix:new l.UniformMatrix4f(p),u_up_vector:new l.Uniform3f(p),u_ecef_origin:new l.Uniform3f(p),u_is_halo:new l.Uniform1i(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new l.Uniform1i(p),u_is_size_feature_constant:new l.Uniform1i(p),u_size_t:new l.Uniform1f(p),u_size:new l.Uniform1f(p),u_camera_to_center_distance:new l.Uniform1f(p),u_rotate_symbol:new l.Uniform1i(p),u_aspect_ratio:new l.Uniform1f(p),u_fade_change:new l.Uniform1f(p),u_matrix:new l.UniformMatrix4f(p),u_label_plane_matrix:new l.UniformMatrix4f(p),u_coord_matrix:new l.UniformMatrix4f(p),u_is_text:new l.Uniform1i(p),u_pitch_with_map:new l.Uniform1i(p),u_texsize:new l.Uniform2f(p),u_texsize_icon:new l.Uniform2f(p),u_texture:new l.Uniform1i(p),u_texture_icon:new l.Uniform1i(p),u_gamma_scale:new l.Uniform1f(p),u_device_pixel_ratio:new l.Uniform1f(p),u_is_halo:new l.Uniform1i(p)}),background:p=>({u_matrix:new l.UniformMatrix4f(p),u_opacity:new l.Uniform1f(p),u_color:new l.UniformColor(p)}),backgroundPattern:p=>({u_matrix:new l.UniformMatrix4f(p),u_opacity:new l.Uniform1f(p),u_image:new l.Uniform1i(p),u_pattern_tl_a:new l.Uniform2f(p),u_pattern_br_a:new l.Uniform2f(p),u_pattern_tl_b:new l.Uniform2f(p),u_pattern_br_b:new l.Uniform2f(p),u_texsize:new l.Uniform2f(p),u_mix:new l.Uniform1f(p),u_pattern_size_a:new l.Uniform2f(p),u_pattern_size_b:new l.Uniform2f(p),u_scale_a:new l.Uniform1f(p),u_scale_b:new l.Uniform1f(p),u_pixel_coord_upper:new l.Uniform2f(p),u_pixel_coord_lower:new l.Uniform2f(p),u_tile_units_to_pixels:new l.Uniform1f(p)}),terrainRaster:au,terrainDepth:au,skybox:p=>({u_matrix:new l.UniformMatrix4f(p),u_sun_direction:new l.Uniform3f(p),u_cubemap:new l.Uniform1i(p),u_opacity:new l.Uniform1f(p),u_temporal_offset:new l.Uniform1f(p)}),skyboxGradient:p=>({u_matrix:new l.UniformMatrix4f(p),u_color_ramp:new l.Uniform1i(p),u_center_direction:new l.Uniform3f(p),u_radius:new l.Uniform1f(p),u_opacity:new l.Uniform1f(p),u_temporal_offset:new l.Uniform1f(p)}),skyboxCapture:p=>({u_matrix_3f:new l.UniformMatrix3f(p),u_sun_direction:new l.Uniform3f(p),u_sun_intensity:new l.Uniform1f(p),u_color_tint_r:new l.Uniform4f(p),u_color_tint_m:new l.Uniform4f(p),u_luminance:new l.Uniform1f(p)}),globeRaster:p=>({u_proj_matrix:new l.UniformMatrix4f(p),u_globe_matrix:new l.UniformMatrix4f(p),u_normalize_matrix:new l.UniformMatrix4f(p),u_merc_matrix:new l.UniformMatrix4f(p),u_zoom_transition:new l.Uniform1f(p),u_merc_center:new l.Uniform2f(p),u_image0:new l.Uniform1i(p),u_grid_matrix:new l.UniformMatrix3f(p),u_frustum_tl:new l.Uniform3f(p),u_frustum_tr:new l.Uniform3f(p),u_frustum_br:new l.Uniform3f(p),u_frustum_bl:new l.Uniform3f(p),u_globe_pos:new l.Uniform3f(p),u_globe_radius:new l.Uniform1f(p),u_viewport:new l.Uniform2f(p)}),globeAtmosphere:p=>({u_frustum_tl:new l.Uniform3f(p),u_frustum_tr:new l.Uniform3f(p),u_frustum_br:new l.Uniform3f(p),u_frustum_bl:new l.Uniform3f(p),u_horizon:new l.Uniform1f(p),u_transition:new l.Uniform1f(p),u_fadeout_range:new l.Uniform1f(p),u_color:new l.Uniform4f(p),u_high_color:new l.Uniform4f(p),u_space_color:new l.Uniform4f(p),u_star_intensity:new l.Uniform1f(p),u_star_density:new l.Uniform1f(p),u_star_size:new l.Uniform1f(p),u_temporal_offset:new l.Uniform1f(p),u_horizon_angle:new l.Uniform1f(p),u_rotation_matrix:new l.UniformMatrix4f(p)})};let _u;function bd(p,a,h,g,v,b,I){const C=p.context,k=C.gl,P=p.transform,L=p.useProgram("collisionBox"),N=[];let G=0,X=0;for(let le=0;le<g.length;le++){const ce=g[le],ie=a.getTile(ce),he=ie.getBucket(h);if(!he)continue;const xe=Qc(ce,he,P);let Ae=xe;v[0]===0&&v[1]===0||(Ae=p.translatePosMatrix(xe,ie,v,b));const Ie=I?he.textCollisionBox:he.iconCollisionBox,qe=he.collisionCircleArray;if(qe.length>0){const _e=l.create(),Fe=Ae;l.mul(_e,he.placementInvProjMatrix,P.glCoordMatrix),l.mul(_e,_e,he.placementViewportMatrix),N.push({circleArray:qe,circleOffset:X,transform:Fe,invTransform:_e,projection:he.getProjection()}),G+=qe.length/4,X=G}Ie&&(p.terrain&&p.terrain.setupElevationDraw(ie,L),L.draw(C,k.LINES,l.DepthMode.disabled,l.StencilMode.disabled,p.colorModeForRenderPass(),l.CullFaceMode.disabled,du(Ae,P,ie,he.getProjection()),h.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,P.zoom,null,[Ie.collisionVertexBuffer,Ie.collisionVertexBufferExt]))}if(!I||!N.length)return;const W=p.useProgram("collisionCircle"),K=new l.StructArrayLayout2f1f2i16;K.resize(4*G),K._trim();let Z=0;for(const le of N)for(let ce=0;ce<le.circleArray.length/4;ce++){const ie=4*ce,he=le.circleArray[ie+0],xe=le.circleArray[ie+1],Ae=le.circleArray[ie+2],Ie=le.circleArray[ie+3];K.emplace(Z++,he,xe,Ae,Ie,0),K.emplace(Z++,he,xe,Ae,Ie,1),K.emplace(Z++,he,xe,Ae,Ie,2),K.emplace(Z++,he,xe,Ae,Ie,3)}(!_u||_u.length<2*G)&&(_u=function(le){const ce=2*le,ie=new l.StructArrayLayout3ui6;ie.resize(ce),ie._trim();for(let he=0;he<ce;he++){const xe=6*he;ie.uint16[xe+0]=4*he+0,ie.uint16[xe+1]=4*he+1,ie.uint16[xe+2]=4*he+2,ie.uint16[xe+3]=4*he+2,ie.uint16[xe+4]=4*he+3,ie.uint16[xe+5]=4*he+0}return ie}(G));const q=C.createIndexBuffer(_u,!0),Q=C.createVertexBuffer(K,l.collisionCircleLayout.members,!0);for(const le of N){const ce={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(H=P).getCameraToCenterDistance(le.projection),u_viewport_size:[H.width,H.height]};W.draw(C,k.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,p.colorModeForRenderPass(),l.CullFaceMode.disabled,ce,h.id,Q,q,l.SegmentVector.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,P.zoom)}var H;Q.destroy(),q.destroy()}const wd=l.create();function ka(p,a,h,g,v,b){const{horizontalAlign:I,verticalAlign:C}=l.getAnchorAlignment(p),k=-(I-.5)*a,P=-(C-.5)*h,L=l.evaluateVariableOffset(p,g);return new l.pointGeometry((k/v+L[0])*b,(P/v+L[1])*b)}function $y(p,a,h,g,v,b,I,C,k,P,L){const N=p.text.placedSymbolArray,G=p.text.dynamicLayoutVertexArray,X=p.icon.dynamicLayoutVertexArray,W={},K=Dl(C,p.getProjection(),b),Z=b.elevation,q=p.getProjection().upVectorScale(C.canonical,b.center.lat,b.worldSize);G.clear();for(let Q=0;Q<N.length;Q++){const H=N.get(Q),le=p.allowVerticalPlacement&&!H.placedOrientation,ce=H.hidden||!H.crossTileID||le?null:g[H.crossTileID];if(ce){const ie=new l.pointGeometry(H.tileAnchorX,H.tileAnchorY),he=p.getProjection().upVector(C.canonical,ie.x,ie.y),xe=Z?Z.getAtTileOffset(C,ie.x,ie.y):0,Ae=on([H.projectedAnchorX+xe*he[0]*q.metersToTile,H.projectedAnchorY+xe*he[1]*q.metersToTile,H.projectedAnchorZ+xe*he[2]*q.metersToTile],h?K:I),Ie=ln(b.getCameraToCenterDistance(p.getProjection()),Ae.signedDistanceFromCamera);let qe=v.evaluateSizeForFeature(p.textSizeData,P,H)*Ie/l.ONE_EM;h&&(qe*=p.tilePixelRatio/k);const{width:_e,height:Fe,anchor:Be,textOffset:we,textScale:me}=ce,ct=ka(Be,_e,Fe,we,me,qe);let Ye;if(h){const Qe=ie.add(ct),{x:At,y:$t,z:Ot}=p.getProjection().projectTilePoint(Qe.x,Qe.y,C.canonical);Ye=on([At+xe*he[0]*q.metersToTile,$t+xe*he[1]*q.metersToTile,Ot+xe*he[2]*q.metersToTile],I).point}else{const Qe=a?ct.rotate(-b.angle):ct;Ye=[Ae.point[0]+Qe.x,Ae.point[1]+Qe.y,0]}const rt=p.allowVerticalPlacement&&H.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let Qe=0;Qe<H.numGlyphs;Qe++)l.addDynamicAttributes(G,Ye[0],Ye[1],Ye[2],rt);L&&H.associatedIconIndex>=0&&(W[H.associatedIconIndex]={shiftedAnchor:Ye,angle:rt})}else ts(H.numGlyphs,G)}if(L){X.clear();const Q=p.icon.placedSymbolArray;for(let H=0;H<Q.length;H++){const le=Q.get(H);if(le.hidden)ts(le.numGlyphs,X);else{const ce=W[H];if(ce)for(let ie=0;ie<le.numGlyphs;ie++)l.addDynamicAttributes(X,ce.shiftedAnchor[0],ce.shiftedAnchor[1],ce.shiftedAnchor[2],ce.angle);else ts(le.numGlyphs,X)}}p.icon.dynamicLayoutVertexBuffer.updateData(X)}p.text.dynamicLayoutVertexBuffer.updateData(G)}function qy(p,a,h){return h.iconsInText&&a?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function xm(p,a,h,g,v,b,I,C,k,P,L,N){const G=p.context,X=G.gl,W=p.transform,K=C==="map",Z=k==="map",q=K&&h.layout.get("symbol-placement")!=="point",Q=K&&!Z&&!q,H=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let le=!1;const ce=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),ie=[l.mercatorXfromLng(W.center.lng),l.mercatorYfromLat(W.center.lat)],he=h.layout.get("text-variable-anchor"),xe=W.projection.name==="globe",Ae=[],Ie=[0,-1,0];let qe=Ie;!xe&&!W.mercatorFromTransition||K||(qe=function(_e){const Fe=_e._camera.getWorldToCamera(_e.worldSize,1),Be=l.multiply([],Fe,_e.globeMatrix);l.invert(Be,Be);const we=[0,0,0],me=[0,1,0,0];return l.transformMat4$1(me,me,Be),we[0]=me[0],we[1]=me[1],we[2]=me[2],l.normalize(we,we),we}(W));for(const _e of g){const Fe=a.getTile(_e),Be=Fe.getBucket(h);if(!Be||Be.projection.name==="mercator"&&xe)continue;const we=v?Be.text:Be.icon;if(!we||Be.fullyClipped||!we.segments.get().length)continue;const me=we.programConfigurations.get(h.id),ct=v||Be.sdfIcons,Ye=v?Be.textSizeData:Be.iconSizeData,rt=Z||W.pitch!==0,Qe=l.evaluateSizeForZoom(Ye,W.zoom);let At,$t,Ot,Ct,Je=[0,0],Xt=null;if(v){if($t=Fe.glyphAtlasTexture,Ot=X.LINEAR,At=Fe.glyphAtlasTexture.size,Be.iconsInText){Je=Fe.imageAtlasTexture.size,Xt=Fe.imageAtlasTexture;const Vi=Ye.kind==="composite"||Ye.kind==="camera";Ct=rt||p.options.rotating||p.options.zooming||Vi?X.LINEAR:X.NEAREST}}else{const Vi=h.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;$t=Fe.imageAtlasTexture,Ot=ct||p.options.rotating||p.options.zooming||Vi||rt?X.LINEAR:X.NEAREST,At=Fe.imageAtlasTexture.size}const tn=Be.projection.name==="globe",Nn=tn?qe:Ie,Un=tn?l.globeToMercatorTransition(W.zoom):0,Pn=Dl(_e,Be.getProjection(),W),Mi=W.calculatePixelsToTileUnitsMatrix(Fe),ur=ba(Pn,Fe.tileID.canonical,Z,K,W,Be.getProjection(),Mi),xs=p.terrain&&Z&&q?l.invert(l.create(),ur):wd,Xn=wa(Pn,Fe.tileID.canonical,Z,K,W,Be.getProjection(),Mi),oi=he&&Be.hasTextData(),Mn=h.layout.get("icon-text-fit")!=="none"&&oi&&Be.hasIconData();if(q){const Vi=W.elevation,bs=Vi?Vi.getAtTileOffsetFunc(_e,W.center.lat,W.worldSize,Be.getProjection()):rs=>[0,0,0],ro=im(Pn,Fe.tileID.canonical,Z,K,W,Be.getProjection(),Mi);Ta(Be,Pn,p,v,ro,Xn,Z,P,bs,_e)}const _i=q||v&&he||Mn,Ji=p.translatePosMatrix(Pn,Fe,b,I),qn=_i?wd:ur,Ir=p.translatePosMatrix(Xn,Fe,b,I,!0),Oo=Be.getProjection().createInversionMatrix(W,_e.canonical),is=[];p.terrainRenderModeElevated()&&Z&&is.push("PITCH_WITH_MAP_TERRAIN"),tn&&is.push("PROJECTION_GLOBE_VIEW"),_i&&is.push("PROJECTED_POS_ON_VIEWPORT");const hr=ct&&h.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let La;La=ct?Be.iconsInText?jy(Ye.kind,Qe,Q,Z,p,Ji,qn,Ir,At,Je,_e,Un,ie,Oo,Nn,Be.getProjection()):mu(Ye.kind,Qe,Q,Z,p,Ji,qn,Ir,v,At,!0,_e,Un,ie,Oo,Nn,Be.getProjection()):vm(Ye.kind,Qe,Q,Z,p,Ji,qn,Ir,v,At,_e,Un,ie,Oo,Nn,Be.getProjection());const io={program:p.useProgram(qy(ct,v,Be),me,is),buffers:we,uniformValues:La,atlasTexture:$t,atlasTextureIcon:Xt,atlasInterpolation:Ot,atlasInterpolationIcon:Ct,isSDF:ct,hasHalo:hr,tile:Fe,labelPlaneMatrixInv:xs};if(H&&Be.canOverlap){le=!0;const Vi=we.segments.get();for(const bs of Vi)Ae.push({segments:new l.SegmentVector([bs]),sortKey:bs.sortKey,state:io})}else Ae.push({segments:we.segments,sortKey:0,state:io})}le&&Ae.sort((_e,Fe)=>_e.sortKey-Fe.sortKey);for(const _e of Ae){const Fe=_e.state;if(p.terrain&&p.terrain.setupElevationDraw(Fe.tile,Fe.program,{useDepthForOcclusion:!xe,labelPlaneMatrixInv:Fe.labelPlaneMatrixInv}),G.activeTexture.set(X.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,X.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(G.activeTexture.set(X.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Fe.isSDF){const Be=Fe.uniformValues;Fe.hasHalo&&(Be.u_is_halo=1,bm(Fe.buffers,_e.segments,h,p,Fe.program,ce,L,N,Be)),Be.u_is_halo=0}bm(Fe.buffers,_e.segments,h,p,Fe.program,ce,L,N,Fe.uniformValues)}}function bm(p,a,h,g,v,b,I,C,k){const P=g.context,L=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer];v.draw(P,P.gl.TRIANGLES,b,I,C,l.CullFaceMode.disabled,k,h.id,p.layoutVertexBuffer,p.indexBuffer,a,h.paint,g.transform.zoom,p.programConfigurations.get(h.id),L)}function wm(p,a,h,g,v,b,I){const C=p.context.gl,k=h.paint.get("fill-pattern"),P=k&&k.constantOr(1),L=h.getCrossfadeParameters();let N,G,X,W,K;I?(G=P&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=C.LINES):(G=P?"fillPattern":"fill",N=C.TRIANGLES);for(const Z of g){const q=a.getTile(Z);if(P&&!q.patternsLoaded())continue;const Q=q.getBucket(h);if(!Q)continue;p.prepareDrawTile();const H=Q.programConfigurations.get(h.id),le=p.useProgram(G,H);P&&(p.context.activeTexture.set(C.TEXTURE0),q.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),H.updatePaintBuffers(L));const ce=k.constantOr(null);if(ce&&q.imageAtlas){const he=q.imageAtlas,xe=he.patternPositions[ce.to.toString()],Ae=he.patternPositions[ce.from.toString()];xe&&Ae&&H.setConstantPatternPositions(xe,Ae)}const ie=p.translatePosMatrix(Z.projMatrix,q,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){W=Q.indexBuffer2,K=Q.segments2;const he=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];X=G==="fillOutlinePattern"&&P?Uy(ie,p,L,q,he):mm(ie,he)}else W=Q.indexBuffer,K=Q.segments,X=P?md(ie,p,L,q):hu(ie);p.prepareDrawProgram(p.context,le,Z.toUnwrapped()),le.draw(p.context,N,v,p.stencilModeForClipping(Z),b,l.CullFaceMode.disabled,X,h.id,Q.layoutVertexBuffer,W,K,h.paint,p.transform.zoom,H)}}function Td(p,a,h,g,v,b,I){const C=p.context,k=C.gl,P=p.transform,L=h.paint.get("fill-extrusion-pattern"),N=L.constantOr(1),G=h.getCrossfadeParameters(),X=h.paint.get("fill-extrusion-opacity"),W=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],K=h.layout.get("fill-extrusion-edge-radius"),Z=P.projection.name==="globe"?l.fillExtrusionHeightLift():0,q=P.projection.name==="globe",Q=q?l.globeToMercatorTransition(P.zoom):0,H=[l.mercatorXfromLng(P.center.lng),l.mercatorYfromLat(P.center.lat)],le=[];q&&(le.push("PROJECTION_GLOBE_VIEW"),p.style.terrainSetForDrapingOnly()&&le.push("TERRAIN")),W[0]>0&&le.push("FAUX_AO");for(const ce of g){const ie=a.getTile(ce),he=ie.getBucket(h);if(!he||he.projection.name!==P.projection.name)continue;const xe=he.programConfigurations.get(h.id),Ae=p.useProgram(N?"fillExtrusionPattern":"fillExtrusion",xe,le);if(p.terrain){const me=p.terrain;if(p.style.terrainSetForDrapingOnly())me.setupElevationDraw(ie,Ae,{useMeterToDem:!0});else{if(!he.enableTerrain)continue;if(me.setupElevationDraw(ie,Ae,{useMeterToDem:!0}),Ed(C,a,ce,he,h,me),!he.centroidVertexBuffer){const ct=Ae.attributes.a_centroid_pos;ct!==void 0&&k.vertexAttrib2f(ct,0,0)}}}N&&(p.context.activeTexture.set(k.TEXTURE0),ie.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),xe.updatePaintBuffers(G));const Ie=L.constantOr(null);if(Ie&&ie.imageAtlas){const me=ie.imageAtlas,ct=me.patternPositions[Ie.to.toString()],Ye=me.patternPositions[Ie.from.toString()];ct&&Ye&&xe.setConstantPatternPositions(ct,Ye)}const qe=p.translatePosMatrix(ce.projMatrix,ie,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),_e=P.projection.createInversionMatrix(P,ce.canonical),Fe=h.paint.get("fill-extrusion-vertical-gradient"),Be=N?pd(qe,p,Fe,X,W,K,ce,G,ie,Z,Q,H,_e):uu(qe,p,Fe,X,W,K,ce,Z,Q,H,_e);p.prepareDrawProgram(C,Ae,ce.toUnwrapped());const we=[];p.terrain&&we.push(he.centroidVertexBuffer),q&&we.push(he.layoutVertexExtBuffer),Ae.draw(C,C.gl.TRIANGLES,v,b,I,l.CullFaceMode.backCCW,Be,h.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,h.paint,p.transform.zoom,xe,we)}}function Ed(p,a,h,g,v,b){const I=[q=>{let Q=q.canonical.x-1,H=q.wrap;return Q<0&&(Q=(1<<q.canonical.z)-1,H--),new l.OverscaledTileID(q.overscaledZ,H,q.canonical.z,Q,q.canonical.y)},q=>{let Q=q.canonical.x+1,H=q.wrap;return Q===1<<q.canonical.z&&(Q=0,H++),new l.OverscaledTileID(q.overscaledZ,H,q.canonical.z,Q,q.canonical.y)},q=>new l.OverscaledTileID(q.overscaledZ,q.wrap,q.canonical.z,q.canonical.x,(q.canonical.y===0?1<<q.canonical.z:q.canonical.y)-1),q=>new l.OverscaledTileID(q.overscaledZ,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y===(1<<q.canonical.z)-1?0:q.canonical.y+1)],C=q=>{const Q=a.getSource().minzoom,H=ce=>{const ie=a.getTileByID(ce);if(ie&&ie.hasData())return ie.getBucket(v)},le=[0,-1,1];for(const ce of le){if(q.overscaledZ+ce<Q)continue;const ie=H(q.calculateScaledKey(q.overscaledZ+ce));if(ie)return ie}},k=[0,0,0],P=(q,Q)=>(k[0]=Math.min(q.min.y,Q.min.y),k[1]=Math.max(q.max.y,Q.max.y),k[2]=l.EXTENT-Q.min.x>q.max.x?Q.min.x-l.EXTENT:q.max.x,k),L=(q,Q)=>(k[0]=Math.min(q.min.x,Q.min.x),k[1]=Math.max(q.max.x,Q.max.x),k[2]=l.EXTENT-Q.min.y>q.max.y?Q.min.y-l.EXTENT:q.max.y,k),N=[(q,Q)=>P(q,Q),(q,Q)=>P(Q,q),(q,Q)=>L(q,Q),(q,Q)=>L(Q,q)],G=new l.pointGeometry(0,0);let X,W,K;const Z=(q,Q,H,le,ce)=>{const ie=[[le?H:q,le?q:H,0],[le?H:Q,le?Q:H,0]],he=ce<0?l.EXTENT+ce:ce,xe=[le?he:(q+Q)/2,le?(q+Q)/2:he,0];return H===0&&ce<0||H!==0&&ce>0?b.getForTilePoints(K,[xe],!0,W):ie.push(xe),b.getForTilePoints(h,ie,!0,X),Math.max(ie[0][2],ie[1][2],xe[2])/b.exaggeration()};for(let q=0;q<4;q++){const Q=(q<2?1:5)-q,H=g.borders[q];if(H.length===0)continue;const le=K=I[q](h),ce=C(le);if(!(ce&&ce instanceof l.FillExtrusionBucket&&ce.enableTerrain)||g.borderDoneWithNeighborZ[q]===ce.canonical.z&&ce.borderDoneWithNeighborZ[Q]===g.canonical.z||(W=b.findDEMTileFor(le),!W||!W.dem))continue;if(!X){const Ae=b.findDEMTileFor(h);if(!Ae||!Ae.dem)return;X=Ae}const ie=ce.borders[Q];let he=0;const xe=ce.borderDoneWithNeighborZ[Q]!==g.canonical.z;if(g.canonical.z===ce.canonical.z){for(let Ae=0;Ae<H.length;Ae++){const Ie=g.featuresOnBorder[H[Ae]],qe=Ie.borders[q];let _e;for(;he<ie.length&&(_e=ce.featuresOnBorder[ie[he]],!(_e.borders[Q][1]>qe[0]+3));)xe&&ce.encodeCentroid(void 0,_e,!1),he++;if(_e&&he<ie.length){const Fe=he;let Be=0;for(;!(_e.borders[Q][0]>qe[1]-3)&&(Be++,++he!==ie.length);)_e=ce.featuresOnBorder[ie[he]];if(_e=ce.featuresOnBorder[ie[Fe]],Ie.intersectsCount()>1||_e.intersectsCount()>1||Be!==1){Be!==1&&(he=Fe),g.encodeCentroid(void 0,Ie,!1),xe&&ce.encodeCentroid(void 0,_e,!1);continue}const we=N[q](Ie,_e),me=q%2?l.EXTENT-1:0;G.x=Z(we[0],Math.min(l.EXTENT-1,we[1]),me,q<2,we[2]),G.y=0,g.encodeCentroid(G,Ie,!1),xe&&ce.encodeCentroid(G,_e,!1)}else g.encodeCentroid(void 0,Ie,!1)}g.borderDoneWithNeighborZ[q]=ce.canonical.z,g.needsCentroidUpdate=!0,xe&&(ce.borderDoneWithNeighborZ[Q]=g.canonical.z,ce.needsCentroidUpdate=!0)}else{for(const Ae of H)g.encodeCentroid(void 0,g.featuresOnBorder[Ae],!1);if(xe){for(const Ae of ie)ce.encodeCentroid(void 0,ce.featuresOnBorder[Ae],!1);ce.borderDoneWithNeighborZ[Q]=g.canonical.z,ce.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[q]=ce.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(p)}const Id=new l.Color(1,0,0,1),Tm=new l.Color(0,1,0,1),Em=new l.Color(0,0,1,1),Im=new l.Color(1,0,1,1),Sd=new l.Color(0,1,1,1);function Ro(p,a,h){const g=p.context,v=p.transform,b=g.gl,I=v.projection.name==="globe",C=I?["PROJECTION_GLOBE_VIEW"]:null;let k=h.projMatrix;if(I&&l.globeToMercatorTransition(v.zoom)>0){const Ie=l.transitionTileAABBinECEF(h.canonical,v),qe=l.globeDenormalizeECEF(Ie);k=l.multiply(new Float32Array(16),v.globeMatrix,qe),l.multiply(k,v.projMatrix,k)}const P=p.useProgram("debug",null,C),L=a.getTileByID(h.key);p.terrain&&p.terrain.setupElevationDraw(L,P);const N=l.DepthMode.disabled,G=l.StencilMode.disabled,X=p.colorModeForRenderPass(),W="$debug";g.activeTexture.set(b.TEXTURE0),p.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),I?L._makeGlobeTileDebugBuffers(p.context,v):L._makeDebugTileBoundsBuffers(p.context,v.projection);const K=L._tileDebugBuffer||p.debugBuffer,Z=L._tileDebugIndexBuffer||p.debugIndexBuffer,q=L._tileDebugSegments||p.debugSegments;P.draw(g,b.LINE_STRIP,N,G,X,l.CullFaceMode.disabled,fu(k,l.Color.red),W,K,Z,q,null,null,null,[L._globeTileDebugBorderBuffer]);const Q=L.latestRawTileData,H=Math.floor((Q&&Q.byteLength||0)/1024),le=a.getTile(h).tileSize,ce=512/Math.min(le,512)*(h.overscaledZ/v.zoom)*.5;let ie=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ie+=` => ${h.overscaledZ}`),ie+=` ${H}kb`,function(Ie,qe){Ie.initDebugOverlayCanvas();const _e=Ie.debugOverlayCanvas,Fe=Ie.context.gl,Be=Ie.debugOverlayCanvas.getContext("2d");Be.clearRect(0,0,_e.width,_e.height),Be.shadowColor="white",Be.shadowBlur=2,Be.lineWidth=1.5,Be.strokeStyle="white",Be.textBaseline="top",Be.font="bold 36px Open Sans, sans-serif",Be.fillText(qe,5,5),Be.strokeText(qe,5,5),Ie.debugOverlayTexture.update(_e),Ie.debugOverlayTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}(p,ie);const he=L._tileDebugTextBuffer||p.debugBuffer,xe=L._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ae=L._tileDebugTextSegments||p.debugSegments;P.draw(g,b.TRIANGLES,N,G,l.ColorMode.alphaBlended,l.CullFaceMode.disabled,fu(k,l.Color.transparent,ce),W,he,xe,Ae,null,null,null,[L._globeTileDebugTextBuffer])}function Ma(p,a,h,g){Ms(p,0,a+h/2,p.transform.width,h,g)}function Ad(p,a,h,g){Ms(p,a-h/2,0,h,p.transform.height,g)}function Ms(p,a,h,g,v,b){const I=p.context,C=I.gl;C.enable(C.SCISSOR_TEST),C.scissor(a*l.exported.devicePixelRatio,h*l.exported.devicePixelRatio,g*l.exported.devicePixelRatio,v*l.exported.devicePixelRatio),I.clear({color:b}),C.disable(C.SCISSOR_TEST)}const Da=l.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Sm}=Da;function ys(p,a,h,g){p.emplaceBack(a,h,g)}class Cn{constructor(a){this.vertexArray=new l.StructArrayLayout3f12,this.indices=new l.StructArrayLayout3ui6,ys(this.vertexArray,-1,-1,1),ys(this.vertexArray,1,-1,1),ys(this.vertexArray,-1,1,1),ys(this.vertexArray,1,1,1),ys(this.vertexArray,-1,-1,-1),ys(this.vertexArray,1,-1,-1),ys(this.vertexArray,-1,1,-1),ys(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Sm),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=l.SegmentVector.simpleSegment(0,0,36,12)}}function Ds(p,a,h,g,v,b){const I=p.gl,C=a.paint.get("sky-atmosphere-color"),k=a.paint.get("sky-atmosphere-halo-color"),P=a.paint.get("sky-atmosphere-sun-intensity"),L=((N,G,X,W,K)=>({u_matrix_3f:N,u_sun_direction:G,u_sun_intensity:X,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(l.fromMat4(l.create$1(),g),v,P,C,k);I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+b,a.skyboxTexture,0),h.draw(p,I.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.frontCW,L,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const Wy=l.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Am{constructor(a){const h=new l.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const g=new l.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(h,Wy.members),this.indexBuffer=a.createIndexBuffer(g),this.segments=l.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Pa={symbol:function(p,a,h,g,v){if(p.renderPass!=="translucent")return;const b=l.StencilMode.disabled,I=p.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(C,k,P,L,N,G,X){const W=k.transform,K=N==="map",Z=G==="map";for(const q of C){const Q=L.getTile(q),H=Q.getBucket(P);if(!H||!H.text||!H.text.segments.get().length)continue;const le=l.evaluateSizeForZoom(H.textSizeData,W.zoom),ce=Dl(q,H.getProjection(),W),ie=W.calculatePixelsToTileUnitsMatrix(Q),he=ba(ce,Q.tileID.canonical,Z,K,W,H.getProjection(),ie),xe=P.layout.get("icon-text-fit")!=="none"&&H.hasIconData();if(le){const Ae=Math.pow(2,W.zoom-Q.tileID.overscaledZ);$y(H,K,Z,X,l.symbolSize,W,he,q,Ae,le,xe)}}}(g,p,h,a,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v),h.paint.get("icon-opacity").constantOr(1)!==0&&xm(p,a,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),b,I),h.paint.get("text-opacity").constantOr(1)!==0&&xm(p,a,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),b,I),a.map.showCollisionBoxes&&(bd(p,a,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),bd(p,a,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(p,a,h,g){if(p.renderPass!=="translucent")return;const v=h.paint.get("circle-opacity"),b=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),C=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(v.constantOr(1)===0&&(b.constantOr(1)===0||I.constantOr(1)===0))return;const k=p.context,P=k.gl,L=p.transform,N=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),G=l.StencilMode.disabled,X=p.colorModeForRenderPass(),W=L.projection.name==="globe",K=[l.mercatorXfromLng(L.center.lng),l.mercatorYfromLat(L.center.lat)],Z=[];for(let Q=0;Q<g.length;Q++){const H=g[Q],le=a.getTile(H),ce=le.getBucket(h);if(!ce||ce.projection.name!==L.projection.name)continue;const ie=ce.programConfigurations.get(h.id),he=gm(h);W&&he.push("PROJECTION_GLOBE_VIEW");const xe=p.useProgram("circle",ie,he),Ae=ce.layoutVertexBuffer,Ie=ce.globeExtVertexBuffer,qe=ce.indexBuffer,_e=L.projection.createInversionMatrix(L,H.canonical),Fe={programConfiguration:ie,program:xe,layoutVertexBuffer:Ae,globeExtVertexBuffer:Ie,indexBuffer:qe,uniformValues:Fl(p,H,le,_e,K,h),tile:le};if(C){const Be=ce.segments.get();for(const we of Be)Z.push({segments:new l.SegmentVector([we]),sortKey:we.sortKey,state:Fe})}else Z.push({segments:ce.segments,sortKey:0,state:Fe})}C&&Z.sort((Q,H)=>Q.sortKey-H.sortKey);const q={useDepthForOcclusion:!W};for(const Q of Z){const{programConfiguration:H,program:le,layoutVertexBuffer:ce,globeExtVertexBuffer:ie,indexBuffer:he,uniformValues:xe,tile:Ae}=Q.state,Ie=Q.segments;p.terrain&&p.terrain.setupElevationDraw(Ae,le,q),p.prepareDrawProgram(k,le,Ae.tileID.toUnwrapped()),le.draw(k,P.TRIANGLES,N,G,X,l.CullFaceMode.disabled,xe,h.id,ce,he,Ie,h.paint,L.zoom,H,[ie])}},heatmap:function(p,a,h,g){if(h.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const v=p.context,b=v.gl,I=l.StencilMode.disabled,C=new l.ColorMode([b.ONE,b.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(X,W,K,Z){const q=X.gl,Q=W.width*Z,H=W.height*Z;X.activeTexture.set(q.TEXTURE1),X.viewport.set([0,0,Q,H]);let le=K.heatmapFbo;if(!le||le&&(le.width!==Q||le.height!==H)){le&&le.destroy();const ce=q.createTexture();q.bindTexture(q.TEXTURE_2D,ce),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),le=K.heatmapFbo=X.createFramebuffer(Q,H,!1),function(ie,he,xe,Ae,Ie,qe){const _e=ie.gl;_e.texImage2D(_e.TEXTURE_2D,0,_e.RGBA,Ie,qe,0,_e.RGBA,ie.extRenderToTextureHalfFloat?ie.extTextureHalfFloat.HALF_FLOAT_OES:_e.UNSIGNED_BYTE,null),Ae.colorAttachment.set(xe)}(X,0,ce,le,Q,H)}else q.bindTexture(q.TEXTURE_2D,le.colorAttachment.get()),X.bindFramebuffer.set(le.framebuffer)})(v,p,h,p.transform.projection.name==="globe"?.5:.25),v.clear({color:l.Color.transparent});const k=p.transform,P=k.projection.name==="globe",L=P?["PROJECTION_GLOBE_VIEW"]:null,N=P?l.CullFaceMode.frontCCW:l.CullFaceMode.disabled,G=[l.mercatorXfromLng(k.center.lng),l.mercatorYfromLat(k.center.lat)];for(let X=0;X<g.length;X++){const W=g[X];if(a.hasRenderableParent(W))continue;const K=a.getTile(W),Z=K.getBucket(h);if(!Z||Z.projection.name!==k.projection.name)continue;const q=Z.programConfigurations.get(h.id),Q=p.useProgram("heatmap",q,L),{zoom:H}=p.transform;p.terrain&&p.terrain.setupElevationDraw(K,Q),p.prepareDrawProgram(v,Q,W.toUnwrapped());const le=k.projection.createInversionMatrix(k,W.canonical);Q.draw(v,b.TRIANGLES,l.DepthMode.disabled,I,C,N,gd(p,W,K,le,G,H,h.paint.get("heatmap-intensity")),h.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,h.paint,p.transform.zoom,q,P?[Z.globeExtVertexBuffer]:null)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,b){const I=v.context,C=I.gl,k=b.heatmapFbo;if(!k)return;I.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get()),I.activeTexture.set(C.TEXTURE1);let P=b.colorRampTexture;P||(P=b.colorRampTexture=new l.Texture(I,b.colorRamp,C.RGBA)),P.bind(C.LINEAR,C.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(I,C.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,v.colorModeForRenderPass(),l.CullFaceMode.disabled,((L,N,G,X)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,b),b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(p,h))},line:function(p,a,h,g){if(p.renderPass!=="translucent")return;const v=h.paint.get("line-opacity"),b=h.paint.get("line-width");if(v.constantOr(1)===0||b.constantOr(1)===0)return;const I=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),C=p.colorModeForRenderPass(),k=p.terrain&&p.terrain.renderingToTexture?1:l.exported.devicePixelRatio,P=h.paint.get("line-dasharray"),L=P.constantOr(1),N=h.layout.get("line-cap"),G=h.paint.get("line-pattern"),X=G.constantOr(1),W=h.paint.get("line-gradient"),K=h.getCrossfadeParameters(),Z=X?"linePattern":"line",q=p.context,Q=q.gl,H=(ce=>{const ie=[];ym(ce)&&ie.push("RENDER_LINE_DASH"),ce.paint.get("line-gradient")&&ie.push("RENDER_LINE_GRADIENT");const he=ce.paint.get("line-trim-offset");he[0]===0&&he[1]===0||ie.push("RENDER_LINE_TRIM_OFFSET");const xe=ce.paint.get("line-pattern").constantOr(1),Ae=ce.paint.get("line-opacity").constantOr(1)!==1;return!xe&&Ae&&ie.push("RENDER_LINE_ALPHA_DISCARD"),ie})(h);let le=H.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const ce of g){const ie=a.getTile(ce);if(X&&!ie.patternsLoaded())continue;const he=ie.getBucket(h);if(!he)continue;p.prepareDrawTile();const xe=he.programConfigurations.get(h.id),Ae=p.useProgram(Z,xe,H),Ie=G.constantOr(null);if(Ie&&ie.imageAtlas){const Ye=ie.imageAtlas,rt=Ye.patternPositions[Ie.to.toString()],Qe=Ye.patternPositions[Ie.from.toString()];rt&&Qe&&xe.setConstantPatternPositions(rt,Qe)}const qe=P.constantOr(null),_e=N.constantOr(null);if(!X&&qe&&_e&&ie.lineAtlas){const Ye=ie.lineAtlas,rt=Ye.getDash(qe.to,_e),Qe=Ye.getDash(qe.from,_e);rt&&Qe&&xe.setConstantPatternPositions(rt,Qe)}let[Fe,Be]=h.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&Fe!==Be&&(Fe===0&&(Fe-=1),Be===1&&(Be+=1));const we=p.terrain?ce.projMatrix:null,me=X?_d(p,ie,h,K,we,k):_m(p,ie,h,K,we,he.lineClipsArray.length,k,[Fe,Be]);if(W){const Ye=he.gradients[h.id];let rt=Ye.texture;if(h.gradientVersion!==Ye.version){let Qe=256;if(h.stepInterpolant){const At=a.getSource().maxzoom,$t=ce.canonical.z===At?Math.ceil(1<<p.transform.maxZoom-ce.canonical.z):1;Qe=l.clamp(l.nextPowerOfTwo(he.maxLineLength/l.EXTENT*1024*$t),256,q.maxTextureSize)}Ye.gradient=l.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Qe,image:Ye.gradient||void 0,clips:he.lineClipsArray}),Ye.texture?Ye.texture.update(Ye.gradient):Ye.texture=new l.Texture(q,Ye.gradient,Q.RGBA),Ye.version=h.gradientVersion,rt=Ye.texture}q.activeTexture.set(Q.TEXTURE1),rt.bind(h.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}L&&(q.activeTexture.set(Q.TEXTURE0),ie.lineAtlasTexture.bind(Q.LINEAR,Q.REPEAT),xe.updatePaintBuffers(K)),X&&(q.activeTexture.set(Q.TEXTURE0),ie.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),xe.updatePaintBuffers(K)),p.prepareDrawProgram(q,Ae,ce.toUnwrapped());const ct=Ye=>{Ae.draw(q,Q.TRIANGLES,I,Ye,C,l.CullFaceMode.disabled,me,h.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,h.paint,p.transform.zoom,xe,[he.layoutVertexBuffer2])};if(le){const Ye=p.stencilModeForClipping(ce).ref;Ye===0&&p.terrain&&q.clear({stencil:0});const rt={func:Q.EQUAL,mask:255};me.u_alpha_discard_threshold=.8,ct(new l.StencilMode(rt,Ye,255,Q.KEEP,Q.KEEP,Q.INVERT)),me.u_alpha_discard_threshold=0,ct(new l.StencilMode(rt,Ye,255,Q.KEEP,Q.KEEP,Q.KEEP))}else ct(p.stencilModeForClipping(ce))}le&&(p.resetStencilClippingMasks(),p.terrain&&q.clear({stencil:0}))},fill:function(p,a,h,g){const v=h.paint.get("fill-color"),b=h.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const I=p.colorModeForRenderPass(),C=h.paint.get("fill-pattern"),k=p.opaquePassEnabledForLayer()&&!C.constantOr(1)&&v.constantOr(l.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===k){const P=p.depthModeForSublayer(1,p.renderPass==="opaque"?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly);wm(p,a,h,g,P,I,!1)}if(p.renderPass==="translucent"&&h.paint.get("fill-antialias")){const P=p.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,l.DepthMode.ReadOnly);wm(p,a,h,g,P,I,!0)}},"fill-extrusion":function(p,a,h,g){const v=h.paint.get("fill-extrusion-opacity");if(v!==0&&p.renderPass==="translucent"){const b=new l.DepthMode(p.context.gl.LEQUAL,l.DepthMode.ReadWrite,p.depthRangeFor3D);if(v!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))Td(p,a,h,g,b,l.StencilMode.disabled,l.ColorMode.disabled),Td(p,a,h,g,b,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const I=p.colorModeForRenderPass();Td(p,a,h,g,b,l.StencilMode.disabled,I)}}},hillshade:function(p,a,h,g){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const v=p.context,b=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),I=p.colorModeForRenderPass(),C=p.terrain&&p.terrain.renderingToTexture,[k,P]=p.renderPass!=="translucent"||C?[{},g]:p.stencilConfigForOverlap(g);for(const L of P){const N=a.getTile(L);if(N.needsHillshadePrepare&&p.renderPass==="offscreen")cm(p,N,h,b,l.StencilMode.disabled,I);else if(p.renderPass==="translucent"){const G=C&&p.terrain?p.terrain.stencilModeForRTTOverlap(L):k[L.overscaledZ];su(p,L,N,h,b,G,I)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,a,h,g,v,b){if(p.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!g.length)return;const I=p.context,C=I.gl,k=a.getSource(),P=p.useProgram("raster"),L=p.colorModeForRenderPass(),N=p.terrain&&p.terrain.renderingToTexture,[G,X]=k instanceof de||N?[{},g]:p.stencilConfigForOverlap(g),W=X[X.length-1].overscaledZ,K=!p.options.moving;for(const Z of X){const q=N?l.DepthMode.disabled:p.depthModeForSublayer(Z.overscaledZ-W,h.paint.get("raster-opacity")===1?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly,C.LESS),Q=Z.toUnwrapped(),H=a.getTile(Z);if(N&&(!H||!H.hasData()))continue;const le=N?Z.projMatrix:p.transform.calculateProjMatrix(Q,K),ce=p.terrain&&N?p.terrain.stencilModeForRTTOverlap(Z):G[Z.overscaledZ],ie=b?0:h.paint.get("raster-fade-duration");H.registerFadeDuration(ie);const he=a.findLoadedParent(Z,0),xe=dd(H,he,a,p.transform,ie);let Ae,Ie;p.terrain&&p.terrain.prepareDrawTile();const qe=h.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;I.activeTexture.set(C.TEXTURE0),H.texture.bind(qe,C.CLAMP_TO_EDGE),I.activeTexture.set(C.TEXTURE1),he?(he.texture.bind(qe,C.CLAMP_TO_EDGE),Ae=Math.pow(2,he.tileID.overscaledZ-H.tileID.overscaledZ),Ie=[H.tileID.canonical.x*Ae%1,H.tileID.canonical.y*Ae%1]):H.texture.bind(qe,C.CLAMP_TO_EDGE);const _e=vd(le,Ie||[0,0],Ae||1,xe,h,k instanceof de?k.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(I,P,Q),k instanceof de)k.boundsBuffer&&k.boundsSegments&&P.draw(I,C.TRIANGLES,q,l.StencilMode.disabled,L,l.CullFaceMode.disabled,_e,h.id,k.boundsBuffer,p.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:Fe,tileBoundsIndexBuffer:Be,tileBoundsSegments:we}=p.getTileBoundsBuffers(H);P.draw(I,C.TRIANGLES,q,ce,L,l.CullFaceMode.disabled,_e,h.id,Fe,Be,we)}}p.resetStencilClippingMasks()},background:function(p,a,h,g){const v=h.paint.get("background-color"),b=h.paint.get("background-opacity");if(b===0)return;const I=p.context,C=I.gl,k=p.transform,P=k.tileSize,L=h.paint.get("background-pattern");if(p.isPatternMissing(L))return;const N=!L&&v.a===1&&b===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==N)return;const G=l.StencilMode.disabled,X=p.depthModeForSublayer(0,N==="opaque"?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly),W=p.colorModeForRenderPass(),K=p.useProgram(L?"backgroundPattern":"background");let Z,q=g;q||(Z=p.getBackgroundTiles(),q=Object.values(Z).map(H=>H.tileID)),L&&(I.activeTexture.set(C.TEXTURE0),p.imageManager.bind(p.context));const Q=h.getCrossfadeParameters();for(const H of q){const le=H.toUnwrapped(),ce=g?H.projMatrix:p.transform.calculateProjMatrix(le);p.prepareDrawTile();const ie=a?a.getTile(H):Z?Z[H.key]:new l.Tile(H,P,k.zoom,p),he=L?Gy(ce,b,p,L,{tileID:H,tileSize:P},Q):xd(ce,b,v);p.prepareDrawProgram(I,K,le);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Ae,tileBoundsSegments:Ie}=p.getTileBoundsBuffers(ie);K.draw(I,C.TRIANGLES,X,G,W,l.CullFaceMode.disabled,he,h.id,xe,Ae,Ie)}},sky:function(p,a,h){const g=p.transform,v=g.projection.name==="mercator"||g.projection.name==="globe"?1:l.smoothstep(7,8,g.zoom),b=h.paint.get("sky-opacity")*v;if(b===0)return;const I=p.context,C=h.paint.get("sky-type"),k=new l.DepthMode(I.gl.LEQUAL,l.DepthMode.ReadOnly,[0,1]),P=p.frameCounter/1e3%1;C==="atmosphere"?p.renderPass==="offscreen"?h.needsSkyboxCapture(p)&&(function(L,N,G,X){const W=L.context,K=W.gl;let Z=N.skyboxFbo;if(!Z){Z=N.skyboxFbo=W.createFramebuffer(32,32,!1),N.skyboxGeometry=new Cn(W),N.skyboxTexture=W.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,N.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let le=0;le<6;++le)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(Z.framebuffer),W.viewport.set([0,0,32,32]);const q=N.getCenter(L,!0),Q=L.useProgram("skyboxCapture"),H=new Float64Array(16);l.identity(H),l.rotateY(H,H,.5*-Math.PI),Ds(W,N,Q,H,q,0),l.identity(H),l.rotateY(H,H,.5*Math.PI),Ds(W,N,Q,H,q,1),l.identity(H),l.rotateX(H,H,.5*-Math.PI),Ds(W,N,Q,H,q,2),l.identity(H),l.rotateX(H,H,.5*Math.PI),Ds(W,N,Q,H,q,3),l.identity(H),Ds(W,N,Q,H,q,4),l.identity(H),l.rotateY(H,H,Math.PI),Ds(W,N,Q,H,q,5),W.viewport.set([0,0,L.width,L.height])}(p,h),h.markSkyboxValid(p)):p.renderPass==="sky"&&function(L,N,G,X,W){const K=L.context,Z=K.gl,q=L.transform,Q=L.useProgram("skybox");K.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,N.skyboxTexture);const H=((le,ce,ie,he,xe)=>({u_matrix:le,u_sun_direction:ce,u_cubemap:0,u_opacity:he,u_temporal_offset:xe}))(q.skyboxMatrix,N.getCenter(L,!1),0,X,W);L.prepareDrawProgram(K,Q),Q.draw(K,Z.TRIANGLES,G,l.StencilMode.disabled,L.colorModeForRenderPass(),l.CullFaceMode.backCW,H,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,h,k,b,P):C==="gradient"&&p.renderPass==="sky"&&function(L,N,G,X,W){const K=L.context,Z=K.gl,q=L.transform,Q=L.useProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new Cn(K)),K.activeTexture.set(Z.TEXTURE0);let H=N.colorRampTexture;H||(H=N.colorRampTexture=new l.Texture(K,N.colorRamp,Z.RGBA)),H.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const le=((ce,ie,he,xe,Ae)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:ie,u_radius:l.degToRad(he),u_opacity:xe,u_temporal_offset:Ae}))(q.skyboxMatrix,N.getCenter(L,!1),N.paint.get("sky-gradient-radius"),X,W);L.prepareDrawProgram(K,Q),Q.draw(K,Z.TRIANGLES,G,l.StencilMode.disabled,L.colorModeForRenderPass(),l.CullFaceMode.backCW,le,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,h,k,b,P)},debug:function(p,a,h){for(let g=0;g<h.length;g++)Ro(p,a,h[g])},custom:function(p,a,h){const g=p.context,v=h.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))l.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(p.renderPass==="offscreen"){const b=v.prerender;b&&(p.setCustomLayerDefaults(),g.setColorMode(p.colorModeForRenderPass()),b.call(v,g.gl,p.transform.customLayerMatrix()),g.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),g.setColorMode(p.colorModeForRenderPass()),g.setStencilMode(l.StencilMode.disabled);const b=v.renderingMode==="3d"?new l.DepthMode(p.context.gl.LEQUAL,l.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,l.DepthMode.ReadOnly);g.setDepthMode(b),v.render(g.gl,p.transform.customLayerMatrix()),g.setDirty(),p.setBaseState(),g.bindFramebuffer.set(null)}}};class Zy{constructor(a,h){this.context=new F(a),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=l.SourceCache.maxUnderzooming+l.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Do,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,h){const g=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new dm(this,a));const v=this._terrain;this.transform.elevation=g?v:null,v.update(a,this.transform,h)}_updateFog(a){const h=a.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const b=g+.78*(v-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,h){if(this.width=a*l.exported.devicePixelRatio,this.height=h*l.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const a=this.context,h=new l.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(l.EXTENT,0),h.emplaceBack(0,l.EXTENT),h.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(h,l.posAttributes.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const g=new l.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(l.EXTENT,0),g.emplaceBack(0,l.EXTENT),g.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=a.createVertexBuffer(g,l.posAttributes.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const v=new l.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(v,l.posAttributes.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const b=new l.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(l.EXTENT,0,l.EXTENT,0),b.emplaceBack(0,l.EXTENT,0,l.EXTENT),b.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(b,l.boundsAttributes.members),this.mercatorBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const I=new l.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(I);const C=new l.StructArrayLayout1ui2;for(const P of[0,1,3,2,0])C.emplaceBack(P);this.debugIndexBuffer=a.createIndexBuffer(C),this.emptyTexture=new l.Texture(a,new l.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=l.create();const k=this.context.gl;this.stencilClearMode=new l.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(l.window.performance.now()),this.atmosphereBuffer=new Am(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,h=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,h.TRIANGLES,l.DepthMode.disabled,this.stencilClearMode,l.ColorMode.disabled,l.CullFaceMode.disabled,Ca(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,h,g){if(!h||this.currentStencilSource===h.id||!a.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const k of g)if(this._tileClippingMaskIDs[k.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=h.id;const v=this.context,b=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(l.ColorMode.disabled),v.setDepthMode(l.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of g){const k=h.getTile(C),P=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:N,tileBoundsSegments:G}=this.getTileBoundsBuffers(k);I.draw(v,b.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:b.ALWAYS,mask:0},P,255,b.KEEP,b.KEEP,b.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,Ca(C.projMatrix),"$clipping",L,N,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,h=this.context.gl;return new l.StencilMode({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const h=this.context.gl;return new l.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(a){const h=this.context.gl,g=a.sort((I,C)=>C.overscaledZ-I.overscaledZ),v=g[g.length-1].overscaledZ,b=g[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const I={};for(let C=0;C<b;C++)I[C+v]=new l.StencilMode({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[I,g]}return[{[v]:l.StencilMode.disabled},g]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new l.ColorMode([a.CONSTANT_COLOR,a.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?l.ColorMode.unblended:l.ColorMode.alphaBlended}depthModeForSublayer(a,h,g){if(!this.opaquePassEnabledForLayer())return l.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new l.DepthMode(g||this.context.gl.LEQUAL,h,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,h){this.style=a,this.options=h,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const k in v){const P=v[k];P.used&&P.prepare(this.context)}const b={},I={},C={};for(const k in v){const P=v[k];b[k]=P.getVisibleCoordinates(),I[k]=b[k].slice().reverse(),C[k]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<g.length;k++)if(this.style._layers[g[k]].is3D()){this.opaquePassCutoff=k;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new l.GlobeSharedBuffers(this.context)),l.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const k of g){const P=this.style._layers[k],L=a._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const N=L?I[L.id]:void 0;(P.type==="custom"||P.isSky()||N&&N.length)&&this.renderLayer(this,L,P,N)}if(this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[g[this.currentLayer]],P=a._getLayerSourceCache(k);if(k.isSky())continue;const L=P?I[P.id]:void 0;this._renderTileClippingMasks(k,P,L),this.renderLayer(this,P,k,L)}if(this.style.fog&&this.transform.projection.supportsFog&&function(k,P){const L=k.context,N=L.gl,G=k.transform,X=new l.DepthMode(N.LEQUAL,l.DepthMode.ReadOnly,[0,1]),W=k.useProgram("globeAtmosphere",null,G.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),K=l.globeToMercatorTransition(G.zoom),Z=P.properties.get("color").toArray01(),q=P.properties.get("high-color").toArray01(),Q=P.properties.get("space-color").toArray01PremultipliedAlpha(),H=l.identity$1([]);l.rotateY$1(H,H,-l.degToRad(G._center.lng)),l.rotateX$1(H,H,l.degToRad(G._center.lat)),l.rotateZ$1(H,H,G.angle),l.rotateX$1(H,H,-G._pitch);const le=l.fromQuat(new Float32Array(16),H),ce=l.mapValue(P.properties.get("star-intensity"),0,1,0,.25),ie=5e-4,he=l.mapValue(P.properties.get("horizon-blend"),0,1,ie,.25),xe=l.globeUseCustomAntiAliasing(k,L,G)&&he===ie?G.worldSize/(2*Math.PI*1.025)-1:G.globeRadius,Ae=k.frameCounter/1e3%1,Ie=l.length(G.globeCenterInViewSpace),qe=Math.sqrt(Math.pow(Ie,2)-Math.pow(xe,2)),_e=Math.acos(qe/Ie),Fe=((we,me,ct,Ye,rt,Qe,At,$t,Ot,Ct,Je,Xt,tn,Nn)=>({u_frustum_tl:we,u_frustum_tr:me,u_frustum_br:ct,u_frustum_bl:Ye,u_horizon:rt,u_transition:Qe,u_fadeout_range:At,u_color:$t,u_high_color:Ot,u_space_color:Ct,u_star_intensity:Je,u_star_size:5*l.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Xt,u_horizon_angle:tn,u_rotation_matrix:Nn}))(G.frustumCorners.TL,G.frustumCorners.TR,G.frustumCorners.BR,G.frustumCorners.BL,G.frustumCorners.horizon,K,he,Z,q,Q,ce,Ae,_e,le);k.prepareDrawProgram(L,W);const Be=k.atmosphereBuffer;Be&&W.draw(L,N.TRIANGLES,X,l.StencilMode.disabled,l.ColorMode.alphaBlended,l.CullFaceMode.backCW,Fe,"skybox",Be.vertexBuffer,Be.indexBuffer,Be.segments)}(this,this.style.fog),this.renderPass="sky",(l.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const k=this.style._layers[g[this.currentLayer]],P=a._getLayerSourceCache(k);k.isSky()&&this.renderLayer(this,P,k,P?I[P.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const k=this.style._layers[g[this.currentLayer]],P=a._getLayerSourceCache(k);if(k.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(k)){if(k.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const L=P?(k.type==="symbol"?C:I)[P.id]:void 0;this._renderTileClippingMasks(k,P,P?b[P.id]:void 0),this.renderLayer(this,P,k,L),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let k=null;l.values(this.style._layers).forEach(P=>{const L=a._getLayerSourceCache(P);L&&!P.isHidden(this.transform.zoom)&&(!k||k.getSource().maxzoom<L.getSource().maxzoom)&&(k=L)}),k&&this.options.showTileBoundaries&&Pa.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const P=k.transform.padding;Ma(k,k.transform.height-(P.top||0),3,Id),Ma(k,P.bottom||0,3,Tm),Ad(k,P.left||0,3,Em),Ad(k,k.transform.width-(P.right||0),3,Im);const L=k.transform.centerPoint;(function(N,G,X,W){Ms(N,G-1,X-10,2,20,W),Ms(N,G-10,X-1,20,2,W)})(k,L.x,k.transform.height-L.y,Sd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(l.window.performance.now()),this.saveCanvasCopy())}}renderLayer(a,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(g.type)||Pa[g.type](a,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let g=this.gpuTimers[a.id];g||(g=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),g.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,h=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),a.beginQueryEXT(a.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const h={};for(const g in a){const v=a[g],b=this.context.extTimerQuery,I=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),h[g]=I}return h}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let g=0;for(const v of a)g+=h.getQueryObjectEXT(v,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(v);return g}translatePosMatrix(a,h,g,v,b){if(!g[0]&&!g[1])return a;const I=b?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(I){const P=Math.sin(I),L=Math.cos(I);g=[g[0]*L-g[1]*P,g[0]*P+g[1]*L]}const C=[b?g[0]:bi(h,g[0],this.transform.zoom),b?g[1]:bi(h,g[1],this.transform.zoom),0],k=new Float32Array(16);return l.translate(k,a,C),k}saveTileTexture(a){const h=this._tileTextures[a.size[0]];h?h.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const h=this._tileTextures[a];return h&&h.length>0?h.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const h=this.imageManager.getPattern(a.from.toString()),g=this.imageManager.getPattern(a.to.toString());return!h||!g}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,g=[];return this.terrainRenderModeElevated()&&g.push("TERRAIN"),this.transform.projection.name==="globe"&&g.push("GLOBE"),h&&!a&&h.getOpacity(this.transform.pitch)!==0&&g.push("FOG"),a&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(a,h,g){this.cache=this.cache||{};const v=g||[],b=this.currentGlobalDefines().concat(v),I=fm.cacheKey(ud[a],a,b,h);return this.cache[I]||(this.cache[I]=new fm(this.context,a,ud[a],h,gu[a],b)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,h,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),I=((C,k,P,L,N,G,X,W,K,Z,q)=>{const Q=C.transform,H=k.properties.get("color").toArray01();H[3]=L;const le=C.frameCounter/1e3%1;return{u_fog_matrix:P?Q.calculateFogTileMatrix(P):C.identityMat,u_fog_range:k.getFovAdjustedRange(Q._fov),u_fog_color:H,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_temporal_offset:le,u_frustum_tl:N,u_frustum_tr:G,u_frustum_br:X,u_frustum_bl:W,u_globe_pos:K,u_globe_radius:Z,u_viewport:q,u_globe_transition:l.globeToMercatorTransition(Q.zoom),u_is_globe:+(Q.projection.name==="globe")}})(this,v,g,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*l.exported.devicePixelRatio,this.transform.height*l.exported.devicePixelRatio]);h.setFogUniformValues(a,I)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const a=this.context.gl,h=a.createTexture();return a.bindTexture(a.TEXTURE_2D,h),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)h[v.key]=a[v.key]||new l.Tile(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class Cd{constructor(a=0,h=0,g=0,v=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=g,this.right=v}interpolate(a,h,g){return h.top!=null&&a.top!=null&&(this.top=l.number(a.top,h.top,g)),h.bottom!=null&&a.bottom!=null&&(this.bottom=l.number(a.bottom,h.bottom,g)),h.left!=null&&a.left!=null&&(this.left=l.number(a.left,h.left,g)),h.right!=null&&a.right!=null&&(this.right=l.number(a.right,h.right,g)),this}getCenter(a,h){const g=l.clamp((this.left+a-this.right)/2,0,a),v=l.clamp((this.top+h-this.bottom)/2,0,h);return new l.pointGeometry(g,v)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Cd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function kd(p,a){const h=l.getColumn(p,3);l.fromQuat(p,a),l.setColumn(p,3,h)}function Md(p,a){const h=l.identity$1([]);return l.rotateZ$1(h,h,-a),l.rotateX$1(h,h,-p),h}function Ul(p,a){const h=[p[0],p[1],0],g=[a[0],a[1],0];if(l.length(h)>=1e-15){const I=l.normalize([],h);l.scale$2(g,I,l.dot(g,I)),a[0]=g[0],a[1]=g[1]}const v=l.cross([],a,p);if(l.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return Md(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class Vl{constructor(a,h){this.position=a,this.orientation=h}get position(){return this._position}set position(a){if(a){const h=a instanceof l.MercatorCoordinate?a:new l.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(h.x=l.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(a,h){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(a)):0,v=this.position,b=l.MercatorCoordinate.fromLngLat(a,g),I=[b.x-v.x,b.y-v.y,b.z-v.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Ul(I,h)}setPitchBearing(a,h){this.orientation=Md(l.degToRad(a),l.degToRad(-h))}}class Lo{constructor(a,h){this._transform=l.identity([]),this.orientation=h,this.position=a}get mercatorPosition(){const a=this.position;return new l.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=l.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var h;a&&l.setColumn(this._transform,3,[(h=a)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||l.identity$1([]),a&&kd(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,h){this._orientation=Md(a,h),kd(this._transform,this._orientation)}forward(){const a=l.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=l.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=l.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,h){const g=new Float64Array(16);return l.invert(g,this.getWorldToCamera(a,h)),g}getWorldToCameraPosition(a,h,g){const v=this.position;l.scale$2(v,v,-a);const b=new Float64Array(16);return l.fromScaling(b,[g,g,g]),l.translate(b,b,v),b[10]*=h,b}getWorldToCamera(a,h){const g=new Float64Array(16),v=new Float64Array(4),b=this.position;return l.conjugate(v,this._orientation),l.scale$2(b,b,-a),l.fromQuat(g,v),l.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(a,h,g,v){const b=new Float64Array(16);return l.perspective(b,a,h,g,v),b}getDistanceToElevation(a){const h=a===0?0:l.mercatorZfromAltitude(a,this.position[1]),g=this.forward();return(h-this.position[2])/g[2]}clone(){return new Lo([...this.position],[...this.orientation])}}function yu(p,a){const h=jl(p.projection,p.zoom,p.width,p.height),g=function(b,I,C,k,P){const L=new l.LngLat(C.lng-180*Ps,C.lat),N=new l.LngLat(C.lng+180*Ps,C.lat),G=b.project(L.lng,L.lat),X=b.project(N.lng,N.lat),W=-Math.atan2(X.y-G.y,X.x-G.x),K=l.MercatorCoordinate.fromLngLat(C);K.y=l.clamp(K.y,-.999975,.999975);const Z=K.toLngLat(),q=b.project(Z.lng,Z.lat),Q=l.MercatorCoordinate.fromLngLat(Z);Q.x+=Ps;const H=Q.toLngLat(),le=b.project(H.lng,H.lat),ce=gt(le.x-q.x,le.y-q.y,W),ie=l.MercatorCoordinate.fromLngLat(Z);ie.y+=Ps;const he=ie.toLngLat(),xe=b.project(he.lng,he.lat),Ae=gt(xe.x-q.x,xe.y-q.y,W),Ie=Math.abs(ce.x)/Math.abs(Ae.y),qe=l.identity([]);l.rotateZ(qe,qe,-W*(1-(P?0:k)));const _e=l.identity([]);return l.scale(_e,_e,[1,1-(1-Ie)*k,1]),_e[4]=-Ae.x/Ae.y*k,l.rotateZ(_e,_e,W),l.multiply(_e,qe,_e),_e}(p.projection,0,p.center,h,a),v=vu(p);return l.scale(g,g,[v,v,1]),g}function vu(p){const a=p.projection,h=jl(p.projection,p.zoom,p.width,p.height),g=Gl(a,p.center),v=Gl(a,l.LngLat.convert(a.center));return Math.pow(2,g*h+(1-h)*v)}function jl(p,a,h,g,v=1/0){const b=p.range;if(!b)return 0;const I=Math.min(v,Math.max(h,g)),C=Math.log(I/1024)/Math.LN2;return l.smoothstep(b[0]+C,b[1]+C,a)}const Ps=1/4e4;function Gl(p,a){const h=l.clamp(a.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),g=new l.LngLat(a.lng-180*Ps,h),v=new l.LngLat(a.lng+180*Ps,h),b=p.project(g.lng,h),I=p.project(v.lng,h),C=l.MercatorCoordinate.fromLngLat(g),k=l.MercatorCoordinate.fromLngLat(v),P=I.x-b.x,L=I.y-b.y,N=k.x-C.x,G=k.y-C.y,X=Math.sqrt((N*N+G*G)/(P*P+L*L));return Math.log(X)/Math.LN2}function gt(p,a,h){const g=Math.cos(h),v=Math.sin(h);return{x:p*g-a*v,y:p*v+a*g}}class zr{constructor(a,h,g,v,b,I,C){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=g==null?0:g,this._maxPitch=v==null?60:v,this.setProjection(I),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Cd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Lo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new zr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(a||h)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return l.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=l.getProjection(this.projectionOptions);const g=!T(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=l.getProjection({name:"mercator"});const h=a!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return l.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return l.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const h=-a*Math.PI/180;var g;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(g=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),function(v,b,I){var C=b[0],k=b[1],P=b[2],L=b[3],N=Math.sin(I),G=Math.cos(I);v[0]=C*G+P*N,v[1]=k*G+L*N,v[2]=C*-N+P*G,v[3]=k*-N+L*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const h=l.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=l.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const h=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,b=0;for(let I=0;I<h.length;I++){const C=new l.pointGeometry(h[I][0]*this.width,g+h[I][1]*(this.height-g)),k=a.pointCoordinate(C);if(!k)continue;const P=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);v+=k[3]*P,b+=P}return b===0?NaN:v/b}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(a),b=this._mercatorZfromZoom(this._maxZoom),I=Math.max(v-g,b);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let g;g=a.z<this._camera.position[2]?[h.x,h.y,h.z]:[a.x,a.y,a.z];const v=l.length(l.sub([],this._camera.position,g));return l.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let h=!1;if(a.orientation&&!l.exactEquals(a.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(a.orientation)),a.position){const g=[a.position.x,a.position.y,a.position.z];l.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,h=new Vl;return h.position=new l.MercatorCoordinate(a[0],a[1],a[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(a){if(!l.length$1(a))return!1;l.normalize$1(a,a);const h=l.transformQuat([],[0,0,-1],a),g=l.transformQuat([],[0,-1,0],a);if(g[2]<0)return!1;const v=Ul(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(a){const h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;a[2]=l.clamp(a[2],v/g,v/h),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,g){this._unmodified=!1,this._edgeInsets.interpolate(a,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const h=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(a){const h=[new l.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const g=this.pointCoordinate(new l.pointGeometry(0,0)),v=this.pointCoordinate(new l.pointGeometry(this.width,0)),b=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new l.pointGeometry(0,this.height)),C=Math.floor(Math.min(g.x,v.x,b.x,I.x)),k=Math.floor(Math.max(g.x,v.x,b.x,I.x)),P=1;for(let L=C-P;L<=k+P;L++)L!==0&&h.push(new l.UnwrappedTileID(L,a))}return h}coveringTiles(a){let h=this.coveringZoomLevel(a);const g=h,v=this.elevation&&!a.isTerrainDEM,b=this.projection.name==="mercator";if(a.minzoom!==void 0&&h<a.minzoom)return[];a.maxzoom!==void 0&&h>a.maxzoom&&(h=a.maxzoom);const I=this.locationCoordinate(this.center),C=this.center.lat,k=1<<h,P=[k*I.x,k*I.y,0],L=this.projection.name==="globe",N=!L,G=l.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,N),X=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=k*l.mercatorZfromAltitude(1,this.center.lat),K=this._camera.position[2]/l.mercatorZfromAltitude(1,this.center.lat),Z=[k*X.x,k*X.y,K*(N?1:W)],q=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),Q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,H=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=a.isTerrainDEM?-H:this._elevation?this._elevation.getMinElevationBelowMSL():0,ce=this.projection.isReprojectedInTileSpace?vu(this):1,ie=me=>{const Ye=new l.MercatorCoordinate(me.x+25e-6,me.y,me.z),rt=new l.MercatorCoordinate(me.x,me.y+25e-6,me.z),Qe=me.toLngLat(),At=Ye.toLngLat(),$t=rt.toLngLat(),Ot=this.locationCoordinate(Qe),Ct=this.locationCoordinate(At),Je=this.locationCoordinate($t),Xt=Math.hypot(Ct.x-Ot.x,Ct.y-Ot.y),tn=Math.hypot(Je.x-Ot.x,Je.y-Ot.y);return Math.sqrt(Xt*tn)*ce/25e-6},he=me=>{const ct=H,Ye=le;return{aabb:l.tileAABB(this,k,0,0,0,me,Ye,ct,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:ct,wrap:me,fullyVisible:!1}},xe=[];let Ae=[];const Ie=h,qe=a.reparseOverscaled?g:h,_e=me=>me*me,Fe=_e((K-this._centerAltitude)*W),Be=me=>{if(!this._elevation||!me.tileID||!b)return;const ct=this._elevation.getMinMaxForTile(me.tileID),Ye=me.aabb;ct?(Ye.min[2]=ct.min,Ye.max[2]=ct.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(me.shouldSplit=we(me),me.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},we=me=>{if(me.zoom<Q)return!0;if(me.zoom===Ie)return!1;if(me.shouldSplit!=null)return me.shouldSplit;const ct=me.aabb.distanceX(Z),Ye=me.aabb.distanceY(Z);let rt=Fe,Qe=1;if(L){rt=_e(me.aabb.distanceZ(Z));const Ot=Math.pow(2,me.zoom),Ct=l.latFromMercatorY((me.y+1)/Ot),Je=l.latFromMercatorY(me.y/Ot),Xt=Math.min(Math.max(C,Ct),Je),tn=l.circumferenceAtLatitude(Xt)/l.circumferenceAtLatitude(C);if(Qe=Xt===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,tn/this._mercatorScaleRatio),this.zoom<=l.GLOBE_ZOOM_THRESHOLD_MIN&&me.zoom===Ie-1&&tn>=.9)return!0}else if(v&&(rt=_e(me.aabb.distanceZ(Z)*W)),this.projection.isReprojectedInTileSpace&&g<=5){const Ot=Math.pow(2,me.zoom),Ct=ie(new l.MercatorCoordinate((me.x+.5)/Ot,(me.y+.5)/Ot));Qe=Ct>.85?1:Ct}const At=ct*ct+Ye*Ye+rt,$t=_e((1<<Ie-me.zoom)*q*Qe*((Ot,Ct)=>{if(Ct*_e(.707)<Ot)return 1;const Je=Math.sqrt(Ct/Ot);return Je/(1.4144271570014144+(Math.pow(1.1,Je-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(rt,Fe),At));return At<$t};if(this.renderWorldCopies)for(let me=1;me<=3;me++)xe.push(he(-me)),xe.push(he(me));for(xe.push(he(0));xe.length>0;){const me=xe.pop(),ct=me.x,Ye=me.y;let rt=me.fullyVisible;if(!rt){const Qe=me.aabb.intersects(G);if(Qe===0)continue;rt=Qe===2}if(me.zoom!==Ie&&we(me))for(let Qe=0;Qe<4;Qe++){const At=(ct<<1)+Qe%2,$t=(Ye<<1)+(Qe>>1),Ot={aabb:b?me.aabb.quadrant(Qe):l.tileAABB(this,k,me.zoom+1,At,$t,me.wrap,me.minZ,me.maxZ,this.projection),zoom:me.zoom+1,x:At,y:$t,wrap:me.wrap,fullyVisible:rt,tileID:void 0,shouldSplit:void 0,minZ:me.minZ,maxZ:me.maxZ};v&&!L&&(Ot.tileID=new l.OverscaledTileID(me.zoom+1===Ie?qe:me.zoom+1,me.wrap,me.zoom+1,At,$t),Be(Ot)),xe.push(Ot)}else{const Qe=me.zoom===Ie?qe:me.zoom;if(a.minzoom&&a.minzoom>Qe)continue;const At=P[0]-(.5+ct+(me.wrap<<me.zoom))*(1<<h-me.zoom),$t=P[1]-.5-Ye,Ot=me.tileID?me.tileID:new l.OverscaledTileID(Qe,me.wrap,me.zoom,ct,Ye);Ae.push({tileID:Ot,distanceSq:At*At+$t*$t})}}if(this.fogCullDistSq){const me=this.fogCullDistSq,ct=this.horizonLineFromTop();Ae=Ae.filter(Ye=>{const rt=[0,0,0,1],Qe=[l.EXTENT,l.EXTENT,0,1],At=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());l.transformMat4$1(rt,rt,At),l.transformMat4$1(Qe,Qe,At);const $t=l.getAABBPointSquareDist(rt,Qe);if($t===0)return!0;let Ot=!1;const Ct=this._elevation;if(Ct&&$t>me&&ct!==0){const Je=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let Xt;a.isTerrainDEM||(Xt=Ct.getMinMaxForTile(Ye.tileID)),Xt||(Xt={min:le,max:H});const tn=l.furthestTileCorner(this.rotation),Nn=[tn[0]*l.EXTENT,tn[1]*l.EXTENT,Xt.max];l.transformMat4(Nn,Nn,Je),Ot=(1-Nn[1])*this.height*.5<ct}return $t<me||Ot})}return Ae.sort((me,ct)=>me.distanceSq-ct.distanceSq).map(me=>me.tileID)}resize(a,h){this.width=a,this.height=h,this.pixelsToGLUnits=[2/a,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const h=l.clamp(a.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),g=this.projection.project(a.lng,h);return new l.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(a,h){let g,v;const b=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;g=(h.x-b.x)/C,v=(h.y-b.y)/C}else{const C=this.pointCoordinate(h),k=this.pointCoordinate(b);g=C.x-k.x,v=C.y-k.y}const I=this.locationCoordinate(a);this.setLocation(new l.MercatorCoordinate(I.x-g,I.y-v))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,h){const g=h?l.mercatorZfromAltitude(h,a.lat):void 0,v=this.projection.project(a.lng,a.lat);return new l.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,h){const g=h!=null?h:this._centerAltitude,v=[a.x,a.y,0,1],b=[a.x,a.y,1,1];l.transformMat4$1(v,v,this.pixelMatrixInverse),l.transformMat4$1(b,b,this.pixelMatrixInverse);const I=b[3];l.scale$1(v,v,1/v[3]),l.scale$1(b,b,1/I);const C=v[2],k=b[2];return{p0:v,p1:b,t:C===k?0:(g-C)/(k-C)}}screenPointToMercatorRay(a){const h=[a.x,a.y,0,1],g=[a.x,a.y,1,1];return l.transformMat4$1(h,h,this.pixelMatrixInverse),l.transformMat4$1(g,g,this.pixelMatrixInverse),l.scale$1(h,h,1/h[3]),l.scale$1(g,g,1/g[3]),h[2]=l.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,g[2]=l.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,l.scale$1(h,h,1/this.worldSize),l.scale$1(g,g,1/this.worldSize),new l.Ray([h[0],h[1],h[2]],l.normalize([],l.sub([],g,h)))}rayIntersectionCoordinate(a){const{p0:h,p1:g,t:v}=a,b=l.mercatorZfromAltitude(h[2],this._center.lat),I=l.mercatorZfromAltitude(g[2],this._center.lat);return new l.MercatorCoordinate(l.number(h[0],g[0],v)/this.worldSize,l.number(h[1],g[1],v)/this.worldSize,l.number(b,I,v))}pointCoordinate(a,h=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,h)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let h=this.projection.pointCoordinate3D(this,a.x,a.y);if(h)return new l.MercatorCoordinate(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(a.y>v)return this.pointCoordinate(a);const b=.02*v,I=a.clone();for(let C=0;C<10&&v-g>b;C++){I.y=l.number(g,v,.66);const k=this.projection.pointCoordinate3D(this,I.x,I.y);k?(v=I.y,h=k):g=I.y}return h?new l.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}_coordinatePoint(a,h){const g=h&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,v=[a.x*this.worldSize,a.y*this.worldSize,g+a.toAltitude(),1];return l.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new l.pointGeometry(v[0]/v[3],v[1]/v[3]):new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:a,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=this.pointCoordinate3D(new l.pointGeometry(h,a)),I=this.pointCoordinate3D(new l.pointGeometry(v,a)),C=this.pointCoordinate3D(new l.pointGeometry(v,g)),k=this.pointCoordinate3D(new l.pointGeometry(h,g));let P=Math.min(b.x,k.x),L=Math.max(I.x,C.x),N=Math.min(b.y,I.y),G=Math.max(k.y,C.y);const X=Math.pow(2,-this.zoom)/16,W=(q,Q,H,le)=>{const ce=(q+H)/2,ie=(Q+le)/2,he=new l.pointGeometry(ce,ie),xe=this.pointCoordinate3D(he),Ae=Math.max(0,P-xe.x,N-xe.y,xe.x-L,xe.y-G);P=Math.min(P,xe.x),L=Math.max(L,xe.x),N=Math.min(N,xe.y),G=Math.max(G,xe.y),Ae>X&&(W(q,Q,ce,ie),W(ce,ie,H,le))};W(h,a,v,a),W(v,a,v,g),W(v,g,h,g),W(h,g,h,a);const K=new l.LngLat(l.lngFromMercatorX(L),l.latFromMercatorY(N)),Z=new l.LngLat(l.lngFromMercatorX(P),l.latFromMercatorY(G));return new l.LngLatBounds(Z,K)}_getBounds(a,h){if(this.projection.name==="globe")return this._getGlobeBounds();const g=new l.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new l.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new l.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),I=new l.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let C=this.pointCoordinate(g,a),k=this.pointCoordinate(v,a);const P=this.pointCoordinate(b,h),L=this.pointCoordinate(I,h),N=(G,X)=>(X.y-G.y)/(X.x-G.x);return C.y>1&&k.y>=0?C=new l.MercatorCoordinate((1-L.y)/N(L,C)+L.x,1):C.y<0&&k.y<=1&&(C=new l.MercatorCoordinate(-L.y/N(L,C)+L.x,0)),k.y>1&&C.y>=0?k=new l.MercatorCoordinate((1-P.y)/N(P,k)+P.x,1):k.y<0&&C.y<=1&&(k=new l.MercatorCoordinate(-P.y/N(P,k)+P.x,0)),new l.LngLatBounds().extend(this.coordinateLocation(C)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(P))}_getBounds3D(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBounds(0,0);const h=a.visibleDemTiles.reduce((g,v)=>{if(v.dem){const b=v.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*a.exaggeration(),h.max*a.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(a=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return a?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-l.MAX_MERCATOR_LATITUDE,this.maxLat=l.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=l.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=l.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=l.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,h){return this.projection.createTileMatrix(this,h,a)}calculateDistanceTileData(a){const h=a.key,g=this._distanceTileDataCache;if(g[h])return g[h];const v=a.canonical,b=1/this.height,I=this.cameraWorldSize/this.zoomScale(v.z),C=(v.x+Math.pow(2,v.z)*a.wrap)*I,k=v.y*I,P=this.point,L=this.angle,N=Math.sin(-L),G=-Math.cos(-L);return g[h]={bearing:[N,G],center:[(P.x-C)*b,(P.y-k)*b],scale:I/l.EXTENT*b},g[h]}calculateFogTileMatrix(a){const h=a.key,g=this._fogTileMatrixCache;if(g[h])return g[h];const v=this.projection.createTileMatrix(this,this.cameraWorldSize,a);return l.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(a,h=!1){const g=a.key,v=h?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const b=this.calculatePosMatrix(a,this.worldSize);return l.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(a){const h=a.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];const v=function(b,I){const{scale:C}=b.tileTransform,k=C*l.EXTENT/(b.tileSize*Math.pow(2,I.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return P=new Float32Array(4),G=(L=I.inverseAdjustmentMatrix)[1],X=L[2],W=L[3],Z=(N=[k,k])[1],P[0]=L[0]*(K=N[0]),P[1]=G*K,P[2]=X*Z,P[3]=W*Z,P;var P,L,N,G,X,W,K,Z}(a,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const h=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),b=l.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,v[2]/=b,l.normalize(v,v);const I=a.raycast(g,v,a.exaggeration());if(I){const C=l.scaleAndAdd([],g,v,I),k=new l.MercatorCoordinate(C[0],C[1],l.mercatorZfromAltitude(C[2],l.latFromMercatorY(C[1]))),P=(k.z+l.length([k.x-g[0],k.y-g[1],k.z-g[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const a=this._elevation;this._updateCameraState();const h=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=a.getAtPointOrZero(new l.MercatorCoordinate(...g)),b=this._minimumHeightOverTerrain()*Math.cos(l.degToRad(this._maxPitch)),I=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(I<b){const C=this.locationCoordinate(this._center,this._centerAltitude),k=[C.x-g[0],C.y-g[1],C.z-g[2]],P=l.length(k);k[2]-=(b-I)/this._pixelsPerMercatorPixel;const L=l.length(k);if(L===0)return;l.scale$2(k,k,P/L*this._pixelsPerMercatorPixel),this._camera.position=[C.x-k[0],C.y-k[1],C.z*this._pixelsPerMercatorPixel-k[2]],this._camera.orientation=Ul(k,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const G=this.center;return G.lat=l.clamp(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(G.lng=l.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const h=this._unmodified,{x:g,y:v}=this.point;let b=0,I=g,C=v;const k=this.width/2,P=this.height/2,L=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(v-P<L&&(C=L+P),v+P>N&&(C=N-P),N-L<this.height&&(b=Math.max(b,this.height/(N-L)),C=(N+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,W=this.worldSize/2-(G+X)/2;I=(g+W+this.worldSize)%this.worldSize-W,I-k<G&&(I=G+k),I+k>X&&(I=X-k),X-G<this.width&&(b=Math.max(b,this.width/(X-G)),I=(X+G)/2)}I===g&&C===v||(this.center=this.unproject(new l.pointGeometry(I,C))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCameraAltitude(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=l.mercatorZfromAltitude(1,this.center.lat)/l.mercatorZfromAltitude(1,l.GLOBE_SCALE_MATCH_LATITUDE));const g=jl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?h:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-a.x/this.width,b[9]=2*a.y/this.height;let I=l.mul([],b,v);if(this.projection.isReprojectedInTileSpace){const ce=this.locationCoordinate(this.center),ie=l.identity([]);l.translate(ie,ie,[ce.x*this.worldSize,ce.y*this.worldSize,0]),l.multiply(ie,ie,yu(this)),l.translate(ie,ie,[-ce.x*this.worldSize,-ce.y*this.worldSize,0]),l.multiply(I,I,ie),this.inverseAdjustmentMatrix=function(he){const xe=yu(he,!0);return vt([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=l.scale([],I,[this.worldSize,this.worldSize,this.worldSize/h,1]),this.projMatrix=I,this.invProjMatrix=l.invert(new Float64Array(16),this.projMatrix);const C=l.invert([],b);this.frustumCorners=l.FrustumCorners.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height);const k=new Float32Array(16);l.identity(k),l.scale(k,k,[1,-1,1]),l.rotateX(k,k,this._pitch),l.rotateZ(k,k,this.angle);const P=l.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),L=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-a.x/this.width,P[9]=2*(a.y+L)/this.height,this.skyboxMatrix=l.multiply(k,P,k);const N=this.point,G=N.x,X=N.y,W=this.width%2/2,K=this.height%2/2,Z=Math.cos(this.angle),q=Math.sin(this.angle),Q=G-Math.round(G)+Z*W+q*K,H=X-Math.round(X)+Z*K+q*W,le=new Float64Array(I);if(l.translate(le,le,[Q>.5?Q-1:Q,H>.5?H-1:H,0]),this.alignedProjMatrix=le,I=l.create(),l.scale(I,I,[this.width/2,-this.height/2,1]),l.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=l.create(),l.scale(I,I,[1,-1,1]),l.translate(I,I,[-1,-1,0]),l.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=l.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=l.calculateGlobeMatrix(this);const ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=l.transformMat4(ce,ce,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSize,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,b=[a,a,h];l.scale$2(b,b,v),l.scale$2(g,g,-1),l.multiply$2(g,g,b);const I=l.create();l.translate(I,I,g),l.scale(I,I,b),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,h,v)}_computeCameraPosition(a){const h=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-a/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*b,v.y/this.worldSize-g[1]*b,a/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=a[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(b=Math.min((h-g)/v,1)),this._camera.position=l.scaleAndAdd([],this._camera.position,a,b),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),b=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.degToRad(this._maxPitch)),C=Math.max((a[2]-b)/Math.cos(g),I),k=this._zoomFromMercatorZ(C);l.scaleAndAdd(a,a,h,C),this._pitch=l.clamp(g,l.degToRad(this.minPitch),l.degToRad(this.maxPitch)),this.angle=l.wrap(v,-Math.PI,Math.PI),this._setZoom(l.clamp(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new l.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){const h=I=>{const C=this.getCameraToCenterDistance(this.projection,I);return this.scaleZoom(C/(a*this.tileSize))};let g,v=h(this.zoom),b=Math.abs(v-h(v));for(;g!==b;)v=h(v),g=b,b=Math.abs(v-h(v));return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(l.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,h){const g=Math.min(a.x,h.x),v=Math.max(a.x,h.x),b=Math.min(a.y,h.y),I=Math.max(a.y,h.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new l.pointGeometry(g,b),new l.pointGeometry(v,I),new l.pointGeometry(g,I),new l.pointGeometry(v,b)],k=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const L of C){const N=this.pointRayIntersection(L);if(N.t<0)return!0;const G=this.rayIntersectionCoordinate(N);if(G.x<k||G.y<0||G.x>P||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.pointGeometry(0,0),new l.pointGeometry(this.width,this.height))}zoomDeltaToMovement(a,h){const g=l.length(l.sub([],this._camera.position,a)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const a=function(h,g){const v=[h[0],h[1],h[2],1];l.transformMat4$1(v,v,g);const b=Math.max(v[3],1e-6);return[v[0]/b,v[1]/b,v[2]/b,b]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new l.pointGeometry(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,a))}}getCameraToCenterDistance(a,h=this.zoom){const g=jl(a,h,this.width,this.height,1024),v=a.pixelSpaceConversion(this.center.lat,this.worldSize,g);return .5/Math.tan(.5*this._fov)*this.height*v}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&l.multiply(a,a,this.globeMatrix),a}}function Dd(p,a){let h=!1,g=null;const v=()=>{g=null,h&&(p(),g=setTimeout(v,a),h=!1)};return()=>(h=!0,g||v(),g)}class Cm{constructor(a){this._hashName=a&&encodeURIComponent(a),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Dd(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,l.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),l.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const h=Pd(a);if(this._hashName){const g=this._hashName;let v=!1;const b=l.window.location.hash.slice(1).split("&").map(I=>{const C=I.split("=")[0];return C===g?(v=!0,`${C}=${h}`):I}).filter(I=>I);return v||b.push(`${g}=${h}`),`#${b.join("&")}`}return`#${h}`}_getCurrentHash(){const a=l.window.location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){const g=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(h[3]||0):a.getBearing();return a.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=l.window.location.href.replace(/(#.+)?$/,this.getHashString());l.window.history.replaceState(l.window.history.state,null,a)}}function Pd(p,a){const h=p.getCenter(),g=Math.round(100*p.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),I=Math.round(h.lng*b)/b,C=Math.round(h.lat*b)/b,k=p.getBearing(),P=p.getPitch();let L=a?`/${I}/${C}/${g}`:`${g}/${C}/${I}`;return(k||P)&&(L+="/"+Math.round(10*k)/10),P&&(L+=`/${Math.round(P)}`),L}const Rs={linearity:.3,easing:l.bezier(0,0,.3,1)},km=l.extend({deceleration:2500,maxSpeed:1400},Rs),xu=l.extend({deceleration:20,maxSpeed:1400},Rs),Rd=l.extend({deceleration:1e3,maxSpeed:360},Rs),bu=l.extend({deceleration:1e3,maxSpeed:90},Rs);class Mm{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,h=l.exported.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const b=Ls(h.pan.mag(),g,l.extend({},km,a||{}));v.offset=h.pan.mult(b.amount/h.pan.mag()),v.center=this._map.transform.center,$l(v,b)}if(h.zoom){const b=Ls(h.zoom,g,xu);v.zoom=this._map.transform.zoom+b.amount,$l(v,b)}if(h.bearing){const b=Ls(h.bearing,g,Rd);v.bearing=this._map.transform.bearing+l.clamp(b.amount,-179,179),$l(v,b)}if(h.pitch){const b=Ls(h.pitch,g,bu);v.pitch=this._map.transform.pitch+b.amount,$l(v,b)}if(v.zoom||v.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function $l(p,a){(!p.duration||p.duration<a.duration)&&(p.duration=a.duration,p.easing=a.easing)}function Ls(p,a,h){const{maxSpeed:g,linearity:v,deceleration:b}=h,I=l.clamp(p*v/(a/1e3),-g,g),C=Math.abs(I)/(b*v);return{easing:h.easing,duration:1e3*C,amount:I*(C/2)}}class Or extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,g,v={}){const b=ge(h.getCanvasContainer(),g),I=h.unproject(b);super(a,l.extend({point:b,lngLat:I,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class wu extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,g){const v=a==="touchend"?g.changedTouches:g.touches,b=Ke(h.getCanvasContainer(),v),I=b.map(k=>h.unproject(k)),C=b.reduce((k,P,L,N)=>k.add(P.div(N.length)),new l.pointGeometry(0,0));super(a,{points:b,point:C,lngLats:I,lngLat:h.unproject(C),originalEvent:g}),this._defaultPrevented=!1}}class Dm extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,g){super(a,{originalEvent:g}),this._defaultPrevented=!1}}class Tu{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Dm(a.type,this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new Or(a.type,this._map,a))}mouseup(a){this._map.fire(new Or(a.type,this._map,a))}preclick(a){const h=l.extend({},a);h.type="preclick",this._map.fire(new Or(h.type,this._map,h))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Or(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Or(a.type,this._map,a))}mouseover(a){this._map.fire(new Or(a.type,this._map,a))}mouseout(a){this._map.fire(new Or(a.type,this._map,a))}touchstart(a){return this._firePreventable(new wu(a.type,this._map,a))}touchmove(a){this._map.fire(new wu(a.type,this._map,a))}touchend(a){this._map.fire(new wu(a.type,this._map,a))}touchcancel(a){this._map.fire(new wu(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ld{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Or(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Or(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pm{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&a.button===0&&(Ge(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;const g=h,v=this._startPos,b=this._lastPos;if(!v||!b||b.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=j("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const I=Math.min(v.x,g.x),C=Math.max(v.x,g.x),k=Math.min(v.y,g.y),P=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${k}px)`,this._box.style.width=C-I+"px",this._box.style.height=P-k+"px")})}mouseupWindow(a,h){if(!this._active)return;const g=this._startPos,v=h;if(g&&a.button===0){if(this.reset(),Ue(),g.x!==v.x||g.y!==v.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:b=>b.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),it(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new l.Event(a,{originalEvent:h}))}}function Eu(p,a){const h={};for(let g=0;g<p.length;g++)h[p[g].identifier]=a[g];return h}class Iu{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const b=new l.pointGeometry(0,0);for(const I of v)b._add(I);return b.div(v.length)}(h),this.touches=Eu(g,h)))}touchmove(a,h,g){if(this.aborted||!this.centroid)return;const v=Eu(g,h);for(const b in this.touches){const I=this.touches[b],C=v[b];(!C||C.dist(I)>30)&&(this.aborted=!0)}}touchend(a,h,g){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class ql{constructor(a){this.singleTap=new Iu(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,h,g){this.singleTap.touchstart(a,h,g)}touchmove(a,h,g){this.singleTap.touchmove(a,h,g)}touchend(a,h,g){const v=this.singleTap.touchend(a,h,g);if(v){const b=a.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(v)<30;if(b&&I||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Rm{constructor(){this._zoomIn=new ql({numTouches:1,numTaps:2}),this._zoomOut=new ql({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,g){this._zoomIn.touchstart(a,h,g),this._zoomOut.touchstart(a,h,g)}touchmove(a,h,g){this._zoomIn.touchmove(a,h,g),this._zoomOut.touchmove(a,h,g)}touchend(a,h,g){const v=this._zoomIn.touchend(a,h,g),b=this._zoomOut.touchend(a,h,g);return v?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(v)},{originalEvent:a})}):b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(b)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Lm={0:1,2:2};class Su{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,h){return!1}_move(a,h){return{}}mousedown(a,h){if(this._lastPoint)return;const g=He(a);this._correctButton(a,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(a,h){const g=this._lastPoint;if(g){if(a.preventDefault(),this._eventButton!=null&&function(v,b){const I=Lm[b];return v.buttons===void 0||(v.buttons&I)!==I}(a,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(a){this._lastPoint&&He(a)===this._eventButton&&(this._moved&&Ue(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zm extends Su{mousedown(a,h){super.mousedown(a,h),this._lastPoint&&(this._active=!0)}_correctButton(a,h){return h===0&&!a.ctrlKey}_move(a,h){return{around:h,panDelta:h.sub(a)}}}class zd extends Su{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){const g=.8*(h.x-a.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(a){a.preventDefault()}}class zo extends Su{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){const g=-.5*(h.y-a.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(a){a.preventDefault()}}class Om{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),l.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0)}touchstart(a,h,g){return this._calculateTransform(a,h,g)}touchmove(a,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!l.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,h,g)}}touchend(a,h,g){this._calculateTransform(a,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,g){g.length>0&&(this._active=!0);const v=Eu(g,h),b=new l.pointGeometry(0,0),I=new l.pointGeometry(0,0);let C=0;for(const P in v){const L=v[P],N=this._touches[P];N&&(b._add(L),I._add(L.sub(N)),C++,v[P]=L)}if(this._touches=v,C<this._minTouches||!I.mag())return;const k=I.div(C);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(C),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Au{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,h,g){return{}}touchstart(a,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,g){const v=this._firstTwoTouches;if(!v)return;a.preventDefault();const[b,I]=v,C=Wl(g,h,b),k=Wl(g,h,I);if(!C||!k)return;const P=this._aroundCenter?null:C.add(k).div(2);return this._move([C,k],P,a)}touchend(a,h,g){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,I=Wl(g,h,v),C=Wl(g,h,b);I&&C||(this._active&&Ue(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Wl(p,a,h){for(let g=0;g<p.length;g++)if(p[g].identifier===h)return a[g]}function Od(p,a){return Math.log(p/a)/Math.LN2}class Bm extends Au{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){const g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Od(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Od(this._distance,g),pinchAround:h}}}function Bd(p,a){return 180*p.angleWith(a)/Math.PI}class Qi extends Au{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h){const g=this._vector;if(this._vector=a[0].sub(a[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Bd(this._vector,g),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=Bd(a,g);return Math.abs(v)<h}}function Fd(p){return Math.abs(p.y)>Math.abs(p.x)}class Fm extends Au{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Fd(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,g){const v=this._lastPoints;if(!v)return;const b=a[0].sub(v[0]),I=a[1].sub(v[1]);return this._map._cooperativeGestures&&!l.isFullscreen()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,I,g.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(b.y+I.y)/2*-.5})}gestureBeginsVertically(a,h,g){if(this._valid!==void 0)return this._valid;const v=a.mag()>=2,b=h.mag()>=2;if(!v&&!b)return;if(!v||!b)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const I=a.y>0==h.y>0;return Fd(a)&&Fd(h)&&I}}const Hy={panStep:100,bearingStep:15,pitchStep:10};class Xy{constructor(){const a=Hy;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,g=0,v=0,b=0,I=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?g=-1:(a.preventDefault(),b=-1);break;case 39:a.shiftKey?g=1:(a.preventDefault(),b=1);break;case 38:a.shiftKey?v=1:(a.preventDefault(),I=-1);break;case 40:a.shiftKey?v=-1:(a.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:C=>{const k=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:zs,zoom:h?Math.round(k)+h*(a.shiftKey?2:1):k,bearing:C.getBearing()+g*this._bearingStep,pitch:C.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-I*this._panStep],center:C.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function zs(p){return p*(2-p)}const Nd=4.000244140625;class Ra{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||l.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=a.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const g=l.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%Nd==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=ge(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Nd?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&P!==0&&(P=1/P);const L=h(),N=Math.pow(2,L),G=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(G*P))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,b=this._easing;let I,C=!1;if(this._type==="wheel"&&v&&b){const k=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),P=b(k);I=l.number(v,g,P),k<1?this._frameId||(this._frameId=!0):C=!0}else I=g,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:I-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=l.ease;if(this._prevEase){const g=this._prevEase,v=(l.exported.now()-g.start)/g.duration,b=g.easing(v+.01)-g.easing(v),I=.27/Math.sqrt(b*b+1e-4)*.01,C=Math.sqrt(.0729-I*I);h=l.bezier(I,C,.25,1)}return this._prevEase={start:l.exported.now(),duration:a,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(l.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class vs{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,h){return a.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(a.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xt{constructor(){this._tap=new ql({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,h,g){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(a,h,g))}touchmove(a,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=h[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,a.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(a,h,g)}touchend(a,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(a,h,g)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nm{constructor(a,h,g){this._el=a,this._mousePan=h,this._touchPan=g}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Um{constructor(a,h,g){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zl{constructor(a,h,g,v){this._el=a,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const no=p=>p.zoom||p.drag||p.pitch||p.rotate;class Vm extends l.Event{}class jm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,h){const g=l.sub([],h,a);this.radius=l.length(g[2]<0?l.div([],g,this.constants):[g[0],g[1],0])}projectRay(a){l.div(a,a,this.constants),l.normalize(a,a),l.mul$1(a,a,this.constants);const h=l.scale$2([],a,this.radius);if(h[2]>0){const g=l.scale$2([],[0,0,1],l.dot(h,[0,0,1])),v=l.scale$2([],l.normalize([],[h[0],h[1],0]),this.radius),b=l.add([],h,l.scale$2([],l.sub([],l.add([],v,g),h),2));h[0]=b[0],h[1]=b[1]}return h}}function Hl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Gm{constructor(a,h){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mm(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new jm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),l.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[l.window,"blur",void 0]];for(const[v,b,I]of this._listeners)v.addEventListener(b,v===l.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[a,h,g]of this._listeners)a.removeEventListener(h,a===l.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(a){const h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new Tu(h,a));const v=h.boxZoom=new Pm(h,a);this._add("boxZoom",v);const b=new Rm,I=new Cu;h.doubleClickZoom=new vs(I,b),this._add("tapZoom",b),this._add("clickZoom",I);const C=new xt;this._add("tapDragZoom",C);const k=h.touchPitch=new Fm(h);this._add("touchPitch",k);const P=new zd(a),L=new zo(a);h.dragRotate=new Um(a,P,L),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const N=new zm(a),G=new Om(h,a);h.dragPan=new Nm(g,N,G),this._add("mousePan",N),this._add("touchPan",G,["touchZoom","touchRotate"]);const X=new Qi,W=new Bm;h.touchZoomRotate=new Zl(g,W,X,C),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ld(h));const K=h.scrollZoom=new Ra(h,this);this._add("scrollZoom",K,["mousePan"]);const Z=h.keyboard=new Xy;this._add("keyboard",Z);for(const q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[q]&&h[q].enable(a[q])}_add(a,h,g){this._handlers.push({handlerName:a,handler:h,allowed:g}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!no(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,h,g){for(const v in a)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const h=[];for(const g of a)this._el.contains(g.target)&&h.push(g);return h}handleEvent(a,h){this._updatingCamera=!0;const g=a.type==="renderFrame",v=g?void 0:a,b={needsRenderFrame:!1},I={},C={},k=a.touches?this._getMapTouches(a.touches):void 0,P=k?Ke(this._el,k):g?void 0:ge(this._el,a);for(const{handlerName:G,handler:X,allowed:W}of this._handlers){if(!X.isEnabled())continue;let K;this._blockedByActive(C,W,G)?X.reset():X[h||a.type]&&(K=X[h||a.type](a,P,k),this.mergeHandlerResult(b,I,K,G,v),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||X.isActive())&&(C[G]=X)}const L={};for(const G in this._previousActiveHandlers)C[G]||(L[G]=v);this._previousActiveHandlers=C,(Object.keys(L).length||Hl(b))&&(this._changes.push([b,I,L]),this._triggerRenderFrame()),(Object.keys(C).length||Hl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=b;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(a,h,g,v,b){if(!g)return;l.extend(a,g);const I={handlerName:v,originalEvent:g.originalEvent||b};g.zoomDelta!==void 0&&(h.zoom=I),g.panDelta!==void 0&&(h.drag=I),g.pitchDelta!==void 0&&(h.pitch=I),g.bearingDelta!==void 0&&(h.rotate=I)}_applyChanges(){const a={},h={},g={};for(const[v,b,I]of this._changes)v.panDelta&&(a.panDelta=(a.panDelta||new l.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(a.around=v.around),v.aroundCoord!==void 0&&(a.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(a.pinchAround=v.pinchAround),v.noInertia&&(a.noInertia=v.noInertia),l.extend(h,b),l.extend(g,I);this._updateMapTransform(a,h,g),this._changes=[]}_updateMapTransform(a,h,g){const v=this._map,b=v.transform,I=Q=>[Q.x,Q.y,Q.z];if((Q=>{const H=this._eventsInProgress.drag;return H&&!this._handlersById[H.handlerName].isActive()})()&&!Hl(a)){const Q=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",Q!==b.zoom&&this._map._update(!0)}if(!Hl(a))return void this._fireEvents(h,g,!0);let{panDelta:C,zoomDelta:k,bearingDelta:P,pitchDelta:L,around:N,aroundCoord:G,pinchAround:X}=a;X!==void 0&&(N=X),(Q=>h.drag&&!this._eventsInProgress.drag)()&&N&&(this._dragOrigin=I(b.pointCoordinate3D(N)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),N=N||v.transform.centerPoint,P&&(b.bearing+=P),L&&(b.pitch+=L),b._updateCameraState();const W=[0,0,0];if(C)if(b.projection.name==="mercator"){const Q=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N).dir),H=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N.sub(C)).dir);W[0]=H[0]-Q[0],W[1]=H[1]-Q[1]}else{const Q=b.pointCoordinate(N);if(b.projection.name==="globe"){C=C.rotate(-b.angle);const H=b._pixelsPerMercatorPixel/b.worldSize;W[0]=-C.x*l.mercatorScale(l.latFromMercatorY(Q.y))*H,W[1]=-C.y*l.mercatorScale(b.center.lat)*H}else{const H=b.pointCoordinate(N.sub(C));Q&&H&&(W[0]=H.x-Q.x,W[1]=H.y-Q.y)}}const K=b.zoom,Z=[0,0,0];if(k){const Q=I(G||b.pointCoordinate3D(N)),H={dir:l.normalize([],l.sub([],Q,b._camera.position))};if(H.dir[2]<0){const le=b.zoomDeltaToMovement(Q,k);l.scale$2(Z,H.dir,le)}}const q=l.add(W,W,Z);b._translateCameraConstrained(q),k&&Math.abs(b.zoom-K)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,g,!0)}_fireEvents(a,h,g){const v=no(this._eventsInProgress),b=no(a),I={};for(const L in a){const{originalEvent:N}=a[L];this._eventsInProgress[L]||(I[`${L}start`]=N),this._eventsInProgress[L]=a[L]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in I)this._fireEvent(L,I[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in a){const{originalEvent:N}=a[L];this._fireEvent(L,N)}const C={};let k;for(const L in this._eventsInProgress){const{handlerName:N,originalEvent:G}=this._eventsInProgress[L];this._handlersById[N].isActive()||(delete this._eventsInProgress[L],k=h[N]||G,C[`${L}end`]=k)}for(const L in C)this._fireEvent(L,C[L]);const P=no(this._eventsInProgress);if(g&&(v||b)&&!P){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;L?(N(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:k})):(this._map.fire(new l.Event("moveend",{originalEvent:k})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new l.Event(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Vm("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ud="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class $m extends l.Evented{constructor(a,h){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}panBy(a,h,g){return a=l.pointGeometry.convert(a).mult(-1),this.panTo(this.transform.center,l.extend({offset:a},h),g)}panTo(a,h,g){return this.easeTo(l.extend({center:a},h),g)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,g){return this.easeTo(l.extend({zoom:a},h),g)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,g){return this.easeTo(l.extend({bearing:a},h),g)}resetNorth(a,h){return this.rotateTo(0,l.extend({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}cameraForBounds(a,h){a=l.LngLatBounds.convert(a);const g=h&&h.bearing||0,v=a.getNorthWest(),b=a.getSouthEast();return this._cameraForBounds(this.transform,v,b,g,h)}_extendCameraOptions(a){const h={top:0,bottom:0,right:0,left:0};if(typeof(a=l.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=="number"){const g=a.padding;a.padding={top:g,bottom:g,right:g,left:g}}return a.padding=l.extend(h,a.padding),a}_minimumAABBFrustumDistance(a,h){const g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>a.aspect?g/(2*Math.tan(.5*a.fovX)*a.aspect):v/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,h,g,v,b){const I=a.clone(),C=this._extendCameraOptions(b);I.bearing=v;const k=l.LngLat.convert(h),P=l.LngLat.convert(g),L=.5*(k.lat+P.lat),N=.5*(k.lng+P.lng),G=l.latLngToECEF(L,N),X=l.normalize([],G),W=l.normalize([],l.cross([],X,[0,1,0])),K=l.cross([],W,X),Z=[W[0],W[1],W[2],0,K[0],K[1],K[2],0,X[0],X[1],X[2],0,0,0,0,1],q=[G,l.latLngToECEF(k.lat,k.lng),l.latLngToECEF(P.lat,k.lng),l.latLngToECEF(P.lat,P.lng),l.latLngToECEF(k.lat,P.lng),l.latLngToECEF(L,k.lng),l.latLngToECEF(L,P.lng),l.latLngToECEF(k.lat,N),l.latLngToECEF(P.lat,N)];let Q=l.Aabb.fromPoints(q.map(Ye=>[l.dot(W,Ye),l.dot(K,Ye),l.dot(X,Ye)]));const H=l.transformMat4([],Q.center,Z);l.squaredLength(H)===0&&l.set(H,0,0,1),l.normalize(H,H),l.scale$2(H,H,l.GLOBE_RADIUS),I.center=l.ecefToLatLng(H);const le=I.getWorldToCameraMatrix(),ce=l.invert(new Float64Array(16),le);Q=l.Aabb.applyTransform(Q,l.multiply([],le,Z)),l.transformMat4(H,H,le);const ie=.5*(Q.max[2]-Q.min[2]),he=this._minimumAABBFrustumDistance(I,Q),xe=l.scale$2([],[0,0,1],ie),Ae=l.add(xe,H,xe),Ie=he+(I.pitch===0?0:l.distance(H,Ae)),qe=I.globeCenterInViewSpace,_e=l.sub([],H,[qe[0],qe[1],qe[2]]);l.normalize(_e,_e),l.scale$2(_e,_e,Ie);const Fe=l.add([],H,_e);l.transformMat4(Fe,Fe,ce);const Be=l.earthRadius/l.GLOBE_RADIUS,we=l.length(Fe),me=l.mercatorZfromAltitude(we*Be-l.earthRadius,0),ct=Math.min(I.zoomFromMercatorZAdjusted(me),C.maxZoom);return ct>.5*(l.GLOBE_ZOOM_THRESHOLD_MIN+l.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"mercator"}),I.zoom=ct,this._cameraForBounds(I,h,g,v,b)):{center:I.center,zoom:ct,bearing:v}}queryTerrainElevation(a,h){const g=this.transform.elevation;return g?(h=l.extend({},{exaggerated:!0},h),g.getAtPoint(l.MercatorCoordinate.fromLngLat(a),null,h.exaggerated)):null}_cameraForBounds(a,h,g,v,b){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,h,g,v,b);const I=a.clone(),C=this._extendCameraOptions(b),k=I.padding;I.bearing=v;const P=l.LngLat.convert(h),L=l.LngLat.convert(g),N=new l.LngLat(P.lng,L.lat),G=new l.LngLat(L.lng,P.lat),X=I.project(P),W=I.project(L),K=this.queryTerrainElevation(P),Z=this.queryTerrainElevation(L),q=this.queryTerrainElevation(N),Q=this.queryTerrainElevation(G),H=[[X.x,X.y,Math.min(K||0,Z||0,q||0,Q||0)],[W.x,W.y,Math.max(K||0,Z||0,q||0,Q||0)]];let le=l.Aabb.fromPoints(H);const ce=I.getWorldToCameraMatrix(),ie=l.invert(new Float64Array(16),ce);le=l.Aabb.applyTransform(le,ce);const he=l.sub([],le.max,le.min),xe=k.left||0,Ae=k.right||0,Ie=k.bottom||0,qe=k.top||0,{left:_e,right:Fe,top:Be,bottom:we}=C.padding,me=.5*(xe+Ae),ct=.5*(qe+Ie),Ye=Math.min(I.scaleZoom(I.scale*Math.min((I.width-(xe+Ae+_e+Fe))/he[0],(I.height-(Ie+qe+we+Be))/he[1])),C.maxZoom),rt=I.scale/I.zoomScale(Ye);le=new l.Aabb([le.min[0]-(_e+me)*rt,le.min[1]-(we+ct)*rt,le.min[2]],[le.max[0]+(Fe+me)*rt,le.max[1]+(Be+ct)*rt,le.max[2]]);const Qe=.5*he[2],At=this._minimumAABBFrustumDistance(I,le),$t=[0,0,1,0];l.transformMat4$1($t,$t,ce),l.normalize$2($t,$t);const Ot=l.scale$2([],$t,At+Qe),Ct=l.add([],le.center,Ot),Je=(typeof C.offset.x=="number"&&typeof C.offset.y=="number"?new l.pointGeometry(C.offset.x,C.offset.y):l.pointGeometry.convert(C.offset)).rotate(-l.degToRad(v));le.center[0]-=Je.x*rt,le.center[1]+=Je.y*rt,l.transformMat4(le.center,le.center,ie),l.transformMat4(Ct,Ct,ie);const Xt=[le.center[0],le.center[1],Ct[2]*I.pixelsPerMeter];l.scale$2(Xt,Xt,1/I.worldSize);const tn=l.lngFromMercatorX(Xt[0]),Nn=l.latFromMercatorY(Xt[1]),Un=Math.min(I._zoomFromMercatorZ(Xt[2]),C.maxZoom),Pn=new l.LngLat(tn,Nn);return I.mercatorFromTransition&&Un<.5*(l.GLOBE_ZOOM_THRESHOLD_MIN+l.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"globe"}),I.zoom=Un,this._cameraForBounds(I,h,g,v,b)):{center:Pn,zoom:Un,bearing:v}}fitBounds(a,h,g){const v=this.cameraForBounds(a,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(a,h,g,v,b){const I=l.pointGeometry.convert(a),C=l.pointGeometry.convert(h),k=new l.pointGeometry(Math.min(I.x,C.x),Math.min(I.y,C.y)),P=new l.pointGeometry(Math.max(I.x,C.x),Math.max(I.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(I,C))return this;const L=this.transform.pointLocation3D(k),N=this.transform.pointLocation3D(P),G=this.transform.pointLocation3D(new l.pointGeometry(k.x,P.y)),X=this.transform.pointLocation3D(new l.pointGeometry(P.x,k.y)),W=[Math.min(L.lng,N.lng,G.lng,X.lng),Math.min(L.lat,N.lat,G.lat,X.lat)],K=[Math.max(L.lng,N.lng,G.lng,X.lng),Math.max(L.lat,N.lat,G.lat,X.lat)],Z=this._cameraForBounds(this.transform,W,K,g,v);return this._fitInternal(Z,v,b)}_fitInternal(a,h,g){return a?(delete(h=l.extend(a,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this}jumpTo(a,h){this.stop();const g=a.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,I=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(v=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=l.LngLat.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(b=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(I=!0,g.pitch=+a.pitch),a.padding==null||g.isPaddingEqual(a.padding)||(g.padding=a.padding),a.preloadOnly?(this._preloadTiles(g),this):(this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),v&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),b&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),I&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||l.warnOnce(Ud),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,h){const g=this.transform;if(!g.projection.supportsFreeCamera)return l.warnOnce(Ud),this;this.stop();const v=g.zoom,b=g.pitch,I=g.bearing;g.setFreeCameraOptions(a);const C=v!==g.zoom,k=b!==g.pitch,P=I!==g.bearing;return this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),C&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),P&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),k&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h)),this}easeTo(a,h){this._stop(!1,a.easeId),((a=l.extend({offset:[0,0],duration:500,easing:l.ease},a)).animate===!1||!a.essential&&l.exported.prefersReducedMotion)&&(a.duration=0);const g=this.transform,v=this.getZoom(),b=this.getBearing(),I=this.getPitch(),C=this.getPadding(),k="zoom"in a?+a.zoom:v,P="bearing"in a?this._normalizeBearing(a.bearing,b):b,L="pitch"in a?+a.pitch:I,N="padding"in a?a.padding:g.padding,G=l.pointGeometry.convert(a.offset);let X,W,K;if(g.projection.name==="globe"){const Ae=l.MercatorCoordinate.fromLngLat(g.center),Ie=G.rotate(-g.angle);Ae.x+=Ie.x/g.worldSize,Ae.y+=Ie.y/g.worldSize;const qe=Ae.toLngLat(),_e=l.LngLat.convert(a.center||qe);this._normalizeCenter(_e),X=g.centerPoint.add(Ie),W=new l.pointGeometry(Ae.x,Ae.y).mult(g.worldSize),K=new l.pointGeometry(l.mercatorXfromLng(_e.lng),l.mercatorYfromLat(_e.lat)).mult(g.worldSize).sub(W)}else{X=g.centerPoint.add(G);const Ae=g.pointLocation(X),Ie=l.LngLat.convert(a.center||Ae);this._normalizeCenter(Ie),W=g.project(Ae),K=g.project(Ie).sub(W)}const Z=g.zoomScale(k-v);let q,Q;a.around&&(q=l.LngLat.convert(a.around),Q=g.locationPoint(q));const H=this._zooming||k!==v,le=this._rotating||b!==P,ce=this._pitching||L!==I,ie=!g.isPaddingEqual(N),he=Ae=>Ie=>{if(H&&(Ae.zoom=l.number(v,k,Ie)),le&&(Ae.bearing=l.number(b,P,Ie)),ce&&(Ae.pitch=l.number(I,L,Ie)),ie&&(Ae.interpolatePadding(C,N,Ie),X=Ae.centerPoint.add(G)),q)Ae.setLocationAtPoint(q,Q);else{const qe=Ae.zoomScale(Ae.zoom-v),_e=k>v?Math.min(2,Z):Math.max(.5,Z),Fe=Math.pow(_e,1-Ie),Be=Ae.unproject(W.add(K.mult(Ie*Fe)).mult(qe));Ae.setLocationAtPoint(Ae.renderWorldCopies?Be.wrap():Be,X)}return a.preloadOnly||this._fireMoveEvents(h),Ae};if(a.preloadOnly){const Ae=this._emulate(he,a.duration,g);return this._preloadTiles(Ae),this}const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=H,this._rotating=le,this._pitching=ce,this._padding=ie,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,xe),this._ease(he(g),Ae=>{g.recenterOnTerrain(),this._afterEase(h,Ae)},a),this}_prepareEase(a,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||g.moving||this.fire(new l.Event("movestart",a)),this._zooming&&!g.zooming&&this.fire(new l.Event("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new l.Event("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new l.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new l.Event("move",a)),this._zooming&&this.fire(new l.Event("zoom",a)),this._rotating&&this.fire(new l.Event("rotate",a)),this._pitching&&this.fire(new l.Event("pitch",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new l.Event("zoomend",a)),v&&this.fire(new l.Event("rotateend",a)),b&&this.fire(new l.Event("pitchend",a)),this.fire(new l.Event("moveend",a))}flyTo(a,h){if(!a.essential&&l.exported.prefersReducedMotion){const rt=l.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(rt,h)}this.stop(),a=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},a);const g=this.transform,v=this.getZoom(),b=this.getBearing(),I=this.getPitch(),C=this.getPadding(),k="zoom"in a?l.clamp(+a.zoom,g.minZoom,g.maxZoom):v,P="bearing"in a?this._normalizeBearing(a.bearing,b):b,L="pitch"in a?+a.pitch:I,N="padding"in a?a.padding:g.padding,G=g.zoomScale(k-v),X=l.pointGeometry.convert(a.offset);let W=g.centerPoint.add(X);const K=g.pointLocation(W),Z=l.LngLat.convert(a.center||K);this._normalizeCenter(Z);const q=g.project(K),Q=g.project(Z).sub(q);let H=a.curve;const le=Math.max(g.width,g.height),ce=le/G,ie=Q.mag();if("minZoom"in a){const rt=l.clamp(Math.min(a.minZoom,v,k),g.minZoom,g.maxZoom),Qe=le/g.zoomScale(rt-v);H=Math.sqrt(Qe/ie*2)}const he=H*H;function xe(rt){const Qe=(ce*ce-le*le+(rt?-1:1)*he*he*ie*ie)/(2*(rt?ce:le)*he*ie);return Math.log(Math.sqrt(Qe*Qe+1)-Qe)}function Ae(rt){return(Math.exp(rt)-Math.exp(-rt))/2}function Ie(rt){return(Math.exp(rt)+Math.exp(-rt))/2}const qe=xe(0);let _e=function(rt){return Ie(qe)/Ie(qe+H*rt)},Fe=function(rt){return le*((Ie(qe)*(Ae(Qe=qe+H*rt)/Ie(Qe))-Ae(qe))/he)/ie;var Qe},Be=(xe(1)-qe)/H;if(Math.abs(ie)<1e-6||!isFinite(Be)){if(Math.abs(le-ce)<1e-6)return this.easeTo(a,h);const rt=ce<le?-1:1;Be=Math.abs(Math.log(ce/le))/H,Fe=function(){return 0},_e=function(Qe){return Math.exp(rt*H*Qe)}}a.duration="duration"in a?+a.duration:1e3*Be/("screenSpeed"in a?+a.screenSpeed/H:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const we=b!==P,me=L!==I,ct=!g.isPaddingEqual(N),Ye=rt=>Qe=>{const At=Qe*Be,$t=1/_e(At);rt.zoom=Qe===1?k:v+rt.scaleZoom($t),we&&(rt.bearing=l.number(b,P,Qe)),me&&(rt.pitch=l.number(I,L,Qe)),ct&&(rt.interpolatePadding(C,N,Qe),W=rt.centerPoint.add(X));const Ot=Qe===1?Z:rt.unproject(q.add(Q.mult(Fe(At))).mult($t));return rt.setLocationAtPoint(rt.renderWorldCopies?Ot.wrap():Ot,W),rt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(h),rt};if(a.preloadOnly){const rt=this._emulate(Ye,a.duration,g);return this._preloadTiles(rt),this}return this._zooming=!0,this._rotating=we,this._pitching=me,this._padding=ct,this._prepareEase(h,!1),this._ease(Ye(g),()=>this._afterEase(h),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!a){const g=this.handlers;g&&g.stop(!1)}return this}_ease(a,h,g){g.animate===!1||g.duration===0?(a(1),h()):(this._easeStart=l.exported.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,h){a=l.wrap(a,-180,180);const g=Math.abs(a-h);return Math.abs(a-360-h)<g&&(a-=360),Math.abs(a+360-h)<g&&(a+=360),a}_normalizeCenter(a){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const g=a.lng-h.center.lng;a.lng+=g>180?-360:g<-180?360:0}_emulate(a,h,g){const v=Math.ceil(15*h/1e3),b=[],I=a(g.clone());for(let C=0;C<=v;C++){const k=I(C/v);b.push(k.clone())}return b}}class Vd{constructor(a={}){this.options=a,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const h=this.options&&this.options.compact;return this._map=a,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j("button","mapboxgl-ctrl-attrib-button",this._container),j("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,h){const g=this._map._getUIString(`AttributionControl.${h}`);a.setAttribute("aria-label",g),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(a){const g=h.reduce((v,b,I)=>(b.value&&(v+=`${b.key}=${b.value}${I<h.length-1?"&":""}`),v),"?");a.href=`${l.config.FEEDBACK_URL}/${g}#${Pd(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style._sourceCaches;for(const v in h){const b=h[v];if(b.used){const I=b.getSource();I.attribution&&a.indexOf(I.attribution)<0&&a.push(I.attribution)}}a.sort((v,b)=>v.length-b.length),a=a.filter((v,b)=>{for(let I=b+1;I<a.length;I++)if(a[I].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const g=a.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,a.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xl{constructor(){l.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=j("div","mapboxgl-ctrl");const h=j("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const h in a){const g=a[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class ku{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){const h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(const v of g)if(v.id===a)return void(v.cancelled=!0)}run(a=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const g of h)if(!g.cancelled&&(g.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Kl(p,a,h){if(p=new l.LngLat(p.lng,p.lat),a){const g=new l.LngLat(p.lng-360,p.lat),v=new l.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-h.center.lng)/360),I=h.locationPoint(p).distSqr(a),C=a.x<0||a.y<0||a.x>h.width||a.y>h.height;h.locationPoint(g).distSqr(a)<I&&(C||Math.abs(g.lng-h.center.lng)<b)?p=g:h.locationPoint(v).distSqr(a)<I&&(C||Math.abs(v.lng-h.center.lng)<b)&&(p=v)}for(;Math.abs(p.lng-h.center.lng)>180;){const g=h.locationPoint(p);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;p.lng>h.center.lng?p.lng-=360:p.lng+=360}return p}const Mu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Du extends l.Evented{constructor(a,h){if(super(),(a instanceof l.window.HTMLElement||h)&&(a=l.extend({element:a},h)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=l.pointGeometry.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=j("div");const v=41,b=27,I=ee("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),C=ee("radialGradient",{id:"shadowGradient"},ee("defs",{},I));ee("stop",{offset:"10%","stop-opacity":.4},C),ee("stop",{offset:"100%","stop-opacity":.05},C),ee("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),ee("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),ee("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),ee("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=l.pointGeometry.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in Mu)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=l.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const h=a.code,g=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(a){const h=a.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,h=this._pos;if(!a||!h)return!1;const g=a.unproject(h),v=a.getFreeCameraOptions();if(!v.position)return!1;const b=v.position.toLngLat();return b.distanceTo(g)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const h=this._pos;if(!h||h.x<0||h.x>a.transform.width||h.y<0||h.y>a.transform.height)return void this._clearFadeTimer();const g=a.unproject(h);let v;a._showingGlobe()&&l.isLngLatBehindGlobe(a.transform,this._lngLat)?v=0:(v=1-a._queryFogOpacity(g),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Mu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const a=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!a||g!=="map")return"";if(!h._showingGlobe()){const k=h.getPitch();return k?`rotateX(${k}deg)`:""}const v=l.radToDeg(l.globeTiltAtLngLat(h.transform,this._lngLat)),b=a.sub(l.globeCenterToScreenPoint(h.transform)),I=Math.abs(b.x)+Math.abs(b.y);if(I===0)return"";const C=v/I;return`rotateX(${-b.y*C}deg) rotateY(${b.x*C}deg)`}_calculateZTransform(){const a=this._pos,h=this._map;if(!h||!a)return"";let g=0;const v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){const b=h.project(new l.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=h.project(new l.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);g=l.radToDeg(Math.atan2(I.y,I.x))-90}else g=-h.getBearing();else if(v==="horizon"){const b=l.smoothstep(4,6,h.getZoom()),I=l.globeCenterToScreenPoint(h.transform);I.y+=b*h.transform.height;const C=a.sub(I),k=l.radToDeg(Math.atan2(C.y,C.x));g=(k>90?k-270:k+90)*(1-b)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(a){l.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Kl(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),a===!0?this._updateFrameId=l.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=l.pointGeometry.convert(a),this._update(),this}_onMove(a){const h=this._map;if(!h)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const b=this._clickTolerance||h._clickTolerance;if(a.point.dist(g)<b)return;this._isDragging=!0}this._pos=a.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(a){const h=this._map,g=this._pos;h&&g&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(g),this._pointerdownPos=a.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const h=this._map;return h&&(a?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const qm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Wm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jd(p=new l.pointGeometry(0,0),a="bottom"){if(typeof p=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(a){case"top":return new l.pointGeometry(0,p);case"top-left":return new l.pointGeometry(h,h);case"top-right":return new l.pointGeometry(-h,h);case"bottom":return new l.pointGeometry(0,-p);case"bottom-left":return new l.pointGeometry(h,-h);case"bottom-right":return new l.pointGeometry(-h,-h);case"left":return new l.pointGeometry(p,0);case"right":return new l.pointGeometry(-p,0)}return new l.pointGeometry(0,0)}return p instanceof l.pointGeometry||Array.isArray(p)?l.pointGeometry.convert(p):l.pointGeometry.convert(p[a]||[0,0])}class Zm{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const h=l.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,h,g){this._start=this.getValue(h),this._end=a,this._startTime=h,this._endTime=h+g}}const Hm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Gd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Pu(p){p.parentNode&&p.parentNode.removeChild(p)}const Xm={showCompass:!0,showZoom:!0,visualizePitch:!1};class Km{constructor(a,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new zd({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,g&&(this.mousePitch=new zo({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(a,h){this.mouseRotate.mousedown(a,h),this.mousePitch&&this.mousePitch.mousedown(a,h),Ge()}move(a,h){const g=this.map,v=this.mouseRotate.mousemoveWindow(a,h),b=v&&v.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const I=this.mousePitch.mousemoveWindow(a,h),C=I&&I.pitchDelta;C&&g.setPitch(g.getPitch()+C)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){it(),l.window.removeEventListener("mousemove",this.mousemove),l.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(l.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),ge(this.element,a)),l.window.addEventListener("mousemove",this.mousemove),l.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,ge(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ke(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=Ke(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ym={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},$d={maxWidth:100,unit:"metric"};function Qm(p,a,h){const g=Ru(a),v=g/a,b={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[h];this._map._requestDomTask(()=>{this._container.style.width=p*v+"px",this._container.innerHTML=`${g}&nbsp;${b}`})}function Ru(p){const a=Math.pow(10,`${Math.floor(p)}`.length-1);let h=p/a;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(g){const v=Math.pow(10,Math.ceil(-Math.log(g)/Math.LN10));return Math.round(g*v)/v}(h),a*h}const Yl={version:l.version,supported:A,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends $m{constructor(p){if(l.LivePerformanceUtils.mark(l.PerformanceMarkers.create),(p=l.extend({},Gd,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&l.isSafariWithAntialiasingBug(l.window)&&(p.antialias=!1,l.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new zr(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new ku,this._domRenderTaskQueue=new ku,this._controls=[],this._markers=[],this._popups=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Hm,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Zm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new l.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,typeof p.container=="string"){if(this._container=l.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof l.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&l.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),l.window!==void 0&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1),l.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Gm(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new Cm(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,l.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new Vd({customAttribution:p.customAttribution})),this._logoControl=new Xl,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new l.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new l.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(p,a){if(a===void 0&&(a=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=p.onAdd(this);this._controls.push(p);const g=this._controlPositions[a];return a.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(p);return a>-1&&this._controls.splice(a,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new l.Event("movestart",p)).fire(new l.Event("move",p)),this.fire(new l.Event("resize",p)),a&&this.fire(new l.Event("moveend",p)),this}getBounds(){return this.transform.projection.name==="globe"&&l.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(l.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p==null?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p==null?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p==null?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p==null?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?l.window.navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(a=>a==="auto"?l.window.navigator.language:a):p}setLanguage(p){const a=this._parseLanguage(p);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,a=p.projection.name;let h;a==="globe"&&p.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX?(p.setMercatorFromTransition(),h=!0):a==="mercator"&&p.zoom<l.GLOBE_ZOOM_THRESHOLD_MAX&&(p.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,a){return this._updateProjection(p||a||{name:"mercator"})}_updateProjection(p){let a;if(a=p.name==="globe"&&this.transform.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(p){return this.transform.locationPoint3D(l.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(l.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,a,h){if(p==="mouseenter"||p==="mouseover"){let g=!1;const v=I=>{const C=a.filter(P=>this.getLayer(P)),k=C.length?this.queryRenderedFeatures(I.point,{layers:C}):[];k.length?g||(g=!0,h.call(this,new Or(p,this,I.originalEvent,{features:k}))):g=!1},b=()=>{g=!1};return{layers:new Set(a),listener:h,delegates:{mousemove:v,mouseout:b}}}if(p==="mouseleave"||p==="mouseout"){let g=!1;const v=I=>{const C=a.filter(k=>this.getLayer(k));(C.length?this.queryRenderedFeatures(I.point,{layers:C}):[]).length?g=!0:g&&(g=!1,h.call(this,new Or(p,this,I.originalEvent)))},b=I=>{g&&(g=!1,h.call(this,new Or(p,this,I.originalEvent)))};return{layers:new Set(a),listener:h,delegates:{mousemove:v,mouseout:b}}}{const g=v=>{const b=a.filter(C=>this.getLayer(C)),I=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];I.length&&(v.features=I,h.call(this,v),delete v.features)};return{layers:new Set(a),listener:h,delegates:{[p]:g}}}}on(p,a,h){if(h===void 0)return super.on(p,a);Array.isArray(a)||(a=[a]);const g=this._createDelegatedListener(p,a,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(p,a,h){if(h===void 0)return super.once(p,a);Array.isArray(a)||(a=[a]);const g=this._createDelegatedListener(p,a,h);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(p,a,h){if(h===void 0)return super.off(p,a);a=new Set(Array.isArray(a)?a:[a]);const g=(b,I)=>{if(b.size!==I.size)return!1;for(const C of b)if(!I.has(C))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[p]:void 0;return v&&(b=>{for(let I=0;I<b.length;I++){const C=b[I];if(C.listener===h&&g(C.layers,a)){for(const k in C.delegates)this.off(k,C.delegates[k]);return b.splice(I,1),this}}})(v),this}queryRenderedFeatures(p,a){return this.style?(a!==void 0||p===void 0||p instanceof l.pointGeometry||Array.isArray(p)||(a=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(p,a){return this.style.querySourceFeatures(p,a)}setStyle(p,a){return(a=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(p,a))}_getUIString(p){const a=this._locale[p];if(a==null)throw new Error(`Missing UI string '${p}'`);return a}_updateStyle(p,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new ms(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ms(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,a){if(typeof p=="string"){const h=this._requestManager.normalizeStyleURL(p),g=this._requestManager.transformRequest(h,l.ResourceType.Style);l.getJSON(g,(v,b)=>{v?this.fire(new l.ErrorEvent(v)):b&&this._updateDiff(b,a)})}else typeof p=="object"&&this._updateDiff(p,a)}_updateDiff(p,a){try{this.style.setState(p)&&this._update(!0)}catch(h){l.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(p,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(l.warnOnce("There is no style added to the map."),!1)}addSource(p,a){return this._lazyInitEmptyStyle(),this.style.addSource(p,a),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const a in p){const h=p[a]._tiles;for(const g in h){const v=h[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(p,a,h){this._lazyInitEmptyStyle(),this.style.addSourceType(p,a,h)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,a,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:b,content:I}={}){if(this._lazyInitEmptyStyle(),a instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&a instanceof l.window.ImageBitmap){const{width:C,height:k,data:P}=l.exported.getImageData(a);this.style.addImage(p,{data:new l.RGBAImage({width:C,height:k},P),pixelRatio:h,stretchX:v,stretchY:b,content:I,sdf:g,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:k}=a,P=a;this.style.addImage(p,{data:new l.RGBAImage({width:C,height:k},new Uint8Array(P.data)),pixelRatio:h,stretchX:v,stretchY:b,content:I,sdf:g,version:0,userImage:P}),P.onAdd&&P.onAdd(this,p)}}updateImage(p,a){const h=this.style.getImage(p);if(!h)return void this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=a instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&a instanceof l.window.ImageBitmap?l.exported.getImageData(a):a,{width:v,height:b}=g;v!==void 0&&b!==void 0?v===h.data.width&&b===h.data.height?(h.data.replace(g.data,!(a instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&a instanceof l.window.ImageBitmap)),this.style.updateImage(p,h)):this.fire(new l.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${b})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`))):this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,a){l.getImage(this._requestManager.transformRequest(p,l.ResourceType.Image),(h,g)=>{a(h,g instanceof l.window.HTMLImageElement?l.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(p,a){return this._lazyInitEmptyStyle(),this.style.addLayer(p,a),this._update(!0)}moveLayer(p,a){return this.style.moveLayer(p,a),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,a,h){return this.style.setLayerZoomRange(p,a,h),this._update(!0)}setFilter(p,a,h={}){return this.style.setFilter(p,a,h),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,a,h,g={}){return this.style.setPaintProperty(p,a,h,g),this._update(!0)}getPaintProperty(p,a){return this.style.getPaintProperty(p,a)}setLayoutProperty(p,a,h,g={}){return this.style.setLayoutProperty(p,a,h,g),this._update(!0)}getLayoutProperty(p,a){return this.style.getLayoutProperty(p,a)}setLight(p,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.LngLat.convert(p),this.transform):0}setFeatureState(p,a){return this.style.setFeatureState(p,a),this._update()}removeFeatureState(p,a){return this.style.removeFeatureState(p,a),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let h,g,v,b=this._container;for(;b&&(!g||!v);){const I=l.window.getComputedStyle(b).transform;I&&I!=="none"&&(h=I.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),b=b.parentElement}this._containerWidth=g?Math.abs(p/g):p,this._containerHeight=v?Math.abs(a/v):a}_detectMissingCSS(){l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=j("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=j("div","mapboxgl-canvas-container",p);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=j("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=j("div","mapboxgl-control-container",p),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=j("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,a){const h=l.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(p),this._canvas.height=h*Math.ceil(a),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${a}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const a=this._markers.indexOf(p);a!==-1&&this._markers.splice(a,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const a=this._popups.indexOf(p);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const p=l.extend({},A.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);a?(l.storeAuthState(a,!0),this.painter=new Zy(a,this.transform),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),l.exported$1.testSupport(a)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let a;const h=this.painter.context.extTimerQuery,g=l.exported.now();if(this.listens("gpu-timing-frame")&&(a=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],l.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],l.window.performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();let v=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,P=this.transform.pitch,L=l.exported.now();this.style.zoomHistory.update(k,L);const N=new l.EvaluationParameters(k,{now:L,fadeDuration:b,pitch:P,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=N.crossFadingFactor();G===1&&G===this._crossFadingFactor||(v=!0,this._crossFadingFactor=G),this.style.update(N)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):I=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const k=l.exported.now()-g;h.endQueryEXT(h.TIME_ELAPSED_EXT,a),setTimeout(()=>{const P=h.getQueryObjectEXT(a,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(a),this.fire(new l.Event("gpu-timing-frame",{cpuTime:k,gpuTime:P})),l.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(k);this.fire(new l.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(k);this.fire(new l.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(C||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(I=this._updateAverageElevation(g,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new l.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new l.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,l.LivePerformanceUtils.mark(l.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&l.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const a of this._markers)p&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!p||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(p,a=!1){const h=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);if((a||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=p;const I=Math.abs(g-v);if(I>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(v),h(v);this._averageElevation.easeTo(v,p,300)}else if(I>1e-4)return this._averageElevation.jumpTo(v),h(v)}return!!this._averageElevation.isEasing(p)&&h(this._averageElevation.getValue(p))}_authenticate(){l.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===l.AUTH_ERR_MSG||p.status===401)){const a=this.painter.context.gl;l.storeAuthState(a,!1),this._logoControl instanceof Xl&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const h=this.painter.context.gl,g=h.createFramebuffer();function v(b){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,b,0);const I=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,I),I}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(p),a.canvasCopies.map(v),a.timeStamps)}_canvasPixelComparison(p,a,h){let g=h[1]-h[0];const v=p.length/4;for(let b=0;b<a.length;b++){const I=a[b];let C=0;for(let k=0;k<I.length;k+=4)I[k]===p[k]&&I[k+1]===p[k+1]&&I[k+2]===p[k+2]&&I[k+3]===p[k+3]&&(C+=1);g+=(h[b+2]-h[b+1])*(1-C/v)}return g}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),l.window!==void 0&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1),l.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),Pu(this._canvasContainer),Pu(this._controlContainer),Pu(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),l.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=l.exported.frame(a=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(a)}))}_preloadTiles(p){const a=this.style?Object.values(this.style._sourceCaches):[];return l.asyncAll(a,(h,g)=>h._preloadTiles(p,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){l.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,a){l.setCacheLimits(p,a)}get version(){return l.version}},NavigationControl:class{constructor(p){this.options=l.extend({},Xm,p),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),j("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),j("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:a}):h.resetNorth({},{originalEvent:a}))}),this._compassIcon=j("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const a=p.getZoom(),h=a===p.getMaxZoom(),g=a===p.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Km(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,a){const h=j("button",p,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(p,a){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${a}`);p.setAttribute("aria-label",h),p.firstElementChild&&p.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends l.Evented{constructor(p){super(),this.options=l.extend({geolocation:l.window.navigator.geolocation},Ym,p),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Dd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const a=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,p(h)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):l.window.navigator.permissions!==void 0?l.window.navigator.permissions.query({name:"geolocation"}).then(h=>a(h.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(p){const a=this._map.getMaxBounds(),h=p.coords;return!!a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",p)),this._finish()}}_updateCamera(p){const a=new l.LngLat(p.coords.longitude,p.coords.latitude),h=p.coords.accuracy,g=this._map.getBearing(),v=l.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(h),v,{geolocateSource:!0})}_updateMarker(p){if(p){const a=new l.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,a=l.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,h=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=j("button","mapboxgl-ctrl-geolocate",this._container),j("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j("div","mapboxgl-user-location"),this._dotElement.appendChild(j("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(j("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Du({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=j("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Du({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{l.window.addEventListener("ondeviceorientationabsolute"in l.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};l.window.DeviceMotionEvent!==void 0&&typeof l.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),l.window.removeEventListener("deviceorientation",this._onDeviceOrientation),l.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Vd,ScaleControl:class{constructor(p){this.options=l.extend({},$d,p),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Qm.bind(this)),l.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,a=this._map,h=a._containerHeight/2,g=a._containerWidth/2-p/2,v=a.unproject([g,h]),b=a.unproject([g+p,h]),I=v.distanceTo(b);if(this.options.unit==="imperial"){const C=3.2808*I;C>5280?this._setScale(p,C/5280,"mile"):this._setScale(p,C,"foot")}else this.options.unit==="nautical"?this._setScale(p,I/1852,"nautical-mile"):I>=1e3?this._setScale(p,I/1e3,"kilometer"):this._setScale(p,I,"meter")}_setScale(p,a,h){const g=Ru(a),v=g/a;this._map._requestDomTask(()=>{this._container.style.width=p*v+"px",this._container.innerHTML=h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:h}).format(g):`${g}&nbsp;nm`})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof l.window.HTMLElement?this._container=p.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in l.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!l.window.document.fullscreenEnabled&&!l.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=j("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(l.window.document.fullscreenElement||l.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(p){super(),this.options=l.extend(Object.create(qm),p),l.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=l.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(l.window.document.createTextNode(p))}setHTML(p){const a=l.window.document.createDocumentFragment(),h=l.window.document.createElement("body");let g;for(h.innerHTML=p;g=h.firstChild,g;)a.appendChild(g);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=j("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(p),this.options.closeButton){const h=this._closeButton=j("button","mapboxgl-popup-close-button",a);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let a;return this._classList.delete(p)?a=!1:(this._classList.add(p),a=!0),this._updateClassList(),a}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const a=this._map,h=this._container,g=this._pos;if(!a||!h||!g)return"bottom";const v=h.offsetWidth,b=h.offsetHeight,I=g.x<v/2,C=g.x>a.transform.width-v/2;if(g.y+p<b)return I?"top-left":C?"top-right":"top";if(g.y>a.transform.height-b){if(I)return"bottom-left";if(C)return"bottom-right"}return I?"left":C?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),p.className=a.join(" ")}_update(p){const a=this._map,h=this._content;if(!a||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=j("div","mapboxgl-popup",a.getContainer()),this._tip=j("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Kl(this._lngLat,this._pos,a.transform)),!this._trackPointer||p){const v=this._pos=this._trackPointer&&p?p:a.project(this._lngLat),b=jd(this.options.offset),I=this._anchor=this._getAnchor(b.y),C=jd(this.options.offset,I),k=v.add(C).round();a._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${Mu[I]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&a._showingGlobe()){const v=l.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Wm);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Du,Style:ms,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,FreeCameraOptions:Vl,Evented:l.Evented,config:l.config,prewarm:function(){Wt().acquire(zt)},clearPrewarmedResources:function(){const p=Mt;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(zt),Mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(p){l.config.ACCESS_TOKEN=p},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(p){l.config.API_URL=p},get workerCount(){return Rt.workerCount},set workerCount(p){Rt.workerCount=p},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){l.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){l.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:l.exported.setNow,restoreNow:l.exported.restoreNow};return Yl});var y=u;return y})})(Vk);const I0=Vk.exports;function q5(i){let e,t,r,u=i[7][0]+"",f,y,l,T,A,R,z,j=i[5][0]+"",ee,se,be,Re,Ge=i[3][0]+"",it,dt,Ue,ge,Ke,He,en,vt,Ft=i[0][0]+"",Lt,kt,Qt,lt,Xe=i[2][0]+"",an,li,ni,ii,rn=i[1][0]+"",It,ri,Tn,bi,et=new Date(i[6][0]).toString().split("GMT")[0]+"",Nt;return{c(){e=tt("div"),t=tt("div"),r=tt("h1"),f=un(u),y=Dt(),l=tt("img"),A=Dt(),R=tt("h2"),z=un("Price : $"),ee=un(j),se=Dt(),be=tt("h2"),Re=un("Description : "),it=un(Ge),dt=Dt(),Ue=tt("div"),ge=tt("div"),Ke=Dt(),He=tt("div"),en=tt("h2"),vt=un("Location : "),Lt=un(Ft),kt=Dt(),Qt=tt("h2"),lt=un("Contact : "),an=un(Xe),li=Dt(),ni=tt("h2"),ii=un("Listed By : "),It=un(rn),ri=Dt(),Tn=tt("h2"),bi=un("Date Posted : "),Nt=un(et),mh(l.src,T=i[4][0])||st(l,"src",T),st(l,"alt","img"),st(l,"class","svelte-127onvh"),st(t,"class","listingleft svelte-127onvh"),st(ge,"id","map"),st(ge,"class","svelte-127onvh"),st(He,"class","details"),st(Ue,"class","listingright svelte-127onvh"),st(e,"class","listing svelte-127onvh")},m(vn,Hn){yt(vn,e,Hn),Pe(e,t),Pe(t,r),Pe(r,f),Pe(t,y),Pe(t,l),Pe(t,A),Pe(t,R),Pe(R,z),Pe(R,ee),Pe(t,se),Pe(t,be),Pe(be,Re),Pe(be,it),Pe(e,dt),Pe(e,Ue),Pe(Ue,ge),Pe(Ue,Ke),Pe(Ue,He),Pe(He,en),Pe(en,vt),Pe(en,Lt),Pe(He,kt),Pe(He,Qt),Pe(Qt,lt),Pe(Qt,an),Pe(He,li),Pe(He,ni),Pe(ni,ii),Pe(ni,It),Pe(He,ri),Pe(He,Tn),Pe(Tn,bi),Pe(Tn,Nt)},p(vn,[Hn]){Hn&128&&u!==(u=vn[7][0]+"")&&Fi(f,u),Hn&16&&!mh(l.src,T=vn[4][0])&&st(l,"src",T),Hn&32&&j!==(j=vn[5][0]+"")&&Fi(ee,j),Hn&8&&Ge!==(Ge=vn[3][0]+"")&&Fi(it,Ge),Hn&1&&Ft!==(Ft=vn[0][0]+"")&&Fi(Lt,Ft),Hn&4&&Xe!==(Xe=vn[2][0]+"")&&Fi(an,Xe),Hn&2&&rn!==(rn=vn[1][0]+"")&&Fi(It,rn),Hn&64&&et!==(et=new Date(vn[6][0]).toString().split("GMT")[0]+"")&&Fi(Nt,et)},i:pn,o:pn,d(vn){vn&&mt(e)}}}function W5(i,e,t){let r;const u=Sp();Hr(i,u,Ue=>t(10,r=Ue));let{id:f}=e;var y=[],l=[],T=[],A=[],R=[],z=[],j=[],ee=[],se=[],be=[],Re=[],Ge=[];wp(()=>it());async function it(){console.log("searching..."),y=[],t(1,l=[]),T=[],t(2,A=[]),t(3,R=[]),t(4,z=[]),t(0,j=[]),t(5,ee=[]),se=[],t(6,be=[]),t(7,Re=[]),Ge=[];const Ue=SF(eF(Nk,"ads"),AF("adid","==",f));(await MF(Ue)).forEach(Ke=>{const{description:He,userid:en,time:vt,images:Ft,adownerid:Lt,adowner:kt,location:Qt,tags:lt,title:Xe,adid:an,price:li,contact:ni}=Ke.data();var ii="";for(let rn=0;rn<Xe.length;rn++)Xe[rn].charAt(0).toUpperCase()+Xe[rn].slice(1),ii=ii+" "+Xe[rn];y.includes(an)||(y.push(an),l.push(kt),T.push(Lt),A.push(ni),R.push(He),z.push(Ft),j.push(Qt),ee.push(li),se.push(lt),be.push(vt),Re.push(ii),Ge.push(en),y=y,t(1,l),T=T,t(2,A),t(3,R),t(4,z),t(0,j),t(5,ee),se=se,t(6,be),t(7,Re),Ge=Ge)})}async function dt(){const Ue={method:"GET"};var ge="https://api.mapbox.com/geocoding/v5/mapbox.places/"+j[0]+".json?access_token=pk.eyJ1IjoiZG9pbmd0aGVnb29kIiwiYSI6ImNsNno4YTIwZjAxdW8zdm1xemFlYWg2bnkifQ.URsY8wmTg76N32qj58PajA";fetch(ge,Ue).then(Ke=>Ke.json()).then(Ke=>{const{center:He}=Ke.features[0];console.log(He),I0.accessToken="pk.eyJ1IjoiZG9pbmd0aGVnb29kIiwiYSI6ImNsNno4YTIwZjAxdW8zdm1xemFlYWg2bnkifQ.URsY8wmTg76N32qj58PajA";const en=new I0.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:He,zoom:12});new I0.Marker().setLngLat(He).addTo(en)})}return i.$$set=Ue=>{"id"in Ue&&t(9,f=Ue.id)},i.$$.update=()=>{i.$$.dirty&1024&&it(),i.$$.dirty&1&&j[0]!=null&&dt()},[j,l,A,R,z,ee,be,Re,u,f,r]}class Z5 extends yl{constructor(e){super(),_l(this,e,W5,q5,ia,{id:9})}}function ZI(i,e,t){const r=i.slice();return r[24]=e[t],r[26]=t,r}function H5(i){let e,t,r,u,f,y;function l(z,j){return z[1]!=!0?Y5:K5}let T=l(i),A=T(i),R=i[1]==!0&&HI(i);return{c(){e=tt("div"),t=tt("h2"),r=un(`Filters\r
        `),A.c(),u=Dt(),R&&R.c(),st(t,"class","svelte-um67s0"),st(e,"class","filtersmobile svelte-um67s0")},m(z,j){yt(z,e,j),Pe(e,t),Pe(t,r),A.m(t,null),Pe(e,u),R&&R.m(e,null),f||(y=[Gn(e,"keypress",i[16]),Gn(e,"click",i[18])],f=!0)},p(z,j){T!==(T=l(z))&&(A.d(1),A=T(z),A&&(A.c(),A.m(t,null))),z[1]==!0?R?R.p(z,j):(R=HI(z),R.c(),R.m(e,null)):R&&(R.d(1),R=null)},d(z){z&&mt(e),A.d(),R&&R.d(),f=!1,Pr(y)}}}function X5(i){let e,t,r,u,f,y,l,T,A,R;return{c(){e=tt("div"),t=tt("h1"),t.textContent="Filters",r=Dt(),u=tt("button"),u.textContent="Lowest Price",f=Dt(),y=tt("button"),y.textContent="Highest Price",l=Dt(),T=tt("button"),T.textContent="Clear Filters",st(u,"class","svelte-um67s0"),st(y,"class","svelte-um67s0"),st(T,"class","svelte-um67s0"),st(e,"class","filters svelte-um67s0")},m(z,j){yt(z,e,j),Pe(e,t),Pe(e,r),Pe(e,u),Pe(e,f),Pe(e,y),Pe(e,l),Pe(e,T),A||(R=[Gn(u,"click",i[13]),Gn(y,"click",i[14]),Gn(T,"click",i[12])],A=!0)},p:pn,d(z){z&&mt(e),A=!1,Pr(R)}}}function K5(i){let e,t;return{c(){e=sl("svg"),t=sl("path"),st(t,"d","M233.4 105.4c12.5-12.5 32.8-12.5 45.3 0l192 192c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L256 173.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l192-192z"),st(e,"xmlns","http://www.w3.org/2000/svg"),st(e,"viewBox","0 0 512 512")},m(r,u){yt(r,e,u),Pe(e,t)},d(r){r&&mt(e)}}}function Y5(i){let e,t;return{c(){e=sl("svg"),t=sl("path"),st(t,"d","M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"),st(e,"xmlns","http://www.w3.org/2000/svg"),st(e,"viewBox","0 0 512 512")},m(r,u){yt(r,e,u),Pe(e,t)},d(r){r&&mt(e)}}}function HI(i){let e,t,r,u,f,y,l;return{c(){e=tt("button"),e.textContent="Lowest Price",t=Dt(),r=tt("button"),r.textContent="Highest Price",u=Dt(),f=tt("button"),f.textContent="Clear Filters",st(e,"class","svelte-um67s0"),st(r,"class","svelte-um67s0"),st(f,"class","svelte-um67s0")},m(T,A){yt(T,e,A),yt(T,t,A),yt(T,r,A),yt(T,u,A),yt(T,f,A),y||(l=[Gn(e,"click",i[13]),Gn(r,"click",i[14]),Gn(f,"click",i[12])],y=!0)},p:pn,d(T){T&&mt(e),T&&mt(t),T&&mt(r),T&&mt(u),T&&mt(f),y=!1,Pr(l)}}}function Q5(i){let e;return{c(){e=tt("h1"),e.textContent="Loading ..."},m(t,r){yt(t,e,r)},p:pn,i:pn,o:pn,d(t){t&&mt(e)}}}function J5(i){let e,t,r,u=i[0].charAt(0).toUpperCase()+i[0].slice(1)+"",f,y,l,T=i[2],A=[];for(let z=0;z<T.length;z+=1)A[z]=KI(ZI(i,T,z));const R=z=>wt(A[z],1,1,()=>{A[z]=null});return{c(){e=tt("div"),t=tt("h1"),r=un("Results For "),f=un(u),y=Dt();for(let z=0;z<A.length;z+=1)A[z].c();st(e,"class","results svelte-um67s0")},m(z,j){yt(z,e,j),Pe(e,t),Pe(t,r),Pe(t,f),Pe(e,y);for(let ee=0;ee<A.length;ee+=1)A[ee].m(e,null);l=!0},p(z,j){if((!l||j&1)&&u!==(u=z[0].charAt(0).toUpperCase()+z[0].slice(1)+"")&&Fi(f,u),j&508){T=z[2];let ee;for(ee=0;ee<T.length;ee+=1){const se=ZI(z,T,ee);A[ee]?(A[ee].p(se,j),_t(A[ee],1)):(A[ee]=KI(se),A[ee].c(),_t(A[ee],1),A[ee].m(e,null))}for(gr(),ee=T.length;ee<A.length;ee+=1)R(ee);_r()}},i(z){if(!l){for(let j=0;j<T.length;j+=1)_t(A[j]);l=!0}},o(z){A=A.filter(Boolean);for(let j=0;j<A.length;j+=1)wt(A[j]);l=!1},d(z){z&&mt(e),e2(A,z)}}}function XI(i){let e,t;return e=new Pi({props:{to:"/viewad/"+i[2][i[26]],$$slots:{default:[eU]},$$scope:{ctx:i}}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p(r,u){const f={};u&4&&(f.to="/viewad/"+r[2][r[26]]),u&134218232&&(f.$$scope={dirty:u,ctx:r}),e.$set(f)},i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function eU(i){let e,t,r,u,f,y,l,T,A=i[8][i[26]]+"",R,z,j,ee,se=i[6][i[26]]+"",be,Re,Ge,it,dt=i[5][i[26]]+"",Ue,ge,Ke=new Date(i[7][i[26]]).toString().split("GMT")[0]+"",He,en,vt,Ft,Lt,kt=i[3][i[26]]+"",Qt,lt;return{c(){e=tt("div"),t=tt("div"),r=tt("img"),f=Dt(),y=tt("div"),l=tt("div"),T=tt("h2"),R=un(A),z=Dt(),j=tt("h2"),ee=un("$ "),be=un(se),Re=Dt(),Ge=tt("div"),it=tt("h4"),Ue=un(dt),ge=un(" | "),He=un(Ke),en=Dt(),vt=tt("div"),Ft=tt("h3"),Lt=un("Descripton : "),Qt=un(kt),lt=Dt(),mh(r.src,u=i[4][i[26]])||st(r,"src",u),st(r,"alt","ad img"),st(r,"class","svelte-um67s0"),st(t,"class","resultleft svelte-um67s0"),st(l,"class","resultrow svelte-um67s0"),st(Ge,"class","resultrow svelte-um67s0"),st(vt,"class","resultrow svelte-um67s0"),st(y,"class","resultright svelte-um67s0"),st(e,"class","result svelte-um67s0")},m(Xe,an){yt(Xe,e,an),Pe(e,t),Pe(t,r),Pe(e,f),Pe(e,y),Pe(y,l),Pe(l,T),Pe(T,R),Pe(l,z),Pe(l,j),Pe(j,ee),Pe(j,be),Pe(y,Re),Pe(y,Ge),Pe(Ge,it),Pe(it,Ue),Pe(it,ge),Pe(it,He),Pe(y,en),Pe(y,vt),Pe(vt,Ft),Pe(Ft,Lt),Pe(Ft,Qt),yt(Xe,lt,an)},p(Xe,an){an&16&&!mh(r.src,u=Xe[4][Xe[26]])&&st(r,"src",u),an&256&&A!==(A=Xe[8][Xe[26]]+"")&&Fi(R,A),an&64&&se!==(se=Xe[6][Xe[26]]+"")&&Fi(be,se),an&32&&dt!==(dt=Xe[5][Xe[26]]+"")&&Fi(Ue,dt),an&128&&Ke!==(Ke=new Date(Xe[7][Xe[26]]).toString().split("GMT")[0]+"")&&Fi(He,Ke),an&8&&kt!==(kt=Xe[3][Xe[26]]+"")&&Fi(Qt,kt)},d(Xe){Xe&&mt(e),Xe&&mt(lt)}}}function KI(i){let e,t,r=i[2][i[26]]!=null&&XI(i);return{c(){r&&r.c(),e=gl()},m(u,f){r&&r.m(u,f),yt(u,e,f),t=!0},p(u,f){u[2][u[26]]!=null?r?(r.p(u,f),f&4&&_t(r,1)):(r=XI(u),r.c(),_t(r,1),r.m(e.parentNode,e)):r&&(gr(),wt(r,1,1,()=>{r=null}),_r())},i(u){t||(_t(r),t=!0)},o(u){wt(r),t=!1},d(u){r&&r.d(u),u&&mt(e)}}}function tU(i){let e,t,r,u,f,y,l;yh(i[17]);function T(se,be){return se[10]>1e3?X5:H5}let A=T(i),R=A(i);const z=[J5,Q5],j=[];function ee(se,be){return se[9]?0:1}return r=ee(i),u=j[r]=z[r](i),{c(){e=tt("div"),R.c(),t=Dt(),u.c(),st(e,"class","searchpage svelte-um67s0")},m(se,be){yt(se,e,be),R.m(e,null),Pe(e,t),j[r].m(e,null),f=!0,y||(l=Gn(window,"resize",i[17]),y=!0)},p(se,[be]){A===(A=T(se))&&R?R.p(se,be):(R.d(1),R=A(se),R&&(R.c(),R.m(e,t)));let Re=r;r=ee(se),r===Re?j[r].p(se,be):(gr(),wt(j[Re],1,1,()=>{j[Re]=null}),_r(),u=j[r],u?u.p(se,be):(u=j[r]=z[r](se),u.c()),_t(u,1),u.m(e,null))},i(se){f||(_t(u),f=!0)},o(se){wt(u),f=!1},d(se){se&&mt(e),R.d(),j[r].d(),y=!1,l()}}}function nU(i,e,t){let r;const u=Sp();Hr(i,u,Lt=>t(15,r=Lt));let{id:f}=e;var y=[],l=[],T=[],A=[],R=[],z=[],j=[],ee=[],se=[],be=[],Re=[],Ge=[],it=!1;wp(()=>dt());async function dt(){const{collection:Lt,query:kt,where:Qt,getDocs:lt}=await Yo(()=>import("./index.esm.8955433d.js"),[]),{db:Xe}=await Yo(()=>Promise.resolve().then(()=>Uk),void 0);console.log("searching..."),t(2,y=[]),l=[],T=[],A=[],t(3,R=[]),t(4,z=[]),t(5,j=[]),t(6,ee=[]),se=[],t(7,be=[]),t(8,Re=[]),Ge=[];const an=kt(Lt(Xe,"ads"),Qt("category","==",f.toLowerCase()));(await lt(an)).forEach(ni=>{const{description:ii,userid:rn,time:It,images:ri,adownerid:Tn,adowner:bi,location:et,tags:Nt,title:vn,adid:Hn,price:Vr,contact:wi}=ni.data();var ar="";for(let xn=0;xn<vn.length;xn++)vn[xn].charAt(0).toUpperCase()+vn[xn].slice(1),ar=ar+" "+vn[xn];y.includes(Hn)||y.length>10?console.log("Ad Already In Array!"):(y.push(Hn),l.push(bi),T.push(Tn),A.push(wi),R.push(ii),z.push(ri),j.push(et),ee.push(Vr),se.push(Nt),be.push(It),Re.push(ar),Ge.push(rn)),t(2,y),l=l,T=T,A=A,t(3,R),t(4,z),t(5,j),t(6,ee),se=se,t(7,be),t(8,Re),Ge=Ge}),t(9,it=!0)}async function Ue(){if(ee.length==1)return;await dt();const Lt=ee,kt=Math.min(...Lt),Qt=Lt.indexOf(kt.toString());console.log(kt,Qt);for(let lt=0;lt<y.length;lt++)lt!=Qt&&(t(2,y[lt]=null,y),l[lt]=null,T[lt]=null,A[lt]=null,t(3,R[lt]=null,R),t(4,z[lt]=null,z),t(5,j[lt]=null,j),t(6,ee[lt]=null,ee),se[lt]=null,t(7,be[lt]=null,be),t(8,Re[lt]=null,Re),Ge[lt]=null),t(2,y),l=l,T=T,A=A,t(3,R),t(4,z),t(5,j),t(6,ee),se=se,t(7,be),t(8,Re),Ge=Ge}async function ge(){if(ee.length==1)return;await dt();const Lt=ee;console.log(Lt);const kt=Math.max(...Lt),Qt=Lt.indexOf(kt.toString());console.log(kt,Qt);for(let lt=0;lt<y.length;lt++)lt!=Qt&&(t(2,y[lt]=null,y),l[lt]=null,T[lt]=null,A[lt]=null,t(3,R[lt]=null,R),t(4,z[lt]=null,z),t(5,j[lt]=null,j),t(6,ee[lt]=null,ee),se[lt]=null,t(7,be[lt]=null,be),t(8,Re[lt]=null,Re),Ge[lt]=null),t(2,y),l=l,T=T,A=A,t(3,R),t(4,z),t(5,j),t(6,ee),se=se,t(7,be),t(8,Re),Ge=Ge}let Ke=!1,He;function en(Lt){m_.call(this,i,Lt)}function vt(){t(10,He=window.innerWidth)}const Ft=()=>t(1,Ke=!Ke);return i.$$set=Lt=>{"id"in Lt&&t(0,f=Lt.id)},i.$$.update=()=>{i.$$.dirty&32768&&dt(),i.$$.dirty&2&&console.log(Ke)},[f,Ke,y,R,z,j,ee,be,Re,it,He,u,dt,Ue,ge,r,en,vt,Ft]}class iU extends yl{constructor(e){super(),_l(this,e,nU,tU,ia,{id:0})}}function YI(i){let e,t,r,u,f,y,l,T;const A=[sU,rU],R=[];function z(j,ee){return j[3]?0:1}return u=z(i),f=R[u]=A[u](i),{c(){e=tt("div"),t=tt("button"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="svelte-1cdrbnd"><path d="M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"></path></svg>',r=Dt(),f.c(),st(t,"class","closebtn svelte-1cdrbnd"),st(e,"class","sidenav svelte-1cdrbnd")},m(j,ee){yt(j,e,ee),Pe(e,t),Pe(e,r),R[u].m(e,null),y=!0,l||(T=[Gn(t,"keypress",i[8]),Gn(t,"click",i[10])],l=!0)},p(j,ee){let se=u;u=z(j),u===se?R[u].p(j,ee):(gr(),wt(R[se],1,1,()=>{R[se]=null}),_r(),f=R[u],f?f.p(j,ee):(f=R[u]=A[u](j),f.c()),_t(f,1),f.m(e,null))},i(j){y||(_t(f),y=!0)},o(j){wt(f),y=!1},d(j){j&&mt(e),R[u].d(),l=!1,Pr(T)}}}function rU(i){let e,t,r,u;return e=new Pi({props:{to:"/login",$$slots:{default:[oU]},$$scope:{ctx:i}}}),r=new Pi({props:{to:"/post",$$slots:{default:[aU]},$$scope:{ctx:i}}}),{c(){bn(e.$$.fragment),t=Dt(),bn(r.$$.fragment)},m(f,y){gn(e,f,y),yt(f,t,y),gn(r,f,y),u=!0},p(f,y){const l={};y&32768&&(l.$$scope={dirty:y,ctx:f}),e.$set(l);const T={};y&32768&&(T.$$scope={dirty:y,ctx:f}),r.$set(T)},i(f){u||(_t(e.$$.fragment,f),_t(r.$$.fragment,f),u=!0)},o(f){wt(e.$$.fragment,f),wt(r.$$.fragment,f),u=!1},d(f){_n(e,f),f&&mt(t),_n(r,f)}}}function sU(i){let e,t,r,u,f,y,l,T;return r=new Pi({props:{to:"/account",$$slots:{default:[lU]},$$scope:{ctx:i}}}),f=new Pi({props:{to:"/post",$$slots:{default:[cU]},$$scope:{ctx:i}}}),{c(){e=tt("button"),e.textContent="Logout",t=Dt(),bn(r.$$.fragment),u=Dt(),bn(f.$$.fragment),st(e,"class","svelte-1cdrbnd")},m(A,R){yt(A,e,R),yt(A,t,R),gn(r,A,R),yt(A,u,R),gn(f,A,R),y=!0,l||(T=Gn(e,"click",i[6]),l=!0)},p(A,R){const z={};R&32768&&(z.$$scope={dirty:R,ctx:A}),r.$set(z);const j={};R&32768&&(j.$$scope={dirty:R,ctx:A}),f.$set(j)},i(A){y||(_t(r.$$.fragment,A),_t(f.$$.fragment,A),y=!0)},o(A){wt(r.$$.fragment,A),wt(f.$$.fragment,A),y=!1},d(A){A&&mt(e),A&&mt(t),_n(r,A),A&&mt(u),_n(f,A),l=!1,T()}}}function oU(i){let e;return{c(){e=tt("button"),e.textContent="Login",st(e,"class","svelte-1cdrbnd")},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function aU(i){let e;return{c(){e=tt("button"),e.textContent="Post Ad",st(e,"class","svelte-1cdrbnd")},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function lU(i){let e;return{c(){e=tt("button"),e.textContent="Account",st(e,"class","svelte-1cdrbnd")},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function cU(i){let e;return{c(){e=tt("button"),e.textContent="Post Ad",st(e,"class","svelte-1cdrbnd")},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function uU(i){let e,t,r,u,f,y,l,T,A,R,z,j,ee,se,be,Re;r=new Pi({props:{to:"/",$$slots:{default:[dU]},$$scope:{ctx:i}}});const Ge=[pU,fU],it=[];function dt(Ue,ge){return Ue[0]>400?0:1}return f=dt(i),y=it[f]=Ge[f](i),{c(){e=tt("header"),t=tt("div"),bn(r.$$.fragment),u=Dt(),y.c(),l=Dt(),T=tt("header"),A=tt("div"),R=tt("form"),z=tt("input"),j=Dt(),ee=tt("button"),ee.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"></path></svg>',st(t,"class","logo"),st(e,"class","svelte-1cdrbnd"),st(z,"placeholder","Search..."),st(z,"class","svelte-1cdrbnd"),st(ee,"class","svelte-1cdrbnd"),st(R,"class","svelte-1cdrbnd"),st(A,"class","search svelte-1cdrbnd"),st(T,"class","svelte-1cdrbnd")},m(Ue,ge){yt(Ue,e,ge),Pe(e,t),gn(r,t,null),Pe(e,u),it[f].m(e,null),yt(Ue,l,ge),yt(Ue,T,ge),Pe(T,A),Pe(A,R),Pe(R,z),d_(z,i[2]),Pe(R,j),Pe(R,ee),se=!0,be||(Re=[Gn(z,"input",i[13]),Gn(z,"change",i[5]),Gn(R,"submit",t2(i[5]))],be=!0)},p(Ue,ge){const Ke={};ge&32768&&(Ke.$$scope={dirty:ge,ctx:Ue}),r.$set(Ke);let He=f;f=dt(Ue),f===He?it[f].p(Ue,ge):(gr(),wt(it[He],1,1,()=>{it[He]=null}),_r(),y=it[f],y?y.p(Ue,ge):(y=it[f]=Ge[f](Ue),y.c()),_t(y,1),y.m(e,null)),ge&4&&z.value!==Ue[2]&&d_(z,Ue[2])},i(Ue){se||(_t(r.$$.fragment,Ue),_t(y),se=!0)},o(Ue){wt(r.$$.fragment,Ue),wt(y),se=!1},d(Ue){Ue&&mt(e),_n(r),it[f].d(),Ue&&mt(l),Ue&&mt(T),be=!1,Pr(Re)}}}function hU(i){let e,t,r,u,f,y,l,T,A,R,z,j,ee,se,be,Re,Ge,it;r=new Pi({props:{to:"/",$$slots:{default:[xU]},$$scope:{ctx:i}}});const dt=[wU,bU],Ue=[];function ge(Ke,He){return Ke[3]?0:1}return j=ge(i),ee=Ue[j]=dt[j](i),be=new Pi({props:{to:"/post",$$slots:{default:[IU]},$$scope:{ctx:i}}}),{c(){e=tt("header"),t=tt("div"),bn(r.$$.fragment),u=Dt(),f=tt("div"),y=tt("form"),l=tt("input"),T=Dt(),A=tt("button"),A.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"></path></svg>',R=Dt(),z=tt("div"),ee.c(),se=Dt(),bn(be.$$.fragment),st(t,"class","logo"),st(l,"placeholder","Search..."),st(l,"class","svelte-1cdrbnd"),st(A,"class","svelte-1cdrbnd"),st(y,"class","svelte-1cdrbnd"),st(f,"class","search svelte-1cdrbnd"),st(z,"class","account svelte-1cdrbnd"),st(e,"class","svelte-1cdrbnd")},m(Ke,He){yt(Ke,e,He),Pe(e,t),gn(r,t,null),Pe(e,u),Pe(e,f),Pe(f,y),Pe(y,l),d_(l,i[2]),Pe(y,T),Pe(y,A),Pe(e,R),Pe(e,z),Ue[j].m(z,null),Pe(z,se),gn(be,z,null),Re=!0,Ge||(it=[Gn(l,"input",i[11]),Gn(l,"change",i[5]),Gn(y,"submit",t2(i[5]))],Ge=!0)},p(Ke,He){const en={};He&32768&&(en.$$scope={dirty:He,ctx:Ke}),r.$set(en),He&4&&l.value!==Ke[2]&&d_(l,Ke[2]);let vt=j;j=ge(Ke),j===vt?Ue[j].p(Ke,He):(gr(),wt(Ue[vt],1,1,()=>{Ue[vt]=null}),_r(),ee=Ue[j],ee?ee.p(Ke,He):(ee=Ue[j]=dt[j](Ke),ee.c()),_t(ee,1),ee.m(z,se));const Ft={};He&32768&&(Ft.$$scope={dirty:He,ctx:Ke}),be.$set(Ft)},i(Ke){Re||(_t(r.$$.fragment,Ke),_t(ee),_t(be.$$.fragment,Ke),Re=!0)},o(Ke){wt(r.$$.fragment,Ke),wt(ee),wt(be.$$.fragment,Ke),Re=!1},d(Ke){Ke&&mt(e),_n(r),Ue[j].d(),_n(be),Ge=!1,Pr(it)}}}function dU(i){let e;return{c(){e=tt("h1"),e.textContent="B&S"},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function fU(i){let e,t,r;return{c(){e=tt("div"),e.innerHTML='<button style="background-color: var(--tertiary-color); fill: white;" class="svelte-1cdrbnd"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"></path></svg></button>',st(e,"class","account svelte-1cdrbnd")},m(u,f){yt(u,e,f),t||(r=[Gn(e,"keypress",i[7]),Gn(e,"click",i[12])],t=!0)},p:pn,i:pn,o:pn,d(u){u&&mt(e),t=!1,Pr(r)}}}function pU(i){let e,t,r,u,f,y;const l=[gU,mU],T=[];function A(R,z){return R[3]?0:1}return t=A(i),r=T[t]=l[t](i),f=new Pi({props:{to:"/post",$$slots:{default:[vU]},$$scope:{ctx:i}}}),{c(){e=tt("div"),r.c(),u=Dt(),bn(f.$$.fragment),st(e,"class","account svelte-1cdrbnd")},m(R,z){yt(R,e,z),T[t].m(e,null),Pe(e,u),gn(f,e,null),y=!0},p(R,z){let j=t;t=A(R),t===j?T[t].p(R,z):(gr(),wt(T[j],1,1,()=>{T[j]=null}),_r(),r=T[t],r?r.p(R,z):(r=T[t]=l[t](R),r.c()),_t(r,1),r.m(e,u));const ee={};z&32768&&(ee.$$scope={dirty:z,ctx:R}),f.$set(ee)},i(R){y||(_t(r),_t(f.$$.fragment,R),y=!0)},o(R){wt(r),wt(f.$$.fragment,R),y=!1},d(R){R&&mt(e),T[t].d(),_n(f)}}}function mU(i){let e,t;return e=new Pi({props:{to:"/login",$$slots:{default:[_U]},$$scope:{ctx:i}}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p(r,u){const f={};u&32768&&(f.$$scope={dirty:u,ctx:r}),e.$set(f)},i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function gU(i){let e,t,r,u,f,y;return r=new Pi({props:{to:"/account",$$slots:{default:[yU]},$$scope:{ctx:i}}}),{c(){e=tt("button"),e.textContent="Logout",t=Dt(),bn(r.$$.fragment),st(e,"class","svelte-1cdrbnd")},m(l,T){yt(l,e,T),yt(l,t,T),gn(r,l,T),u=!0,f||(y=Gn(e,"click",i[6]),f=!0)},p(l,T){const A={};T&32768&&(A.$$scope={dirty:T,ctx:l}),r.$set(A)},i(l){u||(_t(r.$$.fragment,l),u=!0)},o(l){wt(r.$$.fragment,l),u=!1},d(l){l&&mt(e),l&&mt(t),_n(r,l),f=!1,y()}}}function _U(i){let e;return{c(){e=tt("button"),e.textContent="Login",st(e,"class","svelte-1cdrbnd")},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function yU(i){let e;return{c(){e=tt("button"),e.textContent="Account",st(e,"class","svelte-1cdrbnd")},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function vU(i){let e;return{c(){e=tt("button"),e.textContent="Post Ad",f_(e,"background-color","var(--tertiary-color)"),f_(e,"color","white"),st(e,"class","svelte-1cdrbnd")},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function xU(i){let e;return{c(){e=tt("h1"),e.textContent="B&S"},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function bU(i){let e,t;return e=new Pi({props:{to:"/login",$$slots:{default:[TU]},$$scope:{ctx:i}}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p(r,u){const f={};u&32768&&(f.$$scope={dirty:u,ctx:r}),e.$set(f)},i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function wU(i){let e,t,r,u,f,y;return r=new Pi({props:{to:"/account",$$slots:{default:[EU]},$$scope:{ctx:i}}}),{c(){e=tt("button"),e.textContent="Logout",t=Dt(),bn(r.$$.fragment),st(e,"class","svelte-1cdrbnd")},m(l,T){yt(l,e,T),yt(l,t,T),gn(r,l,T),u=!0,f||(y=Gn(e,"click",i[6]),f=!0)},p(l,T){const A={};T&32768&&(A.$$scope={dirty:T,ctx:l}),r.$set(A)},i(l){u||(_t(r.$$.fragment,l),u=!0)},o(l){wt(r.$$.fragment,l),u=!1},d(l){l&&mt(e),l&&mt(t),_n(r,l),f=!1,y()}}}function TU(i){let e;return{c(){e=tt("button"),e.textContent="Login",st(e,"class","svelte-1cdrbnd")},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function EU(i){let e;return{c(){e=tt("button"),e.textContent="Account",st(e,"class","svelte-1cdrbnd")},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function IU(i){let e;return{c(){e=tt("button"),e.textContent="Post Ad",f_(e,"background-color","var(--tertiary-color)"),f_(e,"color","white"),st(e,"class","svelte-1cdrbnd")},m(t,r){yt(t,e,r)},p:pn,d(t){t&&mt(e)}}}function SU(i){let e;return{c(){e=un("Vehicles")},m(t,r){yt(t,e,r)},d(t){t&&mt(e)}}}function AU(i){let e;return{c(){e=un("Electronics")},m(t,r){yt(t,e,r)},d(t){t&&mt(e)}}}function CU(i){let e;return{c(){e=un("Home Goods")},m(t,r){yt(t,e,r)},d(t){t&&mt(e)}}}function kU(i){let e;return{c(){e=un("Toys And Games")},m(t,r){yt(t,e,r)},d(t){t&&mt(e)}}}function MU(i){let e;return{c(){e=un("Realestate")},m(t,r){yt(t,e,r)},d(t){t&&mt(e)}}}function DU(i){let e;return{c(){e=un("Services")},m(t,r){yt(t,e,r)},d(t){t&&mt(e)}}}function PU(i){let e;return{c(){e=un("Other")},m(t,r){yt(t,e,r)},d(t){t&&mt(e)}}}function RU(i){let e,t;return e=new Oy({props:{loader:jU}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p:pn,i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function LU(i){let e,t;return e=new Oy({props:{loader:GU}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p:pn,i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function zU(i){let e,t;return e=new Oy({props:{loader:$U}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p:pn,i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function OU(i){let e,t;return e=new Oy({props:{loader:qU}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p:pn,i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function BU(i){let e,t;return e=new go({props:{path:":id",component:G5}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p:pn,i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function FU(i){let e,t;return e=new go({props:{path:":id",component:iU}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p:pn,i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function NU(i){let e,t;return e=new go({props:{path:":id",component:Z5}}),{c(){bn(e.$$.fragment)},m(r,u){gn(e,r,u),t=!0},p:pn,i(r){t||(_t(e.$$.fragment,r),t=!0)},o(r){wt(e.$$.fragment,r),t=!1},d(r){_n(e,r)}}}function UU(i){let e,t,r,u,f,y,l,T,A,R,z,j,ee,se,be,Re,Ge,it,dt,Ue,ge,Ke,He,en,vt,Ft,Lt,kt,Qt,lt,Xe,an,li,ni,ii,rn,It=i[1]&&YI(i);const ri=[hU,uU],Tn=[];function bi(et,Nt){return et[0]>800?0:1}return t=bi(i),r=Tn[t]=ri[t](i),y=new Pi({props:{to:"/category/vehicles",$$slots:{default:[SU]},$$scope:{ctx:i}}}),T=new Pi({props:{to:"/category/electronics",$$slots:{default:[AU]},$$scope:{ctx:i}}}),R=new Pi({props:{to:"/category/home",$$slots:{default:[CU]},$$scope:{ctx:i}}}),j=new Pi({props:{to:"/category/toys",$$slots:{default:[kU]},$$scope:{ctx:i}}}),se=new Pi({props:{to:"/category/realestate",$$slots:{default:[MU]},$$scope:{ctx:i}}}),Re=new Pi({props:{to:"/category/services",$$slots:{default:[DU]},$$scope:{ctx:i}}}),it=new Pi({props:{to:"/category/other",$$slots:{default:[PU]},$$scope:{ctx:i}}}),ge=new go({props:{path:"/",$$slots:{default:[RU]},$$scope:{ctx:i}}}),He=new go({props:{path:"/login",$$slots:{default:[LU]},$$scope:{ctx:i}}}),vt=new go({props:{path:"/account",$$slots:{default:[zU]},$$scope:{ctx:i}}}),Lt=new go({props:{path:"/post",$$slots:{default:[OU]},$$scope:{ctx:i}}}),Qt=new go({props:{path:"search/*",primary:!1,$$slots:{default:[BU,({params:et})=>({14:et}),({params:et})=>et?16384:0]},$$scope:{ctx:i}}}),Xe=new go({props:{path:"category/*",primary:!1,$$slots:{default:[FU,({params:et})=>({14:et}),({params:et})=>et?16384:0]},$$scope:{ctx:i}}}),li=new go({props:{path:"viewad/*",primary:!1,$$slots:{default:[NU,({params:et})=>({14:et}),({params:et})=>et?16384:0]},$$scope:{ctx:i}}}),{c(){It&&It.c(),e=Dt(),r.c(),u=Dt(),f=tt("nav"),bn(y.$$.fragment),l=Dt(),bn(T.$$.fragment),A=Dt(),bn(R.$$.fragment),z=Dt(),bn(j.$$.fragment),ee=Dt(),bn(se.$$.fragment),be=Dt(),bn(Re.$$.fragment),Ge=Dt(),bn(it.$$.fragment),dt=Dt(),Ue=tt("main"),bn(ge.$$.fragment),Ke=Dt(),bn(He.$$.fragment),en=Dt(),bn(vt.$$.fragment),Ft=Dt(),bn(Lt.$$.fragment),kt=Dt(),bn(Qt.$$.fragment),lt=Dt(),bn(Xe.$$.fragment),an=Dt(),bn(li.$$.fragment),ni=Dt(),ii=tt("footer"),ii.innerHTML=`<a href="https://github.com/mukulve">Made By Mukul Using
      <svg viewBox="0 0 128 128"><path d="M119.838 16.936C105.553-.076 77.336-5.118 56.942 5.696l-35.829 19c-4.847 2.529-9.006 5.871-12.212 9.814-3.206 3.943-5.387 8.399-6.404 13.083a30.64 30.64 0 00-.688 6.396c.022 5.831 1.74 11.571 5.007 16.73-3.063 3.872-5.154 8.22-6.146 12.782a30.483 30.483 0 00.415 14.412c1.29 4.733 3.702 9.204 7.096 13.152 14.284 17.011 42.564 22.053 62.895 11.24l35.792-19.001c4.844-2.532 8.998-5.878 12.196-9.825 3.197-3.947 5.367-8.407 6.37-13.093.46-2.107.691-4.244.688-6.386-.009-5.82-1.705-11.551-4.945-16.709 3.062-3.869 5.153-8.213 6.147-12.771.444-2.109.67-4.245.676-6.386.002-7.595-2.852-15-8.162-21.178v-.02z" fill="#FF3E00"></path><path d="M53.44 112.667a34.23 34.23 0 01-7.16.76c-4.595.001-9.122-.925-13.193-2.7-4.07-1.774-7.563-4.343-10.179-7.487-3.194-3.716-4.91-8.171-4.907-12.74a18.83 18.83 0 01.4-3.833 18.55 18.55 0 01.865-2.782l.676-1.708 1.827 1.156c4.243 2.591 8.984 4.564 14.02 5.834l1.328.333-.125 1.104v.573c-.003 1.381.514 2.73 1.477 3.854.778.958 1.826 1.744 3.052 2.288a9.936 9.936 0 003.983.837 9.923 9.923 0 002.153-.229 8.745 8.745 0 002.204-.802l35.79-19.094c1.073-.566 1.957-1.349 2.568-2.276.61-.927.928-1.968.924-3.026-.01-1.381-.54-2.725-1.515-3.844-.79-.946-1.844-1.718-3.071-2.252a9.997 9.997 0 00-3.977-.81 9.917 9.917 0 00-2.153.23 8.344 8.344 0 00-2.19.801l-13.645 7.25a29.314 29.314 0 01-7.273 2.656c-2.34.502-4.745.758-7.161.76-4.594 0-9.119-.926-13.189-2.698-4.07-1.772-7.564-4.338-10.183-7.478-3.19-3.718-4.906-8.172-4.907-12.74.002-1.285.136-2.567.4-3.833.613-2.816 1.921-5.495 3.844-7.867 1.922-2.373 4.416-4.387 7.323-5.914L67.274 18c2.248-1.19 4.7-2.09 7.273-2.667 2.34-.499 4.745-.75 7.16-.75 4.605-.01 9.144.91 13.228 2.681 4.084 1.77 7.59 4.34 10.219 7.486 3.171 3.727 4.865 8.184 4.845 12.75a18.939 18.939 0 01-.401 3.844 18.529 18.529 0 01-.864 2.781l-.676 1.708-1.827-1.114c-4.24-2.595-8.982-4.568-14.02-5.834l-1.328-.343.125-1.105v-.572c0-1.385-.516-2.735-1.477-3.865-.789-.945-1.84-1.716-3.066-2.25a9.992 9.992 0 00-3.97-.813 9.887 9.887 0 00-2.127.271 8.2 8.2 0 00-2.203.802L42.337 50a7.071 7.071 0 00-2.209 1.79 5.713 5.713 0 00-1.158 2.377 6.057 6.057 0 00-.163 1.104c-.001 1.378.515 2.722 1.477 3.844.788.945 1.84 1.717 3.065 2.25a9.98 9.98 0 003.97.812 9.918 9.918 0 002.153-.23 8.35 8.35 0 002.204-.801l13.67-7.292a29.125 29.125 0 017.273-2.656 34.305 34.305 0 017.16-.76c4.596 0 9.123.925 13.195 2.697 4.072 1.772 7.569 4.339 10.19 7.48 3.19 3.717 4.906 8.171 4.907 12.74.003 1.299-.135 2.596-.413 3.874-.609 2.817-1.917 5.497-3.839 7.87-1.923 2.372-4.418 4.385-7.328 5.911L60.726 110a29.233 29.233 0 01-7.285 2.667z" fill="#fff"></path></svg>
      &amp;
      <svg viewBox="0 0 128 128"><path fill="#f58220" d="M27.35 80.52l10.68-68.44c.37-2.33 3.5-2.89 4.6-.8l11.48 21.48-26.76 47.76zm75.94 16.63L93.1 34.11c-.31-1.96-2.76-2.76-4.17-1.35L24.71 97.15l35.54 19.95a7.447 7.447 0 007.18 0l35.86-19.95zm-28.85-55L66.21 26.5c-.92-1.78-3.44-1.78-4.36 0L25.7 90.95l48.74-48.8z"></path></svg></a> 

    <a href="https://github.com/mukulve/Classified-Advertising-Website"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a>`,st(f,"class","svelte-1cdrbnd"),st(ii,"class","svelte-1cdrbnd")},m(et,Nt){It&&It.m(et,Nt),yt(et,e,Nt),Tn[t].m(et,Nt),yt(et,u,Nt),yt(et,f,Nt),gn(y,f,null),Pe(f,l),gn(T,f,null),Pe(f,A),gn(R,f,null),Pe(f,z),gn(j,f,null),Pe(f,ee),gn(se,f,null),Pe(f,be),gn(Re,f,null),Pe(f,Ge),gn(it,f,null),yt(et,dt,Nt),yt(et,Ue,Nt),gn(ge,Ue,null),Pe(Ue,Ke),gn(He,Ue,null),Pe(Ue,en),gn(vt,Ue,null),Pe(Ue,Ft),gn(Lt,Ue,null),Pe(Ue,kt),gn(Qt,Ue,null),Pe(Ue,lt),gn(Xe,Ue,null),Pe(Ue,an),gn(li,Ue,null),yt(et,ni,Nt),yt(et,ii,Nt),rn=!0},p(et,Nt){et[1]?It?(It.p(et,Nt),Nt&2&&_t(It,1)):(It=YI(et),It.c(),_t(It,1),It.m(e.parentNode,e)):It&&(gr(),wt(It,1,1,()=>{It=null}),_r());let vn=t;t=bi(et),t===vn?Tn[t].p(et,Nt):(gr(),wt(Tn[vn],1,1,()=>{Tn[vn]=null}),_r(),r=Tn[t],r?r.p(et,Nt):(r=Tn[t]=ri[t](et),r.c()),_t(r,1),r.m(u.parentNode,u));const Hn={};Nt&32768&&(Hn.$$scope={dirty:Nt,ctx:et}),y.$set(Hn);const Vr={};Nt&32768&&(Vr.$$scope={dirty:Nt,ctx:et}),T.$set(Vr);const wi={};Nt&32768&&(wi.$$scope={dirty:Nt,ctx:et}),R.$set(wi);const ar={};Nt&32768&&(ar.$$scope={dirty:Nt,ctx:et}),j.$set(ar);const xn={};Nt&32768&&(xn.$$scope={dirty:Nt,ctx:et}),se.$set(xn);const xr={};Nt&32768&&(xr.$$scope={dirty:Nt,ctx:et}),Re.$set(xr);const mn={};Nt&32768&&(mn.$$scope={dirty:Nt,ctx:et}),it.$set(mn);const br={};Nt&32768&&(br.$$scope={dirty:Nt,ctx:et}),ge.$set(br);const $s={};Nt&32768&&($s.$$scope={dirty:Nt,ctx:et}),He.$set($s);const jr={};Nt&32768&&(jr.$$scope={dirty:Nt,ctx:et}),vt.$set(jr);const As={};Nt&32768&&(As.$$scope={dirty:Nt,ctx:et}),Lt.$set(As);const qs={};Nt&32768&&(qs.$$scope={dirty:Nt,ctx:et}),Qt.$set(qs);const Jr={};Nt&32768&&(Jr.$$scope={dirty:Nt,ctx:et}),Xe.$set(Jr);const So={};Nt&32768&&(So.$$scope={dirty:Nt,ctx:et}),li.$set(So)},i(et){rn||(_t(It),_t(r),_t(y.$$.fragment,et),_t(T.$$.fragment,et),_t(R.$$.fragment,et),_t(j.$$.fragment,et),_t(se.$$.fragment,et),_t(Re.$$.fragment,et),_t(it.$$.fragment,et),_t(ge.$$.fragment,et),_t(He.$$.fragment,et),_t(vt.$$.fragment,et),_t(Lt.$$.fragment,et),_t(Qt.$$.fragment,et),_t(Xe.$$.fragment,et),_t(li.$$.fragment,et),rn=!0)},o(et){wt(It),wt(r),wt(y.$$.fragment,et),wt(T.$$.fragment,et),wt(R.$$.fragment,et),wt(j.$$.fragment,et),wt(se.$$.fragment,et),wt(Re.$$.fragment,et),wt(it.$$.fragment,et),wt(ge.$$.fragment,et),wt(He.$$.fragment,et),wt(vt.$$.fragment,et),wt(Lt.$$.fragment,et),wt(Qt.$$.fragment,et),wt(Xe.$$.fragment,et),wt(li.$$.fragment,et),rn=!1},d(et){It&&It.d(et),et&&mt(e),Tn[t].d(et),et&&mt(u),et&&mt(f),_n(y),_n(T),_n(R),_n(j),_n(se),_n(Re),_n(it),et&&mt(dt),et&&mt(Ue),_n(ge),_n(He),_n(vt),_n(Lt),_n(Qt),_n(Xe),_n(li),et&&mt(ni),et&&mt(ii)}}}function VU(i){let e,t,r,u;return yh(i[9]),e=new E2({props:{$$slots:{default:[UU]},$$scope:{ctx:i}}}),{c(){bn(e.$$.fragment)},m(f,y){gn(e,f,y),t=!0,r||(u=Gn(window,"resize",i[9]),r=!0)},p(f,[y]){const l={};y&32783&&(l.$$scope={dirty:y,ctx:f}),e.$set(l)},i(f){t||(_t(e.$$.fragment,f),t=!0)},o(f){wt(e.$$.fragment,f),t=!1},d(f){_n(e,f),r=!1,u()}}}const jU=()=>Yo(()=>import("./Home.31a9bc2e.js"),["assets/Home.31a9bc2e.js","assets/Home.3832290e.css"]),GU=()=>Yo(()=>import("./Login.a72a6600.js"),["assets/Login.a72a6600.js","assets/Login.19f66734.css"]),$U=()=>Yo(()=>import("./Account.f0c8ffd3.js"),["assets/Account.f0c8ffd3.js","assets/Login.a72a6600.js","assets/Login.19f66734.css","assets/Account.7b38fb17.css"]),qU=()=>Yo(()=>import("./Postlisting.84ccfe9f.js"),["assets/Postlisting.84ccfe9f.js","assets/Postlisting.fecd218d.css"]);function WU(i,e,t){let r;const u=_5(fx);Hr(i,u,Ge=>t(3,r=Ge));function f(){iR("/search/"+T,{replace:!0})}async function y(){const{signOut:Ge}=await Yo(()=>import("./index.esm.67ce5181.js"),[]);Ge(fx)}let l,T,A=!1;function R(Ge){m_.call(this,i,Ge)}function z(Ge){m_.call(this,i,Ge)}function j(){t(0,l=window.innerWidth)}const ee=()=>t(1,A=!A);function se(){T=this.value,t(2,T)}const be=()=>t(1,A=!A);function Re(){T=this.value,t(2,T)}return i.$$.update=()=>{i.$$.dirty&2&&console.log(A),i.$$.dirty&1&&console.log(l)},[l,A,T,r,u,f,y,R,z,j,ee,se,be,Re]}class ZU extends yl{constructor(e){super(),_l(this,e,WU,VU,ia,{})}}new ZU({target:document.getElementById("app")});export{qV as $,fx as A,iR as B,yh as C,Nk as D,Oy as E,f_ as F,d_ as G,Pr as H,HV as I,em as J,Jp as K,Pi as L,KV as M,vp as N,Wc as O,Ka as P,$V as Q,Qa as R,yl as S,Ya as T,na as U,l_ as V,ZV as W,Ec as X,ph as Y,c5 as Z,Yo as _,Dt as a,eV as a$,I6 as a0,hx as a1,WV as a2,Ja as a3,r6 as a4,FN as a5,WN as a6,a5 as a7,Ik as a8,kN as a9,C6 as aA,D6 as aB,L6 as aC,KF as aD,d6 as aE,n6 as aF,l6 as aG,y6 as aH,JV as aI,W1 as aJ,t6 as aK,a6 as aL,u6 as aM,S6 as aN,M6 as aO,R6 as aP,b6 as aQ,e6 as aR,x6 as aS,m6 as aT,g6 as aU,k6 as aV,p6 as aW,v6 as aX,f6 as aY,s6 as aZ,XC as a_,i6 as aa,sN as ab,o6 as ac,XV as ad,w6 as ae,h6 as af,_6 as ag,g5 as ah,YV as ai,WF as aj,T6 as ak,O6 as al,EI as am,r4 as an,OF as ao,c6 as ap,SN as aq,A6 as ar,P6 as as,z6 as at,E6 as au,NN as av,BN as aw,QV as ax,zF as ay,AN as az,gl as b,AV as b$,iF as b0,Nc as b1,tV as b2,To as b3,Oi as b4,zh as b5,jc as b6,Gc as b7,hi as b8,nt as b9,DV as bA,LV as bB,pV as bC,UV as bD,NV as bE,sV as bF,eF as bG,QU as bH,JB as bI,MV as bJ,BV as bK,lV as bL,tF as bM,dV as bN,iV as bO,rV as bP,aV as bQ,bV as bR,xV as bS,Ni as bT,Yp as bU,zV as bV,TV as bW,EV as bX,IV as bY,MF as bZ,SV as b_,P1 as ba,gF as bb,yr as bc,Hh as bd,Xp as be,s_ as bf,Ey as bg,Kp as bh,wy as bi,F1 as bj,Oh as bk,Ty as bl,vc as bm,xi as bn,RF as bo,PF as bp,kc as bq,Tt as br,KU as bs,hO as bt,Li as bu,Rn as bv,XU as bw,YU as bx,Th as by,QB as bz,yt as c,_F as c0,VV as c1,nV as c2,gV as c3,_V as c4,uV as c5,hV as c6,PV as c7,RV as c8,fV as c9,mV as ca,SF as cb,AC as cc,JU as cd,OV as ce,FV as cf,CV as cg,GV as ch,HU as ci,wV as cj,vV as ck,yV as cl,cV as cm,kV as cn,oV as co,AF as cp,jV as cq,Uk as cr,_r as d,tt as e,_t as f,gr as g,mt as h,_l as i,Hr as j,st as k,e2 as l,bn as m,pn as n,wp as o,gn as p,_n as q,un as r,ia as s,wt as t,Sp as u,mh as v,Pe as w,Fi as x,Gn as y,_5 as z};
